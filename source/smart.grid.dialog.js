
/* Smart UI v11.0.5 (2021-12-02) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart.Utilities.Assign("Grid.Dialog",class{_openImagePreviewDialog(e){const t=this;e=e.cloneNode(),t._dialogImagePreview||(t._dialogImagePreview=t._createDialog({modal:!0,screenModal:!0,left:"screenMiddle",top:"screenCenter",width:"80%",height:"80%"})),t._dialogImagePreview.content.innerHTML="",t._dialogImagePreview.content.appendChild(e),t._dialogImagePreview.btnClose.onclick=e=>{t._dialogImagePreview.close(),e.preventDefault(),e.stopPropagation()},e.style.marginLeft="auto",e.style.marginRight="auto",e.style.maxWidth="",e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const l=150+Math.min(850,e.width),a=150+Math.min(650,e.height);t._dialogImagePreview.style.width=l+"px",t._dialogImagePreview.style.height=a+"px",t._dialogImagePreview.style.left="calc(50% - "+Math.min(850,t._dialogImagePreview.offsetWidth/2)+"px)",t._dialogImagePreview.style.top="calc(50% - "+Math.min(650,t._dialogImagePreview.offsetHeight/2)+"px)";const i=getComputedStyle(t._dialogImagePreview),o=parseInt(i.top),n=parseInt(i.left);(window.offsetWidth<l||window.offsetHeight<a||o<0||n<0)&&(t._dialogImagePreview.style.left="0px",t._dialogImagePreview.style.top="0px",t._dialogImagePreview.style.width="100%",t._dialogImagePreview.style.height="100%"),e.style.maxWidth="100%"},t._dialogImagePreview.content.onpointerdown=t._dialogImagePreview.content.onpointerup=e=>{e.preventDefault(),e.stopPropagation()},t._dialogImagePreview.onkeydown=function(e){"Escape"===e.key&&t._dialogImagePreview.close()},t._dialogImagePreview.btnClose.tabIndex=0,t._dialogImagePreview.onOpen=()=>{setTimeout((()=>{t._dialogImagePreview.btnClose.focus()}),100)},t._dialogImagePreview.footer.remove(),t._dialogImagePreview.header.parentNode.style.backgroundColor="var(--smart-background)",t._dialogImagePreview.open()}_openImageDialog(e,t){const l=this,a=l._dialogImage||l._createDialog(),i='<span class="smart-grid-icon smart-icon-image show"></span>'+l.localize("dialogImageHeader");if(a.cell||(a.cell=e),a.header.innerHTML=i,a.column=e.column,a.command=t,a.classList.add("smart-grid-image-dialog"),!l._dialogImage){a.modal=!0,a.btnConfirm.innerHTML=l.localize("dialogEditButtonConfirm"),a.btnCancel.innerHTML=l.localize("dialogEditButtonCancel"),a.onOpen=function(){a.fileUpload.value="",a.input.value="";let e=a.cell.editor.instance.getValue();if("[]"!==e)if(e&&"string"==typeof e&&e.indexOf("http")>=0)a.input.value=JSON.parse(e)[0].value,a.tabs[1].click(),o("input");else{a.tabs[0].click();const t=(e,t)=>{let l=e.split(","),a=l[0].match(/:(.*?);/)[1],i=atob(l[1]),o=i.length,n=new Uint8Array(o);for(;o--;)n[o]=i.charCodeAt(o);return new File([n],t,{type:a})},l=new DataTransfer;"string"==typeof e&&e.indexOf("base64")>=0&&(e=JSON.parse(e)),Array.isArray(e)&&(e.forEach((e=>{l.items.add(t(e.value,e.label))})),a.fileUpload.files=l.files,o())}else a.tabs[0].click()},a.onClose=function(){},a.btnCancel.onclick=function(){a.close()},a.btnClose.onclick=function(){a.close()},a.btnConfirm.onclick=function(){if(a.tabs[1].classList.contains("active"))a.input.value?e.editor.instance.setValue([{label:a.input.value,value:a.input.value}]):e.editor.instance.setValue([]),l._endCellEdit(a.cell);else{const t=(e,t)=>{var l=new FileReader;l.readAsDataURL(e),l.onload=function(){t(l.result)},l.onerror=function(){t("error")}},i=[];if(a.fileUpload.files.length)for(let o=0;o<a.fileUpload.files.length;o++){const n=a.fileUpload.files[o];t(n,(t=>{"error"===t&&console.log("Image load error"),i.push({value:t,label:n.name}),i.length===a.fileUpload.files.length&&(e.editor.instance.setValue(i),l._endCellEdit(a.cell))}))}else e.editor.instance.setValue([]),l._endCellEdit(a.cell)}a.close()},a.onkeydown=function(e){"Escape"===e.key&&a.close()},l._dialogImage=a,a.content.innerHTML=`\n                <div>\n                    <div>\n                        <div class="tabs">\n                            <div class="active tab">\n                                <span class="smart-grid-icon smart-icon-plus show"></span><label>${l.localize("dialogImageDevice")}</label>\n                            </div>\n                            <div class="tab">\n                                <span class="smart-grid-icon smart-icon-link show"></span><label>${l.localize("dialogImageLink")}</label>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="smart-grid-drop-zone">\n                         <div>\n                            <div class="title"><span class="smart-grid-icon smart-icon-plus show"></span><label>${l.localize("dialogImageUpload")}</label></div>\n                            <div class="subtitle"><span class="smart-grid-icon smart-icon-docs show"></span><label>${l.localize("dialogImageDrop")}</label></div>\n                         </div> \n                         <input accept=".jpg, .jpeg, .png" type="file" multiple="multiple" style="display: none;">\n                    </div>\n                    <div class="smart-hidden url-zone">\n                        <div class="url-title">\n                        ${l.localize("dialogImageURL")}\n                        </div>\n                        <div class="upload">\n                            <smart-input placeholder="https://example.com/image.png" class="underlined"></smart-input>\n                            <br/>\n                            <smart-button disabled class="success">${l.localize("dialogImageURLUpload")}</smart-button>\n                        </div>\n                    </div>\n                    <div class="preview">\n                    </div>\n                    <br/>\n                </div>`,a.input=a.querySelector("smart-input"),a.dropZone=a.querySelector(".smart-grid-drop-zone"),a.upload=a.querySelector(".title"),a.fileUpload=a.querySelector("input"),a.preview=a.querySelector(".preview"),a.tabs=a.querySelectorAll(".tab"),a.urlZone=a.querySelector(".url-zone"),a.uploadButton=a.querySelector("smart-button");const t=["image/apng","image/bmp","image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon"],i=e=>t.includes(e.type);a.dropZone.ondrop=e=>{if(e.preventDefault(),e.dataTransfer.items){let t=0;for(let l=0;l<e.dataTransfer.items.length;l++)if("file"===e.dataTransfer.items[l].kind){const a=e.dataTransfer.items[l].getAsFile();i(a)&&t++}if(t===e.dataTransfer.files.length){const t=new DataTransfer,l=[...e.dataTransfer.files];[...a.fileUpload.files].forEach((e=>{t.items.add(e)})),l.forEach((e=>{t.items.add(e)})),a.fileUpload.files=t.files,o()}}else a.fileUpload.files=e.dataTransfer.files,o()},a.dropZone.ondragover=e=>{e.preventDefault()},a.tabs[0].onclick=()=>{a.tabs[0].classList.add("active"),a.tabs[1].classList.remove("active"),a.dropZone.classList.remove("smart-hidden"),a.urlZone.classList.add("smart-hidden"),a.updatePreview()},a.tabs[1].onclick=()=>{a.tabs[0].classList.remove("active"),a.tabs[1].classList.add("active"),a.dropZone.classList.add("smart-hidden"),a.urlZone.classList.remove("smart-hidden"),a.updatePreview("input")},a.uploadButton.onclick=()=>{a.updatePreview("input")};const o=e=>{const t=a.preview,n=a.fileUpload;function d(e){return e<1024?e+"bytes":e>=1024&&e<1048576?(e/1024).toFixed(1)+"KB":e>=1048576?(e/1048576).toFixed(1)+"MB":void 0}for(;t.firstChild;)t.removeChild(t.firstChild);const r=()=>{const e=document.createElement("div");return e.classList.add("item"),e.onpointerdown=t=>{const i=e.getBoundingClientRect();if(a.input.value="",t.clientY>=i.bottom-12){if(t.clientX>i.left+i.width/2-13&&t.clientX<i.left+i.width/2+13){e.remove();const t=a.preview.querySelectorAll(".item"),l=new DataTransfer;t.forEach((e=>{l.items.add(e.file)})),n.files=l.files,a.clearButton&&0===t.length&&a.clearButton.classList.remove("show")}}else l._openImagePreviewDialog(e.querySelector("img"))},e},s=()=>{const e=document.createElement("div");e.classList.add("list");const i=document.createElement("div");i.classList.add("smart-grid-icon","show","smart-icon-delete"),i.title=l.localize("clear"),t.appendChild(i),i.onclick=()=>{n.value="",a.input.value="",o()},a.clearButton=i,t.appendChild(e)};if("input"===e){const e=a.input.value;if(e){const t=r();if(s(),e.endsWith("png")||e.endsWith("jpeg")||e.endsWith("jpg")){const l=document.createElement("img");l.src=e,t.appendChild(l)}a.preview.lastChild.appendChild(t)}else{const e=document.createElement("p");e.textContent=l.localize("dialogImageFileUpload"),t.appendChild(e)}}else{const e=n.files;if(0===e.length){const e=document.createElement("p");e.textContent=l.localize("dialogImageFileUpload"),t.appendChild(e)}else{s();const o=new DataTransfer;for(const n of e){const e=r(),s=document.createElement("div");if(i(n)){s.textContent=`${n.name}, ${d(n.size)}.`,s.textContent.length>20&&(s.textContent=`${n.name.substring(0,5)}...${n.name.substring(n.name.length-4)}, ${d(n.size)}.`);const a=document.createElement("img");if(a.src=URL.createObjectURL(n),n.size>2097152){const e=document.createElement("p");e.textContent=l.localize("dialogImageSize",{value:n.name}),t.appendChild(e);continue}o.items.add(n),e.file=n,e.title=s.textContent,e.appendChild(a),e.appendChild(s)}a.preview.querySelector(".list").appendChild(e)}n.files=o.files}}};a.updatePreview=o,a.fileUpload.onchange=()=>{if(0===a.fileUpload.files.length&&a._tempFiles)a.fileUpload.files=a._tempFiles;else if(a._tempFiles){const e=new DataTransfer,t=[...a.fileUpload.files];[...a._tempFiles].forEach((t=>{e.items.add(t)})),t.forEach((t=>{e.items.add(t)})),a.fileUpload.files=e.files}o()},a.input.onchange=a.input.onblur=a.input.onkeyup=()=>{a.uploadButton.disabled=!a.input.value||!a.input.value.startsWith("https://")},a.upload.onclick=()=>{a._tempFiles=[];const e=new DataTransfer;[...a.fileUpload.files].forEach((t=>{e.items.add(t)})),a._tempFiles=e.files,a.fileUpload.click()}}a.open(),setTimeout((function(){a.btnConfirm.focus()}),100)}_createOverlay(){const e=document.createElement("div");return e.onpointerdown=function(){return!1},e.onmousedown=function(){return!1},e.onclick=function(){},e.classList.add("smart-grid-dialog-overlay"),e}_createDialog(e){const t=this;let l=document.createElement("div");e||(e=t.editing.dialog),void 0!==e.modal&&(l.modal=e.modal),void 0!==e.screenModal&&(l.screenModal=e.screenModal),l.setAttribute("animation","none"),l.classList.add("smart-window","smart-grid-dialog"),l.style.width="auto"===e.width?e.width:e.width+"px",l.style.height="auto"===e.height?e.height:e.height+"px",e.width&&"string"==typeof e.width&&(l.style.width=e.width),e.height&&"string"==typeof e.height&&(l.style.height=e.height),l.style.left="",l.style.top="",l.innerHTML='<div class="smart-container">\n                   <div class ="smart-content-container" smart-id="container">\n                        <div id="headerSection" class="smart-header-section">\n                            <div class="smart-header"></div>\n                            <div class="smart-buttons-container">\n                            <button tabindex=-1 class ="smart-hidden smart-button smart-element smart-prev-button" aria-label="Previous Record" smart-id="prevButton"></button>\n                            <button tabindex=-1 class ="smart-hidden smart-button smart-element smart-next-button" aria-label="Next Record" smart-id="nextButton"></button>\n                            <button class ="smart-button smart-element smart-close-button" aria-label="Close" smart-id="closeButton"></button>\n                            </div>\n                        </div>\n                        <div class="smart-content"><div class="smart-content-container"></div></div>\n                        <div class ="smart-footer">\n                            <div class ="smart-stack-layout right spacing">\n                                <smart-button class ="smart-confirm-button item primary">Ok</smart-button>\n                                <smart-button class ="smart-cancel-button item">Cancel</smart-button>\n                            </div>\n                        </div>\n                    </div>\n              </div>\n            ',l.querySelector&&l.querySelector(".smart-content")&&(l.content=l.querySelector(".smart-content").firstChild),l.footer=l.querySelector(".smart-footer"),l.header=l.querySelector(".smart-header"),l.btnConfirm=l.querySelector(".smart-confirm-button"),l.btnCancel=l.querySelector(".smart-cancel-button"),l.btnClose=l.querySelector(".smart-close-button"),l.btnNext=l.querySelector(".smart-next-button"),l.btnPrev=l.querySelector(".smart-prev-button");const a=document.createElement("div");return a.classList.add("smart-grid-dialog-overlay"),a.onclick=function(){},l.overlay=a,l.remove=function(){l.parentNode&&l.parentNode.removeChild(l)},l.close=function(){l.classList.remove("open"),l.addEventListener("transitionend",l.remove),l.addEventListener("transitioncancel",l.remove),l.modal&&l.overlay.parentNode&&l.overlay.parentNode.removeChild(l.overlay),l.onClose&&l.onClose()},l.open=function(a,i){l.removeEventListener("transitionend",l.remove),l.removeEventListener("transitioncancel",l.remove),document.body.appendChild(l),a||(a=e.left),i||(i=e.top),requestAnimationFrame((function(){l.classList.add("open");const e=function(e,a){const i=t.offset(t);switch("center"===e&&"horizontal"===a&&(e="middle"),e){case"top":return i.top;case"bottom":return Math.max(i.top,i.top+t.offsetHeight-l.offsetHeight);case"center":return Math.max(i.top,i.top+t.offsetHeight/2-l.offsetHeight/2);case"left":return i.left;case"middle":return i.left+t.offsetWidth/2-l.offsetWidth/2;case"right":return i.left+t.offsetWidth-l.offsetWidth}return"horizontal"===a?parseInt(e)+i.left:"vertical"===a?parseInt(e)+i.top:"number"==typeof e?e:parseInt(e)};l.style.left=e(a,"horizontal")+"px",l.style.top=e(i,"vertical")+"px","screenMiddle"===a&&(l.style.left="calc(50% - "+l.offsetWidth/2+"px)"),"screenCenter"===i&&(l.style.top="calc(50% - "+l.offsetHeight/2+"px)")})),l.modal&&(l.screenModal?document.body.appendChild(l.overlay):t.appendChild(l.overlay)),l.onOpen&&l.onOpen()},l}_openAddRowDialog(e,t){const l=this;if(!l.editing.addDialog.enabled)return!1;const a=l._dialogAddRow||l._createDialog(),i="{{message}}"===l.editing.dialog.header?l.localize("dialogAddHeader"):l.editing.dialog.header,o=a.content;a.header.innerHTML=i,e.grid=l,void 0===e.index&&(e.index=l.rows.length,l._rowsAdded&&(e.index+=l._rowsAdded.length));const n=e.cells;let d=null,r=0;if(l._cellEditors||(l._cellEditors=[]),!l._dialogAddRow){a.modal=!0,a.btnConfirm.innerHTML=l.localize("dialogAddButtonConfirm"),a.btnCancel.innerHTML=l.localize("dialogAddButtonCancel"),a.onOpen=function(){l.editing.dialog.visible=!0},a.onClose=function(){l.editing.dialog.visible=!1},a.btnCancel.onclick=function(){a.close()},a.btnClose.onclick=function(){a.close()},a.btnConfirm.onclick=function(){const e={};for(let t=0;t<n.length;t++){const a=n[t],i=l._getEditorValue(a),o=l._getEditorId(a),d=l._cellEditors[o];d&&(i&&i.error?(e[a.column.dataField]=i.value,d.detach()):(e[a.column.dataField]=i,d.detach()))}const i=l._rowsAdded?l._rowsAdded.length:0,o=new Smart.Grid.Row({index:l.rows.length+i,id:Smart.Utilities.Core.createGUID(),grid:l,data:e});a.close(),t(o,0===a.index)},a.onkeydown=function(e){const t=e.key;"Enter"===t?a.btnConfirm.onclick():"Escape"===t&&a.close()},o.classList.add("smart-grid-layout");for(let e=0;e<l.columns.length;e++){const t=l.columns[e];if(!t.allowEdit)continue;r%2==0&&(d=document.createElement("div"),d.classList.add("row"),o.appendChild(d));const a=document.createElement("div");a.classList.add("col-sm-6");const i=document.createElement("div");i.classList.add("column");const n=document.createElement("label");n.innerHTML=l.columns[e].label;const s=document.createElement("div");s.classList.add("smart-grid-dialog-editor"),s.setAttribute("editor",t.dataField),s.setAttribute("template",t.editor.template),a.appendChild(i),d.appendChild(a),i.appendChild(n),i.appendChild(s),r++}}a.open(),a.index=e.index;let s=0;for(let e=0;e<n.length;e++){const t=n[e],i=t.column,o=i.dataField,d=a.querySelector("[editor="+o+"]");if(!d)continue;d.innerHTML="";let r="";void 0!==t.value&&(r=t.value),"int64"!==i.dataType&&"number"!==i.dataType&&"int"!==i.dataType&&"float"!==i.dataType||(r=0),"date"===i.dataType&&(r=new Date),"bool"!==i.dataType&&"boolean"!==i.dataType||(r=!1);let c=null;switch(t.editor.template){default:case"custom":c=l._getCustomCellEditor(t);break;case"image":c=l._getImageCellEditor(t);break;case"checkBox":c=l._getCheckBoxCellEditor(t);break;case"autoComplete":c=l._getAutoCompleteCellEditor(t);break;case"dropDownList":c=l._getAutoCompleteCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"comboBox":c=l._getAutoCompleteCellEditor(t),c.readonly=!1,c.dropDownButtonPosition="right";break;case"maskedTextBox":c=l._getMaskCellEditor(t);break;case"checkInput":c=l._getCheckInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiInput":c=l._getMultiInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiComboInput":c=l._getMultiComboInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"time":case"timeInput":c=l._getTimeInputCellEditor(t);break;case"date":case"dateInput":c=l._getDateInputCellEditor(t);break;case"dateRangeInput":c=l._getDateRangeInputCellEditor(t);break;case"dateTimePicker":c=l._getDateTimePickerCellEditor(t);break;case"textArea":case"textarea":c=l._getTextAreaCellEditor(t);break;case"numberInput":case"text":case"input":c="numberInput"===t.editor.template?l._getNumberInputCellEditor(t):l._getInputCellEditor(t)}if(c.attach(),t.editor.instance=c,c.setValue(r),0===s&&setTimeout((()=>{c.focus()}),100),!t.editor.isInitialized&&(t.editor.isInitialized=!0,t.editor.onInit)){const e=t.editor.onInit(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const l="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)l[t]=e[t]}));else if(e){const l=e,a="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in l)a[e]=l[e]}}if(t.editor.onRender){const e=t.editor.onRender(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const l="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)l[t]=e[t]}));else if(e){const l=e,a="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in l)a[e]=l[e]}}d.appendChild(c.element),c.element.onfocus=()=>{d.setAttribute("focus","")},c.element.onblur=()=>{d.removeAttribute("focus")},s++}l._dialogAddRow=a}_openEditDialog(e,t){const l=this;if(!l.editing.dialog.enabled)return!1;const a=l._dialogEdit||l._createDialog(),i="{{message}}"===l.editing.dialog.header?l.localize("dialogEditHeader",{value:l.editing.editRow?e.row.visibleIndex+1:e.column.label}):l.editing.dialog.header,o=a.content;a.header.innerHTML=i,a.row=l.editing.editRow,l.editing.recordNavigation&&a.classList.add("disable-animation");let n=null,d=0;if(void 0!==l._settingsDialogRowId){a.btnPrev.classList.remove("smart-hidden"),a.btnNext.classList.remove("smart-hidden");const e=e=>{const t=l.editing.editRow,i=l._recyclingRows.indexOf(t),o=e?l._recyclingRows[i+1]:l._recyclingRows[i-1];if(o){a.classList.add("disable-animation"),l.editing.recordNavigation=!0;const e=a.querySelector("[focus]");if(e){const t=e.closest(".row"),a=t.closest(".smart-grid-edit-dialog-editors-container");let i=-1;if(a&&(i=[...a.children].indexOf(t)),l.cancelEdit(),l._openRowSettingsDialog(o.id),l._dialogEdit&&i>=0){const e=l._dialogEdit.querySelectorAll(".row")[i];if(e){const t=e.querySelector(".smart-grid-dialog-editor");t.setAttribute("focus",""),t.querySelector(".smart-grid-cell-editor").focus()}}}else l.cancelEdit(),l._openRowSettingsDialog(o.id)}};a.btnNext.onmousedown=t=>{e(!0),t.preventDefault(),t.stopPropagation()},a.btnPrev.onmousedown=t=>{e(!1),t.preventDefault(),t.stopPropagation()}}if(!l._dialogEdit)if(a.modal=!0,a.btnConfirm.innerHTML=l.localize("dialogEditButtonConfirm"),a.btnCancel.innerHTML=l.localize("dialogEditButtonCancel"),a.onOpen=function(){l.editing.dialog.visible=!0,l._settingsDialogRowId&&a.editorsContent&&a.editorsContent.offsetHeight&&(a.editorsContent.style.maxHeight=a.editorsContent.offsetHeight+40+"px")},a.onClose=function(){l.editing.dialog.visible=!1,a.row&&(a.row.showDetail=!1)},a.btnCancel.onclick=function(){l.cancelEdit()},a.btnClose.onclick=function(){l.cancelEdit()},a.btnConfirm.onclick=function(){if(void 0!==l._settingsDialogRowId){if(l.rowById[l._settingsDialogRowId]){const e=l.editing.editRow;if(!e)return!1;const t=e.cells;let i={};e.element.removeAttribute("error");for(let e=0;e<t.length;e++){const a=t[e],o=l._getEditorValue(a);i[a.column.dataField]=o}const o=l.validateRow(e.id,i);if(Object.keys(o).length>0){let e=!0;for(let i=0;i<t.length;i++){const n=t[i],d=o[n.column.dataField],r=a.querySelector(`[label-for="${n.column.dataField}"]`);if(r&&(r.innerHTML=""),d)for(let t in d){const a=d[t];let i="";if(!a)continue;let o=a[t];"minLength"!==t&&"maxLength"!==t||(o=a[t.toLowerCase()]),i=a.message?a.message:"required"===t?l.localize("requiredValue",{value:n.column.label}):"min"===t?l.localize("invalidMinValue",{value:n.column.label,min:o.min}):"max"===t?l.localize("invalidMaxValue",{value:n.column.label,max:o.max}):"minLength"===t?l.localize("invalidMinLengthValue",{value:n.column.label,min:o.requiredLength}):"maxLength"===t?l.localize("invalidMaxLengthValue",{value:n.column.label,max:o.requiredLength}):l.localize("invalidValue"),e=!1,r&&(r.innerHTML=i)}}if(!e)return}a._userData._changed=!0,e._userData=a._userData}if(a.columnVisibility){let e=!1;const t=l.columns.canNotify;l.columns.canNotify=!1;for(let t in a.columnVisibility){const i=l.columnByDataField[t];i.visible!==a.columnVisibility[t]&&(i.visible=a.columnVisibility[t],e=!0)}if(l.columns.canNotify=t,e)return l.endEdit(),void l.refresh(!1)}}l.endEdit()},a.onkeydown=function(e){const t=e.key,a=l.editing.commandKeys;for(let e in a){const i=a[e];if(t===i.key){l._applyCommand(i.command);break}}},l.editing.editRow)if(void 0!==l._settingsDialogRowId)l._applySettingsDialogLayout(a,o,l.editing.editRow);else{o.classList.add("smart-grid-layout");for(let e=0;e<l.columns.length;e++){const t=l.columns[e];if(!t.allowEdit)continue;d%2==0&&(n=document.createElement("div"),n.classList.add("row"),o.appendChild(n));const a=document.createElement("div");a.classList.add("col-sm-6");const i=document.createElement("div");i.classList.add("column");const r=l._settingsDialogRowId?document.createElement("div"):document.createElement("label");r.innerHTML=l.columns[e].label;const s=document.createElement("div");s.classList.add("smart-grid-dialog-editor"),s.setAttribute("editor",t.dataField),s.setAttribute("template",t.editor.template),a.appendChild(i),n.appendChild(a),i.appendChild(r),i.appendChild(s),d++}}else{const t=e.column,l=document.createElement("div");l.classList.add("smart-grid-dialog-editor"),l.setAttribute("editor",""),l.setAttribute("template",t.editor.template),o.appendChild(l)}if(a.open(),l.editing.editRow){const l=a.querySelector("[editor="+e.column.dataField+"]");l.innerHTML="",l.appendChild(t.element),t.element.onfocus=()=>{l.setAttribute("focus","")},t.element.onblur=()=>{l.removeAttribute("focus")}}else{const l=e.column,i=a.querySelector("[editor]");i.innerHTML="",i.setAttribute("template",l.editor.template),i.appendChild(t.element),t.element.onfocus=()=>{i.setAttribute("focus","")},t.element.onblur=()=>{i.removeAttribute("focus")}}l._dialogEdit=a}_refreshCurrentUser(){const e=this,t=e.users;let l=e.currentUser,a=!0,i=!0,o=e.editing.enabled,n=!0;t&&null!==l&&(l=t.find((e=>e.id===l)),l&&(a=!1!==l.allowAdd,i=!1!==l.allowComment,o=o&&!1!==l.allowEdit,n=!1!==l.allowRemove)),e._currentUser={allowAdd:a,allowComment:i,allowEdit:o,allowRemove:n,info:l}}_getColorInput(){const e=document.createElement("smart-color-input");return e.dataSource=["#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161","#FFFFFF","#000000",""],e.valueDisplayMode="colorBox",e.classList.add("underlined","smart-grid-color-input"),e.style.width="auto",e.readonly=!0,e.onRender=()=>{const t=e.$.scrollView;t&&t.classList.add("smart-grid-color-input")},e}_applySettingsDialogLayout(e,t,l){const a=this;e.classList.add("smart-grid-dialog-expand-row");const i=[];e.columnVisibility=i;const o=document.createElement("div"),n=document.createElement("div"),d=document.createElement("div");d.appendChild(o),d.appendChild(n),t.appendChild(d),d.classList.add("smart-grid-edit-dialog-layout"),o.classList.add("smart-grid-edit-dialog-editors-container"),n.classList.add("smart-grid-edit-dialog-activity-container"),a.columns.length>=8&&o.classList.add("many"),e.editorsContent=o,e.activityContent=n;const r=document.createElement("div"),s=document.createElement("div");n.appendChild(r),n.appendChild(s),r.innerHTML=`\n            <div class="row"><div class="column"><div class="header smart-grid-edit-dialog-column-info">${a.localize("format").replace(":","")}\n            <span title="${a.localize("resetFormat")}" class="reset-format smart-grid-icon smart-icon-reload show"></span>\n            </div>\n             </div>\n            <div class="format-layout">\n                    <div title="${a.localize("background")}" class="format smart-grid-edit-dialog-column-info">\n                        <span class="smart-grid-icon smart-icon-color-background show"></span><div class="background"></div>\n                    </div>\n                    <div title="${a.localize("color")}" class="format smart-grid-edit-dialog-column-info">\n                        <span style="border-bottom: 2px solid #46CA78;" color="#46CA78" class="format smart-grid-icon smart-icon-font show"></span><div class="color"></div>\n                    </div>\n                    <div class="format-layout button-group">\n                        <span title="${a.localize("bold")}" class="formatbtn bold smart-grid-icon smart-icon-bold show"></span>\n                        <span title="${a.localize("italic")}" class="formatbtn italic smart-grid-icon smart-icon-italic show"></span>\n                        <span title="${a.localize("underline")}" class="formatbtn underline smart-grid-icon smart-icon-underline show"></span>\n                    </div>\n            </div>\n           <div class="format-layout font-group">\n                <div title="${a.localize("fontFamily").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                <span class="smart-grid-icon smart-icon-font show"></span><div class="font-family"></div>\n                </div>\n                <div title="${a.localize("fontSize").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                    <span class="smart-grid-icon smart-icon-fontsize show"></span><div class="font-size"></div>\n                </div>\n           </div>\n            <div class="format-layout font-group">\n                <div title="${a.localize("status").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                <span color="#F1C58B" class="smart-grid-icon smart-icon-star show"></span><div class="status"></div>\n                </div>\n            </div>\n            <div class="column"><div class="comments-header smart-grid-edit-dialog-column-info">${a.localize("comments").replace(":","")}</div></div>\n            <div class="comments-layout">\n                <div class="comments"><span class="no-comments">${a.localize("noComments")}</span></div>\n                <div class="footer">\n                    <smart-text-area hint="${a.localize("comment")}" placeholder="${a.localize("comment")}" class="success underlined"></smart-text-area>\n                    <smart-button class="success">${a.localize("send")}</smart-button>\n                </div>\n            </div>\n        `;const c=e._userData=JSON.parse(JSON.stringify(l._userData)),m=a._getColorInput();r.querySelector(".background").appendChild(m),m.onchange=()=>{c.background=m.value},c.background&&(m.value=c.background);const u=a._getColorInput();r.querySelector(".color").appendChild(u),u.onchange=()=>{c.color=u.value},c.color&&(u.value=c.color);const p=a._getColorInput();r.querySelector(".status").appendChild(p),p.onchange=()=>{c.status=p.value},c.status&&(p.value=c.status);const g=document.createElement("smart-input");g.style.width="auto",g.classList.add("underlined"),g.dropDownButtonPosition="right",g.readonly=!0,g.dropDownHeight="auto",g.dataSource=["-","Segoe UI","Arial","Georgia","Impact","Tahoma","Times New Roman","Verdana"],g.onchange=()=>{c.fontFamily=g.value},c.fontFamily?g.value=c.fontFamily:g.selectedIndex=0,r.querySelector(".font-family").appendChild(g);const f=document.createElement("smart-input");f.style.width="auto",f.classList.add("underlined"),f.dropDownButtonPosition="right",f.readonly=!0,f.dropDownHeight="auto",f.dataSource=["-","8px","10px","12px","14px","18px","24px","36px"],f.onchange=()=>{c.fontSize=f.value},c.fontSize?f.value=c.fontSize:f.selectedIndex=0,r.querySelector(".font-size").appendChild(f);const b=r.querySelector(".button-group");b.onclick=e=>{const t=e.target.closest(".formatbtn");let l;t.classList.contains("checked")?(t.classList.remove("checked"),l=!1):(t.classList.add("checked"),l=!0),t.classList.contains("bold")?c.fontWeight=l?"bold":null:t.classList.contains("italic")?c.fontStyle=l?"italic":null:t.classList.contains("underline")&&(c.textDecoration=l?"underline":null)},c.fontWeight?b.children[0].classList.add("checked"):b.children[0].classList.remove("checked"),c.fontStyle?b.children[1].classList.add("checked"):b.children[1].classList.remove("checked"),c.textDecoration?b.children[2].classList.add("checked"):b.children[2].classList.remove("checked"),r.querySelector(".reset-format").onclick=()=>{for(let e=0;e<b.children.length;e++)b.children[e].classList.remove("checked");g.selectedIndex=0,f.selectedIndex=0,u.value="",m.value="",p.value="",c.fontWeight=null,c.fontStyle=null,c.textDecoration=null,c.fontSize=null,c.fontFamily=null};const h=r.querySelector(".comments-header"),v=r.querySelector(".comments-layout smart-text-area"),y=r.querySelector(".comments-layout smart-button"),C=r.querySelector(".comments-layout .footer"),w=r.querySelector(".comments-layout .comments");y.disabled=!0,w.innerHTML=`<span class="no-comments">${a.localize("noComments")}</span>`;const x=()=>{const e=w.querySelector(".no-comments");0===c.comments.length?e.classList.remove("smart-hidden"):e.classList.add("smart-hidden")},A=e=>{e.querySelector(".remove-button").onclick=e=>{const t=e.target,l=c.comments.indexOf(t.comment);l>-1&&(c.comments.splice(l,1),t.element.remove(),h.innerHTML=`${a.localize("comments").replace(":","")} (${c.comments.length})`)}};for(let e=0;e<c.comments.length;e++){const t=c.comments[e],l=a._createComment(t);A(l),w.appendChild(l)}h.innerHTML=`${a.localize("comments").replace(":","")} (${c.comments.length})`,x(),v.onfocus=()=>{C.classList.add("focus")},v.onblur=()=>{C.classList.remove("focus")},v.onkeyup=()=>{y.disabled=""===v.value},y.onclick=()=>{if(""===v.value)return;a._refreshCurrentUser();const e={text:v.value,userId:a._currentUser.info?a._currentUser.info.id:-1,time:new Date},t=a._createComment(e);A(t),c.comments.push(e),v.value="",y.disabled=!0,x(),w.appendChild(t),h.innerHTML=`${a.localize("comments").replace(":","")} (${c.comments.length})`};for(let e=0;e<a.columns.length;e++){const t=a.columns[e];if(!t.allowEdit)continue;const l=document.createElement("div");l.classList.add("row"),o.appendChild(l);const n=document.createElement("div"),d=a._settingsDialogRowId?document.createElement("div"):document.createElement("label"),r=t.validationRules&&t.validationRules.length>0?"*":"";d.innerHTML=`<div class="smart-grid-edit-dialog-column-info"><span class="smart-grid-icon ${a.columns[e].icon} show"></span><label>`+a.columns[e].label+r+'</label><span toggle class="smart-grid-icon smart-icon-visibility-on show"</div>';const s=document.createElement("div");s.classList.add("smart-grid-dialog-editor"),s.setAttribute("editor",t.dataField),s.setAttribute("template",t.editor.template);const c=d.querySelector("[toggle]");c.column=t,i[t.dataField]=t.visible,c.title=a.localize("columnMenuItemHide"),c.onclick=()=>{i[c.column.dataField]=!c.column.visible,c.classList.contains("smart-icon-visibility-on")?(c.classList.remove("smart-icon-visibility-on"),c.classList.add("smart-icon-visibility-off"),c.title=a.localize("columnMenuItemShow")):(c.classList.add("smart-icon-visibility-on"),c.classList.remove("smart-icon-visibility-off"),c.title=a.localize("columnMenuItemHide"))},t.visible||(c.classList.remove("smart-icon-visibility-on"),c.title=a.localize("columnMenuItemShow")),t.visible?c.classList.add("smart-icon-visibility-on"):c.classList.add("smart-icon-visibility-off"),n.appendChild(d),n.appendChild(s);const m=document.createElement("label");m.classList.add("smart-field-editor-error-label"),m.setAttribute("label-for",t.dataField),n.appendChild(m),l.appendChild(n)}}_createComment(e){const t=this,l=t.users.find((t=>t.id===e.userId)),a=document.createElement("div"),i=l?l.name||l.id:t.localize("guestUser"),o=l?l.name:t.localize("guestUser"),n=l.image?l.image:"";if(a.className="comment",a.setAttribute("role","listitem"),a.innerHTML=`<div class="comment-indent" role="presentation">\n<div class="user-icon smart-icon" role="img" aria-label="Icon of user ${i}"></div>\n</div>\n<div class="comment-main" role="presentation">\n<div class="comment-header" role="presentation">\n    <div class="user-name" aria-label="User name">${o}</div>\n    <div class="time" aria-label="Comment time">${e.time?new Smart.Utilities.DateTime(e.time).toString(t.formatStringTime):""}</div>\n    <div class="remove-button${t._currentUser.info&&l.id===t._currentUser.info.id&&t._currentUser.allowComment?" enabled":""}" role="button" aria-haspopup="menu" aria-label="Comment settings"></div>\n</div>\n<div class="comment-body" aria-label="Comment text">${e.text||""}</div >\n</div>`,n){const e=a.querySelector(".user-icon");e.style.backgroundImage=`url('${n}')`,e.classList.add("image")}a.comment=e;const d=a.querySelector(".remove-button");return d.comment=e,d.element=a,e.userId!==t._currentUser.info.id&&d.classList.add("smart-visibility-hidden"),a}_openDeleteRowDialog(e,t){const l=this;if(!l.editing.deleteDialog.enabled)return!1;const a=l._dialogDelete||l._createDialog(),i="{{message}}"===l.editing.dialog.header?l.localize("dialogDeleteHeader",{value:e.visibleIndex+1}):l.editing.dialog.header;a.header.innerHTML=i,a.content.innerHTML=l.localize("dialogDeleteContent"),a.row=e,l._dialogDelete||(a.modal=!0,a.btnConfirm.innerHTML=l.localize("dialogDeleteButtonConfirm"),a.btnCancel.innerHTML=l.localize("dialogDeleteButtonCancel"),a.onOpen=function(){l.editing.dialog.visible=!0},a.onClose=function(){l.editing.dialog.visible=!1},a.btnCancel.onclick=function(){a.close()},a.btnClose.onclick=function(){a.close()},a.btnConfirm.onclick=function(){t(a.row),a.close()},a.onkeydown=function(e){"Escape"===e.key&&a.close()},l._dialogDelete=a),a.open(),setTimeout((function(){a.btnConfirm.focus()}),100)}_getAddColumnDialogTemplate(){const e=this,t=(new Date).getFullYear().toString(),l=new Date(t,6,30);return[{bind:"name",type:"input",label:e.localize("dialogAddColumnName"),filter:"any",info:e.localize("dialogAddColumnNameInfo")},{bind:"description",type:"input",label:e.localize("dialogAddColumnDescription"),filter:"any",info:e.localize("dialogAddColumnDescriptionInfo")},{bind:"type",name:"typeslist",type:"dropDownList",filter:"any",label:e.localize("dialogAddColumnType"),icon:"smart-icon-font",options:[{value:"string",prefix:'<span class="smart-grid-icon visible smart-icon-font"></span>',label:e.localize("dialogAddColumnTypeText")},{value:"multiText",prefix:'<span class="smart-grid-icon visible smart-icon-fontsize"></span>',label:e.localize("dialogAddColumnTypeMultilineText")},{value:"image",prefix:'<span class="smart-grid-icon visible smart-icon-image"></span>',label:e.localize("dialogAddColumnTypeImage")},{value:"number",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:e.localize("dialogAddColumnTypeNumber")},{value:"select",prefix:'<span class="smart-grid-icon visible smart-icon-sort-down"></span>',label:e.localize("dialogAddColumnTypeSelect")},{value:"multiSelect",prefix:'<span class="smart-grid-icon visible smart-icon-list-unordered"></span>',label:e.localize("dialogAddColumnTypeMultipleSelect")},{value:"boolean",prefix:'<span class="smart-grid-icon visible smart-icon-check-squared"></span>',label:e.localize("dialogAddColumnTypeCheckBox")},{value:"date",prefix:'<span class="smart-grid-icon visible smart-icon-calendar"></span>',label:e.localize("dialogAddColumnTypeDate")},{value:"createdTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:e.localize("dialogAddColumnTypeCreatedTime")},{value:"modifiedTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:e.localize("dialogAddColumnTypeLastModifiedTime")},{value:"createdBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeCreatedBy")},{value:"modifiedBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeLastModifiedBy")},{value:"collaborator",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeCollaborator")},{value:"slider",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:e.localize("dialogAddColumnTypeSlider")},{value:"autoNumber",prefix:'<span class="smart-grid-icon visible smart-icon-list-ordered"></span>',label:e.localize("dialogAddColumnTypeAutoNumber")},{value:"url",prefix:'<span class="smart-grid-icon visible smart-icon-link"></span>',label:e.localize("dialogAddColumnTypeURL")},{value:"email",prefix:'<span class="smart-grid-icon visible smart-icon-mail"></span>',label:e.localize("dialogAddColumnTypeEmail")},{value:"phone",prefix:'<span class="smart-grid-icon visible smart-icon-phone"></span>',label:e.localize("dialogAddColumnTypePhone")},{value:"password",prefix:'<span class="smart-grid-icon visible smart-icon-lock"></span>',label:e.localize("dialogAddColumnTypePassword")}],info:e.localize("dialogAddColumnTypeInfo")},{bind:"dateFormat",name:"dateformat",type:"dropDownList",label:e.localize("dialogAddColumnDateFormat"),options:[{value:"M/d/yyyy",label:e.localize("dialogAddColumnDateFormatShort")+" ("+new Smart.Utilities.DateTime(l).toString("d")+")"},{value:"dddd, MMMM dd, yyyy",label:e.localize("dialogAddColumnDateFormatLong")+" ("+new Smart.Utilities.DateTime(l).toString("D")+")"},{value:"yyyy-MM-ddTHH:mm:ss.sssZ",label:e.localize("dialogAddColumnDateFormatISO")+"  ("+new Smart.Utilities.DateTime(l).toString("ISO8601")+")"},{value:"d/M/yyyy",label:e.localize("dialogAddColumnDateFormatEU")+" (30/7/"+t+")"},{value:"yyyy-MM-dd",label:e.localize("dialogAddColumnDateFormatAS")+" ("+t+"-30-07)"},{value:"MMMM, dd, yyyy",label:e.localize("dialogAddColumnDateFormatFull")+" (July, 30, "+t+")"}],filter:"date",info:e.localize("dialogAddColumnDateFormatInfo")},{bind:"timeFormat",name:"timeformat",type:"dropDownList",label:e.localize("dialogAddColumnTimeFormat"),filter:"time",width:"50%",options:[{value:"hh:mm",label:"12 "+e.localize("dialogAddColumnTimeFormatHour")},{value:"HH:mm",label:"24 "+e.localize("dialogAddColumnTimeFormatHour")}],info:e.localize("dialogAddColumnTimeFormatInfo")},{bind:"allowTimeFormat",type:"boolean",label:e.localize("dialogAddColumnAllowTimeFormat"),filter:"date",value:!1,info:""},{bind:"allowCustomDateSeparator",type:"boolean",label:e.localize("dialogAddColumnCustomDateSeparator"),filter:"date",value:!1,info:""},{bind:"dateFormatSeparator",name:"dateFormatSeparator",type:"radio",label:"",filter:"date",columns:3,options:[{value:"/",label:e.localize("dialogAddColumnDateFormatSlash")+" (/)"},{value:"-",label:e.localize("dialogAddColumnDateFormatHyphen")+" (-)"},{value:".",label:e.localize("dialogAddColumnDateFormatDot")+" (.)"}]},{bind:"numberFormat",name:"numberFormat",type:"dropDownList",label:e.localize("dialogAddColumnNumberFormat"),filter:"number",options:[{value:{style:"decimal",maximumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatInteger")+" 1,000"},{value:{style:"decimal",minimumFractionDigits:2},label:e.localize("dialogAddColumnNumberFormatNumber")+" 1,000.12"},{value:{style:"percent",minimumFractionDigits:2},label:e.localize("dialogAddColumnNumberFormatPercent")+" 10.12%"},{value:{style:"percent",maximumFractionDigits:0,minimumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatPercentRounded")+" 10%"},{value:{style:"decimal",notation:"scientific"},label:e.localize("dialogAddColumnNumberFormatScientific")+" 1.01E+03"},{value:{style:"decimal",notation:"engineering"},label:e.localize("dialogAddColumnNumberFormatEngineering")+" 34.284 x 10^9"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,currencySign:"accounting"},label:e.localize("dialogAddColumnNumberFormatAccounting")+" $(1,000.12)"},{value:{style:"unit",unit:"kilogram"},label:e.localize("dialogAddColumnNumberFormatUnit")+" 10.12 kg"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency},label:e.localize("dialogAddColumnNumberFormatCurrency")+" $1,000.12"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,maximumFractionDigits:0,minimumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatCurrencyRounded")+"  $1,000"}],required:!1,info:e.localize("dialogAddColumnNumberFormatInfo")},{bind:"unit",name:"unit",type:"dropDownList",filter:"number",required:!1,options:[{value:"acre",label:e.localize("dialogAddColumnNumberFormatUnitAcre")},{value:"percent",label:e.localize("dialogAddColumnNumberFormatUnitPercent")},{value:"degree",label:e.localize("dialogAddColumnNumberFormatUnitDegree")},{value:"megabyte",label:e.localize("dialogAddColumnNumberFormatUnitMegaByte")},{value:"centimeter",label:e.localize("dialogAddColumnNumberFormatUnitCentimeter")},{value:"meter",label:e.localize("dialogAddColumnNumberFormatUnitMeter")},{value:"kilometer",label:e.localize("dialogAddColumnNumberFormatUnitKilometer")},{value:"mile",label:e.localize("dialogAddColumnNumberFormatUnitMile")},{value:"celsius",label:e.localize("dialogAddColumnNumberFormatUnitCelsius")},{value:"fahrenheit",label:e.localize("dialogAddColumnNumberFormatUnitFahrenheit")},{value:"kilogram",label:e.localize("dialogAddColumnNumberFormatUnitKilogram")},{value:"pound",label:e.localize("dialogAddColumnNumberFormatUnitPound")},{value:"liter",label:e.localize("dialogAddColumnNumberFormatUnitLiter")},{value:"gallon",label:e.localize("dialogAddColumnNumberFormatUnitGallon")},{value:"second",label:e.localize("dialogAddColumnNumberFormatUnitSecond")},{value:"minute",label:e.localize("dialogAddColumnNumberFormatUnitMinute")},{value:"hour",label:e.localize("dialogAddColumnNumberFormatUnitHour")},{value:"day",label:e.localize("dialogAddColumnNumberFormatUnitDay")},{value:"week",label:e.localize("dialogAddColumnNumberFormatUnitWeek")},{value:"month",label:e.localize("dialogAddColumnNumberFormatUnitMonth")},{value:"year",label:e.localize("dialogAddColumnNumberFormatUnitYear")}],label:e.localize("dialogAddColumnNumberFormatUnit"),info:e.localize("dialogAddColumnNumberFormatUnitInfo")},{bind:"minLength",name:"minlength",width:"50%",type:"number",filter:"text",required:!1,label:e.localize("dialogAddColumnMinLength"),info:e.localize("dialogAddColumnMinLengthInfo")},{bind:"maxLength",name:"maxlength",width:"50%",filter:"text",type:"number",required:!1,label:e.localize("dialogAddColumnMaxLength"),info:e.localize("dialogAddColumnMaxLengthInfo")},{bind:"minValue",name:"minvalue",width:"50%",filter:"number",type:"number",required:!1,label:e.localize("dialogAddColumnMinValue"),info:e.localize("dialogAddColumnMinValueInfo")},{bind:"maxValue",name:"maxvalue",width:"50%",filter:"number",type:"number",required:!1,label:e.localize("dialogAddColumnMaxValue"),info:e.localize("dialogAddColumnMaxValueInfo")},{bind:"minDateTime",name:"mindatetime",type:"datetime",filter:"date",width:"50%",label:e.localize("dialogAddColumnMinDate"),info:e.localize("dialogAddColumnMinDateInfo")},{bind:"maxDateTime",name:"maxdatetime",type:"datetime",width:"50%",filter:"date",label:e.localize("dialogAddColumnMaxDate"),info:e.localize("dialogAddColumnMaxDateInfo")},{bind:"allowColorItems",type:"boolean",label:e.localize("dialogAddColumnColorItems"),filter:"list, collaborator",value:!0,info:""},{bind:"allowCheckItems",type:"boolean",filter:"hidden",value:!1,label:e.localize("dialogAddColumnCheckItems"),info:""},{bind:"allowMultipleCollaborators",type:"boolean",filter:"collaborator",value:!1,label:e.localize("dialogAddColumnMultipleCollaborators"),info:e.localize("dialogAddColumnMultipleCollaboratorsInfo")},{bind:"options",name:"listitems",type:"items",label:e.localize("dialogAddColumnListItems"),filter:"list",info:""},{bind:"users",name:"users",type:"items",label:e.localize("dialogAddColumnListItems"),filter:"collaborator",info:""},{name:"align",bind:"cellsAlign",type:"dropDownList",label:e.localize("dialogAddColumnAlign"),required:!1,options:[{value:"left",label:e.localize("dialogAddColumnAlignLeft")},{value:"right",label:e.localize("dialogAddColumnAlignRight")},{value:"center",label:e.localize("dialogAddColumnAlignCenter")}],filter:"any",info:e.localize("dialogAddColumnAlignInfo")},{bind:"allowResize",type:"boolean",filter:"any",width:"50%",label:e.localize("dialogAddColumnResizable"),info:e.localize("dialogAddColumnResizableInfo")},{bind:"required",type:"boolean",width:"50%",filter:"text",label:e.localize("dialogAddColumnRequired"),info:e.localize("dialogAddColumnRequiredInfo")},{bind:"allowSort",type:"boolean",width:"50%",filter:"any",label:e.localize("dialogAddColumnSortable"),info:e.localize("dialogAddColumnSortableInfo")},{bind:"allowFilter",type:"boolean",align:"left",width:"50%",filter:"any",label:e.localize("dialogAddColumnFilterable"),info:e.localize("dialogAddColumnFilterableInfo")},{bind:"allowEdit",type:"boolean",width:"50%",filter:"any",label:e.localize("dialogAddColumnEditable"),info:e.localize("dialogAddColumnEditableInfo")}]}_addColumnDialogShowHideEditors(e){const t=this,l=t._dialogAddColumn.querySelector('[bind="type"]').querySelector("smart-input").getSelectedItem().value,a=t._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor");let i=!!e;for(let e=0;e<a.length;e++){const o=a[e],n=o.getAttribute("filter"),d=o.getAttribute("bind"),r=o.parentNode;if(r.classList.add("smart-hidden"),"cellsAlign"!==d||"boolean"!==l&&"image"!==l&&"email"!==l&&"url"!==l&&"collaborator"!==l&&"createdBy"!==l&&"password"!==l&&"phone"!==l&&"createdTime"!==l&&"modifiedBy"!==l&&"modifiedTime"!==l)if("type"===d&&i)r.classList.add("smart-hidden");else if("allowEdit"!==d||!1!==t.editing.enabled&&"autoNumber"!==l&&"createdBy"!==l&&"modifiedBy"!==l&&"createdTime"!==l&&"modifiedTime"!==l)if("allowResize"!==d||"none"!==t.behavior.columnResizeMode)if("allowFilter"!==d||!1!==t.filtering.enabled)if("allowSort"!==d||!1!==t.sorting.enabled)if("required"!==d||!1!==t.editing.enabled&&("string"===l||"multiText"===l))if("any"!==n)switch(l){default:case"text":"text"===n&&r.classList.remove("smart-hidden");break;case"slider":case"number":if("number"===n&&r.classList.remove("smart-hidden"),"unit"===d){r.classList.add("smart-hidden");const e=t._dialogAddColumn.querySelector('[field-name="numberFormat"]'),l=t._dialogAddColumn.querySelector('[field-name="unit"]'),a=e.querySelector("smart-input"),i=()=>{const e=a.getSelectedItem();e&&"unit"===e.value.style?l.classList.remove("smart-hidden"):l.classList.add("smart-hidden")};e.onchange=()=>{i()},i()}break;case"select":case"multiSelect":n.indexOf("list")>=0&&r.classList.remove("smart-hidden");break;case"collaborator":n.indexOf("collaborator")>=0&&r.classList.remove("smart-hidden");break;case"createdBy":case"modifiedBy":case"autoNumber":case"createdTime":case"modifiedTime":case"url":case"email":case"image":case"phone":case"password":case"boolean":break;case"date":{const e=t._dialogAddColumn.querySelector('[field-name="dateFormat"]').querySelector(".smart-input").value;"date"===n&&r.classList.remove("smart-hidden");const l=e=>{const l=t._dialogAddColumn.querySelector('[field-filter="time"]'),a=t._dialogAddColumn.querySelector('[field-name="dateFormat"]');e?(l.classList.remove("smart-hidden"),a.style.width="50%",a.style.float="left"):(l.classList.add("smart-hidden"),a.style.width="",a.style.float="")},a=e=>{const l=t._dialogAddColumn.querySelector('[field-name="allowTimeFormat"]'),a=l.querySelector(".smart-grid-dialog-editor");e.indexOf("T")>=0?(l.classList.add("smart-hidden"),a.uncheck()):l.classList.remove("smart-hidden")},i=e=>{const l=t._dialogAddColumn.querySelector('[field-name="dateFormatSeparator"]');e?l.classList.remove("smart-hidden"):l.classList.add("smart-hidden")};if("allowTimeFormat"===d){const e=o.querySelector(".smart-input").value;o.onchange=e=>{l(e)},l(e)}if("dateFormat"===d){const e=o.querySelector(".smart-input").value;o.onchange=e=>{a(e.detail.value)},a(e)}if("dateFormatSeparator"===d){const e=t._dialogAddColumn.querySelector('[field-name="allowCustomDateSeparator"]').querySelector(".smart-input").value;i(e)}if("allowCustomDateSeparator"===d){e.indexOf("T")>=0&&e.indexOf("-")>0&&o.uncheck();const t=o.querySelector(".smart-input").value;o.onchange=e=>{i(e)},i(t)}a(e);break}}else r.classList.remove("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden")}}_addColumnDialogInitEditors(){const e=this,t=e._dialogAddColumn.editColumn;for(let l in e._addColumnDialogEditors){const a=e._addColumnDialogEditors[l],i=a.querySelector("input"),o=a.querySelector("smart-input");switch(l){case"allowTimeFormat":{const e=a.querySelector(".smart-input");t&&t.editor?"dateInput"===t.editor.template?(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked","")):(e.value=!1,e.removeAttribute("checked"));break}case"allowCustomDateSeparator":{const l=a.querySelector(".smart-input");l.value=!1,l.removeAttribute("checked");let i=0;t&&t.cellsFormat&&(t.cellsFormat.indexOf(".")>=0?(l.value=!0,l.setAttribute("checked",""),i=2):(t.cellsFormat.indexOf("M-d-yyyy")>=0||t.cellsFormat.indexOf("d-M-yyyy")>=0||t.cellsFormat.indexOf("yyyy/MM/dd")>=0)&&(l.value=!0,l.setAttribute("checked",""),i=1));const o=e._addColumnDialogEditors.dateFormatSeparator.querySelectorAll(".smart-grid-dialog-boolean-field");o.forEach((e=>{e.value=!1,e.removeAttribute("checked")})),o[i].setAttribute("checked",""),o[i].value=!0;break}case"dateFormat":t&&t.cellsFormat?t.cellsFormat.indexOf("M/d/yyyy")>=0?o.selectedIndex=0:t.cellsFormat.indexOf("dddd, MMMM dd, yyyy")>=0?o.selectedIndex=1:t.cellsFormat.indexOf("yyyy-MM-ddTHH:mm:ss.sssZ")>=0?o.selectedIndex=2:t.cellsFormat.indexOf("d/M/yyyy")>=0?o.selectedIndex=3:t.cellsFormat.indexOf("yyyy-MM-dd")>=0?o.selectedIndex=4:t.cellsFormat.indexOf("MMMM, dd, yyyy")>=0&&(o.selectedIndex=5):o.selectedIndex=0;break;case"timeFormat":t&&t.cellsFormat&&t.cellsFormat.indexOf("HH")>=0&&-1===t.cellsFormat.indexOf("T")?o.selectedIndex=1:o.selectedIndex=0;break;case"allowMultipleCollaborators":{let e=!0;t&&t.editor&&t.editor.singleSelect&&(e=!1);const l=a.querySelector(".smart-input");t?e?(l.value=!0,l.setAttribute("checked","")):(l.value=!1,l.removeAttribute("checked")):(l.value=!0,l.setAttribute("checked",""));break}case"numberFormat":if(t&&"numberInput"===t.editor.template&&t.editor.numberFormat)if("decimal"===t.editor.numberFormat.style&&0===t.editor.numberFormat.maximumFractionDigits)o.selectedIndex=0;else if("decimal"===t.editor.numberFormat.style&&2===t.editor.numberFormat.minimumFractionDigits)o.selectedIndex=1;else if("percent"===t.editor.numberFormat.style&&2===t.editor.numberFormat.minimumFractionDigits)o.selectedIndex=2;else if("percent"===t.editor.numberFormat.style&&0===t.editor.numberFormat.maximumFractionDigits)o.selectedIndex=3;else if("decimal"===t.editor.numberFormat.style&&"scientific"===t.editor.numberFormat.notation)o.selectedIndex=4;else if("decimal"===t.editor.numberFormat.style&&"engineering"===t.editor.numberFormat.notation)o.selectedIndex=5;else if("currency"===t.editor.numberFormat.style&&"accounting"===t.editor.numberFormat.currencySign)o.selectedIndex=6;else if("unit"===t.editor.numberFormat.style){o.selectedIndex=7;const l=t.editor.numberFormat.unit,a=e._addColumnDialogEditors.unit.querySelector("smart-input");a.dataSource.forEach(((e,t)=>{if(e.value===l)return a.selectedIndex=t,!0}))}else"currency"===t.editor.numberFormat.style?o.selectedIndex=8:"currency"===t.editor.numberFormat.style&&0===t.editor.numberFormat.maximumFractionDigits&&0===t.editor.numberFormat.minimumFractionDigits&&(o.selectedIndex=9);else o.selectedIndex=0;break;case"allowCheckItems":{const e=a.querySelector(".smart-input");t?t.editor&&!t.editor.pills?(e.value=!0,e.setAttribute("checked","")):!1===t[l]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!1,e.setAttribute("checked",""));break}case"allowColorItems":{const e=a.querySelector(".smart-input");t?t.editor&&t.editor.colorItems?(e.value=!0,e.setAttribute("checked","")):!1===t[l]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}case"allowResize":case"allowSort":case"allowEdit":case"allowFilter":case"required":{const e=a.querySelector(".smart-input");t?t[l]?(e.value=!0,e.setAttribute("checked","")):!1===t[l]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}}if(!t||"options"!==l&&"users"!==l){const t=a.querySelector("smart-sortable");if(t&&t._init)if("users"===l){let l=[];for(let t=0;t<e.users.length;t++)l.push({color:e.users[t].color,label:e.users[t].name,id:e.users[t].id,image:e.users[t].image});t._init(l)}else t._init()}else{const e=a.querySelector("smart-sortable");if(e&&e._init)if(t.editor.singleSelect){const l=t.editor.dataSource.filter((e=>""!==e));e._init(l)}else"mutliComboInput"===t.editor.template&&e._init(JSON.parse(JSON.stringify(t.editor.dataSource)))}if(t&&"type"===l?("number"===t.dataType||"int"===t.dataType?o.selectedIndex=3:"date"===t.dataType?o.selectedIndex=7:"bool"!==t.dataType&&"boolean"!==t.dataType||(o.selectedIndex=6),t.editor&&t.editor.template&&o.dataSource.forEach(((e,l)=>{switch(e.value){case"select":"multiComboInput"===t.editor.template&&t.editor.singleSelect&&"tags"===t.template&&(o.selectedIndex=l);break;case"multiSelect":"multiComboInput"===t.editor.template&&"tags"===t.template&&(o.selectedIndex=l);break;case"multiText":"textarea"===t.editor.template&&(o.selectedIndex=l);break;case"date":"dateInput"!==t.editor.template&&"dateTimePicker"!==t.editor.template||(o.selectedIndex=l);break;case"checkBox":"checkBox"===t.editor.template&&(o.selectedIndex=l);break;case"slider":"slider"===t.editor.template&&(o.selectedIndex=l);break;case"image":"image"===t.editor.template&&(o.selectedIndex=l);break;case"modifiedTime":"modifiedTime"===t.template&&(o.selectedIndex=l);break;case"createdTime":"createdTime"===t.template&&(o.selectedIndex=l);break;case"createdBy":"createdBy"===t.template&&(o.selectedIndex=l);break;case"modifiedBy":"modifiedBy"===t.template&&(o.selectedIndex=l);break;case"collaborator":"collaborator"===t.template&&t.editor&&t.editor.collaborator&&(o.selectedIndex=l);break;case"autoNumber":"autoNumber"===t.template&&(o.selectedIndex=l);break;case"phone":"phone"===t.template&&(o.selectedIndex=l);break;case"password":"password"===t.template&&(o.selectedIndex=l);break;case"url":"url"===t.template&&(o.selectedIndex=l);break;case"email":"email"===t.template&&(o.selectedIndex=l)}}))):"type"===l&&(o.selectedIndex=0),"cellsAlign"===l&&t&&("center"===t.cellsAlign||"middle"===t.cellsAlign?o.selectedIndex=2:"right"===t.cellsAlign&&(o.selectedIndex=1)),!i)continue;"dataField"!==l&&"type"!==l&&"timeFormat"!==l&&"dateFormat"!==l&&"numberFormat"!==l&&"unit"!==l&&"cellsAlign"!==l&&o&&(o.selectedIndex=0),"name"===l&&(o.value=t?t.label:""),"description"===l&&(o.value=t?t.description:"");const n=(e,l)=>{t&&t.validationRules.forEach((t=>"minDate"===t.type&&"minDateTime"===e||"maxDate"===t.type&&"maxDateTime"===e||"min"===t.type&&"minValue"===e||"max"===t.type&&"maxValue"===e||t.type===e?(l.value=t.value,!0):void 0))};if("minValue"===l?(i.value=0,n(l,i)):"maxValue"===l?(i.value=100,n(l,i)):"minLength"===l?(i.value=0,n(l,i)):"maxLength"===l&&(i.value=500,n(l,i)),"minDateTime"===l){const e=a.querySelector("smart-date-input");e.value=new Date(1900,0,1),n(l,e)}else if("maxDateTime"===l){const e=a.querySelector("smart-date-input");e.value=new Date(2100,0,1),n(l,e)}}}_createColumnBooleanEditor(e,t,l,a,i){e.setAttribute("template","checkBox"),e.setAttribute("editor","");const o=document.createElement("div");return o.classList.add("smart-input"),o.classList.add("smart-grid-cell-editor"),o.classList.add("smart-grid-check-box-cell-editor"),o.setAttribute("checked",""),o.value=!0,t.width&&(l.style.width=t.width,l.style.float="left"),!1===t.value&&(o.value=!1,o.removeAttribute("checked")),e.appendChild(o),e.check=function(){o.setAttribute("checked",""),o.value=!0,e.onchange&&e.onchange(o.value)},e.uncheck=function(){o.removeAttribute("checked"),o.value=!1,e.onchange&&e.onchange(o.value)},e.toggle=function(){!0!==o.value&&!1!==o.value&&null!==o.value&&(o.value=!1),null===o.value?o.value=!1:o.value=!o.value,!1===o.value?o.removeAttribute("checked"):o.setAttribute("checked",o.value?"":"indeterminate"),e.onchange&&e.onchange(o.value)},e.onclick=i.onclick=()=>{e.toggle()},a.appendChild(l),l.classList.add("smart-grid-dialog-boolean-field"),l.appendChild(e),l.appendChild(i),e}_getColumnTemplateByType(e){switch(e){case"boolean":case"bool":return"checkBox";case"image":return"image";case"createdBy":case"modifiedBy":case"collaborator":case"select":case"multiSelect":return"tags";case"url":return"url";case"email":return"email";case"autoNumber":return"autoNumber";case"password":return"password";case"createdTime":return"createdTime";case"modifiedTime":return"modifiedTime";default:return""}}_confirmAddColumnDialog(){const e=this,t=e._dialogAddColumn,l=e._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor"),a=[];let i,o,n={};for(let t=0;t<l.length;t++){const a=l[t],i=a.querySelector(".smart-input"),o=a.getAttribute("bind"),d=a.parentElement;if("minLength"!==o&&"maxLength"!==o&&"minValue"!==o&&"maxValue"!==o&&"minDateTime"!==o&&"maxDateTime"!==o)if("options"!==o&&"users"!==o){if("allowEdit"===o&&d.classList.contains("smart-hidden"))i.value=!1;else if("required"===o&&d.classList.contains("smart-hidden"))i.value=!1;else if("dateFormatSeparator"===o){const e=a.querySelectorAll(".smart-grid-dialog-boolean-field");for(let t=0;t<e.length;t++)if(e[t].querySelector("[checked]")){switch(t){case 0:n.dateFormatSeparatorType="/";break;case 1:n.dateFormatSeparatorType="-";break;case 2:n.dateFormatSeparatorType="."}break}}i&&(i.getSelectedItem?n[o]=i.getSelectedItem().value:n[o]=i.value)}else{const t=[],l=a.querySelectorAll(".smart-grid-add-column-dialog-color-item .edit-column-input"),i=a.querySelectorAll(".smart-grid-add-column-dialog-color-item smart-color-input");for(let e=0;e<l.length;e++){const a=l[e],o={label:a.value,value:parseInt(a.getAttribute("data-id")),color:i[e].value};o.color=i[e].value,t.push(o)}if("users"===o){e.users||(e.users=[]);for(let l=0;l<t.length;l++){const a=t[l],i=e.users.find((e=>e.id===a.value));i&&(i.name=a.label,i.color=a.color)}}n[o]=t}else n[o]=i.getValue()}t.data=n;let d={},r={},s="";if(i=n.minDateTime,o=n.maxDateTime,"date"===n.type){d={template:"dateInput",min:i,max:o};let e=!1;"-"!==n.dateFormat&&(s=n.dateFormat,n.allowCustomDateSeparator&&(s.indexOf("/")>=0?s=s.replaceAll("/",n.dateFormatSeparatorType):s.indexOf("-")>=0?s=s.replaceAll("-",n.dateFormatSeparatorType):s.indexOf(".")>=0&&(s=s.replaceAll(".",n.dateFormatSeparatorType))),n.dateFormat.indexOf("T")>=0&&(d.template="dateTimePicker",d.dropDownDisplayMode="auto",d.formatString=s),e=!0),d.autoOpen=!0,n.allowTimeFormat&&"-"!==n.timeFormat&&(e&&(s+=" "),s+=n.timeFormat,d.template="dateTimePicker",d.dropDownDisplayMode="auto",d.formatString=s),a.push({type:"minDate",value:i}),a.push({type:"maxDate",value:o})}else if("number"===n.type||"slider"===n.type)i=parseInt(n.minValue),o=parseInt(n.maxValue),"unit"===n.numberFormat.style&&(n.numberFormat.unit=n.unit),d={template:"number"===n.type?"numberInput":"slider",min:i,max:o,numberFormat:n.numberFormat},r={Intl:{NumberFormat:n.numberFormat}},s="d",a.push({type:"min",value:i}),a.push({type:"max",value:o});else if("boolean"===n.type)d={template:"checkBox"};else if("image"===n.type)d={template:"image"};else if("select"===n.type||"multiSelect"===n.type){let e=n.options;"select"===n.type&&(e=[""].concat(n.options)),d={template:"multiComboInput",readonly:!0,dropDownButtonPosition:"right",colorItems:n.allowColorItems,autoOpen:!0,pills:!n.allowCheckItems,singleSelect:"select"===n.type,dataSource:e}}else if("collaborator"===n.type){let t=n.users;n.allowMultipleCollaborators||(t=[""].concat(n.users));for(let l=0;l<e.users.length;l++)t.forEach((t=>{t.value===e.users[l].id&&(t.image=e.users[l].image,t.id=e.users[l].id)}));d={template:"multiComboInput",readonly:!0,collaborator:!0,colorItems:n.allowColorItems,dropDownButtonPosition:"right",autoOpen:!0,pills:!n.allowCheckItems,singleSelect:!n.allowMultipleCollaborators,dataSource:t}}else"multiText"===n.type?(i=n.minLength,o=n.maxLength,d={template:"textarea",min:i,max:o,required:n.required},a.push({type:"minLength",value:i}),a.push({type:"maxLength",value:o})):"password"===n.type?(i=n.minLength,o=n.maxLength,d={template:"password",min:i,max:o,required:n.required},a.push({type:"minLength",value:i}),a.push({type:"maxLength",value:o})):"phone"===n.type?d={template:"phone",required:n.required}:(i=n.minLength,o=n.maxLength,d={template:"input",min:i,max:o,required:n.required},a.push({type:"minLength",value:i}),a.push({type:"maxLength",value:o}));let c="string";switch(n.type){case"boolean":case"bool":c="boolean";break;case"createdTime":case"modifiedTime":case"date":c="date";break;case"autoNumber":case"slider":case"number":c="number"}if(e._dialogAddColumn.editColumn){const t=e._dialogAddColumn.editColumn;t.canNotify=!1,t.label=n.name,t.description=n.description,t.showDescriptionButton=!0,t.allowResize=n.allowResize,t.allowSort=n.allowSort,t.allowFilter=n.allowFilter,t.allowEdit=n.allowEdit,t.align=t.cellsAlign=n.cellsAlign,t.cellsFormat=s,t.dataType=c;const l=t._editorId?t._editorId:"",i=d.template+"_"+t.dataField+l;e._cellEditors[i]&&delete e._cellEditors[i];let o=!0;"list"!==t.template&&"dropDownList"!==t.template||(o=!1),"autoNumber"!==t.template&&"createdBy"!==t.template&&"modifiedBy"!==t.template&&"createdTime"!==t.template&&"modifiedTime"!==t.template||(o=!1),o&&(t.editor=d,t.template=e._getColumnTemplateByType(n.type)),t.formatSettings=r,t._isDirty=!0,n.required&&a.push({type:"required"}),t.validationRules=a,t._state&&["label","description","showDescriptionButton","dataType","editor","formatSettings","template","summary","validationRules","allowResize","allowSort","allowFilter","allowEdit","align","cellsAlign","cellsFormat"].forEach((e=>{t._state[e]=t[e]})),t.canNotify=!0,e.$.fireEvent("closeColumnDialog",{dataField:t.dataField}),e.onColumnUpdated&&e.onColumnUpdated(e.columns.indexOf(t),t),e._recycle(!0),t.refresh(),t._isDirty=!1}else{const t=new Smart.Grid.Column({label:n.name,description:n.description,dataField:n.dataField||"dataField"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),allowResize:n.allowResize,allowSort:n.allowSort,allowFilter:n.allowFilter,allowEdit:n.allowEdit,showDescriptionButton:!0,dataType:c,editor:d,template:e._getColumnTemplateByType(n.type),formatSettings:r,cellsAlign:n.cellsAlign,align:n.cellsAlign,cellsFormat:s,grid:e});e.columns.push(t),e.$.fireEvent("closeColumnDialog",{dataField:t.dataField})}}_openAddColumnDialog(e){const t=this,l=t._dialogAddColumn||t._createDialog(t.editing.addColumnDialog),a=e?t.localize("dialogEditColumn",{value:e.label}):t.localize("dialogAddColumn"),i=l.querySelector(".smart-footer").querySelector(".smart-stack-layout");l.classList.add("smart-grid-dialog-add-column"),l.type=e?"customize":"add",l.editColumn=e||null,i.classList.remove("right"),i.classList.add("center"),t._cellEditors||(t._cellEditors=[]);const o=t._getAddColumnDialogTemplate();if(l.header.innerHTML=a,l.header.parentElement.classList.add("smart-hidden"),t.cancelEdit(),!t._dialogAddColumn){l.modal=!0,l.btnConfirm.innerHTML=t.localize("dialogEditButtonConfirm"),l.btnCancel.innerHTML=t.localize("dialogEditButtonCancel"),l.onOpen=function(){t._addColumnDialogInitEditors(),t._addColumnDialogShowHideEditors(l.editColumn),t.$.fireEvent("openColumnDialog",{dataField:l.editColumn?l.editColumn.dataField:null});const e=t.offset(l);if(e.top+l.offsetHeight>window.innerHeight){const t=e.top+l.offsetHeight-window.innerHeight;l.style.maxHeight=Math.max(250,l.offsetHeight-t)+"px",l.style.minHeight="250px"}else l.style.maxHeight="",l.style.minHeight=""},l.onClose=function(){},l.btnCancel.onclick=function(){l.close()},l.btnClose.onclick=function(){l.close()},l.btnConfirm.onclick=function(){t._confirmAddColumnDialog(),l.close()},l.onkeydown=function(e){"Escape"===e.key&&l.close()},t._dialogAddColumn=l;const e=document.createElement("div");e.classList.add("smart-content-layout-container"),l.content.appendChild(e),t._addColumnDialogEditors=[];for(let a=0;a<o.length;a++){const i=o[a],n=document.createElement("div"),d=document.createElement("label");d.innerHTML=i.label;const r=document.createElement("div");if(r.classList.add("smart-grid-dialog-editor","add-column"),r.innerHTML="",r.setAttribute("filter",i.filter),r.setAttribute("bind",i.bind),n.setAttribute("field-name",i.bind),n.setAttribute("field-filter",i.filter),t._addColumnDialogEditors[i.bind]=r,"type"===i.bind&&r.addEventListener("change",(()=>{t._addColumnDialogShowHideEditors(l.editColumn);const e=t._dialogAddColumn.querySelector('[bind="type"]'),a=e.querySelector("smart-input").getSelectedItem().value;let i="smart-icon-font";switch(a){case"multiText":i="smart-icon-fontsize";break;case"image":i="smart-icon-image";break;case"number":i="smart-icon-number";break;case"select":i="smart-icon-sort-down";break;case"multiSelect":i="smart-icon-list-unordered";break;case"boolean":i="smart-icon-check-squared";break;case"date":i="smart-icon-calendar";break;case"createdTime":case"modifiedTime":i="smart-icon-clock";break;case"createdBy":case"modifiedBy":case"collaborator":i="smart-icon-user";break;case"slider":i="smart-icon-number";break;case"autoNumber":i="smart-icon-list-ordered";break;case"url":i="smart-icon-link";break;case"email":i="smart-icon-mail";break;case"password":i="smart-icon-lock";break;case"phone":i="smart-icon-phone"}if(t._addColumnDialogEditors.type.icon=i,e.firstElementChild.className="smart-grid-icon show smart-description-button "+i,"select"===a||"multiSelect"===a){const e=t._addColumnDialogEditors.options.querySelector("smart-sortable");e&&e._validate&&e._validate()}else l.btnConfirm.disabled=!1})),"boolean"===i.type)t._createColumnBooleanEditor(r,i,n,e,d);else{let s=document.createElement("smart-input");if(s.classList.add("underlined","edit-column-input"),s.style.width="100%",s.style.height="30px",i.width&&(n.style.width=i.width,n.style.float="left"),"items"===i.type){const e=document.createElement("smart-button");e.classList.add("primary"),e.innerHTML='<div style="align-items: center; white-space: nowrap; display: flex;"><span class="smart-grid-icon show smart-icon-plus"></span><span>'+t.localize("commandBarAddRow")+"</span></div>";const a=document.createElement("div");a.classList.add("smart-grid-add-column-dialog-color-panel");const o=document.createElement("smart-sortable");o.disableMode="manual",o.dragMode="handle",o.handleVisibility="visible",o.handlePosition="left";const n=()=>{l.btnConfirm.disabled=!1,a.querySelectorAll(".edit-column-input").forEach((e=>{""===e.value&&(l.btnConfirm.disabled=!0)}))},d=(e,l,a)=>{const d=document.createElement("div"),r=t._getColorInput(),s=document.createElement("div"),c=document.createElement("smart-input"),m=t._addColumnDialogEditors.allowColorItems;if(void 0!==a)c.setAttribute("data-id",a);else{const e=o.querySelectorAll(".smart-sortable-item");c.setAttribute("data-id",e)}return r.disabled=!m.querySelector(".smart-input").value,s.className="smart-grid-icon smart-icon-close show",s.setAttribute("role","button"),s.setAttribute("aria-label","button"),c.classList.add("underlined","edit-column-input"),c.style.width="100%",c.style.height="30px",c.required=!0,e&&(c.value=e),l&&(r.value=l),c.onkeyup=c.onchange=()=>{n()},d.appendChild(r),d.appendChild(c),"users"!==i.bind&&d.appendChild(s),s.onclick=()=>{d.remove(),o.$.container.appendChild(i),o.updateItems(),n()},d.classList.add("smart-sortable-item","smart-grid-add-column-dialog-color-item"),d};o._init=e=>{o.clearContent(),e&&(e.forEach(((e,t)=>{const l=void 0!==e.id?e.id:t,a=d(e.label,e.color,l);o.$.container.appendChild(a)})),o.updateItems())},o._validate=n,t._addColumnDialogEditors.allowColorItems.onchange=e=>{o.querySelectorAll("smart-color-input").forEach((t=>{t.disabled=!e}))},a.appendChild(o),"users"!==i.bind&&(a.appendChild(e),e.onclick=()=>{const e=d();o.$.container.appendChild(e),o.updateItems(),e.querySelector(".edit-column-input").focus(),l.btnConfirm.disabled=!0}),s=a,r.style.height="auto"}else if("number"===i.type)s=document.createElement("smart-number-input"),s.classList.add("underlined"),s.style.width="100%",s.style.height="30px","minValue"===i.bind?(s.value=0,s.min=-9999999,s.max=9999999):"maxValue"===i.bind?(s.value=1e6,s.min=-9999999,s.max=9999999):"minLength"===i.bind?s.value=0:"maxLength"===i.bind&&(s.value=500);else if("datetime"===i.type)s=document.createElement("smart-date-input"),s.classList.add("underlined"),s.style.width="100%",s.style.height="30px","minDateTime"===i.bind?s.value=new Date(1900,0,1):"maxDateTime"===i.bind&&(s.value=new Date(2100,0,1));else if("radio"===i.type){const e=(e,t,l)=>{const a=document.createElement("div"),i=document.createElement("label"),o=document.createElement("div");return i.innerHTML=e,o.classList.add("smart-input"),o.classList.add("smart-grid-cell-editor"),o.classList.add("smart-grid-check-box-cell-editor"),t&&o.setAttribute("checked",""),o.value=void 0!==t&&t,r.appendChild(o),a.onclick=function(){if(o.value=!0,!1===o.value?o.removeAttribute("checked"):o.setAttribute("checked",o.value?"":"indeterminate"),o.value){const e=o.parentElement.parentElement.parentElement;e.querySelectorAll(".smart-grid-cell-editor").forEach((e=>{e.value=!1,e.removeAttribute("checked")})),o.value=!0,o.setAttribute("checked",o.value?"":"indeterminate"),e.value=l}},a.appendChild(o),a.appendChild(i),a.classList.add("smart-grid-dialog-boolean-field"),a.setAttribute("template","checkBox"),a.setAttribute("editor",""),a},t=document.createElement("div");t.classList.add("smart-grid-dialog-radio-field"),r.classList.add("radio-group");for(let l=0;l<i.options.length;l++){const a=i.options[l],o=e(a.label,a.checked);if(i.columns){const e=100/i.columns;o.style.width=e+"%",o.style.float="left"}t.appendChild(o),a.checked&&(r.value=a.value)}const l=document.createElement("div");l.style.clear="both",t.appendChild(l),s=t}if(i.options){s.readonly=!0;let e=i.options;"type"===i.bind&&(void 0!==t.currentUser&&null!==t.currentUser||(e=e.filter((e=>"modifiedBy"!==e.value&&"createdBy"!==e.value))),(void 0===t.users||null===t.users||t.users&&0===t.users.length)&&(e=e.filter((e=>"collaborator"!==e.value)))),s.dataSource=e,s.dropDownButtonPosition="right","dataField"!==i.bind&&(s.selectedIndex=0),i.options.length<15?s.dropDownHeight="auto":s.dropDownHeight=300}if(i.icon){const e=document.createElement("span");e.classList.add("smart-grid-icon",i.icon,"show","smart-description-button"),r.appendChild(e),s.style.width="calc(100% - 25px)"}if(r.appendChild(s),i.info){const e=document.createElement("span");e.classList.add("smart-grid-icon","smart-icon-attention-circled","show","smart-description-button"),e.title=i.info,r.appendChild(e),s.style.width="calc(100% - 25px)"}if(e.appendChild(n),n.classList.add("smart-grid-dialog-field"),n.appendChild(d),n.appendChild(r),i.width&&!o[a+1].width){const t=document.createElement("div");t.style.clear="both",e.appendChild(t)}}}}const n=()=>{const a=parseInt(l.style.width),i=t.offset(t);if(window.screen.availWidth<400)return l.open("left","top"),l.style.width=t.offsetWidth+"px",void(l.style.height=t.offsetHeight+"px");{const e=t.editing.addColumnDialog;l.style.width="auto"===e.width?e.width:e.width+"px",l.style.height="auto"===e.height?e.height:e.height+"px"}if(e){const o=e.element,n=t.offset(o),d=n.left-i.left,r=i.left,s=Math.max(r,d);if(s+a+o.offsetWidth>i.left+t.offsetWidth){const e=s-a+o.offsetWidth;e<0?l.open("center",n.top+o.offsetHeight-i.top):l.open(Math.max(r,e),n.top+o.offsetHeight-i.top)}else l.open(s,n.top+o.offsetHeight-i.top)}else{let e=t._addNewColumn.element,o=t.offset(e),n=o.left-i.left-a+e.offsetWidth,d=i.left,r=Math.max(d,n);t.editing.addNewColumn._addButton&&t.editing.addNewColumn._addButton.classList.contains("show")&&(e=t.editing.addNewColumn._addButton,o=t.offset(t.editing.addNewColumn._addButton),n=o.left-i.left-a+e.offsetWidth,d=i.left,r=Math.max(d,n)),l.open(r,o.top+e.offsetHeight-i.top)}};n(),l.refresh=()=>{n()},setTimeout((function(){l.btnConfirm.focus()}),100)}});