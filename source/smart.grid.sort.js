
/* Smart UI v12.0.0 (2022-01-16) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart.Utilities.Assign("Grid.Sort",class{clearSort(){const t=this;if(!t._isSorting&&t.dataSource){t._isSorting=!0,t.dataSource.clearSort(),t._sortedColumns||(t._sortedColumns=[]);for(let r=0;r<t._sortedColumns.length;r++){const e=t._sortedColumns[r],o=t.columnByDataField[e.dataField];o&&(o.setProperty("sortOrder",null),o.setProperty("sortIndex",null))}t._sortedColumns=[],t.rowById=[];for(let r=0;r<t.dataSource.length;r++){const e=t.rows[r],o=t.dataSource[r];e&&(e.data=o,o&&o.$&&(e.id=o.$.id),t.rowById[e.id]=e)}t._recycle(),t._refreshHeaderBar(),t._isSorting=!1}}getSortedColumns(){const t=this,r=[];if(t._sortedColumns)for(let e=0;e<t._sortedColumns.length;e++){const o=t._sortedColumns[e];r[o.dataField]={sortOrder:o.sortOrder,sortIndex:o.sortIndex},r.length++}return r}addSort(t,r){this.sortBy(t,r)}removeSort(t){this.sortBy(t,null)}refreshSort(){this._refreshSort(this._sortedColumns)}_refreshSort(t){const r=this;if(r._isSorting||!t)return;const e=[],o=[],s=[];r._isSorting=!0;for(let n=0;n<t.length;n++){const a=t[n],d=r.columnByDataField[a.dataField];d&&(d.setProperty("sortOrder",a.sortOrder),e.push(a.dataField),o.push(a.sortOrder),s.push(a.dataType))}!function(){if(r.dataSource&&r.dataSource.virtualDataSource)r._virtualDataRequest("sort");else{if(r.dataSource.sortBy(e,s,o),r.dataSource.boundHierarchy)r._refreshRowHierarchy(),r.dataSource.groupBy.length>0&&(r._refreshRowHierarchy(!0,!0),r.refresh());else{r.rowById=[];for(let t=0;t<r.dataSource.length;t++){const e=r.rows[t],o=r.dataSource[t];e.data=o,e.id=o.$.id,r.rowById[e.id]=e}}r._recycle()}}(),r._refreshHeaderBar(),r._isSorting=!1,r._sortedColumns=t}sortBy(t,r){const e=this,o=e.columnByDataField[t],s=[],n=[],a=[],d=void 0===r;if(e._isSorting||!o)return;e._isSorting=!0,"descending"===r&&(r="desc"),void 0!==r&&"ascending"!==r||(r="asc");const i=function(t){t&&(t.setProperty("sortOrder",null),t.setProperty("sortIndex",null))},l=function(){if(e._sortedColumns.length>0)for(let t=0;t<e._sortedColumns.length;t++){const r=e._sortedColumns[t],o=e.columnByDataField[r.dataField];i(o)}e._sortedColumns=[]};if(null===o)return l(),void(e._isSorting=!1);if(!e.sorting.enabled||!e.dataSource||!o.allowSort||e._sortAnimation)return void(e._isSorting=!1);i(o),e._sortedColumns||(e._sortedColumns=[]);let u="string";for(let r=0;r<e.dataSource.dataFields.length;r++){const o=e.dataSource.dataFields[r];if(o.name===t){u=o.dataType;break}}let c=!0;for(let s=0;s<e._sortedColumns.length;s++){const n=e._sortedColumns[s];if(n.dataField===t)if(c=!1,n.sortIndex=o.sortIndex,d){if("asc"===n.sortOrder)n.sortOrder="desc",r="desc";else if("desc"===n.sortOrder){e.sorting.sortToggleThreeStates?(e._sortedColumns.splice(s,1),i(o),r=null):(n.sortOrder="asc",r="asc");break}}else n.sortOrder=r,null===r&&(e._sortedColumns.splice(s,1),i(o))}c&&("one"===e.sorting.mode&&l(),"many"===e.sorting.mode&&!1===e._canSort&&l(),null!==r&&e._sortedColumns.push({dataField:t,sortOrder:r,sortIndex:o.sortIndex,dataType:u})),o.setProperty("sortOrder",r),e._sortedColumns.sort(((t,r)=>"string"==typeof t.sortIndex&&"string"==typeof r.sortIndex?0:"number"==typeof t.sortIndex&&"string"==typeof r.sortIndex?-1:"string"==typeof t.sortIndex&&"number"==typeof r.sortIndex?1:"number"==typeof t.sortIndex&&"number"==typeof r.sortIndex?t.sortIndex-r.sortIndex:void 0));for(let t=0;t<e._sortedColumns.length;t++){const r=e._sortedColumns[t];s.push(r.dataField),n.push(r.sortOrder),a.push(r.dataType)}const f=function(){if(e.dataSource&&e.dataSource.virtualDataSource)e._virtualDataRequest("sort");else{if(e.dataSource.sortBy(s,a,n),e.dataSource.boundHierarchy)e._refreshRowHierarchy(),e.dataSource.groupBy.length>0&&(e._refreshRowHierarchy(!0,!0),e.refresh());else{e.rowById=[];for(let t=0;t<e.dataSource.length;t++){const r=e.rows[t],o=e.dataSource[t];r&&(r.data=o,o&&o.$&&(r.id=o.$.id),e._filters&&e._filters.length>0&&(r.filtered=void 0===r.data.$.filtered||r.data.$.filtered),e.rowById[r.id]=r)}e._filters&&e._filters.length>0&&e.refresh()}e._recycle()}const t=[];for(let r=0;r<e._sortedColumns.length;r++){const o=e.columnByDataField[e._sortedColumns[r].dataField];o&&(o.setProperty("sortIndex",r),t.push(o))}e._refreshHeaderBar(),e.$.fireEvent("sort",{columns:t,data:e._sortedColumns})};if(e.appearance.allowSortAnimation){let t=[],r=[];e.rows.canNotify=!1,e._sortAnimation=!0;const o=function(){for(let r=0;r<e._rowElements.length;r++){const o=e._rowElements[r];o.classList.remove("smart-grid-sort-animation"),e.removeTransformMoveStyle(o),o.offsetHeight>0&&t.push(o.offsetTop)}};o(),e._sortTimer=setTimeout((function(){o(),e._sortAnimation=!1,e.rows.canNotify=!0}),e.appearance.sortAnimationDuration),e._sortTimer2=setTimeout((function(){f()}),e.appearance.sortAnimationDuration/2);for(let o=0;o<t.length;o++){const s=e._rowElements[o];s.classList.remove("smart-grid-sort-animation"),e.removeTransformMoveStyle(s);let n=Math.floor(Math.random()*t.length-1+1);for(;r[n];)n=Math.floor(Math.random()*t.length-1+1);r[n]=!0,e.addTransformMoveStyle(s,"0ms",0,-s.offsetTop+t[n],0,.5),s.classList.add("smart-grid-sort-animation"),setTimeout((function(){e.addTransformMoveStyle(s,e.appearance.sortAnimationDuration+"ms",0,0,0,1)})),setTimeout((function(){s.classList.remove("smart-grid-sort-animation")}),e.appearance.sortAnimationDuration)}}else f();e._isSorting=!1}});