
/* Smart UI v9.0.0 (2020-Dec) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=54)}({54:function(e,t){Smart.Utilities.Assign("Grid.Edit",class{_renderCommandBar(){const e=this,t=e.editing.commandBar.dataSource,i=i=>{for(let n in t){const o=t[n],a=document.createElement("div");a.classList.add("smart-grid-command-item"),a.label=e.localize(n),o.icon&&(a.innerHTML='<span class="smart-grid-icon '+o.icon+'"></span><span class="smart-grid-label">'+a.label+"</span>"),o.visible||a.classList.add("smart-hidden"),a.command=o.command,a.onclick=function(){const t=a.command;e._applyCommand(t,[])},i.appendChild(a)}};e.editing.enabled&&e.editing.commandBar.visible&&(e.$.headerCommandBar.innerHTML="",e.$.footerCommandBar.innerHTML="","far"!==e.editing.commandBar.position&&i(e.$.headerCommandBar),"near"!==e.editing.commandBar.position&&i(e.$.footerCommandBar))}commandKeyEditCommand(){const e=this;if(e._selection&&e._selection.focusedCell&&e._selection.focusedCell.row){const t=e._selection.focusedCell.row;e.beginEdit(t.id)}}commandKeyCancelCommand(){this.cancelEdit()}commandKeyUpdateCommand(){this.endEdit()}commandColumnMenuCommand(){this._openColumnChooserMenu(this._commandColumn)}commandColumnEditCommand(e){this.beginEdit(e.id)}commandColumnUpdateCommand(){this.endEdit()}commandColumnRowMenuCommand(){}commandColumnCancelCommand(e){const t=this;if(t.editing.batch){const i=t._rowsDeleted?t._rowsDeleted.indexOf(e):-1;i>=0&&t._rowsDeleted.splice(i,1);for(let i=0;i<t.columns.length;i++){const n=t.columns[i].dataField;t._cellsUpdatedValues&&t._cellsUpdatedValues[e.id+"_"+n]&&(delete t._cellsUpdatedValues[e.id+"_"+n],t._cellsUpdatedValues.length--)}t._recycle(!1)}t.cancelEdit()}commandColumnDeleteCommand(e){this.deleteRow(e.id)}_renderAddNewRow(){const e=this;e._frozenNearDefaultRows=[],e._frozenFarDefaultRows=[];const t=new Smart.Grid.Row({data:{},index:-1,grid:e,freeze:"near",visible:"far"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0}),i=new Smart.Grid.Row({data:{},index:-2,grid:e,freeze:"far",visible:"near"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0});if(e._newNearRow){const t=e._frozenNearRows.indexOf(e._newNearRow);if(t>=0&&(e._frozenNearRows.splice(t,1),e.$.rowNearContainer.children.length>0)){const t=e.$.rowNearContainer.children[0];t.parentNode.removeChild(t)}}if(e._newFarRow){const t=e._frozenFarRows.indexOf(e._newFarRow);if(t>=0&&(e._frozenFarRows.splice(t,1),e.$.rowFarContainer.children.length>0)){const t=e.$.rowFarContainer.children[e.$.rowFarContainer.children.length-1];t.parentNode.removeChild(t)}}if(e.editing.addNewRow.visible&&(e._frozenNearDefaultRows.push(t),e._frozenFarDefaultRows.push(i),e._frozenNearRows.splice(0,0,t),e._frozenFarRows.push(i)),e._scrollView.vScrollBar.$.farButton.addEventListener("click",(function(){e.editing.addNewRow.autoCreate&&e._scrollView.vScrollBar.value===e._scrollView.vScrollBar.max&&(e.addUnboundRow(1),e._scrollView.vScrollBar.value=e._scrollView.vScrollBar.max)})),e._newNearRow=t,e._newFarRow=i,e.editing.addNewRow.visible){if(!e._newNearRow.element){const t=e._newNearRow,i=t.createElement();t.visible="far"!==e.editing.addNewRow.position,t.element=i,e.$.rowNearContainer.children.length>0?e.$.rowNearContainer.insertBefore(i,e.$.rowNearContainer.children[0]):e.$.rowNearContainer.appendChild(i)}if(!e._newFarRow.element){const t=e._newFarRow,i=t.createElement();t.visible="near"!==e.editing.addNewRow.position,t.element=i,e.$.rowFarContainer.children.length>0?e.$.rowFarContainer.insertBefore(i,e.$.rowFarContainer.children[0]):e.$.rowFarContainer.appendChild(i)}}}_insertNewRowAfter(e){return this._insertNewRowBefore(e,!0)}_insertNewRowBefore(e,t){const i=this,n=new Smart.Grid.Row({index:t?0:-1,id:Smart.Utilities.Core.createGUID(),grid:i}),o=function(t,n){const o=e=>{i.scrollTop=n?i.scrollHeight:0,i.editing.addDialog.enabled||setTimeout((function(){i.editing.enabled&&i._beginEdit(e)}),100)};!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("add")>=0?(i._batchAddRow(t,n?i.rows.length:0),o(t),e&&e(t)):i.addRow(t.data,n,t=>{o(t),e&&e(t)})}.bind(this);return i.editing.addDialog.enabled?i._openAddRowDialog(n,o):o(n,t),!0}commandBarBatchSaveCommand(){this._saveBatchEdit()}commandBarAddRowCommand(){this._insertNewRowAfter()}commandBarAddTopRowCommand(){this._insertNewRowBefore()}commandBarDeleteRowCommand(){const e=this;let t=1,i=e.rows[e.rows.length-t];for(e._rowsDeleted||(e._rowsDeleted=[]);e._rowsDeleted.indexOf(e.rows[e.rows.length-t])>=0;)t++;i=e.rows[e.rows.length-t],i&&e.commandColumnDeleteCommand(i)}commandBarBatchRevertCommand(){this.revertBatchEdit()}_beginEdit(e,t){const i=this;if(!t)if(i.columns[0]&&i.columns[0].allowEdit)t=i.columns[0].dataField;else for(let e=0;e<i.columns.length;e++)if(i.columns[e].allowEdit){t=i.columns[e].dataField;break}const n=i.columnByDataField[t];if(i.editing.allowColumnHeaderEdit&&!e&&n)return void i._beginColumnEdit(n);if(!e||!n||n&&n.autoGenerated)return!1;const o=e.getCell(t);if(!o)return!1;"cell"===i.editing.mode?i._beginCellEdit(o):"row"===i.editing.mode&&i._beginRowEdit(e,o),i.$.fireEvent("beginEdit",{row:e,column:n,cell:o})}_saveUnboundRows(e){const t=this;if(t._unboundRows&&t._unboundRows.length>0&&t.editing.addNewRow.autoSave){const i=t.rowById[e];if(!i.unbound)return;const n=t._unboundRows.indexOf(i);if(n<0)return;const o=n+1;t.beginUpdate();for(let e=0;e<o;e++){const i=t._unboundRows[e];if(!i)continue;delete t.rowById[i.id],i.unbound=!1;let n=!1;t._selection.focusedCell&&t._selection.focusedCell.row.id===i.id&&(n=!0),t._nearRowsAdded&&t._nearRowsAdded.indexOf(i)>=0?(t._nearRowsAdded.splice(t._nearRowsAdded.indexOf(i),1),t._add(0,i.data),n&&(t._selection.focusedCell.row=t.rows[0])):t._farRowsAdded&&t._farRowsAdded.indexOf(i)>=0&&(t._farRowsAdded.splice(t._farRowsAdded.indexOf(i),1),t._add(i.data),n&&(t._selection.focusedCell.row=t.rows[t.rows.length-1]))}t._unboundRows.splice(0,o),t.endUpdate()}}_validateCell(e,t,i){const n=this;if(n._errorOverlay&&(n._errorOverlay.remove(),n._errorMessage.remove(),n._isUpdating=!1),e.column.validationRules||i){let a={},l=e._updating;if(e._updating=!0,e.error="",i){for(let o in i)i[o]&&"valid"!==o&&(e.error=i.message),"custom"===o&&i[o].minLength?e.error=n.localize("invalidCellValue",{value:t,validationRule:"minLength: "+i[o].value}):"custom"===o&&i[o].maxLength&&(e.error=n.localize("invalidCellValue",{value:t,validationRule:"maxLength: "+i[o].value}));e.error&&(n._isUpdating=!0)}for(let i of e.column.validationRules){switch(i.type){case"min":a.min=o.min(t,i.value);break;case"max":a.max=o.max(t,i.value);break;case"minLength":a.minLength=o.minLength(t,i.value);break;case"maxLength":a.maxLength=o.maxLength(t,i.value);break;case"minDate":a.minDate=o.minDate(t,i.value);break;case"maxDate":a.maxDate=o.maxDate(t,i.value);break;case"required":a.required=o.required(t);break;case"requiredTrue":a.requiredTrue=o.requiredTrue(t);break;case"pattern":a.pattern=o.pattern(t,i.value);break;case"email":a.email=o.email(t);break;case"null":a.null=o.null(t)}a[i.type]&&(i.message?e.error=i.message:e.error=n.localize("invalidCellValue",{value:t,validationRule:void 0!==i.value?i.type+": "+i.value:i.type}),e._updating=l,n._isUpdating=!0,e.element.setAttribute("error",e.error),e.row.element.setAttribute("error",""),n.clearSelection())}if(e._updating=l,e.error){n._errorOverlay=n._createOverlay(),n._errorOverlay.onpointerdown=function(){n.endEdit()};const t=document.createElement("div");t.innerHTML=e.error,t.classList.add("smart-grid-validation-error");const i=e.element.getBoundingClientRect();return i.bottom+5-n.offsetTop>n.offsetHeight?t.style.top=i.top-i.height-5-n.offsetTop+"px":t.style.top=i.bottom+5-n.offsetTop+"px",t.style.left=i.left-n.offsetLeft+"px",n._errorMessage=t,n.$.root.appendChild(n._errorOverlay),n.$.root.appendChild(n._errorMessage),!1}n._isUpdating=!1}return!0}_endCellEdit(e){const t=this,i=e||t.editing.editCell;if(!i||i&&!i.isEditing)return null;let n=t._getEditorValue(i),o=null;n&&n.error&&(i.canNotify=!1,i.element.setAttribute("error",""),i.row.element.setAttribute("error",""),i.error=!0,i.canNotify=!0,o=n.validity,n=n.value);const a=function(){const e=t._getEditorId(i);t._cellEditors[e].detach(),i.row.element.removeAttribute("edit"),i.element.removeAttribute("editor"),i.element.removeAttribute("error"),i.row.element.removeAttribute("error"),i.isEditing=!1,i.element.content.innerHTML="";const o=function(){t.editing.editRow||(t.dataSource&&t.dataSource.boundHierarchy?(t._refreshRowHierarchy(),t.refresh()):t._recycle(!1))},a=t._cellsUpdatedValues?t._cellsUpdatedValues[i.row.id+"_"+i.column.dataField]:void 0,l=void 0!==a?a:i.value;if(function(e,t){return"date"===i.column.dataType?!(!e||!t)&&e.valueOf()===t.valueOf():e===t}(n,l))t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1,o());else{const e=function(){t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1),delete t._editInfo};if(!0===t.editing.batch||t.editing.batch&&t.editing.batch.indexOf("update")>=0)e(),t._batchUpdateCell(i.row,i.column,n,i.value),o();else{const a=function(){e(),i._updating=!0,i.value=n,i._updating=!1,o()};if(!t.editing.editRow&&t.dataSource&&t.dataSource.virtualDataSource){const e={};e[i.column.dataField]=n,t.updateRow(i.row.id,e,()=>{a()})}else a()}}return t.editing.commandColumn.visible&&!t.editing.commandColumn.width&&"cell"===t.editing.mode&&t.refresh(),t.focus(),!0};if(!t._validateCell(i,n,o))return i.editor.instance&&setTimeout(()=>{i.editor.instance.focus()},50),!1;if(t.onCellUpdate){t.beginUpdate(),t.appearance.displayLoadingIndicator=!0,t._setLoadingIndicatorVisibility();const e=t._createOverlay();t.$.root.appendChild(e),t.onCellUpdate(i,t.oldValue,n,(function(i){i?a():t.cancelEdit(),t.appearance.displayLoadingIndicator=!1,t._setLoadingIndicatorVisibility(),e.parentNode.removeChild(e),t.endUpdate()}))}else if(t.onRowUpdate){t.beginUpdate(),t.appearance.displayLoadingIndicator=!0,t._setLoadingIndicatorVisibility();const e=t._createOverlay();t.$.root.appendChild(e);const o=i.column.dataField,l=Object.assign({},i.row.data),d=Object.assign({},i.row.data);d[o]=n,t.onRowUpdate(i.row,l,d,(function(i){i?a():t.cancelEdit(),t.appearance.displayLoadingIndicator=!1,t._setLoadingIndicatorVisibility(),e.parentNode.removeChild(e),t.endUpdate()}))}else a()}_endRowEdit(){const e=this,t=e.editing.editRow;if(!t)return!1;let i=!0;const n=t.cells;let o={},a={};t.element.removeAttribute("error");for(let l=0;l<n.length;l++){const d=n[l],r=e._getEditorValue(d);if(o[d.column.dataField]=d.value,a[d.column.dataField]=r,!e._validateCell(d,r))return i=!1,t.element.setAttribute("error",""),e._isUpdating=!0,d.editor.instance&&setTimeout(()=>{d.editor.instance.focus()},50),!1}if(i){const i=function(){for(let t=0;t<n.length;t++){const i=n[t];e._endCellEdit(i)}e.editing.isEditing=!1,e.editing.editRow=null,e.editing.commandColumn.visible&&!e.editing.commandColumn.width?e.refresh():e._recycle(!1)};if(!0===e.editing.batch||e.editing.batch&&e.editing.batch.indexOf("update")>=0)i();else if(e.onRowUpdate){e.beginUpdate(),e.appearance.displayLoadingIndicator=!0,e._setLoadingIndicatorVisibility();const n=e._createOverlay();e.$.root.appendChild(n),e.onRowUpdate(t,o,a,(function(t){t?i():e.cancelEdit(),e.appearance.displayLoadingIndicator=!1,e._setLoadingIndicatorVisibility(),n.parentNode.removeChild(n),e.endUpdate()}))}else if(e.dataSource&&e.dataSource.virtualDataSource&&e.editing.isEditing){e.beginUpdate(),e.appearance.displayLoadingIndicator=!0,e._setLoadingIndicatorVisibility();const t=e._createOverlay();e.$.root.appendChild(t);let n=Object.assign({},e.editing.editRow.data);for(let t=0;t<e.editing.editRow.cells.length;t++){const i=e.editing.editRow.cells[t];if(!i.column.allowEdit)continue;const o=e._getEditorValue(i);void 0!==o&&(n[i.column.dataField]=o)}e._editInfo={row:n},e._virtualDataRequest("update",(function(n){n?i():e.cancelEdit(),e.appearance.displayLoadingIndicator=!1,e._setLoadingIndicatorVisibility(),t.parentNode.removeChild(t),e.endUpdate()}))}else i();return!0}return e.focus(),!1}_batchDeleteRow(e){const t=this;t._rowsDeleted||(t._rowsDeleted=[]),t._rowsDeleted.push(e),t._recycle(!1)}_batchAddRow(e,t){const i=this;i._rowsAdded||(i._rowsAdded=[]),i._rowsAdded.push(e.id),i.rowById[e.id]=e,e.index=i.rows.length+(i._rowsAdded?i._rowsAdded.length:0),0===t?i._nearRowsAdded.splice(0,0,e):i._farRowsAdded.push(e),i.isInitialized&&i._rowElements&&i._rowElements.length<i.rows.length+i._rowsAdded.length&&i._initializeRowElements(),i.refresh()}_batchUpdateCell(e,t,i,n){const o=this;o._cellsUpdatedValues||(o._cellsUpdatedValues=[]);!function(e,i){return"date"===t.dataType?e.valueOf()===i.valueOf():e===i}(i,n)?o._cellsUpdatedValues[e.id+"_"+t.dataField]=i:delete o._cellsUpdatedValues[e.id+"_"+t.dataField],o._cellsUpdatedValues.length++}_saveBatchEdit(){const e=this;for(let t in e._cellsUpdatedValues){const i=e._cellsUpdatedValues[t],n=t.substring(0,t.indexOf("_")),o=t.substring(t.indexOf("_")+1),a=e.rowById[n],l=a.getCell(o);if(e.dataSource.virtualDataSource){const t={};t[l.column.dataField]=i,a.data.$&&a.data.$.id?e.updateRow(a.data.$.id,t):(l._updating=!0,l.value=i,l._updating=!1)}else l._updating=!0,l.value=i,l._updating=!1}const t=e._rowsDeleted&&e._rowsDeleted.length>0||e._rowsAdded&&e._rowsAdded.length>0;if(t&&e.beginUpdate(),e._rowsAdded&&e._rowsAdded.length>0)for(let t in e._rowsAdded){const i=e._rowsAdded[t],n=e.rowById[i];if(n){if(e._rowsDeleted&&e._rowsDeleted.length>0){let t=!1;for(let n=0;n<e._rowsDeleted.length;n++){if(e._rowsDeleted[n].id===i){t=!0;break}}if(t)continue}e.dataSource.virtualDataSource?e.addRow(n.data,!0):e._nearRowsAdded.indexOf(n)>=0?e.rows.splice(0,0,n):e._farRowsAdded.indexOf(n)>=0&&e.rows.push(n)}}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(let t=0;t<e._rowsDeleted.length;t++){const i=e._rowsDeleted[t],n=e.rows.indexOf(i);n<0||(e.dataSource&&e.dataSource.virtualDataSource?(e._editInfo={row:i.data},e._virtualDataRequest("remove",(function(t){if(t){const t=e.rows.indexOf(i);e.rows.splice(t,1),delete e.rowById[i.id]}}))):e.rows.splice(n,1))}t&&e.endUpdate(),e._clearBatchEdit(!1),e.$.fireEvent("saveBatchEdit")}_clearBatchEdit(){const e=this;let t=!1;e._rowsAdded&&e._rowsAdded.length>0&&(t=!0),e._cellsUpdatedValues=[],e._rowsAdded=[],e._rowsDeleted=[],e._nearRowsAdded=[],e._farRowsAdded=[],t?e.refresh():e._recycle(!1),e.$.fireEvent("clearBatchEdit")}_getEditorId(e){return e.editor!==e.column.editor?e.editor.template+"_"+e.column.dataField+"_"+e.row.id:e.editor.template+"_"+e.column.dataField}_applyCommand(e,t){const i=this;t||(t=[]);const n=function(){"function"==typeof e?e.apply(i,t):i[e]?i[e].apply(i,t):Smart[e]?Smart[e].apply(i,t):window[e]&&window[e].apply(i,t)};if(i.onCommand){t||(t=[]),t[1]||(t[1]=null);const o={name:e,command:n,details:t[0],event:t[1],handled:!1};setTimeout(()=>{i.onCommand.apply(i,[o]),o.handled||n()},200)}else n()}_getCommandColumnCommandsTemplate(){const e=this,t=e.editing.commandColumn.dataSource,i="icon"!==e.editing.commandColumn.displayMode,n="label"!==e.editing.commandColumn.displayMode;let o="";for(let a in t){const l=t[a];let d="<div",r=!1;if("commandColumnMenu"===a)continue;r||(d+=' item="'+a+'" command="'+l.command+'" class="smart-grid-command-item">',r=!0);const s="{{messages}}"===l.label?e.localize(a):l.label;n&&i?(d+='<span class="smart-grid-icon '+l.icon+'"></span>',d+='<span class="smart-grid-label">'+s+"</span>"):n&&!i?d+='<span title="'+s+'" class="smart-grid-icon '+l.icon+'"></span>':i&&!n&&(d+='<span class="smart-grid-label">'+s+"</span>"),d+="</div>",o+=d}return o}_updateCommandColumnCommandsVisibility(e,t){const i=this,n=e.children,o=i.editing.commandColumn.dataSource;for(let e=0;e<n.length;e++){const a=n[e],l=a.getAttribute("item"),d=o[l].visible;!0===d?a.classList.remove("smart-hidden"):!1===d?a.classList.add("smart-hidden"):"auto"===d&&(!i.editing.dialog.enabled&&(i.editing.editRow===t||i.editing.editCell&&i.editing.editCell.row===t)?"commandColumnEdit"===l?a.classList.add("smart-hidden"):"commandColumnUpdate"!==l&&"commandColumnCancel"!==l||n[e].classList.remove("smart-hidden"):"commandColumnEdit"===l?a.classList.remove("smart-hidden"):"commandColumnUpdate"!==l&&"commandColumnCancel"!==l||n[e].classList.add("smart-hidden"))}}_handleEditKeyDown(e){const t=this,i=e.key,n=t.editing.commandKeys;if(!t.editing.dialog.enabled)for(let o in n){const a=n[o],l=a.key.replace(/ /gi,"").split("|");if(("Tab"!==i||!t.editing.editRow)&&l.indexOf(i)>=0){"Enter"===i&&e&&e.stopPropagation(),t._applyCommand(a.command);break}}}_getCustomCellEditor(e){const t=this;e.editor.selector=e.editor.template,e.editor.template="custom";const i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("div");t._applyCellEditorUserSettings(n,e),n.classList.add("smart-grid-cell-editor");const o=function(e){"keydown"!==e.type||t._handleEditKeyDown(e)},a=function(){const t=e.editor.instance.element.firstElementChild;e.editor.focus?setTimeout((function(){e.editor.focus.apply(e.editor.instance.element,[])}),50):setTimeout((function(){t.focus()}),50)},l=function(t){const i=e.editor.instance.element.firstElementChild;e.editor.blur?e.editor.blur.apply(e.editor.instance.element,[t]):i.blur()},d=function(t){const i=e.editor.instance.element.firstElementChild;if(e.editor.setValue)e.editor.setValue.apply(e.editor.instance.element,[t]);else{if(i.innerHTML.indexOf("{{")>=0){const n=i.innerHTML.replace(/{{value}}/gi,t).replace(/{{id}}/gi,e.row.id);i.innerHTML=n}i.value=t,t instanceof Date&&(i.value=t.toISOString().split("T")[0]),e.editor.instance.element.value=i.value}},r=function(){const t=e.editor.instance.element.firstElementChild;if(e.editor.getValue){const i=t.querySelector("input");return i&&i.blur(),e.editor.getValue.apply(e.editor.instance.element,[])}return t.value||""},s=function(){n.removeEventListener("keydown",o),e.editor.detach&&e.editor.detach.apply(n,[])},c=function(){n.addEventListener("keydown",o),e.editor.attach&&e.editor.attach.apply(n,[])};let u=null;if((e.editor.selector.startsWith("#")||e.editor.selector.startsWith("."))&&(u=document.querySelector(e.editor.selector)),u)n.appendChild(u.content.cloneNode(!0).firstElementChild);else{const t=function(e){const t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}(e.editor.selector);t&&n.appendChild(t)}t._cellEditors[i]={element:n,focus:a,blur:l,getValue:r,setValue:d,attach:c,detach:s}}return t._cellEditors[i]}_getTextAreaCellEditor(e){const t=this,i=t._getEditorId(e),n=document.createElement("div"),o=document.createElement("textarea"),a=document.createElement("div");t._applyCellEditorUserSettings(n,e),o.style.direction="",t.rightToLeft&&(o.style.direction="rtl"),o.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-text-area-cell-editor"),a.classList.add("nav"),a.classList.add("smart-icon-resize-full","smart-grid-icon");const l=function(e){let i=e.key;if("keydown"===e.type)return t._handleEditKeyDown(e),void(e.shiftKey&&" "===i&&(a.click(),e.preventDefault()))};a.onclick=function(){const i=document.createElement("div"),n=document.createElement("span"),l=document.createElement("textarea"),d=e.editor.instance.element,r=document.createElement("div"),s=document.createElement("smart-scroll-bar");s.orientation="vertical",i.setAttribute("theme",t.theme),r.appendChild(l),r.classList.add("smart-grid-text-area-container"),r.appendChild(s),l.value=o.value,l.classList.add("smart-input"),a.textAreaEditorDialog=i,a.popupTextArea=l,n.classList.add("close-button"),n.classList.add("smart-grid-icon"),n.classList.add("smart-icon-cancel-circled");const c=function(){s.value=l.scrollTop,s.max=l.scrollHeight-l.offsetHeight,s.onChange=null,l.offsetHeight>=l.scrollHeight?s.classList.add("smart-hidden"):s.classList.remove("smart-hidden"),s.onChange=function(){l.scrollTop=s.value}};l.onscroll=function(){c()},l.onkeydown=function(e){"Escape"===e.key&&i.parentNode.removeChild(i),"Enter"===e.key&&e.shiftKey&&n.click()},n.onclick=function(){a.textAreaEditorDialog.parentNode.removeChild(a.textAreaEditorDialog),setTimeout((function(){o.value=l.value,o.select()}),50)},i.classList.add("smart-grid-text-area-dialog"),i.appendChild(r),i.appendChild(n),document.body.appendChild(i),setTimeout((function(){l.select(),c()}),50),c(),i.style.top=t._offsetTop(d)+"px",i.style.left=t._offsetLeft(d)+"px",i.style.width=d.offsetWidth+"px"},n.appendChild(o),n.appendChild(a);return t._cellEditors[i]={element:n,focus:function(){setTimeout((function(){o.select()}),50)},blur:function(){},setValue:function(e){o.value=e},getValue:function(){const e=o.value;return a.textAreaEditorDialog&&a.textAreaEditorDialog.parentNode?(o.value=a.popupTextArea.value,o.value):e},attach:function(){o.addEventListener("keydown",l)},detach:function(){o.removeEventListener("keydown",l),a.textAreaEditorDialog&&a.textAreaEditorDialog.parentNode&&(o.value=a.popupTextArea.value,a.textAreaEditorDialog.parentNode.removeChild(a.textAreaEditorDialog))}},t._cellEditors[i]}_getInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("input");t._applyCellEditorUserSettings(n,e),e.editor.min&&(n.minLength=e.editor.min),e.editor.max&&(n.maxLength=e.editor.max),n.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-input-cell-editor"),n.autocomplete="off",n.style.direction="",t.rightToLeft&&(n.style.direction="rtl");const o=function(i){if("keydown"===i.type)return"number"!==e.column.dataType&&"int"!==e.column.dataType&&"float"!==e.column.dataType||t.editing.editColumn||i.key.match(/[0-9]/)||"-"===i.key||1!==i.key.length?void t._handleEditKeyDown(i):(i.preventDefault(),void i.stopPropagation())},a=function(){setTimeout((function(){n.select()}),50)},l=function(){},d=function(t){if(!e.column.rowHeaderColumn||t){if("number"===e.column.dataType||"int"===e.column.dataType||"float"===e.column.dataType){if(""===t)return;if(t&&!t.toString().match(/[0-9]/)&&"-"!==t)return}n.value=t}else n.value=e.editor.row.visibleIndex+1},r=function(){return n.value},s=function(){n.removeEventListener("keydown",o)},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:l,getValue:r,setValue:d,attach:c,detach:s}}return t._cellEditors[i]}_applyCellEditorUserSettings(e,t){for(let i in t.editor)"template"!==i&&("list"!==i?e[i]=t.editor[i]:e.setAttribute(i,t.editor[i]))}_getCheckInputCellEditor(e){return this._getAutoCompleteCellEditor(e,"smart-check-input")}_getMultiInputCellEditor(e){return this._getAutoCompleteCellEditor(e,"smart-multi-input")}_getMultiComboInputCellEditor(e){return this._getAutoCompleteCellEditor(e,"smart-multi-combo-input")}_getAutoCompleteCellEditor(e,t){const i=this,n=i._getEditorId(e);if(!i._cellEditors[n]){let o=document.createElement("smart-input");t&&(o=document.createElement(t)),i._applyCellEditorUserSettings(o,e),o.readonly&&(o.dropDownButtonPosition="right");const a=function(e){o.opened||"keydown"!==e.type||i._handleEditKeyDown(e)};o.rightToLeft=i.rightToLeft,o.classList.add("smart-grid-cell-editor"),o.classList.add("smart-grid-auto-complete-cell-editor");const l=function(){setTimeout(()=>{o&&o.select&&o.select()},50)},d=function(e){o.value=e},r=function(){return o.value},s=function(){o&&o.close&&(o.value="",o.close(),o.removeEventListener("keydown",a))},c=function(){},u=function(){o.addEventListener("keydown",a)};i._cellEditors[n]={element:o,focus:l,blur:c,setValue:d,getValue:r,attach:u,detach:s}}if(!e.editor.dataSource){const t=i.getVisibleRows(),o=[];for(let n=0;n<t.length;n++){let a=i.dataSource[t[n].index];a&&(a=a[e.column.dataField],-1===o.indexOf(a)&&o.push(a))}i._cellEditors[n].element.dataSource=o}return i._cellEditors[n]}_getDateRangeInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-range-input");n.dropDownButtonPosition="right",n.dropDownAppendTo="body",n.autoClose=!0,n.selectionMode="default",n.rightToLeft=t.rightToLeft,n.timepicker=!0,t._applyCellEditorUserSettings(n,e);const o=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const a=function(){setTimeout(()=>{n.select()},50)},l=function(e){n.value=e},d=function(){return n._performSelect(),n.selectedDates},r=function(){n.value="",n.close(),n.removeEventListener("keydown",o)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:s,setValue:l,getValue:d,attach:c,detach:r}}return t._cellEditors[i]}_getDateTimePickerCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-time-picker");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const o=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const a=function(){setTimeout(()=>{n.select()},50)},l=function(e){n.value=e},d=function(){return n.value},r=function(){n.value="",n.close(),n.removeEventListener("keydown",o)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:s,setValue:l,getValue:d,attach:c,detach:r}}return t._cellEditors[i]}_getTimeInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-time-input");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const o=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const a=function(){setTimeout(()=>{n.select()},50)},l=function(e){n.value=e},d=function(){const e=new Date;return e.setHours(n.value[0]),e.setMinutes(n.value[1]),"Invalid Date"===e.toString()?new Date:e},r=function(){n.value="",n.close(),n.removeEventListener("keydown",o)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:s,setValue:l,getValue:d,attach:c,detach:r}}return t._cellEditors[i]}_getDateInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-date-input");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",n.rightToLeft=t.rightToLeft,n.formatString=(!e.column.cellsFormat||1!==e.column.cellsFormat.length&&"d"!==e.column.cellsFormat)&&e.column.cellsFormat?e.column.cellsFormat:"MM/dd/yyyy",t._applyCellEditorUserSettings(n,e);const o=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-date-time-picker-cell-editor");const a=function(){setTimeout(()=>{n.select()},50)},l=function(e){n.value=e},d=function(){return n.getValue()},r=function(){n.value="",n.close(),n.removeEventListener("keydown",o)},s=function(e){const i=n.getAttribute("aria-controls");if(i&&n.opened){const n=t.getBoundingRect(document.getElementById(i));e.pageX<n.left||e.pageX>n.right||e.pageY<n.top||e.pageY>n.bottom||e.preventDefault()}},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:s,setValue:l,getValue:d,attach:c,detach:r}}return t._cellEditors[i]}_getMaskCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-masked-text-box");n.rightToLeft=t.rightToLeft,t._applyCellEditorUserSettings(n,e);const o=function(e){n.opened||"keydown"!==e.type||t._handleEditKeyDown(e)};n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-masked-text-box-cell-editor");const a=function(){setTimeout(()=>{n.select()},50)},l=function(e){n.value=e,1===e.length&&(n.$.input.selectionStart=n.$.input.selectionEnd=n.$.input.value.indexOf(e)+1)},d=function(){return n.value},r=function(){n.value="",n.removeEventListener("keydown",o)},s=function(){},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:s,setValue:l,getValue:d,attach:c,detach:r}}return t._cellEditors[i]}_getNumberInputCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const n=document.createElement("smart-number-input");if(t._applyCellEditorUserSettings(n,e),"{}"===JSON.stringify(n.numberFormat)){let i={};if(e.column.cellsFormat)if(e.column.cellsFormat.indexOf("c")>=0){i={style:"currency",currency:t.messages[t.locale].calendar.currency};let n=parseInt(e.column.cellsFormat.substring(1));isNaN(n)||(i.maximumFractionDigits=n)}else if(e.column.cellsFormat.indexOf("p")>=0){i={style:"percent"};let t=parseInt(e.column.cellsFormat.substring(1));isNaN(t)||(i.maximumFractionDigits=t)}else e.column.Intl&&e.column.Intl.NumberFormat&&(i=e.column.Intl.NumberFormat);n.numberFormat=i}n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-number-input-cell-editor");const o=function(e){t._handleEditKeyDown(e)},a=function(){setTimeout((function(){n.focus()}),50)},l=function(){},d=function(e){n.isReady&&n.setValue(e)},r=function(){return n.getValue()},s=function(){n.removeEventListener("keydown",o)},c=function(){n.addEventListener("keydown",o)};t._cellEditors[i]={element:n,focus:a,blur:l,getValue:r,setValue:d,attach:c,detach:s}}return t._cellEditors[i]}_getCheckBoxCellEditor(e){const t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){const e=document.createElement("div");e.classList.add("smart-input"),e.classList.add("smart-grid-cell-editor"),e.classList.add("smart-grid-check-box-cell-editor"),e.tabIndex=0;const n=function(){!0!==e.value&&!1!==e.value&&null!==e.value&&(e.value=!1),null===e.value?e.value=!1:e.value=!e.value,!1===e.value?e.removeAttribute("checked"):e.setAttribute("checked",e.value?"":"indeterminate")},o=function(e){if(" "!==e.key){switch(e.key){case"ArrowLeft":case"ArrowDown":case"ArrowRight":case"ArrowUp":if(t.editing.dialog.enabled)return;t.endEdit()}t._handleEditKeyDown(e)}else n()},a=function(t){e.value=t,!1===e.value?e.removeAttribute("checked"):e.setAttribute("checked",e.value?"":"indeterminate")},l=function(){e.focus(),setTimeout((function(){e.focus()}),25)},d=function(){return e.value},r=function(){e.value=!1,e.removeEventListener("click",n),e.removeEventListener("keydown",o)},s=function(){},c=function(){e.addEventListener("keydown",o),e.addEventListener("click",n)};t._cellEditors[i]={getValue:d,setValue:a,focus:l,blur:s,element:e,detach:r,attach:c}}return t._cellEditors[i]}_getEditorValue(e){const t=this._getEditorId(e);if(!this._cellEditors)return;const i=this._cellEditors[t];if(!i)return;const n=function(t){switch(e.column.dataType){case"float":case"int":case"number":t="int"===e.column.dataType?parseInt(t):parseFloat(t),isNaN(t)&&(t=0);break;case"bool":case"boolean":"true"!==t&&"1"!==t||(t=!0),"false"!==t&&"0"!==t||(t=!1);break;case"date":if(t instanceof Date)return t;"string"==typeof t&&(t=new Date(t));break;case"dateTime":t=new Smart.Utilities.DateTime(t)}return t};let o=null;switch(e.editor.template){case"dateRangeInput":try{o=i.getValue()}catch(t){o=e.value}if(e.editor.getValue){const t=e.editor.getValue(e,o);void 0!==t&&(o=t)}break;case"input":case"autoComplete":case"numberInput":case"dateInput":case"timeInput":case"deteTimePicker":case"checkBox":try{o=n(i.getValue())}catch(t){o=e.value}if(e.editor.getValue){const t=e.editor.getValue(e,o);void 0!==t&&(o=t)}break;default:o=n(i.getValue())}let a=!0,l=!1,d=!1;if(e.column.validator)a=e.column.validator.evaluate(o);else if("string"==typeof o){const t=e.editor.minLength||e.editor.min||0,i=e.editor.maxLength||e.editor.max||999999;(o.length<t||o>i)&&(a=!1),o.length<t&&(l=!0),o.length>i&&(d=!0),e.editor.instance.element&&e.editor.instance.element.checkValidity&&(a=e.editor.instance.element.checkValidity())}if(a)return o;let r=null;const s=e.editor.instance.element;return s&&(r=s.validity,r&&(r.custom&&delete r.custom,l&&(r.custom={minLength:!0,value:e.editor.min}),d&&(r.custom={maxLength:!0,value:e.editor.max}),r.message=s.validationMessage)),{error:!0,validity:r,value:o}}_beginRowEdit(e,t){const i=this;if(e===i.editing.editRow)return!1;if(i.editing.editRow){if(!i.endEdit())return!1}const n=e.cells;i.editing.editRow=e,i.editing.commandColumn.visible&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),e.isEditing=!0;let o=!1;for(let e=0;e<n.length;e++){const a=n[e],l=i._beginCellEdit(a);l&&(t?a===t&&a.editor.instance.focus():l&&!o&&(o=!0,a.editor.instance.focus()),i.editing.commandColumn.visible&&a.column.commandColumn&&a.render())}return!0}_createOverlay(){const e=document.createElement("div");return e.onpointerdown=function(){return!1},e.onmousedown=function(){return!1},e.onclick=function(){},e.classList.add("smart-grid-dialog-overlay"),e}_createDialog(e){const t=this,i=document.createElement("div");e||(e=t.editing.dialog),i.setAttribute("animation","none"),i.classList.add("smart-window","smart-grid-dialog"),i.style.width="auto"===e.width?e.width:e.width+"px",i.style.height="auto"===e.height?e.height:e.height+"px",i.style.left="",i.style.top="",i.innerHTML='<div class="smart-container">\n                   <div class ="smart-content-container" smart-id="container">\n                        <div id="headerSection" class="smart-header-section">\n                            <div class="smart-header"></div>\n                            <div class="smart-buttons-container">\n                                <button class ="smart-button smart-element smart-close-button" aria-label="Close" smart-id="closeButton"></button>\n                            </div>\n                        </div>\n                        <div class="smart-content"><div></div></div>\n                        <div class ="smart-footer">\n                            <div class ="smart-stack-layout right spacing">\n                                <smart-button class ="smart-confirm-button item primary">Ok</smart-button>\n                                <smart-button class ="smart-cancel-button item">Cancel</smart-button>\n                            </div>\n                        </div>\n                    </div>\n              </div>\n            ',i.content=i.querySelector(".smart-content").firstChild,i.footer=i.querySelector(".smart-footer"),i.header=i.querySelector(".smart-header"),i.btnConfirm=i.querySelector(".smart-confirm-button"),i.btnCancel=i.querySelector(".smart-cancel-button"),i.btnClose=i.querySelector(".smart-close-button");const n=document.createElement("div");return n.classList.add("smart-grid-dialog-overlay"),n.onclick=function(){},i.overlay=n,i.remove=function(){i.parentNode&&i.parentNode.removeChild(i)},i.close=function(){i.classList.remove("open"),i.addEventListener("transitionend",i.remove),i.addEventListener("transitioncancel",i.remove),i.modal&&i.overlay.parentNode&&i.overlay.parentNode.removeChild(i.overlay),i.onClose&&i.onClose()},i.open=function(n,o){i.removeEventListener("transitionend",i.remove),i.removeEventListener("transitioncancel",i.remove),document.body.appendChild(i),n||(n=e.left),o||(o=e.top),requestAnimationFrame((function(){i.classList.add("open");const e=function(e,n){const o=t.offset(t);switch("center"===e&&"horizontal"===n&&(e="middle"),e){case"top":return o.top;case"bottom":return Math.max(o.top,o.top+t.offsetHeight-i.offsetHeight);case"center":return Math.max(o.top,o.top+t.offsetHeight/2-i.offsetHeight/2);case"left":return o.left;case"middle":return o.left+t.offsetWidth/2-i.offsetWidth/2;case"right":return o.left+t.offsetWidth-i.offsetWidth}return"horizontal"===n?parseInt(e)+o.left:"vertical"===n?parseInt(e)+o.top:"number"==typeof e?e:parseInt(e)};i.style.left=e(n,"horizontal")+"px",i.style.top=e(o,"vertical")+"px"})),i.modal&&t.appendChild(i.overlay),i.onOpen&&i.onOpen()},i}_openAddRowDialog(e,t){const i=this;if(!i.editing.addDialog.enabled)return!1;const n=i._dialogAddRow||i._createDialog(),o="{{message}}"===i.editing.dialog.header?i.localize("dialogAddHeader"):i.editing.dialog.header,a=n.content;n.header.innerHTML=o,e.grid=i,void 0===e.index&&(e.index=i.rows.length,i._rowsAdded&&(e.index+=i._rowsAdded.length));const l=e.cells;let d=null,r=0;if(i._cellEditors||(i._cellEditors=[]),!i._dialogAddRow){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogAddButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogAddButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){const e={};for(let t=0;t<l.length;t++){const n=l[t],o=i._getEditorValue(n),a=i._getEditorId(n),d=i._cellEditors[a];d&&(e[n.column.dataField]=o,d.detach())}const o=i._rowsAdded?i._rowsAdded.length:0,a=new Smart.Grid.Row({index:i.rows.length+o,id:Smart.Utilities.Core.createGUID(),grid:i,data:e});n.close(),t(a,0===n.index)},n.onkeydown=function(e){const t=e.key;"Enter"===t?n.btnConfirm.onclick():"Escape"===t&&n.close()},a.classList.add("smart-grid-layout");for(let e=0;e<i.columns.length;e++){const t=i.columns[e];if(!t.allowEdit)continue;r%2==0&&(d=document.createElement("div"),d.classList.add("row"),a.appendChild(d));const n=document.createElement("div");n.classList.add("col-sm-6");const o=document.createElement("div");o.classList.add("column");const l=document.createElement("label");l.innerHTML=i.columns[e].label;const s=document.createElement("div");s.classList.add("smart-grid-dialog-editor"),s.setAttribute("editor",t.dataField),s.setAttribute("template",t.editor.template),n.appendChild(o),d.appendChild(n),o.appendChild(l),o.appendChild(s),r++}}n.open(),n.index=e.index;let s=0;for(let e=0;e<l.length;e++){const t=l[e],o=t.column,a=o.dataField,d=n.querySelector("[editor="+a+"]");if(!d)continue;d.innerHTML="";let r="";void 0!==t.value?r=t.value:("int64"!==o.dataType&&"number"!==o.dataType&&"int"!==o.dataType&&"float"!==o.dataType||(r=0),"date"===o.dataType&&(r=new Date),"bool"!==o.dataType&&"boolean"!==o.dataType||(r=!1));let c=null;switch(t.editor.template){default:case"custom":c=i._getCustomCellEditor(t);break;case"checkBox":c=i._getCheckBoxCellEditor(t);break;case"autoComplete":c=i._getAutoCompleteCellEditor(t);break;case"dropDownList":c=i._getAutoCompleteCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"comboBox":c=i._getAutoCompleteCellEditor(t),c.readonly=!1,c.dropDownButtonPosition="right";break;case"maskedTextBox":c=i._getMaskCellEditor(t);break;case"checkInput":c=i._getCheckInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiInput":c=i._getMultiInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiComboInput":c=i._getMultiComboInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"time":case"timeInput":c=i._getTimeInputCellEditor(t);break;case"date":case"dateInput":c=i._getDateInputCellEditor(t);break;case"dateRangeInput":c=i._getDateRangeInputCellEditor(t);break;case"dateTimePicker":c=i._getDateTimePickerCellEditor(t);break;case"textArea":case"textarea":c=i._getTextAreaCellEditor(t);break;case"numberInput":case"text":case"input":c="numberInput"===t.editor.template?i._getNumberInputCellEditor(t):i._getInputCellEditor(t)}c.attach(),t.editor.instance=c,c.setValue(r),0===s&&setTimeout(()=>{c.focus()},100),t.editor.isInitialized||(t.editor.isInitialized=!0,t.editor.onInit&&t.editor.onInit(t.row.index,t.column.dataField,t.editor.instance.element)),t.editor.onRender&&t.editor.onRender(t.row.index,t.column.dataField,t.editor.instance.element),d.appendChild(c.element),s++}i._dialogAddRow=n}_openEditDialog(e,t){const i=this;if(!i.editing.dialog.enabled)return!1;const n=i._dialogEdit||i._createDialog(),o="{{message}}"===i.editing.dialog.header?i.localize("dialogEditHeader",{value:i.editing.editRow?e.row.visibleIndex+1:e.column.label}):i.editing.dialog.header,a=n.content;n.header.innerHTML=o;let l=null,d=0;if(!i._dialogEdit)if(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){i.cancelEdit()},n.btnClose.onclick=function(){i.cancelEdit()},n.btnConfirm.onclick=function(){i.endEdit()},n.onkeydown=function(e){const t=e.key,n=i.editing.commandKeys;for(let e in n){const o=n[e];if(t===o.key){i._applyCommand(o.command);break}}},i.editing.editRow){a.classList.add("smart-grid-layout");for(let e=0;e<i.columns.length;e++){const t=i.columns[e];if(!t.allowEdit)continue;d%2==0&&(l=document.createElement("div"),l.classList.add("row"),a.appendChild(l));const n=document.createElement("div");n.classList.add("col-sm-6");const o=document.createElement("div");o.classList.add("column");const r=document.createElement("label");r.innerHTML=i.columns[e].label;const s=document.createElement("div");s.classList.add("smart-grid-dialog-editor"),s.setAttribute("editor",t.dataField),s.setAttribute("template",t.editor.template),n.appendChild(o),l.appendChild(n),o.appendChild(r),o.appendChild(s),d++}}else{const t=e.column,i=document.createElement("div");i.classList.add("smart-grid-dialog-editor"),i.setAttribute("editor",""),i.setAttribute("template",t.editor.template),a.appendChild(i)}if(n.open(),i.editing.editRow){const i=n.querySelector("[editor="+e.column.dataField+"]");i.innerHTML="",i.appendChild(t.element)}else{const i=e.column,o=n.querySelector("[editor]");o.innerHTML="",o.setAttribute("template",i.editor.template),o.appendChild(t.element)}i._dialogEdit=n}_openDeleteRowDialog(e,t){const i=this;if(!i.editing.deleteDialog.enabled)return!1;const n=i._dialogDelete||i._createDialog(),o="{{message}}"===i.editing.dialog.header?i.localize("dialogDeleteHeader",{value:e.visibleIndex+1}):i.editing.dialog.header;n.header.innerHTML=o,n.content.innerHTML=i.localize("dialogDeleteContent"),n.row=e,i._dialogDelete||(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogDeleteButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogDeleteButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){t(n.row),n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogDelete=n),n.open(),setTimeout((function(){n.btnConfirm.focus()}),100)}_getAddColumnDataFieldsEditorDataSource(){const e=this;let t=e.dataSource?[...e.dataSource.dataFields].map(e=>(e.value=e.label=e.name,e)):[];return t=t.filter(t=>{let i=!0;return e.columns.forEach(e=>{if(e.dataField===t.name)return i=!1,!0}),i}),t}_getAddColumnDialogTemplate(){const e=(new Date).getFullYear().toString();return[{bind:"name",type:"input",label:"Name",filter:"any",info:"Name of the column"},{bind:"dataField",type:"dropDownList",label:"Data field",filter:"any",info:"Bind the column",options:this._getAddColumnDataFieldsEditorDataSource()},{bind:"type",name:"typeslist",type:"dropDownList",filter:"any",label:"Type",options:[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"option",label:"List"},{value:"multioption",label:"List with multiple selections"},{value:"boolean",label:"CheckBox"},{value:"date",label:"Date"},{value:"time",label:"Time"},{value:"datetime",label:"Date and Time"}],info:"Type of the data in the column"},{bind:"dateFormat",name:"dateformat",type:"dropDownList",label:"Date format",options:[{value:"M/d/yyyy",dateTimeFormat:{year:"numeric",day:"numeric",month:"numeric"},label:"7/3/"+e},{value:"MM/dd/yyyy",dateTimeFormat:{year:"numeric",day:"numeric",month:"numeric"},label:"07/03/"+e},{value:"ddd, MMM dd, yyyy",dateTimeFormat:{year:"numeric",day:"numeric",month:"numeric"},label:"Tuesday, July 03, "+e},{value:"M/d",label:"7/3",dateTimeFormat:{day:"numeric",month:"numeric"}},{value:"MM/dd",label:"07/03",dateTimeFormat:{day:"numeric",month:"numeric"}},{value:"M/d/yy",label:"7/3/"+e.substring(2),dateTimeFormat:{year:"2-digit",day:"numeric",month:"numeric"}},{value:"MM/dd/yy",label:"07/03/"+e.substring(2),dateTimeFormat:{year:"2-digit",day:"2-digit",month:"2-digit"}},{value:"dd-MMM",label:"03-Jul",dateTimeFormat:{day:"numeric",month:"numeric"}},{value:"dd-MMM-yy",label:"03-Jul-"+e.substring(2),dateTimeFormat:{day:"numeric",month:"numeric",year:"numeric"}},{value:"d/M/yyyy",label:"3/7/"+e,dateTimeFormat:{day:"numeric",month:"numeric",year:"numeric"}},{value:"dd/MM/yyyy",label:"03/07"+e,dateTimeFormat:{day:"numeric",month:"numeric",year:"numeric"}},{value:"d/M",label:"3/"+e.substring(2),dateTimeFormat:{day:"numeric",month:"numeric"}},{value:"dd/MM",label:"03/"+e.substring(2),dateTimeFormat:{day:"numeric",month:"numeric"}},{value:"d/M/yy",label:"3/7/"+e.substring(2),dateTimeFormat:{day:"numeric",month:"numeric",year:"numeric"}},{value:"dd/MM/yy",label:"03/07/"+e.substring(2),dateTimeFormat:{day:"numeric",month:"numeric",year:"numeric"}}],filter:"date",info:"Choose the dates display format"},{bind:"timeFormat",name:"timeformat",type:"dropDownList",label:"Time format",filter:"time",options:[{value:"HH:mm:ss",label:"14:10:55"},{value:"hh:mm:ss tt",label:"02:10:55 PM"},{value:"h:m:ss tt",label:"2:5:55 PM"},{value:"h:m tt",label:"2:15 PM"},{value:"HH:mm",label:"14:31"}],info:"Choose the time display format"},{bind:"numberFormat",name:"numberFormat",type:"dropDownList",label:"Number Format",filter:"number",options:[{value:{style:"decimal",maximumFractionDigits:0},label:"Integer 1,000"},{value:{style:"decimal",minimumFractionDigits:2},label:"Number 1,000.12"},{value:{style:"percent",minimumFractionDigits:2},label:"Percent 10.12%"},{value:{style:"percent",maximumFractionDigits:0,minimumFractionDigits:0},label:"Percent(rounded) 10%"},{value:{style:"decimal",notation:"scientific"},label:"Scientific 1.01E+03"},{value:{style:"decimal",notation:"engineering"},label:"Engineering 34.284 x 10^9"},{value:{style:"currency",currency:this.messages[this.locale].calendar.currency,currencySign:"accounting"},label:"Accounting $(1,000.12)"},{value:{currencySign:"accounting"},label:"Financial (1,000.12)"},{value:{style:"currency",currency:this.messages[this.locale].calendar.currency},label:"Currency $1,000.12"},{value:{style:"currency",currency:this.messages[this.locale].calendar.currency,maximumFractionDigits:0,minimumFractionDigits:0},label:"Currency(rounded) $1,000"}],required:!1,info:"Choose the number display format"},{bind:"minLength",name:"minlength",type:"number",filter:"text",label:"Minimum length",required:!1,info:"Minimum text length"},{bind:"maxLength",name:"maxlength",filter:"text",type:"number",label:"Maximum length",required:!1,info:"Maximum text length"},{bind:"minValue",name:"minvalue",filter:"number",type:"number",label:"Minimum value",required:!1,info:"Minimum number"},{bind:"maxValue",name:"maxvalue",filter:"number",type:"number",label:"Maximum value",required:!1,info:"Maximum number"},{bind:"minDateTime",name:"mindatetime",type:"datetime",filter:"date",label:"Minimum date",info:"Minimum date"},{bind:"maxDateTime",name:"maxdatetime",type:"datetime",filter:"date",label:"Maximum date",info:"Maximum date"},{bind:"options",name:"listitems",type:"textArea",label:"List items",filter:"list",info:"Enter a list of items separated by comma"},{name:"align",bind:"cellsAlign",type:"dropDownList",label:"Align",required:!1,options:[{value:"left",label:"Left"},{value:"right",label:"Right"},{value:"center",label:"Center"}],filter:"any",info:"Cells text alignment"},{bind:"allowResize",type:"boolean",label:"Resizable",filter:"any",info:"Select if you want to make the column resizable"},{bind:"required",type:"boolean",label:"Required",filter:"text",info:"Select if you want to make the column required"},{bind:"allowSort",type:"boolean",label:"Sortable",filter:"any",info:"Select if you want to sort by this column"},{bind:"allowFilter",type:"boolean",label:"Filterable",align:"left",filter:"any",info:"Select if you want to filter by this column"},{bind:"allowEdit",type:"boolean",label:"Editable",filter:"any",info:"Select if you want to make the column editable"}]}_addColumnDialogShowHideEditors(){const e=this,t=e._dialogAddColumn.querySelector('[bind="type"]').querySelector("smart-input").getSelectedItem().value,i=e._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor");let n=!1;for(let o=0;o<i.length;o++){const a=i[o],l=a.getAttribute("filter"),d=a.getAttribute("bind"),r=a.parentNode;if(r.classList.add("smart-hidden"),"dataField"===d){const t=a.querySelector("smart-input"),i=t.getSelectedItem().value;let o=null;if(e.dataSource&&e.dataSource.dataFields){o=e.dataSource.dataFields.find(e=>{if(e.name===i)return!0})}if(o&&(n=!0),e._dialogAddColumn.editColumn){r.classList.add("smart-hidden"),n=!0;continue}if(!t.dataSource||0===t.dataSource.length){r.classList.add("smart-hidden");continue}}if("cellsAlign"!==d||"boolean"!==t)if("type"===d&&n)r.classList.add("smart-hidden");else if("any"!==l)if("allowResize"!==d||"none"!==e.behavior.columnResizeMode)if("allowFilter"!==d||!1!==e.filtering.enabled)if("allowSort"!==d||!1!==e.sorting.enabled)if("allowEdit"!==d||!1!==e.editing.enabled)if("required"!==d||!1!==e.editing.enabled)switch(t){default:case"text":"text"===l&&r.classList.remove("smart-hidden");break;case"number":"number"===l&&r.classList.remove("smart-hidden");break;case"option":case"multioption":"list"===l&&r.classList.remove("smart-hidden");break;case"boolean":break;case"date":"date"===l&&r.classList.remove("smart-hidden");break;case"time":"time"===l&&r.classList.remove("smart-hidden");break;case"datetime":"date"===l&&r.classList.remove("smart-hidden"),"time"===l&&r.classList.remove("smart-hidden")}else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.add("smart-hidden");else r.classList.remove("smart-hidden");else r.classList.add("smart-hidden")}}_addColumnDialogInitEditors(){const e=this,t=e._addColumnDialogEditors.dataField.querySelector("smart-input"),i=e._dialogAddColumn.editColumn;t.value="",t.dataSource=e._getAddColumnDataFieldsEditorDataSource();for(let t in e._addColumnDialogEditors){const n=e._addColumnDialogEditors[t],o=n.querySelector("input"),a=n.querySelector("smart-input");switch(t){case"allowResize":case"allowSort":case"allowEdit":case"allowFilter":case"required":{const e=n.querySelector(".smart-input");i?i[t]?(e.value=!0,e.setAttribute("checked","")):!1===i[t]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}}if(i&&"type"===t&&("number"===i.dataType||"int"===i.dataType?a.selectedIndex=1:"date"===i.dataType?a.selectedIndex=5:"bool"!==i.dataType&&"boolean"!==i.dataType||(a.selectedIndex=4)),"cellsAlign"===t&&i&&("center"===i.cellsAlign||"middle"===i.cellsAlign?a.selectedIndex=2:"right"===i.cellsAlign&&(a.selectedIndex=1)),o){if("dataField"!==t&&a&&(a.selectedIndex=0),"name"===t&&(a.value=i?i.label:""),"dataField"===t&&(a.value=i?i.dataField:""),"minValue"===t?o.value=0:"maxValue"===t?o.value=100:"minLength"===t?o.value=0:"maxLength"===t&&(o.value=500),"minDateTime"===t){n.querySelector("smart-date-input").value=new Date(1900,0,1)}else if("maxDateTime"===t){n.querySelector("smart-date-input").value=new Date(2100,0,1)}i&&i.editor&&i.editor[t]&&(o.value=i.editor[t])}}}_openAddColumnDialog(e){const t=this,i=t._dialogAddColumn||t._createDialog(t.editing.addColumnDialog),n=e?t.localize("dialogEditColumn",{value:e.label}):t.localize("dialogAddColumn"),o=i.querySelector(".smart-footer").querySelector(".smart-stack-layout");i.classList.add("smart-grid-dialog-add-column"),i.type=e?"customize":"add",i.editColumn=e||null,o.classList.remove("right"),o.classList.add("center"),t._cellEditors||(t._cellEditors=[]);const a=t._getAddColumnDialogTemplate();if(i.header.innerHTML=n,!t._dialogAddColumn){i.modal=!0,i.btnConfirm.innerHTML=t.localize("dialogEditButtonConfirm"),i.btnCancel.innerHTML=t.localize("dialogEditButtonCancel"),i.onOpen=function(){t._addColumnDialogInitEditors(),t._addColumnDialogShowHideEditors(),t.$.fireEvent("openColumnDialog",{column:i.editColumn})},i.onClose=function(){},i.btnCancel.onclick=function(){i.close()},i.btnClose.onclick=function(){i.close()},i.btnConfirm.onclick=function(){const e=t._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor");let n,o,a={};for(let t=0;t<e.length;t++){const i=e[t],n=i.querySelector(".smart-input"),o=i.getAttribute("bind");"minLength"!==o&&"maxLength"!==o&&"minValue"!==o&&"maxValue"!==o&&"minDateTime"!==o&&"maxDateTime"!==o?n.getSelectedItem?a[o]=n.getSelectedItem().value:a[o]=n.value:a[o]=n.getValue()}i.data=a;let l={},d={},r="";if(n=a.minDateTime,o=a.maxDateTime,"time"===a.type?(l={template:"timeInput",min:n,max:o},r=a.timeFormat):"date"===a.type||"datetime"===a.type?(l={template:"dateInput",min:n,max:o},r=a.dateFormat,"datetime"===a.type&&(r+=" "+a.timeFormat)):"number"===a.type?(n=parseInt(a.minValue),o=parseInt(a.maxValue),l={template:"numberInput",min:n,max:o,numberFormat:a.numberFormat},d={Intl:{NumberFormat:a.numberFormat}},r="d"):"boolean"===a.type?l={template:"checkBox"}:"option"===a.type?l={template:"dropDownList",readonly:!0,dropDownButtonPosition:"right",autoOpen:!0,dataSource:a.options.split(",").map(e=>e.trim())}:"multioption"===a.type?l={template:"multiInput",readonly:!0,dropDownButtonPosition:"right",autoOpen:!0,dataSource:a.options.split(",").map(e=>e.trim())}:(n=a.minLength,o=a.maxLength,l={template:"input",min:n,max:o,required:a.required}),t._dialogAddColumn.editColumn){const e=t._dialogAddColumn.editColumn;e.canNotify=!1,e.label=a.name,e.allowResize=a.allowResize,e.allowSort=a.allowSort,e.allowFilter=a.allowFilter,e.allowEdit=a.allowEdit,e.align=e.cellsAlign=a.cellsAlign,e.cellsFormat=r,e.editor=l,e.formatSettings=d,e.canNotify=!0,t.$.fireEvent("closeColumnDialog",{column:e}),t._recycle(!0)}else{const e=new Smart.Grid.Column({label:a.name,dataField:a.dataField||"dataField"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),allowResize:a.allowResize,allowSort:a.allowSort,allowFilter:a.allowFilter,allowEdit:a.allowEdit,dataType:a.type,editor:l,formatSettings:d,cellsAlign:a.cellsAlign,align:a.cellsAlign,cellsFormat:r,grid:t});"boolean"===a.type&&(e.template="checkBox"),t.$.fireEvent("closeColumnDialog",{column:e}),t.columns.push(e)}i.close()},i.onkeydown=function(e){"Escape"===e.key&&i.close()},t._dialogAddColumn=i;const e=i.content;t._addColumnDialogEditors=[];for(let i=0;i<a.length;i++){const n=a[i],o=document.createElement("div"),l=document.createElement("label");l.innerHTML=n.label;const d=document.createElement("div");if(d.classList.add("smart-grid-dialog-editor","add-column"),d.innerHTML="",d.setAttribute("filter",n.filter),d.setAttribute("bind",n.bind),t._addColumnDialogEditors[n.bind]=d,"type"===n.bind&&d.addEventListener("change",()=>{t._addColumnDialogShowHideEditors()}),"boolean"===n.type){d.setAttribute("template","checkBox"),d.setAttribute("editor","");const t=document.createElement("div");t.classList.add("smart-input"),t.classList.add("smart-grid-cell-editor"),t.classList.add("smart-grid-check-box-cell-editor"),t.setAttribute("checked",""),t.value=!0,d.appendChild(t),t.onclick=function(){!0!==t.value&&!1!==t.value&&null!==t.value&&(t.value=!1),null===t.value?t.value=!1:t.value=!t.value,!1===t.value?t.removeAttribute("checked"):t.setAttribute("checked",t.value?"":"indeterminate")},e.appendChild(o),o.classList.add("smart-grid-dialog-boolean-field"),o.appendChild(d),o.appendChild(l)}else{let t=document.createElement("smart-input");if(t.classList.add("underlined"),t.style.width="100%",t.style.height="30px","textArea"===n.type?(t=document.createElement("smart-text-area"),t.classList.add("outlined"),t.style.width="100%",t.style.height="80px",t.placeholder=n.label,d.style.height="80px"):"number"===n.type?(t=document.createElement("smart-number-input"),t.classList.add("underlined"),t.style.width="100%",t.style.height="30px","minValue"===n.bind?(t.value=0,t.min=-9999999,t.max=9999999):"maxValue"===n.bind?(t.value=1e6,t.min=-9999999,t.max=9999999):"minLength"===n.bind?t.value=0:"maxLength"===n.bind&&(t.value=500)):"datetime"===n.type&&(t=document.createElement("smart-date-input"),t.classList.add("underlined"),t.style.width="100%",t.style.height="30px","minDateTime"===n.bind?t.value=new Date(1900,0,1):"maxDateTime"===n.bind&&(t.value=new Date(2100,0,1))),n.options&&(t.readonly=!0,t.dataSource=n.options,t.dropDownButtonPosition="right","dataField"!==n.bind&&(t.selectedIndex=0),"dataField"===n.bind&&(t.readonly=!1),n.options.length<15&&(t.dropDownHeight="auto")),d.appendChild(t),n.info){const e=document.createElement("span");e.classList.add("smart-grid-icon","smart-icon-attention-circled","show","smart-description-button"),e.title=n.info,d.appendChild(e),t.style.width="calc(100% - 25px)"}e.appendChild(o),o.classList.add("smart-grid-dialog-field"),o.appendChild(l),o.appendChild(d)}if("dataField"===n.bind){const e=d.querySelector("smart-input");d.addEventListener("change",()=>{let i="";const n=e.getSelectedItem().value,o=t._addColumnDialogEditors.type.querySelector(".smart-input");let a=null;if(t.dataSource&&t.dataSource.dataFields){a=t.dataSource.dataFields.find(e=>{if(e.name===n)return!0})}a?("number"===a.dataType||"int"===a.dataType?i=a.dataType:"string"===a.dataType?i="text":"date"===a.dataType?i="date":"bool"!==a.dataType&&"boolean"!==a.dataType||(i="boolean"),o.selectItem(i)):o.selectItem("text"),t._addColumnDialogShowHideEditors()})}}}if(e){const n=e.element,o=t.offset(n),a=t.offset(t);i.open(o.left-a.left,o.top+n.offsetHeight-a.top)}else i.open("middle","center");setTimeout((function(){i.btnConfirm.focus()}),100)}_openDescriptionDialog(e,t){const i=this,n=i._dialogDescription||i._createDialog(),o=i.localize("dialogDescriptionHeader",{value:e.label});if(n.header.innerHTML=o,n.column=e,n.command=t,!i._dialogDescription){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){const e=n.querySelector("smart-input");setTimeout(()=>{e.select()},250)},n.onClose=function(){},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){const e=n.querySelector("smart-input");switch(n.command){case"rename":n.column.label=e.value;break;case"editDescription":n.column.description=e.value}n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogDescription=n;const e=document.createElement("smart-input");e.classList.add("underlined"),n.content.appendChild(e)}const a=e.element,l=i.offset(a),d=i.offset(i);n.open(l.left-d.left,l.top+a.offsetHeight-d.top);const r=n.querySelector("smart-input");switch(t){case"rename":r.value=e.label;break;case"editDescription":r.value=e.description}setTimeout((function(){n.btnConfirm.focus()}),100)}_beginCellEdit(e,t){const i=this;if(e.isEditing)return!1;if(i._isUpdating)return!1;let n=!1;if(e.column.autoGenerated&&e.column.rowHeaderColumn&&i.editing.allowRowHeaderEdit&&new Date-i._clickTime<i.behavior.doubleClickTimingDelay&&i._clickedCell===e.element&&(n=!0),(!e.column.allowEdit||e.column.autoGenerated||e.readonly)&&!n)return!1;if(i.editing.editCell&&!i.editing.editRow){if(!1===i._endCellEdit())return!1}i._cellEditors||(i._cellEditors=[]),i.editing.editRow||(i.editing.editCell=e),i.editing.commandColumn.visible&&!i.editing.editRow&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),e.row.element.setAttribute("edit",""),i.editing.isEditing=!0,i._selection.selectionRect&&i._selection.selectionRect.classList.add("smart-visibility-hidden");const o=t=>{const n=t.element;i.editing.dialog.enabled?i._openEditDialog(e,t):(e.element||e.createElement(),e.element.setAttribute("editor","string"==typeof e.editor.template?e.editor.template:"template"),e.element.content.innerHTML="",e.element.content.appendChild(n),i.editing.editRow&&e.element.setAttribute("row-editor","")),t.attach(),e.editor.row=e.row,e.editor.column=e.column,e.editor.cell=e,e.editor.instance=t,e.isEditing=!0},a=i._cellsUpdatedValues?i._cellsUpdatedValues[e.row.id+"_"+e.column.dataField]:void 0;let l=void 0!==a?a:e.value;if(void 0===l){l="";const t=e.column;"number"===t.dataType||"int"===t.dataType||"float"===t.dataType?l=0:"date"===t.dataType&&(l=new Date,l.setHours(0,0,0))}switch(e.editor||(e.editor="input"),"string"==typeof e.editor&&(e.canNotify=!1,e.editor={template:e.editor,autoFocus:!0},e.canNotify=!0),e.editor.template){default:case"custom":{const t=i._getCustomCellEditor(e);o(t),t.setValue(l);break}case"checkBox":{const n=i._getCheckBoxCellEditor(e);o(n);const a=!0===l||1===l;if("checkBox"===e.template&&t){(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.clientX,t.clientY)[0].classList.contains("smart-input")?n.setValue(!a):n.setValue(a)}else n.setValue(a);break}case"autoComplete":{const t=i._getAutoCompleteCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"dropDownList":{e.editor.autoOpen=!0,e.editor.readonly=!0,e.editor.dropDownButtonPosition="right";const t=i._getAutoCompleteCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"comboBox":{e.editor.readonly=!1,e.editor.dropDownButtonPosition="right";const t=i._getAutoCompleteCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"maskedTextBox":{const t=i._getMaskCellEditor(e);o(t),t.setValue(l);break}case"multiInput":{const t=i._getAutoCompleteCellEditor(e,"smart-multi-input");o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"checkInput":{const t=i._getAutoCompleteCellEditor(e,"smart-check-input");o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"multiComboInput":{const t=i._getAutoCompleteCellEditor(e,"smart-multi-combo-input");o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"timeInput":{const t=i._getTimeInputCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"dateInput":{const t=i._getDateInputCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"dateRangeInput":{const t=i._getDateRangeInputCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"dateTimePicker":{const t=i._getDateTimePickerCellEditor(e);o(t),t.setValue(l),e.editor.autoOpen&&t.element.open();break}case"textArea":{const t=i._getTextAreaCellEditor(e);o(t),t.setValue(l);break}case"numberInput":case"text":case"input":{const t="numberInput"===e.editor.template?i._getNumberInputCellEditor(e):i._getInputCellEditor(e);o(t),t.setValue(l);break}}return e.editor.isInitialized||(e.editor.isInitialized=!0,e.editor.onInit&&e.editor.onInit(e.row.index,e.column.dataField,e.editor.instance.element)),e.editor.onRender&&e.editor.onRender(e.row.index,e.column.dataField,e.editor.instance.element),i.editing.editCell&&e.editor.instance.focus(),!0}_onColumnDoubleClick(e){this._beginColumnEdit(e)}_beginColumnEdit(e){const t=this;if(t.editing.enabled&&t.editing.allowColumnHeaderEdit&&e.allowHeaderEdit){t.editing.isEditing&&t.endEdit(),t.editing.editColumn=e,t._cellEditors||(t._cellEditors=[]);const i=t._getInputCellEditor({column:e,row:t.rows[0],editor:{template:"input"}});i.element.value=e.label,i.focus(),e.headerEditor=i,e.element.setAttribute("edit",""),e.element.label.appendChild(i.element),i.attach(),t.editing.isEditing=!0,t.$.fireEvent("beginEdit",{row:null,column:e,cell:null})}}_endColumnEdit(e){if(!1===this.editing.isEditing||this.editing.isEditing&&null===this.editing.editColumn)return!1;const t=this.editing.editColumn;return t.canNotify=!1,t.headerEditor.detach(),t.headerEditor.element.parentNode.removeChild(t.headerEditor.element),!0!==e&&(t.label=t.headerEditor.getValue()),t.headerEditor=null,this.editing.isEditing=!1,t.element.removeAttribute("edit"),t.element.scrollLeft=0,this.editing.editColumn=null,t.canNotify=!0,t.refresh(),this._recycle(),!0}_cancelColumnEdit(){this._endColumnEdit(!0)}_onCellClick(e,t){const i=this;if(e.row.addNewRow)"far"===e.row.freeze?i._insertNewRowAfter():i._insertNewRowBefore();else if(i.editing.enabled)if(i.editing.editColumn)i.endEdit();else{if(i.editing.commandColumn.visible)if(e.column.commandColumn){const n=(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.clientX,t.clientY);let o=null;for(let e=0;e<n.length;e++)if(n[e].classList.contains("smart-grid-command-item")){o=n[e];break}if(o||(o=e.element.querySelector(".smart-grid-command-item")),o&&!o.classList.contains("smart-hidden")){const n=o.getAttribute("command");return void i._applyCommand(n,[e.row,t])}}else if(i.editing.commandColumn.inline){const e=(i.enableShadowDOM?i.shadowRoot:i.getRootNode()).elementsFromPoint(t.pageX,t.pageY);for(let t=0;t<e.length;t++)if(e[t].classList.contains("smart-grid-command-item"))return}if("none"===i.editing.action&&i.editing.isEditing){let t=!1;i.editing.editCell&&i.editing.editCell.row!==e.row&&(t=!0),i.editing.editRow&&i.editing.editRow!==e.row&&(t=!0),i.editing.editColumn&&(t=!0),t&&i.endEdit()}if(e.column.autoGenerated)i.editing.allowRowHeaderEdit&&e.column.rowHeaderColumn&&(i.editing.isEditing&&i.endEdit(),i._beginCellEdit(e,t),i.$.fireEvent("beginEdit",{row:e.row,column:e.column,cell:e}));else if("click"===i.editing.action&&(!i.selection.enabled||e.selected||"extended"!==i.selection.mode))if("cell"===i.editing.mode){const n=e.parent();i.ensureVisible(e.row.id,e.column.dataField),setTimeout((function(){n?(i._beginCellEdit(n,t),i.$.fireEvent("beginEdit",{row:n.row,column:n.column,cell:n})):(i._beginCellEdit(e,t),i.$.fireEvent("beginEdit",{row:e.row,column:e.column,cell:e}))}),25)}else"row"===i.editing.mode&&(i._beginRowEdit(e.row,e,t),i.$.fireEvent("beginEdit",{row:e.row,column:e.column,cell:e}))}}_onCellDoubleClick(e,t){const i=this;i.editing.enabled&&("doubleClick"!==i.editing.action||i.editing.isEditing||e.column.autoGenerated||("cell"===i.editing.mode?i._beginCellEdit(e,t):"row"===i.editing.mode&&i._beginRowEdit(e.row,e,t)))}_onRowClick(){}_onRowDoubleClick(){}beginEdit(e,t){const i=this,n=i.rowById[e];n&&i._beginEdit(n,t)}cancelEdit(){const e=this;if(e._errorOverlay){if(e._errorOverlay.remove(),e._errorMessage.remove(),e.editing.editCell&&(e.editing.editCell.error=""),e.editing.editRow){const t=e.editing.editRow.cells;for(let e=0;e<t.length;e++){t[e].error=""}e.editing.editRow.element.removeAttribute("error"),e.editing.editRow.error=null}e._isUpdating=!1}if(e.editing.editRow){const t=e.editing.editRow.cells;for(let e=0;e<t.length;e++){const i=t[e],n=i.element;0===e&&i.row.element.removeAttribute("edit"),n&&(n.removeAttribute("editor"),n.removeAttribute("error"),n.content.innerHTML=""),i.isEditing=!1}e.editing.editRow=null}else e.editing.editCell?(e.editing.editCell.row.element.removeAttribute("edit"),e.editing.editCell.row.element.removeAttribute("error"),e.editing.editCell.element.removeAttribute("editor"),e.editing.editCell.element.removeAttribute("error"),e.editing.editCell.element.content.innerHTML="",e.editing.editCell.isEditing=!1,e.editing.editCell=null):e.editing.editColumn&&e._cancelColumnEdit();e.editing.dialog.visible&&e.editing.dialog.enabled&&e._dialogEdit.close(),e.editing.isEditing=!1,e._recycle(!1),e.editing.commandColumn.visible&&e.refresh(),e.focus()}deleteRow(e,t){const i=this,n=i.rowById[e];if(!n)return!1;const o=function(e){if(!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("delete")>=0)i._batchDeleteRow(e);else{if(i.dataSource&&i.dataSource.virtualDataSource)return i._editInfo={row:e.data},void i._virtualDataRequest("remove",(function(n){if(n){const n=i.rows.indexOf(e);i.rows.splice(n,1),delete i.rowById[e.id],t&&t(e)}}));const n=i.rows.indexOf(e);i.rows.splice(n,1)}t&&t(e)};return i.editing.deleteDialog.enabled?i._openDeleteRowDialog(n,o):o(n),!0}addRow(e,t,i){const n=this;if(e||(e={}),void 0===t&&(t=!0),n.dataSource&&n.dataSource.virtualDataSource)n._editInfo={row:e},n._virtualDataRequest("add",o=>{o&&(n._add(e,t?n.rows.length:0),i&&i(t?n.rows[n.rows.length-1]:n.rows[0]))});else{if(n.editing.batch)return void(t?n.commandBarAddRowCommand():n.commandBarAddTopRowCommand());n._add(e,t?n.rows.length:0);const o=t?n.rows[n.rows.length-1]:n.rows[0];i&&i(o)}}updateRow(e,t,i){const n=this,a=n.rowById[e];if(!a)return!1;const l=(e,t)=>{let i=[];for(let n of e)switch(n.type){case"min":i.min=o.min(t,n.value);break;case"max":i.max=o.max(t,n.value);break;case"minLength":i.minLength=o.minLength(t,n.value);break;case"maxLength":i.maxLength=o.maxLength(t,n.value);break;case"minDate":i.minDate=o.minDate(t,n.value);break;case"maxDate":i.maxDate=o.maxDate(t,n.value);break;case"required":i.required=o.required(t);break;case"requiredTrue":i.requiredTrue=o.requiredTrue(t);break;case"pattern":i.pattern=o.pattern(t,n.value);break;case"email":i.email=o.email(t);break;case"null":i.null=o.null(t)}return i};for(let e=0;e<n.columns.length;e++){const i=n.columns[e];let o=[];if(t[i.dataField]&&(i.validationRules&&i.validationRules.length>0)){const e=t[i.dataField];if(o=l(i.validationRules,e),Object.keys(o)>0)return!1}}const d=()=>{n.beginUpdate();for(let e in t){if("$"===e)continue;const i=a.getCell(e);i&&(i.value=t[e])}n.endUpdate(),i&&i(a)};n.dataSource&&n.dataSource.virtualDataSource?(n.dataSource.id?t[n.dataSource.id]=e:t.id||(t.id=e),n._editInfo={row:t},n._virtualDataRequest("update",(function(e){e&&d(),n.appearance.displayLoadingIndicator=!1,n._setLoadingIndicatorVisibility()}))):d()}addUnboundRow(e,t){const i=this;void 0===e&&(e=1),void 0===t&&(t="far"),i._nearRowsAdded||(i._nearRowsAdded=[],i._farRowsAdded=[]),i._unboundRows||(i._unboundRows=[]),i.beginUpdate();for(let n=0;n<e;n++){const e=Smart.Utilities.Core.createGUID().replace(/-/gi,""),n=new Smart.Grid.Row({index:-1,unbound:!0,id:e,grid:i});i.rowById[n.id]=n,"far"===t?i._farRowsAdded.push(n):i._nearRowsAdded.push(n),i._unboundRows.push(n)}i.endUpdate()}addNewRow(e){const t=this;"near"===e?t._insertNewRowBefore():t._insertNewRowAfter()}endEdit(){const e=this;let t=!1,i=null;e.editing.dialog.enabled&&e.editing.dialog.visible&&e._dialogEdit&&e._dialogEdit.close();let n=null,o=null,a=null;return e.editing.editRow?(o=e.editing.editRow,i=e.editing.editRow.id,t=e._endRowEdit()):e.editing.editCell?(o=e.editing.editCell.row,a=e.editing.editCell.column,n=e.editing.editCell,i=e.editing.editCell.row.id,t=e._endCellEdit()):e.editing.editColumn&&(i=null,a=e.editing.editColumn,t=e._endColumnEdit()),e._saveUnboundRows(i),e._selection.selectionRect&&e._selection.selectionRect.classList.remove("smart-visibility-hidden"),e.$.scrollView.scrollTop=0,e.$.fireEvent("endEdit",{row:o,column:a,cell:n}),t}getBatchEditChanges(){const e=this,t=[],i=[],n=[];for(let i in e._cellsUpdatedValues){const n=e._cellsUpdatedValues[i],o=i.substring(0,i.indexOf("_")),a=i.substring(i.indexOf("_")+1),l=e.rowById[o].getCell(a);t.push({id:o,dataField:a,oldValue:l.value,newValue:n})}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(let t=0;t<e._rowsDeleted.length;t++){const n=e._rowsDeleted[t];i.push({id:n.id,data:n})}if(e._rowsAdded&&e._rowsAdded.length>0)for(let t=0;t<e._rowsAdded.length;t++){const i=e._rowsAdded[t];n.push({id:i.id,data:i})}return{updated:t,deleted:i,added:n}}saveBatchEdit(){this._saveBatchEdit()}revertBatchEdit(){this._clearBatchEdit(!0)}});const i=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;function n(e){return null===e||0===e.length}class o{static null(e){return null===e}static email(e){return n(e)||i.test(e)?null:{email:!0}}static min(e,t){return(e=>{if(n(e)||n(t))return null;const i=parseFloat(e);return!isNaN(i)&&i<t?{min:{min:t,actual:i}}:null})(e)}static max(e,t){return(e=>{if(n(e)||n(t))return null;const i=parseFloat(e);return!isNaN(i)&&i>t?{max:{max:t,actual:i}}:null})(e)}static minDate(e,t){return(e=>{if(n(e)||n(t))return null;const i=e;return!isNaN(i)&&i<t?{min:{min:t,actual:i}}:null})(e)}static maxDate(e,t){return(e=>{if(n(e)||n(t))return null;const i=e;return!isNaN(i)&&i>t?{max:{max:t,actual:i}}:null})(e)}static required(e){return n(e)?{required:!0}:null}static requiredTrue(e){return!0===e?null:{required:!0}}static minLength(e,t){return(e=>{if(n(e))return null;const i=e?e.length:0;return i<t?{minlength:{requiredLength:t,actualLength:i}}:null})(e)}static maxLength(e,t){return(e=>{const i=e?e.length:0;return i>t?{maxlength:{requiredLength:t,actualLength:i}}:null})(e)}static url(e){return/^(ftp|http|https):\/\/[^ "]+$/.test(e)?null:{pattern:{requiredPattern:'^(ftp|http|https)://[^ "]+$',actualValue:e}}}static pattern(e,t){if(!t)return o.null;let i,a;return"string"==typeof t?(a="","^"!==t.charAt(0)&&(a+="^"),a+=t,"$"!==t.charAt(t.length-1)&&(a+="$"),i=new RegExp(a)):(a=t.toString(),i=t),(e=>n(e)||i.test(e)?null:{pattern:{requiredPattern:a,actualValue:e}})(e)}}window.Smart.Validator=o}});