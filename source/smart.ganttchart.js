
/* Smart UI v9.3.53 (2021-05-10) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-gantt-chart",class extends Smart.ScrollViewer{static get properties(){return{autoSchedule:{value:!1,type:"boolean"},autoScheduleStrictMode:{value:!1,type:"boolean"},autoScrollStep:{value:5,type:"number"},dataExport:{value:{header:{value:!0,type:"boolean"},style:{value:null,type:"object"},itemType:{value:"task",type:"string"},includeHidden:{value:!1,type:"boolean"},fileName:{value:"smartGanttChart",type:"string?"},pageOrientation:{value:"portrait",type:"string"},expandChar:{value:"+",type:"string"},collapseChar:{value:"-",type:"string"}},type:"object"},dataSource:{value:[],type:"any",reflectToAttribute:!1},dayFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},dateEnd:{value:"",type:"any",validator:"_dateValidator"},dateStart:{value:"",type:"any",validator:"_dateValidator"},disableAutoScroll:{value:!1,type:"boolean"},disableTaskDrag:{value:!1,type:"boolean"},disableTaskProgressChange:{value:!1,type:"boolean"},disableTaskResize:{value:!1,type:"boolean"},disableSelection:{value:!1,type:"boolean"},disableWindowEditor:{value:!1,type:"boolean"},durationUnit:{value:"milisecond",allowedValues:["day","week","hour","minute","second","milisecond"],type:"string"},headerTemplate:{value:null,type:"any"},hourFormat:{value:"default",allowedValues:["default","2-digit","numeric"],type:"string"},hideTimelineHeaderDetails:{value:!1,type:"boolean"},hideResourcePanel:{value:!1,type:"boolean"},inverted:{value:!1,type:"boolean"},messages:{extend:!0,value:{en:{invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",outOfBounds:"{{elementType}}: Out of bounds argument {{argumentName}} in method {{methodName}}.",missingReference:"{{elementType}}: Missing reference to {{file}} in method {{methodName}}.",noId:"smartGanttChart requires an id in order to save/load/clear a state.",ok:"Ok",cancel:"Cancel",delete:"Delete",confirm:"{{componentName}} will be deleted permanently, <b>are you sure? </b>",taskColumnLabel:"Task Name",resourceColumnLabel:"Resource Name",deleteLink:"Delete link",unassigned:"Unassigned"}},type:"object"},monthFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},nonworkingDays:{value:[],type:"array"},nonworkingHours:{value:[],type:"array"},popupWindowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"},progressLabelFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},resizeHandlesVisibility:{allowedValues:["auto","hidden","visible"],value:"auto",type:"string"},resourceColumns:{value:[{label:"resourceColumnLabel",value:"label"}],type:"array",reflectToAttribute:!1},resourcePanelHeaderTemplate:{value:null,type:"any"},resourcePanelMin:{value:100,type:"any"},resourcePanelSize:{value:"",type:"any"},resourcePanelRefreshRate:{value:0,reflectToAttribute:!1,type:"number"},resourceTimelineFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},resourceTimelineMode:{allowedValues:["diagram","histogram","custom"],value:"diagram",type:"string"},resourceTimelineView:{allowedValues:["hours","tasks","custom"],value:"hours",type:"string"},selectedIndexes:{value:[],type:"array"},showProgressLabel:{value:!1,type:"boolean"},snapToNearest:{value:!1,type:"boolean"},sortable:{value:!1,type:"boolean"},sortMode:{value:"one",allowedValues:["one","many"],type:"string"},taskColumns:{value:[{label:"taskColumnLabel",value:"label"}],type:"array",reflectToAttribute:!1},taskPanelMin:{value:200,type:"any"},taskPanelSize:{value:"",type:"any"},timelineMin:{value:200,type:"any"},treeMin:{value:100,type:"any"},treeSize:{value:"20%",type:"any"},timelineHeaderFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},verticalScrollBarVisibility:{type:"string",value:"auto",allowedValues:["auto","disabled","hidden","visible"]},view:{value:"year",allowedValues:["day","week","month","year","resource"],type:"any"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},weekFormat:{value:"long",allowedValues:["long","numeric"],type:"string"}}}template(){return'<div id="container" role="presentation">\n                    <smart-splitter id="mainSplitter" auto-fit-mode="end" keep-proportions-on-resize right-to-left="[[rightToLeft]]" animation="[[animation]]" orientation="horizontal">\n                        <smart-splitter-item id="taskSplitterItem" class="smart-task-splitter-item">\n                            <div id="taskSplitterItemHeader" class="smart-task-panel-header"></div>\n                            <smart-splitter id="taskSplitter" class="smart-task-splitter" auto-fit-mode="end" right-to-left="[[rightToLeft]]" animation="[[animation]]">\n                                 <smart-splitter-item id="treeSplitterItem" min="[[treeMin]]">\n                                    <smart-splitter id="taskTreeSplitter" auto-fit-mode="end" class="smart-tree-splitter" unfocusable right-to-left="[[rightToLeft]]" animation="[[animation]]">\n                                        <smart-splitter-item id="taskTreeSplitterItem">\n                                            <div class="smart-task-tree-header"></div>\n                                            <div class="smart-task-tree-content">\n                                                <smart-tree class="smart-hidden" id="taskTree" selection-mode="zeroOrOne" overflow="hidden" toggle-mode="arrow" animation="[[animation]]"\n                                                    aria-controls="[[id]]" right-to-left="[[rightToLeft]]">\n                                                </smart-tree>\n                                            </div>\n                                        </smart-splitter-item>\n                                    <smart-splitter>\n                                </smart-splitter-item>\n                                <smart-splitter-item id="timelineSplitterItem" class="smart-timeline-splitter-item" min="[[timelineMin]]">\n                                        <div id="timeline" class="smart-timeline">\n                                            <div id="timelineContainer" class="smart-timeline-container" role="presentation">\n                                                <div id="timelineHeader" class="smart-timeline-header" role="rowgroup">\n                                                    <div class="smart-timeline-view-details" id="timelineViewDetails" role="row"></div>\n                                                    <div class="smart-timeline-view-cells" id="timelineViewCells" role="row"></div>\n                                                </div>\n                                                <div id="timelineContent" class="smart-timeline-content">\n                                                    <div id="taskTimelineCellsContainer" class="smart-timeline-cells-container" aria-hidden="true"></div>\n                                                    <div id="timelineConnectionsContainer" class="smart-timeline-connections-container" role="group"></div>\n                                                    <div id="timelineTasksContainer" class="smart-timeline-tasks-container" role="group"></div>\n                                                </div>\n                                                <div id="timelineAnimationContainer" class="smart-timeline-animation-container smart-visibility-hidden" aria-hidden="true">\n                                                    <div class="smart-timeline-animation-inner-container">\n                                                        <div><div></div><div></div></div><div><div></div><div></div></div><div><div></div><div></div></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <smart-scroll-bar id="verticalScrollBar" class="smart-timeline-scroll-bar" orientation="vertical"\n                                                right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]">\n                                        </smart-scroll-bar>\n                                </smart-splitter-item>\n                            </smart-splitter>\n                        </smart-splitter-item>\n                        <smart-splitter-item id="resourceSplitterItem" class="smart-resource-splitter-item">\n                            <div id="resourceSplitterItemHeader" class="smart-resource-panel-header"></div>\n                            <smart-splitter id="resourceSplitter" class="smart-resource-splitter" auto-fit-mode="end" right-to-left="[[rightToLeft]]" animation="[[animation]]">\n                                <smart-splitter-item id="resourceTreeItem" min="[[treeMin]]">\n                                    <smart-splitter id="resourceTreeSplitter" class="smart-tree-splitter" auto-fit-mode="end" unfocusable right-to-left="[[rightToLeft]]" animation="[[animation]]">\n                                        <smart-splitter-item id="resourceTreeSplitterItem">\n                                            <div class="smart-resource-tree-header"></div>\n                                            <div class="smart-resource-tree-content">\n                                                <smart-tree class="smart-hidden" id="resourceTree" selection-mode="zeroOrOne" overflow="hidden" toggle-mode="arrow" animation="[[animation]]"\n                                                    aria-controls="[[id]]" right-to-left="[[rightToLeft]]">\n                                                </smart-tree>\n                                            </div>\n                                        </smart-splitter-item>\n                                    </smart-splitter>\n                                </smart-splitter-item>\n                                <smart-splitter-item id="resourceTimelineSplitterItem" class="smart-timeline-splitter-item" min="[[timelineMin]]">\n                                    <div id="resourceTimeline" class="smart-timeline">\n                                        <div class="smart-timeline-container" role="presentation">\n                                            <div id="resourceTimelineHeader" class="smart-timeline-header" role="rowgroup">\n                                                <div class="smart-timeline-view-cells" id="resourceTimelineViewCells" role="row"></div>\n                                            </div>\n                                            <div id="resourceTimelineContent" class="smart-timeline-content" role="rowgroup">\n                                                <div id="resourceTimelineCellsContainer" class="smart-timeline-cells-container" aria-hidden="true"></div>\n                                            </div>\n                                            <div id="resourceTimelineAnimationContainer" class="smart-timeline-animation-container smart-visibility-hidden" aria-hidden="true">\n                                                <div class="smart-timeline-animation-inner-container">\n                                                    <div><div></div><div></div></div><div><div></div><div></div></div><div><div></div><div></div></div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                     <smart-scroll-bar id="resourceVerticalScrollBar" class="smart-timeline-scroll-bar smart-resource-scroll-bar" orientation="vertical"\n                                            right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]">\n                                     </smart-scroll-bar>\n                                </smart-splitter-item>\n                            </smart-splitter>\n                        </smart-splitter-item>\n                    </smart-splitter>\n                    <smart-scroll-bar wait right-to-left="[[rightToLeft]]" animation="[[animation]]" id="horizontalScrollBar" class="smart-timeline-scroll-bar"></smart-scroll-bar>\n                </div>'}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.wheel":"_mouseWheelHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler","resourceVerticalScrollBar.change":"_verticalScrollbarHandler","mainSplitter.resizeEnd":"_resizeEventHandler","mainSplitter.resize":"_resizeEventHandler",move:"_moveHandler","taskTree.change":"_taskTreeChangeHandler","taskTree.collapse":"_taskTreeExpandHandler","taskTree.expand":"_taskTreeExpandHandler","taskTree.blur":"_treeBlurHandler","timelineAnimationContainer.transitionend":"_timelineAnimationContainerTransitionendHandler"}}static get styleUrls(){return["smart.ganttchart.css"]}attached(){const e=this;super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.taskSplitterItem,e.$.horizontalScrollBar,e.$.verticalScrollBar)),!e._resourceScrollView&&e.$.mainSplitter.contains(e.$.resourceSplitter)&&(e._handleResourceTreeEvents(!0),e._resourceScrollView=new Smart.Utilities.Scroll(e.$.resourceSplitterItem,e.$.horizontalScrollBar,e.$.resourceVerticalScrollBar));const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];for(let s=0;s<t.length;s++){const i=t[s];e.$[i]&&e.$[i].opened&&(e._handleModal(!0),e["$"+i].listen("close",e._popupWindowCloseHandler.bind(e)),e["$"+i].listen("closing",e._popupWindowClosingHandler.bind(e)),e["$"+i].listen("open",e._popupWindowOpenHandler.bind(e)),e["$"+i].listen("click",e._popupWindowClickHandler.bind(e)),e["$"+i].listen("transitionend",e._popupWindowTransitionendHandler.bind(e)),e.getShadowRootOrBody().appendChild(e.$[i]))}}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView),e._resourceScrollView&&(e._handleResourceTreeEvents(),e._resourceScrollView.unlisten(),delete e._resourceScrollView);const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];e._handleModal();for(let s=0;s<t.length;s++){const i=t[s],r=e["$"+i];e.$[i]&&e.$[i].remove(),r&&(r.unlisten("open"),r.unlisten("close"),r.unlisten("closing"),r.unlisten("click"),r.unlisten("transitionend"))}}propertyChangedHandler(e,t,s){const i=this;switch(e){case"animation":i.$.resourceTree.animation=i.$.taskTree.animation=s;break;case"autoSchedule":s?i._autoSchedule():i._autoScheduleRestore();break;case"autoScheduleStrictMode":s&&(i._autoSchedule(),i._refreshTimeline(i.view));break;case"dataSource":i._createTasks(),i._createTreeColumns(i.$.taskTreeSplitter),i._createTimeline(),i._createResourceTimeline(),i._setAriaControls(),i._refresh();break;case"disableSelection":s?(i.$.taskTree.selectionMode="none",i.$.resourceTree.selectionMode="none",i._unselectAll("task"),i._unselectAll("resource")):(i.$.taskTree.selectionMode="zeroOrOne",i.$.resourceTree.selectionMode="zeroOrOne");break;case"durationUnit":for(let e=0;e<i._tasks.length;e++){const t=i._tasks[e];i._validateTaskProperties(t,t.$.project)}i._createTimelineCells();for(let e=0;e<i._tasks.length;e++){const t=i._tasks[e];i._setTimelineTaskBar(t,!0),i._refreshTaskConnections(t)}i.taskColumns.some((e=>(e.value+"").toLowerCase().indexOf("duration")>-1))&&i._createTreeColumns(i.$.taskTreeSplitter);break;case"headerTemplate":i._handleHeaderTemplate();break;case"inverted":i._handleInverted(),i.scrollLeft&&(i.$.timeline.scrollLeft=i._getScrollLeft(i.scrollLeft));break;case"rightToLeft":Array.from(i.querySelectorAll("smart-splitter, smart-tree, smart-scroll-bar")).forEach((t=>t[e]=s)),i.closeWindow(),i._handleInverted(),i._refreshTimeline(),i._tasks.forEach((e=>i._setTaskBarProgress(e))),i.$.taskTree.toggleElementPosition=s?"far":"near";break;case"dateStart":case"dateEnd":case"nonworkingDays":case"nonworkingHours":i._refreshTimeline();break;case"messages":case"locale":case"dayFormat":case"hourFormat":case"timelineHeaderFormatFunction":case"monthFormat":case"yearFormat":i._refreshHeaderDate(!0),i._refreshColumnsHeaders(),i._recycleResourceHeaderCells();break;case"hideResourcePanel":i._createResourceTimeline(),i.$.taskTree.refresh(),i._refresh();break;case"selectedIndexes":i._applySelection(t);break;case"resourceColumns":delete i._resourceSplitterItemSizeSet,i._createTreeColumns(i.$.resourceTreeSplitter),i._highlightAssignedItem("task",i.selectedIndexes[0]);break;case"resourcePanelHeaderTemplate":i._handleHeaderTemplate("resource");break;case"resourceTimelineView":case"resourceTimelineMode":case"resourceTimelineFormatFunction":i.$.mainSplitter.contains(i.$.resourceSplitter)&&i._resources.forEach((e=>i._refreshResourceTimelineContent(e)));break;case"showProgressLabel":case"progressLabelFormatFunction":i._tasks.forEach((e=>i._setTaskBarProgress(e)));break;case"sortable":case"sortMode":i._sortTasks(),i._sortResources();break;case"taskColumns":{const e=i.selectedIndexes.slice(0);delete i._taskSplitterItemSizeSet,i._createTreeColumns(i.$.taskTreeSplitter),i.set("selectedIndexes",e),i._applySelection();break}case"timelineMin":i.$.timelineSplitterItem.min=s,i.$.taskSplitter.refresh(),i.$.mainSplitter.contains(i.$.resourceSplitter)&&i._synchronizeSplitters(i.$.taskSplitter,i.$.resourceSplitter);break;case"treeMin":case"treeSize":{const t=e.toLowerCase().indexOf("size")>-1?"size":"min";i.$.treeSplitterItem[t]=s,i.$.taskSplitter.refresh(),i.$.mainSplitter.contains(i.$.resourceSplitter)&&i._synchronizeSplitters(i.$.taskSplitter,i.$.resourceSplitter);break}case"taskPanelMin":case"taskPanelSize":case"resourcePanelSize":case"resourcePanelMin":{const t=e.indexOf("Min")>-1?"min":"size",r=e.indexOf("resource")>-1?"resource":"task";i.$.mainSplitter.contains(i.$.resourceSplitter)&&(i.$[`${r}SplitterItem`][t]=s,i.$.taskSplitterItem._setSize("size",i.taskPanelSize),i.refresh());break}case"unfocusable":i._setFocusable();break;case"view":i._refreshTimeline(t);break;default:super.propertyChangedHandler(e,t,s)}}_predefPropertyGetter(e){const t=this;Object.defineProperty(t,e,{get:function(){switch(e){case"dataSource":{if(t.context===t)return t.properties[e].value;const s=function(e){if(!e.length)return e;for(let i=0;i<e.length;i++){const r=e[i];let n=r.tasks;n&&Array.isArray(n)&&(n=s(n.filter((e=>e.$&&e.$.project===r)))),e[i]=t._cloneObject(r),n&&n.length?e[i].tasks=n:delete e[i].tasks}return e};return s(t.properties[e].value.slice(0))}case"dateStart":case"dateEnd":{const s=t._timelineCells;return s.length?new Date("dateStart"===e?s[0].date:s[s.length-1].date):t.properties[e].value}case"view":return t.context===document?t.properties[e].value:t._view||t.properties[e].value;default:return t.properties[e].value}},set(s){if("dataSource"!==e){if("view"===e&&"resource"===s){if(t._view)return;t._view=t._properties[e].value}else delete t._view;t.updateProperty(t,t._properties[e],s)}else t.updateProperty(t,t._properties[e],s)}})}ready(){this._customScrollView=!0,super.ready()}render(){const e=this;e.$.taskTree.classList.remove("smart-hidden"),e.$.resourceTree.classList.remove("smart-hidden"),e.setAttribute("role","treegrid"),e._predefPropertyGetter("dataSource"),e._predefPropertyGetter("dateStart"),e._predefPropertyGetter("dateEnd"),e._predefPropertyGetter("view"),e.shadowRoot?requestAnimationFrame((()=>{e.$.treeSplitterItem.size=e.treeSize,e.$.resourceTreeSplitterItem.size=e.treeSize})):(e.$.treeSplitterItem.size=e.treeSize,e.$.resourceTreeSplitterItem.size=e.treeSize),e.rightToLeft?(e.$.taskTree.toggleElementPosition="far",e.$.resourceTree.toggleElementPosition="far"):(e.$.verticalScrollBar.removeAttribute("right-to-left"),e.$.taskTree.toggleElementPosition="near",e.$.resourceTree.toggleElementPosition="near"),e.$.taskTree.setAttribute("disable-hover",""),e.$.resourceTree.setAttribute("disable-hover",""),e.$.taskTree._ensureVisibleCallback=e._ensureVisible.bind(e),e.$.taskTree._hoverViaKeyboardCallback=e._hoverViaKeyboardCallback.bind(e),e.$.resourceTree._ensureVisibleCallback=e._ensureVisible.bind(e),e.$.resourceTree._hoverViaKeyboardCallback=e._hoverViaKeyboardCallback.bind(e),e.$.taskTree._waitAnimation=!0,e.$.resourceTree._waitAnimation=!0,e.$.taskTree.$.scrollViewer._scrollView.disableSwipeScroll=!0,e.$.taskTree.$.scrollViewer.disabled=!0,e.$.resourceTree.$.scrollViewer._scrollView.disableSwipeScroll=!0,e.$.resourceTree.$.scrollViewer.disabled=!0,e.disableSelection&&(e.$.taskTree.selectionMode="none",e.$.resourceTree.selectionMode="none",e._unselectAll("task"),e._unselectAll("resource")),e.$.taskSplitterItem.min=e.taskPanelMin,e.$.resourceSplitterItem.min=e.resourcePanelMin,e.$.resourceSplitterItem.size=e.resourcePanelSize,e._setScrollBars(),e.$.taskTreeSplitter.refresh(),"resource"===e.view&&(e._view=e._properties.view.defaultValue),delete e._taskSplitterItemSizeSet,delete e._resourceSplitterItemSizeSet,e._handleHeaderTemplate(),e._handleInverted(!0),e._createTasks(),e._createTimeline(),e._createTreeColumns(e.$.taskTreeSplitter),e._createResourceTimeline(),e._applySelection(),e._setAriaControls(),e._setFocusable(),e.checkLicense(),e.$.taskSplitterItem._setSize("size",e.taskPanelSize),e.shadowRoot&&requestAnimationFrame((()=>e.refresh())),super.render()}refresh(e){const t=this;if(e)return t._refreshTimeline(t.view,!0),t._createTreeColumns(t.$.taskTreeSplitter),t._createResourceTimeline(),t._applySelection(),void t._createResourceTimeline();t._resizeEventHandler()}clearSelection(){this._unselectAll("task"),this._unselectAll("resource")}static get requires(){return{"Smart.Splitter":"smart.splitter.js","Smart.Tree":"smart.tree.js","Smart.Window":"smart.window.js"}}ensureVisible(e,t="task"){const s=this,i=s[`_${t}s`];if(null!=e&&i.length){if("number"==typeof e)e=i[Math.max(0,Math.min(e,i.length-1))];else if("string"==typeof e)(e=i.find((t=>t.id&&t.id.toString()===e)))||(e=s._getItemByTreeIndex("task",arguments[0]));else{if("object"!=typeof e)return;e=i[s._getItemIndex(e,t)]}e&&(s._ensureVisible(e,t),s._scrollTo(e.dateStart,!0))}}removeAllConnections(){const e=this;e.isCompleted&&(e.$.timelineConnectionsContainer.innerHTML="",e._tasks.map((e=>e.connections=[])))}removeConnection(){const e=this,t=Array.from(arguments).filter((e=>void 0!==e));if(!e.isCompleted)return;let s;if(1===t.length){if("string"==typeof t[0]){const e=document.getElementById(t[0]);e&&(s=e.getAttribute("connection-id"))}s||(s=(t[0]+"").split("-"),s=e._getValidConnectionId(s[0],s[1],s[2],"removeConnection"))}else 3===t.length&&(s=e._getValidConnectionId(t[0],t[1],t[2],"removeConnection"));s&&(e._removeConnection(s),e.$.fireEvent("itemRemove",{type:"connection",item:{source:s[0],target:s[1],type:s[2]}}))}removeTaskConnection(e,t){const s=this;if(s.isCompleted){if((e+="").indexOf("-")>-1&&!t){const s=e.split("-");t=s[1],e=s[0]}e=s._getTaskIndexById(e),t=s._getTaskIndexById(t),isNaN(e)?s.error(s.localize("incorrectArgument",{elementType:s.nodeName.toLowerCase(),methodName:"removeTaskConnection",argumentName:"taskEndIndex"})):(s._removeAllTaskConnections=!0,s._removeConnection(""+e+(isNaN(t)?"":t)),delete s._removeAllTaskConnections)}}beginUpdate(){const e=this;e._isUpdating={started:!0,type:{},selectedTasks:e.selectedIndexes.map((t=>e._tasks[t]))},e.$.fireEvent("beginUpdate")}endUpdate(){const e=this;function t(){if(e._sortTasks(),!e._unsortedTasks){e._createTreeColumns(e.$.taskTreeSplitter),delete e._hoveredTimelineTask,e.$.taskTimelineCellsContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="",e._createTimeline(),e._setAriaControls();const t=e.selectedIndexes,s=e._tasks;r&&!r.every((e=>t.includes(s.indexOf(e))))&&e.set("selectedIndexes",r.map((e=>s.indexOf(e)))),e._applySelection()}const t=e._resources;for(let s=0;s<t.length;s++)e._refreshTreeColumnsData(t[s],void 0,"resource")}function s(){if(e.hideResourcePanel)return;e._sortResources(),e._unsortedResources||e._createResourceTimeline();const t=e._tasks;for(let s=0;s<t.length;s++)e._refreshTreeColumnsData(t[s])}if(!e._isUpdating)return;const i=1===Object.keys(e._isUpdating.type).length?Object.keys(e._isUpdating.type)[0]:void 0,r=e._isUpdating.selectedTasks;switch(delete e._isUpdating,i){case"task":t();break;case"resource":s();break;default:t(),s()}e.$.fireEvent("endUpdate")}clearTasks(){this._clearTasks()}_clearTasks(){const e=this;delete e.__tasks,delete e._unsortedTasks,e._tasks=[],e._timelineCells=[],e._timelineHeaderCells=[],e.$.timelineContent.style.width=e.$.timelineAnimationContainer.style.width="",e.$.container.style.removeProperty("--smart-gantt-chart-task-timeline-content-height"),e.$.timelineViewDetails.innerHTML="",e.$.timelineViewCells.innerHTML="",e.$.taskTimelineCellsContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="",delete e._hoveredTimelineTask;const t=e.$.taskTreeSplitter._items;for(let s=0;s<t.length;s++){const i=t[s];if(i===e.$.taskTreeSplitterItem)e.$.taskTree.dataSource=[];else{const e=i.getElementsByClassName("smart-task-tree-content")[0];e&&(e.innerHTML="")}}e._refresh()}clearResources(){const e=this;e._unselectAll("resource");const t=e.$.resourceTreeSplitter._items;for(let s=0;s<t.length;s++){const i=t[s];if(i===e.$.resourceTreeSplitterItem)e.$.resourceTree.dataSource=[];else{const e=i.getElementsByClassName("smart-resource-tree-content")[0];e&&(e.innerHTML="")}}e._resources=[],delete e._unsortResources,e.$.resourceTimelineCellsContainer.innerHTML="",e._tasks.forEach((t=>{t.resources=[],e._refreshTreeColumnsData(t,["resources"])})),e._refreshTimeline(),e._createResourceTimeline()}createConnection(){const e=this,t=e._tasks;let s,i=Array.from(arguments).filter((e=>void 0!==e));e.isCompleted&&0!==t.length&&(1===i.length?s=(i[0]+"").split("-"):3===i.length&&(s=i),s=e._getValidConnectionId(s[0],s[1],s[2],"createConnection"),s&&(e._connectTask(s),s=s.split("-"),e.$.fireEvent("itemInsert",{type:"connection",item:{source:s[0],target:s[1],type:s[2]}})))}collapse(e){this._handleCollapseExpandMethods(e,"collapse")}expand(e){this._handleCollapseExpandMethods(e,"expand")}_handleCollapseExpandMethods(e,t){const s=this,i=s._unsortedTasks||s._tasks;if(null==e||!i||!i.length)return;const r=s._getValidTaskAndIndex(e);if(!r||!r.item)return void s.error(s.localize("incorrectArgument",{elementType:s.nodeName.toLowerCase(),methodName:"collapse",argumentName:"task"}));let n=r.item;"project"!==n.type&&(n=n.$.project),n.hidden?n.expanded="expand"===t:(n=s.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[i.filter((e=>!e.hidden)).indexOf(n)],void 0!==n?s.$.taskTree[`${t}Item`](n instanceof Smart.TreeItemsGroup?n:n.parentItem):s.error(s.localize("incorrectArgument",{elementType:s.nodeName.toLowerCase(),methodName:t,argumentName:"task"})))}_getValidTaskAndIndex(e,t="task"){const s=this;let i,r,n;"task"===t?(n=!!s._unsortedTasks,i=s._unsortedTasks||s._tasks):(n=!!s._unsortedResources,i=s._unsortedResources||s._resources);const a=n?"task"===t?"unsortedTask":"unsortedResource":t;if(null!=e&&i&&i.length)return"string"==typeof e&&(r=i.find((e=>e.id&&e.id.toString()===arguments[0].toString())),r?e=i.indexOf(r):(e=i.indexOf(s._getItemByTreeIndex(a,e)),r=i[e])),"number"==typeof e?r=i[e]||i.find((t=>t.id&&t.id.toString()===e.toString())):"object"==typeof e&&(r=i[s._getItemIndex(e,a)],e=i.indexOf(r)),{item:r,index:e}}exportData(e,t){const s=this;function i(e){function t(e){const t=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]}return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+t(e[1])+t(e[2])+t(e[3]).toUpperCase():"#ffffff"}function r(e){let t={};for(let s=0;s<o.length;s++){const i=o[s];e?(t[i.value]=e[i.value],t._keyDataField=a.indexOf(e),e.tasks&&(t._expanded=!!e.expanded),e.$.project&&(t._parentDataField=a.indexOf(e.$.project))):t[i.value]=i.label}return t}if(!Smart.Utilities.DataExporter)return void s.error(s.localize("missingReference",{elementType:s.nodeName.toLowerCase(),methodName:"exportData",file:"smart.export.js"}));try{new JSZip}catch(e){return void s.error(s.localize("missingReference",{elementType:s.nodeName.toLowerCase(),methodName:"exportData",file:"jszip.min.js"}))}if("pdf"===e&&!window.pdfMake)return void s.error(s.localize("missingReference",{elementType:s.nodeName.toLowerCase(),methodName:"exportData",file:"pdfMake.min.js"}));const n=s.dataExport.itemType,a=s.dataExport.includeHidden?s[`_${n}s`]:s[`_${n}s`].filter((e=>!e.hidden)),o=s[`${n}Columns`];if(!a||!a.length||!o.length)return;const l=new Smart.Utilities.DataExporter({collapseChar:s.dataExport.collapseChar,exportHeader:s.dataExport.header,expandChar:s.dataExport.expandChar,hierarchical:!0,pageOrientation:s.dataExport.pageOrientation,style:s.dataExport.style}),d=r();let c={columns:[]};for(let e in d)c.columns.push({label:d[e],dataField:e});if(l.header=c,!l.style){const t=window.getComputedStyle(s),r=window.getComputedStyle(s.$.timelineHeader),a={height:s.$[`${n}TreeSplitter`].querySelector(`.smart-${n}-tree-header`).offsetHeight+"px",border:"1px solid "+i(r.borderRightColor),fontFamily:"Helvetica",fontSize:r.fontSize,color:i(r.color),backgroundColor:i(r.backgroundColor),fontWeight:"400"},d={border:"1px solid "+i(t.borderColor),fontFamily:t.fontFamily,fontSize:t.fontSize},m=c.columns,u=s.$[`${n}TreeSplitter`].items,f=t=>"pdf"===e?100*t.offsetWidth/s.$[`${n}TreeSplitter`].offsetWidth+"%":t.offsetWidth+"px";for(let e=0;e<m.length;e++){const t=m[e],s=o.find((e=>e.value===t.dataField)),i=u[e].querySelector(".smart-tree-item-label-container")||u[e].querySelector(`.smart-${n}-label-container`);let l;a[t.dataField]={textAlign:r.textAlign,width:f(u[e])},i&&(l=getComputedStyle(i).justifyContent||getComputedStyle(i).textAlign),d[t.dataField]={textAlign:["left","center","right","justify"].indexOf(l)<0?"start":l,format:s.exportFormat||(t.dataField.indexOf("date")>-1?"d":"")}}l.style={border:"1px solid "+i(t.borderColor),borderCollapse:"collapse",header:a,columns:d,rows:{height:(parseFloat(t.getPropertyValue("--smart-gantt-chart-task-default-height"))||0)+"px"}}}let m=[];for(let e=0;e<a.length;e++)m.push(r(a[e]));return l.exportData(m,e,s.dataExport.fileName,t)}print(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const s=e.exportData("html"),i=window.open("","","width=800,height=500"),r=i.document.open(),n='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>'+t+"</title></head><body>"+s+"</body></html>";try{r.write(n),r.close(),setTimeout((function(){i.print(),i.close()}),100)}catch(e){}e.dataExport.fileName=t}getState(){const e=this,t=e._getTasksJSON(!0)||[];return{tasks:JSON.parse(JSON.stringify(t)),selectedIndexes:e.selectedIndexes.slice(0),resources:JSON.parse(JSON.stringify((e._unsortedResources||e._resources).slice(0)))}}get tasks(){const e=this,t=e._tasks;return e.isReady&&t&&t.length?t.map((t=>e._cloneObject(t))):[]}get resources(){const e=this,t=e._resources;return e.isReady&&t&&t.length?t.map((t=>e._cloneObject(t))):[]}getItemPath(e){const t=["milestone","project","task"].indexOf(e.type)>-1?"task":"resource";if(e=this._getValidTaskAndIndex(e,t))return this._getItemPath(e.item,t)}getTaskIndex(e){return this._getItemIndex(e,this._unsortedTasks?"unsortedTask":"task")}getTaskProject(e){const t=this;if((e=t._tasks[t._getItemIndex(e,t._unsortedTasks?"unsortedTask":"task")])&&e.$&&e.$.project)return t._cloneObject(e.$.project)}getResourceIndex(e){return this._getItemIndex(e,"resource")}getResourceTasks(e){const t=this,s=t._resources;if(s&&(e=s[this._getItemIndex(e,t._unsortedResources?"unsortedResource":"resource")]))return t._getTasksAssigned(e)}_getTasksAssigned(e){const t=this,s=t._tasks||[];let i=[];for(let r=0;r<s.length;r++){const n=s[r];!n.disableResources&&n.resources.find((t=>t===e.id))&&i.push(t._cloneObject(n))}return i}_getItemIndex(e,t){const s=this;if(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup)return[].slice.call(s.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e);t||(t="task");const i=s[`_${t}s`];if("unsortedTask"===t?t="task":"unsortedResource"===t&&(t="resource"),e instanceof HTMLElement&&e.classList.contains("smart-timeline-task"))return i.indexOf(e[`_${t}`]);const r="resource"===t?["id","label","value","progress"]:["id","type","class","dateStart","dateEnd","resources","connections"];if("object"==typeof e)for(let t=0;t<i.length;t++)if(r.every((s=>Array.isArray(e[s])?JSON.stringify(e[s])===JSON.stringify(i[t][s]):s.indexOf("date")>-1?new Date(e[s]).getTime()===new Date(i[t][s]).getTime():e[s]===i[t][s])))return i.indexOf(i[t]);return-1}getTaskPath(e){const t=this;if(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup)return t.$.taskTree.contains(e)?e.path:-1;const s=t._tasks;return e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&t.$.mainSplitter.contains(e)?t._getItemPath(e._task):("object"==typeof e&&(e=s.find((t=>e.id&&t.id&&t.id===e.id||e.type===t.type&&e.label===t.label&&e.class===t.class&&e.dateStart&&new Date(e.dateStart).getTime()===new Date(t.dateStart).getTime()&&e.dateEnd&&new Date(e.dateEnd).getTime()===new Date(t.dateEnd).getTime()&&e.resources.every((e=>t.resources.includes(e)))))),t._getItemPath(e))}_getItemPath(e,t="task"){const s=this[`_${t}s`];if(!s||!s.length)return;if(!e||!e.$)return"";if(!e.$.project)return s.filter((e=>!e.$.project)).indexOf(e).toString();let i=e.$.project,r=[];for(;i;)r.push(i.tasks.filter((e=>e.$.project===i)).indexOf(e).toString()),i=(e=i).$.project;return r.push(s.filter((e=>e.$.project===i)).indexOf(e).toString()),r.reverse().join(".")}clearState(){const e=this;e.id?window.localStorage.removeItem("smartGanttChart"+e.id):e.warn(e.localize("noId"))}loadState(e){const t=this;if(!e){if(!t.id)return;e=JSON.parse(window.localStorage.getItem("smartGanttChart"+t.id))}if(!e)return;let s,i=JSON.stringify(e.tasks),r=JSON.stringify(e.selectedIndexes),n=JSON.stringify(e.resources);if(i&&(i=JSON.parse(i)),r&&(r=JSON.parse(r)),n&&(n=JSON.parse(n)),t._noChangeEvent=!0,delete t._taskSplitterItemSizeSet,delete t._resourceSplitterItemSizeSet,Array.isArray(i)&&(t._createTasks(i),s=void 0!==t._view&&t.__tasks,t.set("dataSource",i)),Array.isArray(n)){let e=n;for(let s=0;s<e.length;s++){const e=n[s];let i=t._resources.find((t=>t.id&&t.id.toString()===e.id.toString()))||{};t._setResource(i,e),Object.values(i).length&&!t._resources.includes(i)&&t._resources.push(i)}t.sortable&&t._sortResources()}s||(t._createTimeline(),t._createTreeColumns(t.$.taskTreeSplitter),t._createResourceTimeline(),Array.isArray(r)&&(t.set("selectedIndexes",r),t._applySelection())),delete t._noChangeEvent}saveState(){const e=this;e.id?window.localStorage.setItem("smartGanttChart"+e.id,JSON.stringify(e.getState())):e.warn(e.localize("noId"))}insertTask(e,t){const s=this,i=Array.from(arguments).filter((e=>void 0!==e));if(1===i.length&&(t=i[0]),"object"!=typeof t)return void s.error(s.localize("incorrectArgument",{elementType:s.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"newTask"}));if(!s._tasks)return;const r=s._createTasks([t],!0);if(!r.length)return;if(s._unsortTasks(),"resource"!==s.view&&void 0!==s._view){const e=s.__tasks||s._tasks;for(let t=0;t<r.length;t++)e.push(r[t]);return s._isUpdating?(s.__tasks&&s.__tasks.forEach((e=>e.connections.forEach((e=>{const t=s.__tasks.indexOf(s._tasks[s._getTaskIndexById(e.target)]);t>-1&&(e.target=t)})))),s._isUpdating.type.task=!0,void(s._isUpdating.type.resource=!0)):(s._refreshTimeline(),void s.$.fireEvent("itemInsert",{type:"task",item:s._cloneObject(r[0])}))}const n=s._tasks.slice(0);let a,o,l;if("string"==typeof e?(a=n.find((e=>e.id&&e.id.toString()===arguments[0].toString())),a||(a=s._getItemByTreeIndex("task",e),a&&"project"===a.type&&"resource"!==s.view&&!s._view&&(l=s._getItemPath(a),o=e!==l)),e=o?n.indexOf(a.tasks.length?a.tasks[a.tasks.length-1]:a)+1:n.indexOf(a)):"number"==typeof e?a=n[e]:"object"==typeof e&&(a=n[s._getItemIndex(e)],e=n.indexOf(a)),a||(e=s._tasks.length),a&&a.$.project){r[0].$.project=a.$.project;let e=a.$.project;for(;e;){const t=o&&a.tasks&&a.tasks.length?a.tasks[a.tasks.length-1]:a;e.tasks.splice.apply(e.tasks,[e.tasks.indexOf(t)+(o?1:0),0].concat(r)),e=e.$.project}}if(s._handleTreeItemHover(),s._unfocusTreeItems(s.$.taskTreeSplitter),o){r[0].$.project=a;for(let e=0;e<r.length;e++)a.tasks.push(r[e])}s._synchronizeProjectVisibility(r[0].$.project,r[0]),s.$.timelineConnectionsContainer.innerHTML="";for(let t=0;t<n.length;t++){const s=n[t];if(s.connections)for(let t=0;t<s.connections.length;t++){const i=s.connections[t];"number"==typeof i.target&&i.target>=e&&(i.target+=r.length)}}if(n.splice.apply(n,[e,0].concat(r)),s._tasks=n,s._isUpdating)return s._isUpdating.type.task=!0,void(s._isUpdating.type.resource=!0);s._taskAPIManipulation=!0;const d=s.selectedIndexes.map((e=>s._tasks[e]));s._sortItems(),s._createTreeColumns(s.$.taskTreeSplitter),delete s._hoveredTimelineTask,s.$.taskTimelineCellsContainer.innerHTML="",s.$.timelineTasksContainer.innerHTML="",delete s._hoveredTimelineTask,s.$.timelineConnectionsContainer.innerHTML="",s._createTimeline(),a&&("project"===a.type?s._refreshProject(a):s._refreshProject(a.$.project)),s.set("selectedIndexes",d.map((e=>s._tasks.indexOf(e)))),s._applySelection(),delete s._taskAPIManipulation,s._refreshTaskResources(a),s.$.fireEvent("itemInsert",{type:"task",item:s._cloneObject(r[0])})}openWindow(e){const t=this;if(t.disableWindowEditor)return;if("string"==typeof e){if(e.indexOf(".")>-1){const s=t._getItemByTreeIndex("task",e);return void(s&&t._openPopupWindow(Array.from(t.$.timelineTasksContainer.children).find((e=>e._task===s))))}if(e.indexOf("-")>-1){let e=(arguments[0]+"").split("-");if(e=t._getValidConnectionId(e[0],e[1],e[2],"openEditor"),e)return void t._openPopupWindow(t.$.timelineConnectionsContainer.querySelector('.smart-task-connection[connection-id^="'+e+'"]'))}}const s=t._tasks[t._getTaskIndexById(e)];s&&t._openPopupWindow(Array.from(t.$.timelineTasksContainer.children).find((e=>e._task===s)))}closeWindow(){const e=this,t=["confirm","task","connection"];for(let s=0;s<t.length;s++){const i=e.$[t[s]+"PopupWindow"];i&&(i.close(),delete i._target)}}addTaskTo(e,t){const s=this,i=s._tasks;if(!i.length)return;if("string"==typeof t?(t=i.find((e=>e.id&&e.id.toString()===t.toString())))||(t=s._getItemByTreeIndex(s._unsortedTasks?"unsortedTask":"task",t)):"number"==typeof t?t=i[t]:"object"==typeof t&&(t=i[s._getItemIndex(t,s._unsortedTasks?"unsortedTask":"task")]),"string"==typeof e)(e=i.find((t=>t.id&&t.id.toString()===e.toString())))||(e=s._getItemByTreeIndex(s._unsortedTasks?"unsortedTask":"task",e));else if("number"==typeof e)e=i[e];else if("object"==typeof e){const t=i[s._getItemIndex(e,s._unsortedTasks?"unsortedTask":"task")];t&&(s.removeTask(t),e=t)}if(!t||!e||i.indexOf(t)<0||"object"!=typeof e)return;const r=t.tasks?t.tasks.length:0;s.insertTask(s._getItemPath(t,s._unsortedTasks?"unsortedTask":"task")+"."+r,e)}updateTask(e,t){const s=this,i=s._getValidTaskAndIndex(e);if(!i||!i.item)return;let r=s._unsortedTasks||s._tasks,n=i.item;const a=s.selectedIndexes.map((e=>r[e])),o=!!s._unsortedTasks;if(e=i.index,"object"!=typeof t)return;if(void 0===n||e<0)return;s._unsortTasks(),r=s._tasks;const l=s.$.taskPopupWindow;l&&l._target&&l._target._task===n&&l.close(),e=Math.max(0,Math.min(r.length-1,e));const d=s.$.timelineTasksContainer.children[e],c=n.hidden;let m=s._getTaskResources(n,!0);for(let i in t){let a=n[i],l=t[i];if(!(l instanceof Date&&l.getTime()===new Date(a).getTime()||l===a)){if(!o&&d&&"class"===i&&(d.classList.remove(n.class),l&&d.classList.add(l)),"type"===i&&n.type!==t[i]&&["task","project","milestone"].indexOf(t[i])>-1){let a;if("project"===n.type){if("resource"!==s.view&&s._view)continue;const e=n.tasks,t=r.slice(0);for(let i=e.length-1;i>-1;i--){const n=t.indexOf(e[i]);o||s._isUpdating||(s._removeConnectionsToTask(n,t,e),s._removeConnection(n),s.$.timelineTasksContainer.removeChild(s.$.timelineTasksContainer.children[n]),s.$.taskTimelineCellsContainer.removeChild(s.$.taskTimelineCellsContainer.children[n])),r.splice(n,1)}if(!o){for(let e=0;e<r.length;e++){const s=r[e];s.connections&&s.connections.forEach((e=>e.target=r.indexOf(t[e.target])))}if(!s._isUpdating&&n.$.project&&n.tasks&&n.tasks.length){let e=n.$.project;for(;e;)e.tasks.splice.apply(e.tasks,[e.tasks.indexOf(n.tasks[0]),n.tasks.length]),s._refreshProject(e),e=e.$.project}}a=!0,delete n.tasks}else"project"===t[i]&&(n.tasks||(n.tasks=[]),delete n.expanded,a=!0);if(!o&&!s._isUpdating){if(a){s._taskAPIManipulation=!0,s._handleTreeItemHover(),s._unfocusTreeItems(s.$.taskTreeSplitter);const r=s.$.taskTreeSplitter._items;for(let a=0;a<r.length;a++){const o=r[a];if(s.$.taskTreeSplitterItem===o){const e=s._getItemPath(n);let t=Object.assign({},n);s.$.taskTree.selectedIndexes.includes(e)&&(t.selected=!0),s.$.taskTree.removeItem(e),s.$.taskTree.insert(t,e)}else{const s=o.getElementsByClassName("smart-task-tree-content")[0];if(!s)continue;const r=s.getElementsByClassName("smart-task-item")[e];if("project"!==t[i]||r.lastElementChild.classList.contains("smart-task-drop-down"))r.lastElementChild.classList.contains("smart-task-drop-down")&&r.lastElementChild.remove();else{const e=document.createElement("div");e.classList.add("smart-task-drop-down","smart-visibility-hidden"),r.appendChild(e)}}}delete s._taskAPIManipulation}const r=s.$.timelineTasksContainer.children[e];"milestone"!==t[i]&&"milestone"!==n.type||(r.style.width="",r.innerHTML=s._createTaskBar(t[i]).innerHTML),r.classList.remove(n.type),r.classList.add(t[i])}}"project"===n.type&&n.synchronized&&(i.toLowerCase().indexOf("date")>-1||i.toLowerCase().indexOf("duration")>-1)||("dateEnd"===i&&(n.duration=void 0),n[i]=l,"resources"===i&&(s._handleResources(n),m=m.concat(s._getTaskResources(n,!0)),m=m.filter(((e,t)=>m.indexOf(e)===t)),!s._isUpdating&&s.$.mainSplitter.contains(s.$.resourceSplitter)&&s._highlightAssignedItem("resource",s._resources.indexOf(s._getItemByTreeIndex("resource",s.$.resourceTree.selectedIndexes[0])))),"milestone"!==n.type||"dateStart"!==i&&"dateEnd"!==i||(n.dateEnd=n.dateStart=l))}}if(s._validateTaskProperties(n,n.$.project),"project"===n.type&&n.tasks.length&&n.hidden&&n.tasks.forEach((e=>e.hidden=n.hidden)),s._synchronizeProjectVisibility(n.$.project,n),"resource"!==s.view&&void 0!==s._view)return s._isUpdating?(s.__tasks&&s.__tasks.forEach((e=>e.connections.forEach((e=>{const t=s.__tasks.indexOf(s._tasks[s._getTaskIndexById(e.target)]);t>-1&&(e.target=t)})))),void(s._isUpdating.type.task=!0)):(s._refreshTimeline(),s._refreshTaskResources(n,m),void s.$.fireEvent("itemUpdate",{type:"task",item:s._cloneObject(n)}));if(s._isUpdating)return void(s._isUpdating.type.task=!0);if(o)return s._sortTasks(),void s.$.fireEvent("itemUpdate",{type:"task",item:s._cloneObject(n)});c!==n.hidden?(s._taskAPIManipulation=!0,s._createTreeColumns(s.$.taskTreeSplitter),delete s._hoveredTimelineTask,s.$.taskTimelineCellsContainer.innerHTML="",s.$.timelineConnectionsContainer.innerHTML="",s.$.timelineTasksContainer.innerHTML="",s._createTimeline(),s._setAriaControls(),delete s._taskAPIManipulation,s._applySelection(),n.resources.length&&s._highlightAssignedItem("resource",s._resources.indexOf(s._getItemByTreeIndex("resource",s.$.resourceTree.selectedIndexes[0])))):(s._setTaskBarProgress(n),s._setTaskBarLabel(n),s._refreshTimeline(s.view),s._refreshTreeColumnsData(n),s._refreshTaskConnections(n),s._autoSchedule());const u=s.selectedIndexes.map((e=>r[e]));a.includes(n)&&!u.includes(n)&&(s._taskAPIManipulation=!0,s._select("task",n),delete s._taskAPIManipulation),s._refreshTaskResources(n,m),s.$.fireEvent("itemUpdate",{type:"task",item:s._cloneObject(n)})}_insertTimelineTask(e,t,s){const i=this;i._taskAPIManipulation=!0;const r=i.selectedIndexes.map((e=>i._tasks[e]));i._sortItems(),i._insertNewTreeItem(e,t,s,"task"),i.$.timelineTasksContainer.innerHTML="",delete i._hoveredTimelineTask,i.$.timelineConnectionsContainer.innerHTML="",i._createTimeline(),"project"===t.type?i._refreshProject(t):i._refreshProject(t.$.project),i.set("selectedIndexes",r.map((e=>i._tasks.indexOf(e)))),i._applySelection(),delete i._taskAPIManipulation}removeTask(e){const t=this;let s,i=(t._unsortedTasks||t._tasks).slice(0);if("string"==typeof e){if(s=i.find((e=>e.id&&e.id.toString()===arguments[0].toString())),!s&&(s=t._getItemByTreeIndex(t._unsortedTasks?"unsortedTask":"task",e),e!==t._getItemPath(s,t._unsortedTasks?"unsortedTask":"task")))return;e=i.indexOf(s)}else if("number"==typeof e)s=i[e]||i.find((t=>t.id&&t.id.toString()===e.toString()));else{if("object"!=typeof e)return void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"index"}));s=i[t._getItemIndex(e,t._unsortedTasks?"unsortedTask":"task")]}if(!s)return;t.selectedIndexes.indexOf(e)>-1&&(t._select("task",s,!0),t._highlightAssignedItem("task"));const r=t.selectedIndexes.map((e=>t._tasks[e]));t._unsortTasks(),i=t._tasks,e=i.indexOf(s);const n=t.$.taskPopupWindow;if(n&&n._target===s&&n.close(),"resource"!==t.view&&void 0!==t._view){i=t._tasks;const e=function(e){for(let s=0;s<i.length;s++){const r=i[s];if(r.connections)for(let s=0;s<r.connections.length;s++){let n=r.connections[s];t._getTaskIndexById(n.target,i)>=e&&"number"==typeof n.target&&(n.target-=1)}}};if("project"===s.type){s.tasks.forEach((e=>{t._removeConnectionsToTask(t._tasks.indexOf(e),t._tasks,s.tasks),t._refreshTaskResources(t._tasks.indexOf(e))})),t.__tasks&&t.__tasks.forEach((e=>e.connections.forEach((e=>{const s=t.__tasks.indexOf(t._tasks[t._getTaskIndexById(e.target)]);s>-1&&(e.target=s)}))));for(let t=0;t<s.tasks.length;t++){const r=i.indexOf(s.tasks[t]);e(r),i.splice(r,1)}}else t._removeConnectionsToTask(t._tasks.indexOf(s),t._tasks,[s]),t.__tasks&&i.forEach((e=>e.connections.forEach((e=>e.target=i.indexOf(t._tasks[t._getTaskIndexById(e.target)]))))),e(i.indexOf(s));if(i.splice(i.indexOf(s),1),s.$._project)s.$._project.tasks.splice(s.$._project.tasks.indexOf(s),1+(s.tasks?s.tasks.length:0));else if(!t.__tasks&&s.$.project){let e=s.$.project;for(;e;)e.tasks.splice.apply(e.tasks,[e.tasks.indexOf(s),1+(s.tasks?s.tasks.length:0)]),e=e.$.project;t._refreshProject(s.$.project)}return t._isUpdating?(t._isUpdating.type.task=!0,void(t._isUpdating.type.resource=!0)):(t._refreshTimeline(),t._refreshTaskResources(s),void t.$.fireEvent("itemRemove",{type:"task",item:t._cloneObject(s)}))}t._taskAPIManipulation=!0,t._removeConnection(e),t._removeConnectionsToTask(e,i);let a=1;if("project"===s.type){const e=s.tasks||[];for(let s=0;s<e.length;s++){const r=i.indexOf(e[s]);t._removeConnectionsToTask(r,i,e),t._removeConnection(r)}for(let t=0;t<e.length;t++)i.splice(i.indexOf(e[t]),1),a++;s.tasks=[]}if(s.$.project){let e=s.$.project;for(;e;)e.tasks.splice.apply(e.tasks,[e.tasks.indexOf(s),1+(s.tasks?s.tasks.length:0)]),e=e.$.project}i.splice(i.indexOf(s),1);for(let s=0;s<i.length;s++){const r=i[s];if(r.connections)for(let i=0;i<r.connections.length;i++){const n=r.connections[i],o=t._getTaskIndexById(n.target);if(o>=e){const i=t.$.timelineConnectionsContainer,r=i.querySelectorAll('.smart-task-connection[connection-id^="'+(s>=e?s+a:s)+"-"+o+'"]');for(let e=0;e<r.length;e++)i.removeChild(r[e]);"number"==typeof n.target&&(n.target-=a)}}}if(t._tasks=i,t._isUpdating)return delete t._taskAPIManipulation,t._isUpdating.type.task=!0,void(t._isUpdating.type.resource=!0);t._sortItems(),t.$.timelineTasksContainer.innerHTML="",delete t._hoveredTimelineTask,t.$.taskTimelineCellsContainer.innerHTML="",t.$.timelineConnectionsContainer.innerHTML="",t._createTreeColumns(t.$.taskTreeSplitter),t._createTimeline(),t._refreshProject(s.$.project),t._createResourceTimeline(),t.set("selectedIndexes",r.map((e=>t._tasks.indexOf(e)))),t._applySelection(),delete t._taskAPIManipulation,t.$.fireEvent("itemRemove",{type:"task",item:t._cloneObject(s)})}_getValidConnectionId(e,t,s,i){const r=this,n=r._tasks,a=0===i.indexOf("_");let o;if("string"==typeof e&&(o=r._getTaskIndexById(e),o>=0&&(e=o)),"string"==typeof t&&(o=r._getTaskIndexById(t),o>=0&&(t=o)),e=parseInt(e),t=parseInt(t),s=parseInt(s),isNaN(e)||isNaN(t)||e===t)a||r.error(r.localize("incorrectArgument",{elementType:r.nodeName.toLowerCase(),methodName:i,argumentName:"taskIndex"}));else if(e>=n.length||e<0||t>=n.length||t<0)a||r.error(r.localize("outOfBounds",{elementType:r.nodeName.toLowerCase(),methodName:i,argumentName:"taskIndex"}));else{if(!(isNaN(s)||s<0||s>3))return a?[e,t,s]:e+"-"+t+"-"+s;a||r.error(r.localize("incorrectArgument",{elementType:r.nodeName.toLowerCase(),methodName:i,argumentName:"connectionType"}))}}_applySelection(e){const t=this,s=t.selectedIndexes.slice(0);if(!t._tasks||!t._tasks.length)return void t.set("selectedIndexes",[]);let i=[];e&&e.length>0&&(i=e.filter((e=>t._tasks.filter((e=>!e.hidden))[e]))),t._taskAPIManipulation=!0;for(let e=0;e<s.length;e++){let r=s[e];r="string"==typeof r&&r.indexOf(".")>-1?t._getItemByTreeIndex("task",r):t._tasks[r],r&&i.indexOf(r)<0&&t._select("task",r)}s.length||t._select("task"),delete t._taskAPIManipulation,e&&!t._noChangeEvent&&t.$.fireEvent("change",{value:s,oldValue:e})}_autoSchedule(e){const t=this,s=t._tasks;if(t.autoSchedule){e?Array.isArray(e)||(e=[e]):e=s;for(let s=0;s<e.length;s++){const i=e[s];"project"===i.type&&i.synchronized||(i.minDateStart=i.minDateEnd=void 0,t._autoScheduleTasks(i))}if(t._isUpdateRequired){t._createTimelineCells();for(let e=0;e<s.length;e++){const i=s[e];i.hidden||(t._setTimelineTaskBar(i,!0),t._refreshTaskConnections(i),t._refreshTreeColumnsData(i))}delete t._isUpdateRequired}}}_autoScheduleTasks(e){const t=this,s=t._tasks,i=s.indexOf(e),r=e.connections;for(let i=0;i<r.length;i++)t._isAutoScheduled(e,s[t._getTaskIndexById(r[i].target)],!0);const n=t._getConnectedTasks(i);let a,o,l;for(let s=0;s<n.length;s++){const r=n[s],d=r.connections.find((e=>t._getTaskIndexById(e.target)===i)),c=d.type,m=d.lag||0;"project"===r.type&&r.synchronized||(0===c||1===c?(l=new Date((0===c?r.dateStart:r.dateEnd).getTime()+m),e.minDateStart=new Date(e.minDateStart?Math.max(e.minDateStart.getTime(),l.getTime()):l),o=e.minDateStart.getTime()-e.dateStart.getTime(),a=new Date(e.dateEnd.getTime()+(t.autoScheduleStrictMode?o:Math.max(0,o))),a.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=a,t._isUpdateRequired=!0),t.autoScheduleStrictMode&&e.minDateStart.getTime()!==e.dateStart.getTime()&&(e.dateStart=e.minDateStart,t._isUpdateRequired=!0)):(l=new Date((2===c?r.dateEnd:r.dateStart).getTime()+m),e.minDateEnd=new Date(e.minDateEnd?Math.min(e.minDateEnd.getTime(),l.getTime()):l),o=e.minDateEnd.getTime()-e.dateEnd.getTime(),a=new Date(e.dateStart.getTime()+(t.autoScheduleStrictMode?o:Math.max(0,o))),a.getTime()!==e.dateStart.getTime()&&(e.dateStart=a,t._isUpdateRequired=!0),t.autoScheduleStrictMode&&e.minDateEnd.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=e.minDateEnd,t._isUpdateRequired=!0)),t._validateTaskProperties(e,e.$.project))}for(let e=0;e<r.length;e++){const i=s[t._getTaskIndexById(r[e].target)];!i||"project"===i.type&&i.synchronized||(i.minDateStart=i.minDateEnd=void 0,t._autoScheduleTasks(i))}}_getConnectedTasks(e){const t=this,s=t._tasks;if(!s||0===s.length)return;let i=[];for(let r=0;r<s.length;r++){const n=s[r],a=n.connections;if(a)for(let s=0;s<a.length;s++)t._getTaskIndexById(a[s].target)===e&&i.push(n)}return i}_autoScheduleRestore(e,t){const s=this._tasks;e||(e=s),Array.isArray(e)||(e=[e]);for(let i=0;i<e.length;i++){const r=e[i];s.indexOf(e[i])>-1&&(t?0===t||1===t?r.minDateStart=void 0:r.minDateEnd=void 0:r.minDateStart=r.minDateEnd=void 0)}}_autoScroll(e){const t=this;function s(s,i){if(!t._dragDetails)return clearInterval(t._scrollInterval),t._scrollInterval=void 0,void delete t._autoScrolling;t._autoScrolling=!0,i?(t.scrollTop-=t.autoScrollStep*s,t._dragDetails.coordinates.y+=t.autoScrollStep*s):(t.scrollLeft-=(t.rightToLeft?-1:1)*t.autoScrollStep*s,t._dragDetails.coordinates.x+=t.autoScrollStep*s),t.hasAttribute("dragged")?t._handleTaskBarDrag(e):t.hasAttribute("resized")&&t._handleTaskBarResize(e)}if(t.disableAutoScroll||!e||!t.hasAttribute("dragged")&&!t.hasAttribute("resized")&&!t.hasAttribute("connecting-task"))return;const i=t.$.timeline.getBoundingClientRect();t._scrollInterval&&clearInterval(t._scrollInterval),t._scrollInterval=setInterval((function(){(t.scrollLeft||t.rightToLeft)&&e.clientX<=i.left+20?s(1):t.scrollLeft!==(t.rightToLeft?0:t.scrollWidth)&&e.clientX>=i.left+i.width-20?s(-1):t.scrollTop&&e.clientY<=i.top+20?s(1,!0):t.scrollTop!==t.scrollHeight&&e.clientY>=i.top+i.height-20?s(-1,!0):(clearInterval(t._scrollInterval),t._scrollInterval=void 0,delete t._autoScrolling)}),1)}_checkTaskBarResizability(e){const t=this,s=t._tasks.filter((e=>!e.hidden));let i=e.originalEvent.target;t.shadowRoot&&i===t&&(i=e.originalEvent.composedPath()[0]);const r=t.$.timeline;if(!i.closest)return void r.removeAttribute("task-bar-hovered");let n,a=i.closest(".smart-timeline-task-cell")||i.closest(".smart-timeline-task");if(t.disabled||t.disableTaskResize||!a||!r.contains(a))return void r.removeAttribute("task-bar-hovered");if(a.classList.contains("smart-timeline-task-cell")?n=t.$.timelineTasksContainer.children[s.indexOf(a._task)]:a.classList.contains("smart-timeline-task")&&(n=a,a=t.$.taskTimelineCellsContainer.children[s.indexOf(a._task)]),!n||n.classList.contains("milestone")||n._task.synchronized||n._task.disableResize)return;if(i.classList&&i.classList.contains("smart-task-connection-point"))return void r.removeAttribute("task-bar-hovered");const o=e.pageX-window.pageXOffset,l="visible"===t.resizeHandlesVisibility||Smart.Utilities.Core.isMobile?20:5,d=n.getBoundingClientRect(),c=a.getBoundingClientRect(),m=Math.min(l,o-c.left),u=Math.min(l,c.left+c.width-o);Math.round(d.left)+m>=o&&Math.round(d.left)-m<=o?r.setAttribute("task-bar-hovered","left"):Math.round(d.left+d.width)+u>=o&&Math.round(d.left+d.width)-u<=o?r.setAttribute("task-bar-hovered","right"):r.removeAttribute("task-bar-hovered")}_onShadowDomLoaded(e,t,s){requestAnimationFrame((function i(){const r=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<r.length;e++)if(-1!==r[e].href.indexOf(t))return void s();requestAnimationFrame(i)}))}_openPopupWindow(e,t){const s=this;function i(){function t(){const e=s.getBoundingClientRect();n.style.left=Math.max(e.left+window.pageXOffset,e.left+window.pageXOffset+e.width/2-n.offsetWidth/2)+"px",n.style.top=Math.max(e.top+window.pageYOffset,e.top+window.pageYOffset+e.height/2-n.offsetHeight/2)+"px",n.opened?(n.bringToFront(),n._handleActiveState()):n.open()}if(s.popupWindowCustomizationFunction&&s.popupWindowCustomizationFunction(n,r,e.classList.contains("smart-task-connection")?e.getAttribute("connection-id"):s._tasks.indexOf(e._task)),s._setPopupWindowTemplate("header",r,e),s._setPopupWindowTemplate("footer",r,e),s._setPopupWindowTemplate("content",r,e),!s._popupWindow[r+"PopupWindow"]){const e=s["$"+r+"PopupWindow"];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.listen("transitionend",s._popupWindowTransitionendHandler.bind(s)),e.listen("open",s._popupWindowOpenHandler.bind(s)),e.listen("close",s._popupWindowCloseHandler.bind(s)),e.listen("closing",s._popupWindowClosingHandler.bind(s)),e.listen("click",s._popupWindowClickHandler.bind(s))}n.shadowRoot?(n.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),s._onShadowDomLoaded(n,"smart.window.css",t)):t();const i=(s.getAttribute("aria-owns")||"")+" "+n.id;s.setAttribute("aria-owns",i.trim()),s._popupWindow[r+"PopupWindow"]=n}if(!e)return;const r=t?"confirm":e.classList.contains("smart-task-connection")?"connection":"task",n=s._createPopupWindow(r);!t&&s.$.fireEvent("opening",{target:n,type:r}).defaultPrevented||(n._target=e,s._popupWindow||(s._popupWindow={}),n.parentElement||s.getShadowRootOrBody().appendChild(n),n.isCompleted?i():n.whenReady((()=>i())))}_createPopupWindow(e){const t=this,s=e+"PopupWindow";if(t.$[s])return t.$[s];const i=document.createElement("smart-window");return i.classList.add("smart-"+e+"-popup-window"),i.classList.add("smart-gantt-chart-popup-window"),i.setAttribute("smart-id",s),t.$[s]=i,t["$"+s]=Smart.Utilities.Extend(i),i.rightToLeft=t.rightToLeft,i.theme=t.theme,i.animation=t.animation,i.disableSnap=!0,i.headerButtons=["close"],i}_popupWindowOpenHandler(e){const t=this,s=t["$"+e.target.getAttribute("smart-id")];s&&(t._handleModal(!0),t.$.fireEvent(e.type,e.detail),s.unlisten("open"))}_popupWindowClosingHandler(e){const t=this["$"+e.target.getAttribute("smart-id")];if(!t)return;const s=e.target.classList.contains("smart-confirm-popup-window")?"confirm":e.target.classList.contains("smart-connection-popup-window")?"connection":"task";this.$.fireEvent(e.type,{target:e.target,type:s}).defaultPrevented?e.preventDefault():t.unlisten(e.type)}_popupWindowCloseHandler(e){const t=this,s=e.target.getAttribute("smart-id"),i=t["$"+s];if(i){if(t._handleModal(),t.$.fireEvent(e.type,e.detail),i.unlisten("close"),i.unlisten("click"),t.hasAttribute("aria-owns")){const e=t.getAttribute("aria-owns").replace(t._popupWindow[s].id,"").trim();e?t.setAttribute("aria-owns",e):t.removeAttribute("aria-owns")}delete t._popupWindow[s];const r=Object.keys(t._popupWindow);if(1===r.length&&t._popupWindow.confirmPopupWindow)return delete t._popupWindow.confirmPopupWindow._target,void t._popupWindow.confirmPopupWindow.close();"confirmPopupWindow"===s&&r.length&&requestAnimationFrame((()=>{const e=t._popupWindow[r[r.length-1]];e&&e.focus()}))}}_popupWindowTransitionendHandler(e){const t=this,s=e.target;s instanceof Smart.Window&&!s.opened&&"visibility"===e.propertyName&&(t["$"+s.getAttribute("smart-id")].unlisten("transitionend"),s.parentElement&&s.parentElement.removeChild(s))}_handleModal(e){const t=this;let s=(t.shadowRoot||t).querySelector(".smart-popup-window-modal");e?(s||(s=document.createElement("div"),s.classList.add("smart-popup-window-modal")),s.parentElement||(t.$.container.appendChild(s),t.setAttribute("modal",""))):s&&s.parentElement&&Object.keys(t._popupWindow).length<2&&(s.parentElement.removeChild(s),t.removeAttribute("modal"))}_createTaskEditor(e,t,s){const i=this,r=e.value,n=t[e.value];let a,o,l=s.find((e=>e._label===r));if(l)a=l.firstElementChild,o=l.lastElementChild;else{if(l=document.createElement("div"),l.classList.add("smart-gantt-chart-popup-window-editor"),l._label=r,e.customEditor)return l.appendChild(e.customEditor(r,n)),l;if(a=document.createElement("label"),a.id||(a.id="editorLabel"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),"number"==typeof n||"string"==typeof n)o=document.createElement("input"),o.classList.add("smart-input");else if(n instanceof Date)Smart.DateTimePicker?(o=document.createElement("smart-date-time-picker"),o.locale=i.locale,o.dropDownAppendTo="body",o.calendarButton=!0,o.dropDownDisplayMode="auto",o.enableMouseWheelAction=!0,o.formatString="yyyy-MMM-dd HH:mm:ss"):(o=document.createElement("input"),o.type="datetime-local");else if(Array.isArray(n))if(Smart.DropDownList)o=document.createElement("smart-drop-down-list"),o.virtualized=!0,o.dropDownAppendTo="body",o.selectionMode="zeroOrMany";else{o=document.createElement("input"),o.classList.add("smart-input");const e=document.createElement("datalist");e.id="resourceList",o.setAttribute("list",e.id),l.appendChild(e)}o&&o.setAttribute("aria-labelledby",a.id)}if(!l.parentElement)return l.appendChild(a),l.appendChild(o),l;i._setPopupWindowEditors(e,t,l)}_setAriaControls(e){const t=this;function s(s){const i=t.$.timelineTasksContainer.children;for(let r=0;r<s.length;r++){let n,a=s[r];a.path?n=i[t._tasks.indexOf(t._getItemByTreeIndex(e,a.path))]:(n=i[t._getTreeItemIndex(a)],a=a.parentElement),n&&(a.setAttribute("aria-controls",n.id),n.setAttribute("aria-controls",((n.getAttribute("aria-controls")||"")+" "+(a.id||"")).trim()))}}e||(e="task");const i=t.$[`${e}TreeSplitter`]._items;for(let r=0;r<i.length;r++){const n=i[r];let a;if(t.$.taskTreeSplitterItem===n)a=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group");else{const t=n.querySelector(`.smart-${e}-tree-content`);if(!t)continue;a=t.querySelectorAll(`.smart-${e}-label-container`)}s(a)}}_setPopupWindowEditors(e,t,s){const i=this,r=s.firstElementChild,n=s.lastElementChild,a=(e.value+"").split(/(?=[A-Z])/).join(" "),o=t[e.value];if(e.customEditor)e.setCustomEditorValue&&e.setCustomEditorValue(s,a,o);else{if(r.innerHTML=i.localize(e.value)||a.charAt(0).toUpperCase()+a.slice(1),"number"==typeof o)n.value=parseFloat(o.toFixed(2));else if("string"==typeof o)n.value=o;else if(o instanceof Date)n.value=new Date(o);else if(Array.isArray(o)){const e=i._resources;if(n.placeholder=i.localize("unassigned"),Smart.DropDownList&&n instanceof Smart.DropDownList)n.dataSource=e.map((e=>({label:e.label,value:e.id}))),n.selectedValues=t.disableResources?[]:t.resources.map((e=>e.toString()));else{let i=s.querySelector("datalist"),r=document.createDocumentFragment();i.innerHTML="";for(let t=0;t<e.length;t++){const s=e[t],i=document.createElement("option");i.value=s.id,i.innerHTML=s.label,r.appendChild(i)}n.value=t.resources.toString(),i.appendChild(r)}}"project"===t.type&&t.synchronized&&(a.toLowerCase().indexOf("date")>-1||a.toLowerCase().indexOf("duration")>-1)||"resources"===a&&t.disableResources?n.disabled=!0:n.disabled=!1,n.disabled=!!e.disableEdit,n.rightToLeft=i.rightToLeft,n.animation=i.animation,n.theme=i.theme}}_setPopupWindowContent(e,t){const s=this,i=s.$[e+"PopupWindow"],r=t._task,n=[].slice.call(i.getElementsByClassName("smart-gantt-chart-popup-window-editor"));if(i.content&&(!i.content.innerHTML||n.length))if("task"===e&&r){const e=s.taskColumns;for(let t=0;t<e.length;t++){const a=e[t];if(void 0===r[a.value])continue;const o=s._createTaskEditor(a,r,n);o&&(i.appendChild(o),s._setPopupWindowEditors(a,r,o))}t.id&&i.setAttribute("aria-controls",t.id)}else if("confirm"===e){if(i.innerHTML='<div class="smart-gantt-chart-popup-window-editor">'+s.localize("confirm",{componentName:"The task"})+"</div >",s._popupWindow){const e=Object.keys(s._popupWindow);i.setAttribute("aria-controls",s._popupWindow[e[e.length-1]].id)}}else{const e=t.getAttribute("connection-id").split("-"),r=s._tasks[e[0]],n=s._tasks[e[1]];i.innerHTML='<div class="smart-gantt-chart-popup-window-editor">'+s.localize("deleteLink")+"<b> "+r.label+" - "+n.label+"?</b></div>"}}_setPopupWindowTemplate(e,t,s){const i=this,r=i.$[t+"PopupWindow"];if("content"!==e){if(r[e+"Template"]||(r[e+"Template"]=i._createPopupWindowTemplate(e,t,s)),"header"===e&&s&&s._task){const e=(r.shadowRoot||r).querySelector(".smart-popup-window-label");e&&(e.innerHTML=s._task.label)}else if("footer"===e){const e=(r.shadowRoot||r).querySelectorAll(".smart-popup-window-button");for(let s=0;s<e.length;s++){const r=e[s];r.innerHTML="task"===t?'<span class="smart-icon"></span>':"",r.theme=i.theme,r.rightToLeft=i.rightToLeft,r.animation=i.animation,r.classList.contains("ok")?(r.innerHTML+=i.localize("ok"),r.setAttribute("aria-label","ok")):r.classList.contains("cancel")?(r.innerHTML+=i.localize("cancel"),r.setAttribute("aria-label","cancel")):r.classList.contains("delete")&&(r.innerHTML+=i.localize("delete"),r.setAttribute("aria-label","delete"));const n=r.querySelector(".smart-ripple");n&&n.parentElement.removeChild(n)}}}else i._setPopupWindowContent(t,s)}_createPopupWindowTemplate(e,t){const s=this,i=document.createElement("template");if("footer"===e)switch(t){case"task":i.innerHTML=`<smart-button class="smart-popup-window-button ok primary"\n                            animation="${s.animation}" theme="${s.theme}" ${s.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                        <smart-button class="smart-popup-window-button cancel"\n                            animation="${s.animation}" theme="${s.theme}" ${s.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                        <smart-button class="smart-popup-window-button delete secondary"\n                            animation="${s.animation}" theme="${s.theme}" ${s.rightToLeft?"right-to-left":""}>\n                        </smart-button>`;break;case"connection":case"confirm":i.innerHTML=`<smart-button class="smart-popup-window-button ok primary"\n                            animation="${s.animation}" theme="${s.theme}" ${s.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                    <smart-button class="smart-popup-window-button cancel"\n                        animation="${s.animation}" theme="${s.theme}" ${s.rightToLeft?"right-to-left":""}>\n                    </smart-button>`}else"header"!==e||"task"!==t&&"confirm"!==t||(i.innerHTML='<span class="smart-popup-window-label"></span>');return i}_popupWindowClickHandler(e){const t=this;let s=(e.originalEvent||e).target;s.shadowRoot&&(s=(e.originalEvent||e).composedPath()[0]);const i=s.closest("smart-window")||(s.getRootNode()&&s.getRootNode().host?s.getRootNode().host:void 0),r=i._target;if(s.closest(".smart-popup-window-button.cancel"))return t._popupWindow&&t._popupWindow.confirmPopupWindow&&i!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),i.close(),void delete i._target;if(s.closest(".smart-popup-window-button.ok")){if(i===t.$.connectionPopupWindow&&r.classList.contains("smart-task-connection"))t._removeConnection(r);else if(i===t.$.confirmPopupWindow)void 0!==r._task.$._resourceId?t.removeResource(r._task.$._resourceId):t.removeTask(t._tasks.indexOf(r._task)),i.close(),t.$.taskPopupWindow&&t.$.taskPopupWindow.close(),delete i._target;else{const e=(i.shadowRoot||i).querySelectorAll(".smart-gantt-chart-popup-window-editor");let s={};for(let i=0;i<e.length;i++){const r=e[i]._label,n=t.taskColumns.find((e=>e.value===r));if(n.customEditor&&n.getCustomEditorValue)s[r]=n.getCustomEditorValue(e[i]);else{const t=e[i].lastElementChild;let n;n=Smart.DateTimePicker&&t instanceof Smart.DateTimePicker?t.value.toDate():t instanceof HTMLInputElement&&"datetime-local"===t.type?new Date(t.value):Smart.DropDownList&&t instanceof Smart.DropDownList?t.selectedValues.slice(0):t.hasAttribute("list")?t.value.split(",").map((e=>e.trim())):t.value,n instanceof Date&&isNaN(n.getTime())&&(n=void 0),null!=n&&(s[r]=n)}}void 0!==r._task.$._resourceId?t.updateResource(r._task.$._resourceId,s):t.updateTask(t._tasks.indexOf(r._task),s)}return t._popupWindow&&t._popupWindow.confirmPopupWindow&&i!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),i.close(),void delete i._target}s.closest(".smart-popup-window-button.delete")&&t._openPopupWindow(i._target,!0)}_createTasks(e,t){const s=this;t||s.clearTasks();let i=[];if(function e(r,n){let a=[];if(0!==r.length){for(let o=0;o<r.length;o++){let l=r[o];"object"==typeof l&&(l=s._validateTaskProperties(l,n),l&&(l.$.project=n,l.tasks instanceof Array&&l.tasks.length>0&&(l.synchronized&&(l.dateStart=l.minDateStart=l.maxDateStart=void 0,l.dateEnd=l.minDateEnd=l.maxDateEnd=void 0),l.type="project",l.tasks=e(l.tasks,l),0===l.tasks.length?delete l.tasks:(l.hidden=!l.tasks.some((e=>!e.hidden)),l.hidden?l.tasks.forEach((e=>e.hidden=l.hidden)):s._synchronizeProjectVisibility(n,l))),(!l.type||["project","task","milestone"].indexOf(l.type)<0)&&(l.type="task"),"project"!==l.type||l.tasks||(l.tasks=[]),n&&"project"===l.type&&l.tasks.length>0?(a.push(l),a=a.concat(l.tasks)):(n||((t&&"project"===l.type&&l.synchronized||l.dateStart&&l.dateEnd&&!isNaN(l.dateStart.getTime())&&!isNaN(l.dateEnd.getTime()))&&i.push(l),l.tasks&&(i=i.concat(l.tasks))),a.push(l))))}return a}}(e||s.dataSource),t)return i.slice(0);s._tasks=i.slice(0),s.sortable&&s._sortTasks(!0),s._handleResources()}_createTimeline(){const e=this;e._tasks&&0!==e._tasks.length?(delete e.__tasks,e._autoSchedule(),e._createTimelineCells(),e._prepareViewTasks(!0),e._resetTimeline(),e._insertTimelineTasks(e._tasks),e.$.taskSplitter.refresh()):e._clearTasks()}_insertNewTreeItem(){const e=this,[t,s,i,r]=[...arguments],n=e.$[`${r}TreeSplitter`]._items,a=e.$[`${r}Tree`];for(let o=0;o<n.length;o++){const l=n[o];if(l.contains(a))i?a.insert(s,e._getItemPath(s,r)):a.insert(s,"number"==typeof t?a.querySelectorAll("smart-tree-item, smart-tree-items-group")[t]:t);else{const n=l.getElementsByClassName(`smart-${r}-tree-content`)[0],a=e[`${r}Columns`][o];if(!n||!a||!a.value)continue;let d;if(i){d=n.getElementsByClassName(`smart-${r}-item`)[t],d.lastElementChild.appendChild(e._createTreeItemContainers([s],a,r));continue}d=n.getElementsByClassName(`smart-${r}-item`)[t],d?d.parentElement.insertBefore(e._createTreeItemContainers([s],a,r),d):n.appendChild(e._createTreeItemContainers([s],a,r))}}}_insertTimelineTasks(e,t,s){const i=this,r=function(e){let t=e.$.project;for(;t;){if(!t.expanded)return!1;t=t.$.project}return!0};let n={};i.$.timelineTasksContainer.innerHTML="",delete i._hoveredTimelineTask;for(let a=0;a<e.length;a++){const o=e[a],l=o.connections;if(!o.hidden&&(i._createTimelineTask(o,t?t+a:void 0),i._setTimelineTaskBar(o),i._setTaskBarProgress(o),i._setTaskBarLabel(o),!s&&(i._expandTask(o),r(o)))){for(let t=0;t<l.length;t++){const s=i._getTaskIndexById(l[t].target);if(null==s||isNaN(s)||s<0||s>=e.length||s===a){l.splice(l.indexOf(l[t]),1);continue}const r=a+"-"+s+"-"+l[t].type;s>a?(n[s]||(n[s]=[]),n[s].indexOf(r)<0&&n[s].push(r)):i._connectTask(r)}if(n[a]){for(let e=0;e<n[a].length;e++)i._connectTask(n[a][e]);delete n[a]}}}i._refresh(),i.$.timelineViewCells.setAttribute("no-transition",""),i.$.container.style.setProperty("--smart-gantt-chart-task-timeline-content-height",i.$.taskTimelineCellsContainer.offsetHeight+"px"),requestAnimationFrame((()=>i.$.timelineViewCells.removeAttribute("no-transition")))}_ensureVisible(e,t="task"){const s=this;if(s._isEnsureVisibleCalled)return void delete s._isEnsureVisibleCalled;if(null==e)return;const i=s[`_${t}s`].filter((e=>!e.hidden));let r,n,a;if(e instanceof HTMLElement)r=e.menu||e.closest("smart-tree"),a=e;else if(!i||!i.length)return;r||(r=s.$[`${t}Tree`]);const o=Array.from(r.querySelectorAll("smart-tree-item, smart-tree-items-group"));if(n=e instanceof HTMLElement?o.indexOf(a):i.indexOf(e),n<0)return;if(o.length){if("number"==typeof e&&(a=o[Math.min(Math.max(0,e),o.length-1)]),a||(a="object"==typeof e?o[n]:e),s._isEnsureVisibleCalled=!0,!r._isBranchExpanded(a)){let e=a.parentItem;for(;e&&!r._isBranchExpanded(e);)e=e.parentItem;e&&(a=e)}r.ensureVisible(a),n||(n=o.indexOf(a))}let l,d,c,m;delete s._isEnsureVisibleCalled,r===s.$.taskTree?([c,d]=[s,s.$.timelineContent],[l,m]=[s.$.taskTimelineCellsContainer,"scrollTop"]):([c,d]=[s.$.resourceVerticalScrollBar,s.$.resourceTimelineContent],[l,m]=[s.$.resourceTimelineCellsContainer,"value"]);const u=l.children[n];u&&(u.offsetTop+u.offsetHeight>c[m]+d.offsetHeight?c[m]=Math.max(0,u.offsetTop+u.offsetHeight-d.offsetHeight):u.offsetTop<c[m]&&(c[m]=Math.max(0,u.offsetTop)),d.scrollTop=c[m])}_expandTask(e,t){const s=this;if(!e)return!0;const i="project"===e.type?e:e.$.project;return!(i&&i.tasks&&i.tasks.length)||(s.$.timelineContent.style.minHeight="",s.$.timelineContent.style.maxHeight="",void 0!==t?s._isTaskExpanded(i)?void s._animateTimelineExpanding(i,t):(s._handleTaskItemExpanding(i,t),void(i.expanded=t)):!(!(t=i.expanded)||t!==i.expanded)||(s._handleExpanding(i,t),i.expanded))}_handleExpanding(e,t){const s=this,i=s._tasks.filter((e=>!e.hidden)),r=s.$.timelineConnectionsContainer,n=[].slice.call(r.children),a=s.$.taskTimelineCellsContainer.children,o=s.$.timelineTasksContainer.children,l=e.tasks.filter((e=>!e.hidden)),d=parseFloat(window.getComputedStyle(s).getPropertyValue("--smart-gantt-chart-task-default-height"))||0;let c=s.$.taskTimelineCellsContainer.offsetHeight,m=0;s._handleTaskItemExpanding(e,t);for(let u=0;u<l.length;u++){m=i.indexOf(l[u]);const f=o[m],h=a[m];if(f){for(let e=0;e<n.length;e++){const t=n[e],s=t.getAttribute("connection-id").split("-");parseInt(s[1])!==m&&parseInt(s[0])!==m||!t.parentElement||r.removeChild(t)}if(t){if(!f.classList.contains("smart-visibility-hidden"))continue;const t=f._task.$.project;if(t&&t!==e&&!s._isTaskExpanded(f._task,e))continue;f.classList.remove("smart-visibility-hidden"),h.classList.remove("smart-visibility-hidden"),c+=d,s.$.container.style.setProperty("--smart-gantt-chart-task-timeline-content-height",c+"px"),s._refreshTaskConnections(f)}else{if(f.classList.contains("smart-visibility-hidden"))continue;f.classList.add("smart-visibility-hidden"),h.classList.add("smart-visibility-hidden"),c-=d,s.$.container.style.setProperty("--smart-gantt-chart-task-timeline-content-height",c+"px")}}}for(let t=i.indexOf(e)+1;t<o.length;t++){const e=o[t];e.style.top=a[t].offsetTop+"px",s._refreshTaskConnections(e)}e.expanded=t,s._refresh()}_handleTaskItemExpanding(e,t){const s=this,i=s._tasks.filter((e=>!e.hidden)).indexOf(e),r=s.$.taskTreeSplitter._items,n=s._isTaskExpanded(e);function a(e){"visibility"!==e.propertyName&&(this.style.height="",this.removeEventListener("transitionend",a))}for(let e=0;e<r.length;e++){if(r[e]===s.$.taskTreeSplitterItem)continue;const o=r[e].getElementsByClassName("smart-task-item");if(!o.length||!o[i])continue;const l=o[i].lastElementChild;!s._noAnimation&&s.hasAnimation&&n?requestAnimationFrame((function(){let e=0;for(let t=0;t<l.children.length;t++)e+=l.children[t].offsetHeight;l.style.height=e+"px",l.addEventListener("transitionend",a),t?l.classList.remove("smart-visibility-hidden"):(l.classList.add("smart-visibility-hidden"),requestAnimationFrame((function(){l.style.height="0"})))})):t?l.classList.remove("smart-visibility-hidden"):l.classList.add("smart-visibility-hidden")}}_isTaskExpanded(e,t){if(!e)return;let s,i=e.$.project;if(!i)return!0;for(;i;){if(s=i.expanded,!s)return;if(i=i.$.project,i===t)break}return s}_hoverViaKeyboardCallback(e){const t=this;if(t._unfocusTreeItems(),!e)return;const s=e.menu||e.closest("smart-splitter");let i,r,n,a;s===t.$.taskTree?([i,r]=[t.$.taskTimelineCellsContainer,t.$.timelineAnimationContainer],[n,a]=[t.$.taskTreeSplitter,"task"]):([i,r]=[t.$.resourceTimelineCellsContainer,t.$.resourceTimelineAnimationContainer],[n,a]=[t.$.resourceTreeSplitter,"resource"]);const o=Array.from(s.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e),l=i.children[o];if(l&&l.setAttribute("focus",""),!r.classList.contains("smart-visibility-hidden")&&"task"===a){const e=r.getElementsByClassName(`smart-timeline-${a}`);for(let s=0;s<e.length;s++){const i=e[s];if(t._tasks.indexOf(i._task)===o){i.setAttribute("focus","");break}}}const d=n._items;for(let e=0;e<d.length;e++){const s=d[e];if(s!==t.$[a+"TreeSplitterItem"]){const e=s.getElementsByClassName(`smart-${a}-label-container`)[o];e&&e.setAttribute("focus","")}}t._focusedItem=o}_unfocusTreeItems(e){const t=this;function s(e){if(!t.$.mainSplitter.contains(e))return;const s=e._items,[i,r]=e===t.$.taskTreeSplitter?["task",t.$.taskTimelineCellsContainer]:["resource",t.$.resourceTimelineCellsContainer];for(let e=0;e<s.length;e++){const r=s[e];if(r!==t.$[i+"TreeSplitterItem"]){const e=r.getElementsByClassName(`smart-${i}-label-container`);for(let t=0;t<e.length;t++)e[t].removeAttribute("focus")}}const n=r.children;for(let e=0;e<n.length;e++){const t=n[e];t.hasAttribute("focus")&&t.removeAttribute("focus")}"task"===i&&delete t._focusedItem}e?s(e):(s(t.$.taskTreeSplitter),s(t.$.resourceTreeSplitter))}_emptyAnimationContainer(){const e=this.$.timelineAnimationContainer.firstElementChild.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML="",e[t].lastElementChild.innerHTML=""}_animateTimelineExpanding(e,t){const s=this,i=s.$.timelineAnimationContainer,r=i.firstElementChild,n=r.children[0],a=r.children[1],o=r.children[2];if("none"===s.animation)return i.classList.add("smart-visibility-hidden"),s._emptyAnimationContainer(),void s._handleExpanding(e,t);const l=s._tasks.filter((e=>!e.hidden)),d=s.$.timelineTasksContainer.children,c=s.$.timelineConnectionsContainer.children,m=function(t){let s=t.$.project;for(;s;){if(s===e)return!0;s=s.$.project}},u=e.tasks.filter((t=>!t.hidden&&(t.$.project===e||s._isTaskExpanded(t,e))));let f=l.indexOf(e);const h=d[f].offsetHeight,g=s.$.timelineContent.offsetTop;s._emptyAnimationContainer(),t?a.classList.add("animate"):a.classList.remove("animate");let p,_=[],k=[],T=[],y=0;for(let t=0;t<d.length;t++){const i=d[t],r=i.cloneNode(!0),c=l.indexOf(i._task),u=i._task.$.project;u&&u!==e&&!s._isTaskExpanded(i._task,e)||(r.style["margin"+(s.rightToLeft?"Right":"Left")]=r.style[s.rightToLeft?"right":"left"],r.classList.remove("smart-visibility-hidden"),c<=f?(n.lastElementChild.appendChild(r),_.push(c)):m(i._task)?(a.lastElementChild.appendChild(r),k.push(c),y+=r.offsetHeight):(o.lastElementChild.appendChild(r),T.push(c)),void 0!==s._focusedItem&&s._focusedItem===f&&c===f&&r.setAttribute("focus",""))}a.style.transition="none",t&&s._handleExpanding(e,t);for(let e=0;e<c.length;e++){const t=c[e].cloneNode(),s=t.getAttribute("connection-id").split("-");_.indexOf(parseInt(s[0]))>-1&&_.indexOf(parseInt(s[1]))>-1?n.firstElementChild.appendChild(t):k.indexOf(parseInt(s[0]))>-1&&k.indexOf(parseInt(s[1]))>-1?a.firstElementChild.appendChild(t):T.indexOf(parseInt(s[0]))>-1&&T.indexOf(parseInt(s[1]))>-1&&o.firstElementChild.appendChild(t)}a.firstElementChild.style.transform="translateY(-"+n.offsetHeight+"px)",o.firstElementChild.style.transform="translateY(-"+(y+n.offsetHeight)+"px)",t||s._handleExpanding(e,t),s.$.timelineContent._scrollTop=s.$.timelineContent.scrollTop,p=s.$.timelineContent.offsetHeight,p!==r.offsetHeight&&(s.$.timelineContent.style[(t?"max":"min")+"Height"]=r.offsetHeight+"px"),i.style.top=g+"px",r.style.top=-s.scrollTop+"px",i.classList.remove("smart-visibility-hidden"),s.$.timelineContent.classList.add("smart-visibility-hidden"),requestAnimationFrame((function(){a.style.height=u.length*h+"px",a.style.transition="",t?(a.classList.remove("animate"),s.$.timelineContent.style.maxHeight=p+"px"):(a.classList.add("animate"),requestAnimationFrame((function(){a.style.height="0",s.$.timelineContent.style.minHeight=p+"px"})))}))}_timelineAnimationContainerTransitionendHandler(e){const t=this;if("height"===e.propertyName){const e=t.$.timelineAnimationContainer;e.classList.add("smart-visibility-hidden"),t.$.timelineContent.classList.remove("smart-visibility-hidden"),t._emptyAnimationContainer(),t.$.timelineContent.style.minHeight="",t.$.timelineContent.style.maxHeight="",t.$.timelineContent._scrollTop&&(t.$.timelineContent.scrollTop=t.$.timelineContent._scrollTop,delete t.$.timelineContent._scrollTop),e.firstElementChild.children[1].style.height="",t.taskPanelSize||t.$.mainSplitter.refresh()}clearTimeout(t._transitionTimeout),requestAnimationFrame((()=>t.$.taskSplitter.classList.remove("transition-scroll-bars")))}_getItemByTreeIndex(e,t,s){if(!t)return;const i=t.split("."),r=this[`_${e}s`];"unsortedTask"===e?e="task":"unsortedResource"===e&&(e="resource");let n=r.filter((e=>!e.$.project))[t.split(".")[0]];if(n){if(!n[`${e}s`]||!n[`${e}s`].length)return s?null:n;for(let t=1;t<i.length;t++){const r=n[`${e}s`].filter((e=>!e.hidden&&e.$.project===n))[i[t]];if(!r||s&&"project"!==r.type)break;if(n=r,"project"!==n.type)break}return s?n&&"project"===n.type?n:void 0:n}}_treeBlurHandler(e){const t=this;t._unfocusTreeItems(e.target===t.$.taskTree?t.$.taskTreeSplitter:t.$.resourceTreeSplitter)}_taskTreeChangeHandler(e){const t=this,s=e.target===t.$.taskTree?"task":"resource";let i;t._itemClickDetails&&(i=t._itemClickDetails.type===s),e.stopPropagation(),t[`_${s}APIManipulation`]||i||t._dragDetails||(t[`_${s}TreeChangeEventFired`]=!0,t._select(s,t._getItemByTreeIndex(s,e.detail.selectedIndexes[0])),delete t[`_${s}TreeChangeEventFired`])}_taskTreeExpandHandler(e){const t=this,s=e.target===t.$.taskTree?"task":"resource";if(e.stopPropagation(),!t[`${s}s`]||!t[`${s}s`].length)return;const i=e.detail.item.path,r=t._getItemByTreeIndex(s,i,!0);if(!r)return;t.$.fireEvent(e.type,{index:t._tasks.indexOf(r),label:r.label,value:r.value});const n=t.$[`${s}Splitter`],a=t.hasAnimation;a&&n.classList.add("transition-scroll-bars"),"collapse"===e.type?t._expandTask(r,!1):(t._expandTask(r,!0),a||t.taskPanelSize||t.$.mainSplitter.refresh()),clearTimeout(t._transitionTimeout),a&&(t._transitionTimeout=setTimeout((()=>n.classList.remove("transition-scroll-bars")),1e3))}_resetTimeline(){this.$.taskTimelineCellsContainer.innerHTML="";const e=this.$.timelineTasksContainer.children;for(let t=0;t<e.length;t++)delete e[t]._cellStart,delete e[t]._cellEnd}_refreshTimeline(e,t){const s=this;e||(e=s.view);const i=s._getDateFromCell(s.scrollLeft,s._getFirstCellObjInView(),e),r=s._view||void 0!==s.__tasks;let n;t||(n=s.selectedIndexes.map((e=>s._tasks[e])),s._prepareViewTasks());const a=s.scrollTop;if(s.scrollLeft=0,s._resetTimeline(),s._createTimelineCells(),r)s.$.timelineConnectionsContainer.innerHTML="",n&&s.set("selectedIndexes",n.map((e=>s._tasks.indexOf(e))).filter((e=>e>-1))),s._autoSchedule(),s._insertTimelineTasks(s._tasks),s._applySelection(),s._refreshResourceTimeline(),s._highlightAssignedItem("resource",s._resources.indexOf(s._getItemByTreeIndex("resource",s.$.resourceTree.selectedIndexes[0])));else{const e=s._tasks;for(let t=0;t<e.length;t++){const i=e[t];if(i.hidden)continue;const r=i.dateStart,n=i.dateEnd;if(s._createTimelineTaskCells(i),s._setTimelineTaskBar(i),s._refreshTaskConnections(i),s.selectedIndexes.includes(t)){const e=Array.from(s.$.taskTimelineCellsContainer.children).find((e=>e._task===i));e&&e.setAttribute("selected","")}r.getTime()===i.dateStart.getTime()&&n.getTime()===i.dateEnd.getTime()||s._refreshTreeColumnsData(i)}s.$.mainSplitter.contains(s.$.resourceSplitter)&&(s._refreshResourceTimeline(),s._highlightAssignedItem("resource",s._resources.indexOf(s._getItemByTreeIndex("resource",s.$.resourceTree.selectedIndexes[0])))),s._refresh()}s._scrollTo(i),s.scrollTop=a}_prepareViewTasks(e){const t=this;function s(e){for(let t in n)if(n[t].includes(e))return t;return""}function i(){const e=t.taskColumns,s=t.$.taskTreeSplitter.items,i=t._getTasksJSON().filter((e=>!e.hidden));if(s.length!==e.length)t._createTreeColumns(t.$.taskTreeSplitter);else for(let r=0;r<e.length;r++)t._createTreeColumnsData(s[r].closest("smart-splitter-item"),e[r],i),t._setColumnHeadersSorting("task")}if(!t._view&&!t.__tasks)return;if("resource"!==t.view&&!t._view&&t.__tasks)return void(t.__tasks&&(t._restoreTaskFromResourceView(),t._unsortTasks(),t._sortItems(),i()));t._unsortTasks(),t.__tasks?t.__tasks.forEach((e=>e.connections.forEach((e=>{const s=t.__tasks.indexOf(t._tasks[t._getTaskIndexById(e.target)]);s>-1&&(e.target=s)})))):t.__tasks=t._tasks;let r=t.__tasks,n={},a=[];for(let e=0;e<r.length;e++){const i=r[e];i.disableResources||(i.$.project&&void 0===i.$.project.$._resourceId&&(i.$._project=i.$.project),i.resources.length?i.resources.forEach((function(e){const r=s(i);if(t._resources.find((t=>t.id===e+""))){let t=e;r&&(n[r].splice(n[r].indexOf(i),1),t=[],t.push(r),t.push(e),t=t.sort().join(",")),n[t]?n[t].push(i):n[t]=[i]}else r||(n.unassigned?n.unassigned.push(i):n.unassigned=[i])})):n.unassigned?n.unassigned.push(i):n.unassigned=[i])}let o,l=Array.from(Object.keys(n)),d=t.taskColumns.find((e=>"label"===e.value));d&&(o="desc"===d.sort?"desc":"asc");for(let e=0;e<l.length;e++){const s=l[e];if(!n[s].length)continue;let i;if("unassigned"!==s){const e=s.split(",");i=[];for(let s=0;s<e.length;s++){const r=t._resources.find((t=>t.id&&t.id.toString()===e[s].toString()));r&&i.push(r.label)}i=i.sort("asc"===o?(e,t)=>e.localeCompare(t):(e,t)=>t.localeCompare(e)).join(", ").trim()}const r=t._createTasks([{label:i||t.localize("unassigned"),expanded:!0,synchronized:!0,disableResources:!0,type:"project"}],!0)[0];r.$._resourceId=s,r.tasks=n[s],a.push(r),n[s].forEach((e=>{e.$.project=r,e.expanded=!0,a.push(e),t._synchronizeProjectDates(r,e)}))}for(let e=0;e<a.length;e++)a[e].connections=a[e].connections.filter((s=>{const i=t.__tasks[t._getTaskIndexById(s.target)],r=a.indexOf(i);return r<0?(a[e].$._connections?a[e].$._connections.push(Object.assign({},s)):a[e].$._connections=[Object.assign({},s)],!1):(s.target=r,!0)}));t._tasks=a,t._sortItems(),e||i()}_restoreTaskFromResourceView(){const e=this;if(!e.__tasks)return;let t=[];const s=e._tasks;for(let i=0;i<e.__tasks.length;i++){const r=e.__tasks[i];(s.includes(r)||r.disableResources)&&t.push(r)}for(let i=0;i<s.length;i++){const r=s[i];void 0!==r.$._resourceId||e.__tasks.includes(r)||t.push(r),r.$._project?r.$.project=r.$._project:delete r.$.project,e._synchronizeProjectVisibility(r.$.project,r),delete r.$._project}for(let i=0;i<t.length;i++){const r=t[i];r.disableResources||(t[i].connections=t[i].connections.filter((i=>{const r=t.indexOf(s[e._getTaskIndexById(i.target)]);return!(r<0||(i.target=r,0))}))),e._refreshProject(t[i].$.project),r.$._connections&&(r.connections.push.apply(r.connections,r.$._connections),delete r.$._connections)}e._tasks=t,delete e.__tasks}_scrollTo(e,t){const s=this,i=s._timelineCells;let r;if(void 0!==e&&!isNaN(new Date(e).getTime()))for(let n=0;n<i.length;n++){const a=i[n],o=a.date;switch(s.view){case"year":if(o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()){if(t){r=a.left;break}let s=new Date(e);s.setMonth(e.getMonth()+1),s.setDate(0),s=s.getDate(),r=a.left+(e.getDate()-1)/s*a.width}break;case"month":{let s=new Date(o),i=new Date(o);s.setDate(s.getDate()-s.getDay()),i.setDate(i.getDate()+(6-i.getDay())+1),i.setMilliseconds(i.getMilliseconds()-1),e.getTime()>=s.getTime()&&e.getTime()<=i.getTime()&&(r=a.left+(t||t?0:e.getDay()/7*a.width));break}case"week":o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()&&o.getDate()===e.getDate()&&(r=a.left+parseFloat(e.getHours()+"."+e.getMinutes()+e.getSeconds())/24*a.width);break;case"day":o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()&&o.getDate()===e.getDate()&&o.getHours()===e.getHours()&&(r=a.left+(t?0:parseFloat(e.getMinutes()+e.getSeconds())/60*a.width))}if(void 0!==r)return s.scrollLeft=s.$.resourceTimeline.scrollLeft=r,void(s.$.mainSplitter.contains(s.$.resourceSplitter)&&s._refreshResourceTimeline())}}_updateConnection(e,t){const s=this;function i(e,i,r){const n=e.connections;let a;for(let e=0;e<n.length;e++)if(s._getTaskIndexById(n[e].target)===i){if(!t&&void 0!==r&&n[e].type===r&&!a){a=!0;continue}n.splice(e,1)}return a}e=(e+="").split("-");const r=s._tasks,n=parseInt(e[0]),a=parseInt(e[1]),o=parseInt(e[2]),l=r[n],d=r[a];if(!l)return;if(!d)return l.connections=[],void(s._removeAllTaskConnections&&delete l.$._connections);if(void 0===o)return;const c=i(l,a,o);if(i(r[a],n),t||c)return;l.connections.push({target:a,type:o});const m=d.connections.find((e=>s._getTaskIndexById(e.target)===n&&e.type===o));m&&d.connections.splice(d.connections.indexOf(m),1)}_createTimelineCells(){const e=this,t=e._tasks,s=e.properties.dateStart.value,i=e.properties.dateEnd.value;let r,n;if(s&&(r=s),i&&(n=i),t.length>0){let e=t[0].dateStart,s=t[0].dateEnd;for(let i=0;i<t.length;i++)t[i].dateStart&&t[i].dateEnd&&(e||(e=t[i].dateStart),s||(s=t[i].dateEnd),e.getTime()>t[i].dateStart.getTime()&&(e=t[i].dateStart),s.getTime()<t[i].dateEnd.getTime()&&(s=t[i].dateEnd));(!r||r.getTime()>e.getTime())&&(r=e),(!n||n.getTime()<s.getTime())&&(n=s)}r&&n&&(r=e._minMaxDateValidator(r),n=e._minMaxDateValidator(n),e._createTimelineHeader(r,e._getCellsCount(r,n)))}_getCellsCount(e,t,s){let i,r,n,a,o,l,d=new Date(e),c=new Date(t);const m=t.getFullYear()-e.getFullYear();if(r=i=Math.round(m)+1,"year"===s)return{year:r};if(d.setHours(d.getHours(),0,0,0),c.setHours(c.getHours(),0,0,0),l=Math.floor((t.getTime()-e.getTime())/36e5),l>0){let e=new Date(d);if(l=1,d.getFullYear()!==c.getFullYear()){let t=new Date(d.getFullYear()+1,0,1,0,0,0,0);for(;e.getTime()!==t.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),l++}const s=c.getFullYear()-t.getFullYear();for(let t=0;t<s;t++){const t=e.getFullYear();l+=24*((t%100==0?t%400==0:t%4==0)?366:365)-1,e.setFullYear(t+1)}}for(;e.getTime()!==c.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),l++}}if("hour"===s)return{hour:l};if(d.setHours(0,0,0,0),c.setHours(23,59,59,999),o=i=Math.round((c.getTime()-d.getTime())/864e5),"day"===s)return{day:o};if(d.setDate(d.getDate()-d.getDay()),c.setDate(c.getDate()+6-c.getDay()),a=i=Math.round((c.getTime()-d.getTime())/6048e5),"week"===s)return{week:a};if("month"===this.view&&(0!==e.getDay()&&(e=new Date(e.setDate(e.getDate()-e.getDay()))),6!==t.getDay()&&(t=new Date(t.setDate(t.getDate()+6-t.getDay())))),e.getFullYear()!==t.getFullYear()){i=12-e.getMonth();const s=t.getFullYear();for(let r=e.getFullYear()+1;r<=s;r++)i+=r===t.getFullYear()?t.getMonth()+1:12}else i=t.getMonth()-e.getMonth()+1;return n=Math.ceil(i),"months"===s?{month:n}:{year:r,month:n,week:a,day:o,hour:l}}_createTimelineTask(e,t){const s=this,i=s._createTaskBar(e.type),r="project"===e.type&&e.synchronized;e.disableDrag||r&&!e.dragProject?i.setAttribute("disable-drag",""):i.removeAttribute("disable-drag"),e.disableResize||r?i.setAttribute("disable-resize",""):i.removeAttribute("disable-resize"),e.id?i.id=e.id:i.id="ganttTask"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),s._createTimelineTaskCells(e,t),i._task=e,i.classList.add("smart-timeline-task"),e.class&&i.classList.add(e.class);const n=e=>e.getFullYear()+"-"+(e.getMonth()<10?"0"+e.getMonth():e.getMonth())+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate());i.setAttribute("aria-label",e.label+" Start date: "+n(e.dateStart)+", End date: "+n(e.dateEnd)),i.setAttribute("aria-selected","false"),s.$.timelineTasksContainer.insertBefore(i,s.$.timelineTasksContainer.children[t])}_createTimelineTaskCells(e,t){const s=this,i=document.createElement("div");e.$.project&&!s._isTaskExpanded(e)&&i.classList.add("smart-visibility-hidden"),i._task=e,i.classList.add("smart-timeline-task-cell"),s.$.taskTimelineCellsContainer.insertBefore(i,s.$.taskTimelineCellsContainer.children[t])}_createCells(e){let t,s=document.createDocumentFragment();for(let i=0;i<e;i++)t=document.createElement("div"),t.classList.add("smart-timeline-view-cell"),t.setAttribute("role","columnheader"),s.appendChild(t);return s}_getTimelineVisibleCellsCount(){const e=this,t=e._timelineCells;if(!t)return;const s=e._getFirstCellObjInView(),i=1-(s.left+s.width-e.scrollLeft)/t[0].width;return Math.ceil(parseFloat((e.$.timeline.offsetWidth/s.width).toFixed(2))+i)}_getHeaderVisibleCellsCount(){const e=this;if(!e._timelineHeaderCells)return;const t=Math.abs(e.scrollLeft),s=e.$.timeline.parentElement.offsetWidth,i=e._timelineHeaderCells;let r=0;for(let e=0;e<i.length;e++){const n=i[e];n.left+n.width>t&&n.left<s+t&&r++}return r}_refreshHeaderDate(e){const t=this,s=t._getCellsViewType(),i=t.scrollLeft,r=t.$.timelineViewCells.children,n=t._timelineCells;let a;t._refreshHeaderDetailsDate(e);for(let e=0;e<n.length;e++){const t=n[e];if(i<=t.left+t.width){a=e;break}}for(let i=0;i<r.length;i++){const o=r[i],l=n[a];if(!l)break;a++;const d=l.date;o.innerHTML=`<div>${t._getDateString(new Date(d),s)}</div>`,e||(o._date=new Date(d),o.style.width=l.width+"px",o.style[t.rightToLeft?"right":"left"]=l.left+"px",l.weekend?o.setAttribute("weekend",""):o.removeAttribute("weekend"),l.nonworking?o.setAttribute("nonworking",""):o.removeAttribute("nonworking"))}}_getDateString(e,t,s){const i=this,r=["2-digit","numeric"][i.dayFormat]||"numeric";let n;return"year"===t?n=e.toLocaleDateString(i.locale,{year:i.yearFormat}):"month"===t?n=e.toLocaleDateString(i.locale,{month:i.monthFormat}):"week"===t?n="numeric"!==i.weekFormat&&s?e.toLocaleDateString(i.locale,{day:r,month:i.monthFormat,year:i.yearFormat}):i._getWeekNumber(e):"day"===t?n=e.toLocaleDateString(i.locale,"day"===i.view?{day:r,month:i.monthFormat,year:i.yearFormat}:["long","short","narrow"].indexOf(i.dayFormat)>-1?{weekday:i.dayFormat}:{day:i.dayFormat}):"hour"===t&&(n="default"===i.hourFormat?e.toLocaleTimeString(i.locale,{hour12:!1}):e.toLocaleDateString(i.locale,{hour:i.hourFormat})),i.timelineHeaderFormatFunction?i.timelineHeaderFormatFunction(e,t,s,n):n}_refreshHeaderDetailsDate(e){const t=this,s=t.view,i=t.scrollLeft,r=t.$.timelineViewDetails.children,n=t._timelineHeaderCells;let a;for(let e=0;e<n.length;e++){const t=n[e];if(i<=t.left+t.width){a=e;break}}for(let i=0;i<r.length;i++){const o=n[a],l=r[i];let d=new Date(o.date);"week"===t.view&&d.setDate(d.getDate()-d.getDay()),a++,d=new Date(Math.max(o.date.getTime(),d.getTime())),l.innerHTML=`<div>${t._getDateString(d,s,!0)}</div>`,e||(l._date=d,l.style[t.rightToLeft?"right":"left"]=o.left+"px",l.style.width=o.width+"px")}}_getWeekNumber(e){let t,s=new Date(e.getFullYear(),0,1),i=Math.round((e.getTime()-s.getTime()-6e4*(e.getTimezoneOffset()-s.getTimezoneOffset()))/864e5)+1,r=s.getDay();return r=r>=0?r:r+7,r<4?(t=Math.floor((i+r-1)/7)+1,t>52&&(s=new Date(e.getFullYear()+1,0,1),r=s.getDay(),r=r>=0?r:r+7,t=r<4?1:53)):t=Math.round((i+r-1)/7),t}_convertDuration(e,t){if(!e)return 0;let s;switch(this.durationUnit){case"day":s=864e5;break;case"hour":s=36e5;break;case"minute":s=6e4;break;case"second":s=1e3;break;case"milisecond":return e;case"week":s=6048e5}return Math.max(0,t?e/s:e*s)}_createTaskBar(e){const t=document.createElement("div");return t.classList.add("smart-timeline-task"),t.classList.add(e),t.innerHTML="milestone"===e?'<div class="smart-task-container" aria-hidden="true">\n                <div class="smart-task-connection-point start"></div>\n                <div class="smart-timeline-task-fill"></div>\n                <div class="smart-task-connection-point end"></div>\n            </div>':'<div class="smart-task-container" aria-hidden="true">\n                <div class="smart-task-connection-point start"></div>\n                <div class="smart-timeline-task-fill">\n                    <div class="smart-timeline-task-progress"></div>\n                </div>\n                <div class="smart-timeline-task-progress-thumb"></div>\n                <div class="smart-timeline-task-label"></div>\n                <div class="smart-task-connection-point end"></div>\n            </div>',t}_createTimelineHeader(e,t){const s=this,i=s._getCellsViewType();if(!e){const t=s.$.timelineViewCells.children;if(0===t.length)return;e=t[0]._date}"day"!==s.view&&e.setHours(0,0,0,0),s.$.timelineContent.offsetWidth===s.$.timeline.offsetWidth&&s._timelineCells&&s._timelineCells[0]&&s._timelineCells[0].date.getTime()===e.getTime()&&s._timelineCells.length===t[s._getCellsViewType()]?s._refresh():(s.$.timelineContent.style.width=s.$.timelineAnimationContainer.style.width="",s._createTimelineCellsObj(e,t),s._createTimelineHeaderCellsObj(e,t),s.$.timelineViewDetails.innerHTML="",s.$.timelineViewDetails.appendChild(s._createCells(s._getHeaderVisibleCellsCount())),s.$.timelineViewCells.innerHTML="",s.$.timelineViewCells.appendChild(s._createCells(s._getTimelineVisibleCellsCount())),s._refreshHeaderDate(),s.$.timelineContent.style.width=s.$.timelineAnimationContainer.style.width=Math.max(t[i]*s._timelineCells[0].width,s.$.timeline.parentElement.offsetWidth)+"px",s._refresh(),s.scrollLeft&&(s.$.timeline.scrollLeft=s._getScrollLeft(s.scrollLeft)),s.scrollTop&&(s.$.timelineContent.scrollTop=s.scrollTop))}_getCellsViewType(){switch(this.view){case"year":return"month";case"month":return"week";case"week":return"day";case"day":return"hour"}}_createTimelineCellsObj(e,t){const s=this,i=s._getCellsViewType();t=t[i];const r=window.getComputedStyle(s),n=s.$.timeline.parentElement.offsetWidth;let a=Math.max(parseFloat(r.getPropertyValue("--smart-gantt-chart-timeline-cell-size"))||0,parseFloat(r.getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0)),o=0,l=new Date(e);t*a<n&&(a=n/t),a=parseFloat(a.toFixed(2)),s._timelineCells=[];for(let e=0;e<t;e++){const e={left:o,width:a};if("year"===i)l.setMonth(0),e.date=new Date(l),l.setFullYear(l.getFullYear()+1);else if("month"===i)l.setDate(1),e.date=new Date(l),l.setMonth(l.getMonth()+1);else if("week"===i)l.setHours(0,0,0,0),l.setDate(l.getDate()-l.getDay()),e.date=new Date(l),l.setDate(l.getDate()+7);else if("day"===i)s.nonworkingDays.indexOf(l.getDay())>-1&&(e.nonworking=!0),l.setHours(0,0,0,0),e.date=new Date(l),l.setDate(l.getDate()+1),e.weekend=0===e.date.getDay()||6===e.date.getDay();else if("hour"===i){(s.nonworkingHours.indexOf(l.getHours())>-1||s.nonworkingDays.indexOf(l.getDay())>-1)&&(e.nonworking=!0),l.setHours(l.getHours(),0,0,0),e.date=new Date(l);const t=l.getTime();l.setHours(l.getHours()+1),t===l.getTime()&&l.setHours(l.getHours()+2),e.weekend=0===e.date.getDay()||6===e.date.getDay()}s._timelineCells.push(e),o=parseFloat((o+a).toFixed(2))}}_createTimelineHeaderCellsObj(e,t){const s=this,i=s.view;let r=0,n=new Date(e);t=t[i],s._timelineHeaderCells=[];for(let e=0;e<t;e++){const t={};switch(t.date=new Date(n),i){case"year":n.setFullYear(n.getFullYear()+1);break;case"month":n.setDate(1),n.setMonth(n.getMonth()+1);break;case"week":n.setDate(n.getDate()+7);break;case"day":n.setDate(n.getDate()+1)}r=s._refreshViewDetailCell(t,r,e),s._timelineHeaderCells.push(t)}}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=new Date(this.min),s=new Date(this.max);return t&&(e=new Date(Math.max(t.getTime(),e.getTime()))),s&&(e=new Date(Math.min(s.getTime(),e.getTime()))),e}_dateValidator(e,t){const s=this;let i;if(t instanceof Date)return s._minMaxDateValidator(t);if(Smart.Utilities.DateTime&&t instanceof Smart.Utilities.DateTime)return s._minMaxDateValidator(t.toDate());if("string"!=typeof t)return s._minMaxDateValidator(e);{const e=/\d+:\d+:\d+/;if("new Date()"===t.trim()||"new Smart.Utilities.DateTime()"===t.trim())return s._minMaxDateValidator(new Date);if(isNaN(Date.parse(t))){const s=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(s.test(t)){const r=s.exec(t)[0].replace(/[,-.\/]/g,",").split(",");if(3===r.length){const[s,n]=parseInt(r[0])<parseInt(r[2])?[r[0],r[2]]:[r[2],r[0]];if(i=new Date(parseInt(n),parseInt(r[1])-1,parseInt(s)),e.test(t)){const s=e.exec(t)[0].split(":");i.setHours(s[0]||0,s[1]||0,s[2]||0)}t=i}}}else i=new Date(Date.parse(t)),e.test(t)||i.setHours(0,0,0,0),t=i}return s._minMaxDateValidator(new Date(t))}_getTaskBarPositionLimits(e,t){const s=this;function i(e){const t=s._getTimelineTaskCellByDate(e);if(t)return t.left+s._getTimelineTaskOffset(t,e)||0}return{min:i(e["min"+t]),max:i(e["max"+t])}}_getTimelineTaskOffset(e,t){if(!e)return;let s,i;switch(this.view){case"year":{const r=t.getHours()/24+t.getMinutes()/1440+t.getSeconds()/86400;s=new Date(e.date.getFullYear(),e.date.getMonth()+1,0),i=(t.getDate()-1+r)/s.getDate()*e.width;break}case"month":i=t.getDay()/7*e.width;break;case"week":i=parseFloat(t.getHours()+t.getMinutes()/60+t.getSeconds()/3600)/24*e.width;break;case"day":i=parseFloat(t.getMinutes()+t.getSeconds()/60)/60*e.width}return i}_getTaskBarSizeLimits(e,t){const s=this,i=s._getTaskBarDateRange(e);let r,n=0,a=s._convertDuration(e._task.minDuration)||s._getMinDuration(e,t),o=s._convertDuration(e._task.maxDuration);function l(r,n){if(!r)return;let a,o;"left"===t&&!s.rightToLeft||"right"===t&&s.rightToLeft?(r*=-1,o=i.dateEnd):o=i.dateStart,n&&Math.abs(a)===Math.abs(r)&&(a=0);let l=s._getTaskWorkingDateEnd({dateStart:o},r);const d=l.getTime()+60*(l.getTimezoneOffset()-o.getTimezoneOffset())*1e3,c=s._getTimelineTaskCellByDate(new Date(d));if(!c)return;const m=s._getTimelineTaskOffset(c,new Date(d));return s.rightToLeft?"left"===t?m-(s.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth-c.left):s.$.timelineContent.offsetWidth-e.offsetLeft-c.left-m:"left"===t?e.offsetLeft+e.offsetWidth-c.left-m:c.left-e.offsetLeft+m}if("left"===t&&!s.rightToLeft||"right"===t&&s.rightToLeft){const t=e._task.maxDateStart,s=e._task.minDateStart;s&&(n=60*(s.getTimezoneOffset()-i.dateEnd.getTimezoneOffset())*1e3,r=Math.abs(s.getTime()-i.dateEnd.getTime())+n,o=o?Math.min(r,o):r),t&&(n=60*(t.getTimezoneOffset()-i.dateEnd.getTimezoneOffset())*1e3,r=Math.abs(t.getTime()-i.dateEnd.getTime())+n,a=a?Math.max(r,a):r)}else{const t=e._task.maxDateEnd,s=e._task.minDateEnd;s&&(n=60*(s.getTimezoneOffset()-i.dateStart.getTimezoneOffset())*1e3,r=Math.abs(s.getTime()-i.dateStart.getTime())+n,a=a?Math.max(r,a):r),t&&(n=60*(t.getTimezoneOffset()-i.dateStart.getTimezoneOffset())*1e3,r=Math.abs(t.getTime()-i.dateStart.getTime())+n,o=o?Math.min(r,o):r)}return o&&(a=Math.min(a,o)),{min:l(a,!0),max:l(o)}}_getMinDuration(e,t){const s=this,i=parseFloat(getComputedStyle(s).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;if(!i||!s._timelineCells||0===s._timelineCells.length)return;const r=e._task;let n,a,o=1;a=s.rightToLeft?parseFloat(e.style.right)||s.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth:parseFloat(e.style.left)||e.offsetLeft,"left"===t?(n=r.dateEnd,a+=parseFloat(e.style.width)||e.offsetWidth,o=-1):n=r.dateStart;const l=a+o*i;let d;for(let e=0;e<s._timelineCells.length;e++){const t=s._timelineCells[e];if(l<t.left)break;d=t}const c=s._getDateFromCell(l,d);return c?Math.abs(n.getTime()-c.getTime()):void 0}_createDelimiter(e,t){const s=this,i=e.slice(0,3),r=document.createElement("div");if(r.classList.add("smart-task-bar-limitter-"+e),e.indexOf("date")>-1){if(!this._dragDetails[i].left)return;const e=s._dragDetails.timelineTask,t=s.$.taskTimelineCellsContainer.children[s._tasks.indexOf(e._task)];i.indexOf("max")>-1?r.style.width=t.offsetWidth-s._dragDetails[i].left-e.offsetWidth+"px":r.style.width=s._dragDetails[i].left+"px"}else{if(!this._dragDetails[i].width)return;r.style["left"===t?"right":"left"]=s._dragDetails[i].width+"px"}return r}_doubleClickHandler(e){const t=this;let s=e.target;if(t.disabled||t.disableWindowEditor)return;t.shadowRoot&&s===t&&(s=e.composedPath()[0]);let i=s.closest?s.closest(".smart-task-connection"):void 0;i?t._openPopupWindow(i):(i=s.closest(".smart-timeline-task")||s.closest(".smart-task-label-container")||s.closest(".smart-tree-item-label-container"),i&&t.$.taskSplitter.contains(i)&&(i.classList.contains("smart-timeline-task")?t._openPopupWindow(i):t._openPopupWindow(t.$.timelineTasksContainer.children[t._getTreeItemIndex(i)])))}_checkDoubleClick(e){const t=this;let s=e.target;if(t.shadowRoot&&s===t&&(s=e.composedPath()[0]),void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),s!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=s,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout((function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0)}),300),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,!0}_downHandler(e){const t=this,s=e.originalEvent,i=t.shadowRoot||t.isInShadowDOM?s.composedPath()[0]:s.target,r=i.closest?i.closest(".smart-timeline-task-cell")||i.closest(".smart-timeline-task"):null;if(e.stopPropagation(),delete t._itemClickDetails,delete t._columnHeaderClicked,t._dragDetails)return delete t._dragDetails,void t._setConnectionFeedback();const n=t.$.resourceSplitter.contains(i)?"resource":"task";if((i.closest(".smart-timeline-content")||i.closest(`.smart-${n}-tree-content`))&&requestAnimationFrame((()=>t.$[`${n}Tree`].focus({preventScroll:!0}))),t._itemClickDetails={target:i},!Smart.Utilities.Core.isMobile&&0!==e.button)return;if(!r){if(i.classList.contains("smart-popup-window-modal")){if(t._popupWindow){const e=Object.keys(t._popupWindow);requestAnimationFrame((()=>t._popupWindow[e[e.length-1]].focus()))}return}if((i.closest(".smart-tree-item-label-container")&&!i.classList.contains("smart-arrow-down")||i.closest(".smart-task-connection")||i.closest(".smart-task-label-container"))&&t._checkDoubleClick(s))return;if(!i.closest(".smart-tree-item-label-container")&&!i.closest("smart-scroll-bar")){const e=t._getTreeItemIndex(i);let s;if(void 0!==e)s=t[`_${n}s`].filter((e=>!e.hidden))[e],t._itemClickDetails.type=n,t._select(n,s);else{const e=i.closest(".smart-timeline-resource-cell");e&&(t._dragDetails={target:e})}}return void(t._columnHeaderClicked=i.closest(".smart-task-tree-header")||i.closest(".smart-resource-tree-header"))}if(i.closest(".smart-resource-timeline-view-cell")||t.disabled)return;const a=Array.from(t.$.timelineTasksContainer.children).find((e=>e._task===r._task));if(!a)return;const o=a._task;if(o&&(a.getElementsByClassName("smart-timeline-task-fill")[0]||t.$.timeline.hasAttribute("task-bar-hovered"))){if((i.closest(".smart-timeline-task-fill")||a.classList.contains("milestone")&&i.closest(".smart-task-container"))&&t._checkDoubleClick(s))return;const r=i.closest(".smart-timeline-task-progress-thumb"),n=e.pageX-window.pageXOffset,l=e.pageY-window.pageYOffset;t._dragDetails={},t._dragDetails.target=r||i,t._dragDetails.timelineTask=a,t._dragDetails.coordinates={x:n,y:l};const d=(r||a).getBoundingClientRect();if(t._dragDetails.offset={x:n-d.left,y:l-d.top},r||!r&&"project"===o.type&&o.synchronized&&!o.dragProject)return void(i.closest(".smart-task-connection-point")&&(t._dragDetails.timelineTask=void 0,t._dragDetails.relatedConnections={}));("visible"===t.resizeHandlesVisibility||Smart.Utilities.Core.isMobile&&"auto"===t.resizeHandlesVisibility)&&(i.closest(".smart-timeline-task-fill")?t._checkTaskBarResizability(e):t.$.timeline.removeAttribute("task-bar-hovered")),t.rightToLeft?t._dragDetails.originalPosition={x:t.$.timelineContent.offsetWidth-(a.offsetLeft+a.offsetWidth),y:a.offsetTop}:t._dragDetails.originalPosition={x:a.offsetLeft,y:a.offsetTop},t._dragDetails.originalSize={width:a.offsetWidth,height:a.offsetHeight},t._dragDetails.min={},t._dragDetails.max={},t._setDragLimits(i)}}_documentMoveHandler(e){const t=this;if(!t._dragDetails||!t._dragDetails.target){let s=e.originalEvent.target;return t.shadowRoot&&s===t&&(s=e.originalEvent.composedPath()[0]),t._handleTreeItemHover(t._getTreeItemIndex(s),s),void 0===t._hoveredItemDetails&&t._handleTimelineHover(e),void t._checkTaskBarResizability(e)}if(t._dragDetails.target.classList.contains("smart-task-connection-point"))return t._setConnectionFeedback(e),t._handleTimelineHover(e),void t._autoScroll(e);t._dragDetails.target.classList.contains("smart-timeline-task-progress-thumb")?t._handleTaskProgressChange(e):(t._autoScroll(e),t._autoScrolling||(t.$.timeline.hasAttribute("task-bar-hovered")?t._handleTaskBarResize(e):t._dragDetails.target.closest(".smart-timeline-task-fill")&&t._dragDetails.timelineTask&&!t._dragDetails.timelineTask.hasAttribute("disable-drag")&&t._handleTaskBarDrag(e)))}_documentUpHandler(e){const t=this,s=e.originalEvent;let i=s.target;if(t._upHandler(),t._handleColumnSorting(i),!t._dragDetails)return void t._handleItemClick(s);if(t._scrollView.disableSwipeScroll=t._touchmoveInside=!1,t.shadowRoot&&i===t&&(i=s.composedPath()[0]),t.hasAttribute("connecting-task")){const s=t._connectTask(e),i=t._tasks;return t._setConnectionFeedback(),s&&(t.$.fireEvent("connectionEnd",{startIndex:i.indexOf(s.taskStart._task),endIndex:i.indexOf(s.taskEnd._task),type:s.type}),t._autoSchedule(s.taskStart._task)),Smart.Utilities.Core.isMobile&&t._handleTimelineHover(e,!0),void delete t._dragDetails}const r=t._dragDetails.timelineTask;if(!r)return void delete t._dragDetails;let n;if(r&&(n=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._task===r._task))),t.hasAttribute("dragged")){t._snapToNearest(r),t._checkWorkingDays(r),t._refreshProject(n._task.$.project);const e=n.getElementsByClassName("smart-task-bar-limitter-min-date")[0],s=n.getElementsByClassName("smart-task-bar-limitter-max-date")[0];e&&e.parentElement.removeChild(e),s&&s.parentElement.removeChild(s),t._autoSchedule(r._task),t._resourceTreeRefreshTimeout?(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n._task)):(t.snapToNearest||t.nonworkingDays.length>0||t.nonworkingHours.length>0)&&t._refreshAssignedResources(n._task),t.removeAttribute("dragged"),t.$.fireEvent("dragEnd",{index:t._tasks.indexOf(n._task),dateStart:new Date(n._task.dateStart),dateEnd:new Date(n._task.dateEnd)})}else t.hasAttribute("progress-change")?(t._resourceTreeRefreshTimeout&&(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n._task,["progress"])),t.removeAttribute("progress-change"),t.$.fireEvent("progressChangeEnd",{index:t._tasks.indexOf(n._task),progress:n._task.progress||0})):t.hasAttribute("resized")?(t._snapToNearest(r),t._refreshProject(n._task.$.project),t._resourceTreeRefreshTimeout?(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n._task,["workload"])):t.snapToNearest&&t._refreshAssignedResources(n._task,["workload"]),t.removeAttribute("resized"),t.$.fireEvent("resizeEnd",{index:t._tasks.indexOf(n._task),dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}),t._autoSchedule(r._task)):i.closest(".smart-timeline-task")===r&&(t._select("task",n._task,!0),delete t._dragDetails,t._handleItemClick(s));const a=r.getElementsByClassName("smart-task-bar-limitter-max")[0],o=r.getElementsByClassName("smart-task-bar-limitter-min")[0];a&&a.parentElement.removeChild(a),o&&o.parentElement.removeChild(o),delete t._dragDetails}_handleItemClick(e){const t=this,s=e.target;if(t._dragDetails||!t._itemClickDetails||t._itemClickDetails.target!==s)return void delete t._itemClickDetails;let i,r,n;s.closest(".smart-timeline-task-fill")?(r=t._cloneObject(s.closest(".smart-timeline-task")._task),n="task"):(i=s.closest(".smart-task-connection"),i?(r=i.getAttribute("connection-id").split("-"),r={source:r[0],target:r[1],type:r[2]},n="connection"):(i=s.closest(".smart-tree-item-label-container")||s.closest(".smart-task-label-container")||s.closest(".smart-resource-label-container"),i&&(n=t.$.taskSplitter.contains(i)?"task":"resource",r=t[`_${n}s`].filter((e=>!e.hidden))[t._getTreeItemIndex(i)]))),r&&(delete t._itemClickDetails,t.$.fireEvent("itemClick",{originalEvent:e,type:n,item:r}))}_handleColumnSorting(e){if(!e)return;const t=this,s=e.closest(".smart-task-tree-header")||e.closest(".smart-resource-tree-header");if(t.sortable&&t._columnHeaderClicked&&s&&t._columnHeaderClicked===s){const i=s.classList.contains("smart-task-tree-header")?"task":"resource",r=e.closest("smart-splitter").items,n=r.findIndex((t=>t.contains(e))),a=["asc","desc"],o=t[`${i}Columns`];let l=r[n].getAttribute("sort");if("one"===t.sortMode&&o.forEach((e=>delete e.sort)),o[n]&&(l?l===a[0]?l=a[1]:(delete o[n].sort,"many"===t.sortMode&&delete o[n].sortOrder,l=null):l=a[0],l)){if("many"===t.sortMode){const e=parseInt(o.filter((e=>e.sort)).map((e=>e.sortOrder)).reverse()[0]+"");o[n].sortOrder=isNaN(e)?0:e-1}o[n].sort=l}"task"===i?t._sortTasks():t._sortResources()}delete t._columnHeaderClicked}_moveHandler(e){Smart.Utilities.Core.isMobile||e.stopPropagation(),(this.hasAttribute("dragged")||this.hasAttribute("progress-change"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_getTreeItemIndex(e){if(!e||!e.closest||!(this.shadowRoot||this).contains(e))return;let t,s=e.closest(".smart-task-label-container")||e.closest(".smart-resource-label-container");return s?(t=s.classList.contains("smart-resource-label-container")?"resource":"task",[].slice.call(s.closest("smart-splitter-item").getElementsByClassName(`smart-${t}-label-container`)).indexOf(s)):(s=e.closest(".smart-tree-item-label-container"),s?[].slice.call(s.closest("smart-tree").getElementsByClassName("smart-tree-item-label-container")).indexOf(s):void 0)}_handleTreeItemHover(e,t){const s=this;let i;if(t&&(i=s.$.taskSplitter.contains(t)?s.$.taskTreeSplitter:s.$.resourceTreeSplitter),s._hoveredItemDetails&&s._hoveredItemDetails.index===e&&s._hoveredItemDetails.splitter===i)return;const r=s.$.mainSplitter.querySelectorAll("smart-tree-item[hover], smart-tree-items-group[hover], .smart-task-label-container[hover], .smart-resource-label-container[hover]");for(let e=0;e<r.length;e++)r[e].removeAttribute("hover");if(void 0===e||e<0)return s._hoveredItemDetails=void 0,void s._handleTimelineHover({target:s});const n=i===s.$.taskTreeSplitter?"task":"resource";if(Smart.Utilities.Core.isMobile||!s[n+"Columns"].length)return;const a=i._items;for(let t=0;t<a.length;t++){const i=a[t];let r;r=i===s.$[n+"TreeSplitterItem"]?[].slice.call(i.querySelectorAll("smart-tree-item, smart-tree-items-group")):[].slice.call(i.getElementsByClassName(`smart-${n}-label-container`)),r[e]&&r[e].setAttribute("hover","")}s._hoveredItemDetails={index:e,splitter:i},s._handleTimelineHover({target:s.$["task"===n?"timelineTasksContainer":"resourceTimelineCellsContainer"].children[e]})}_checkWorkingDays(e){const t=this;if((t._dragDetails._taskDuration||t._timelineCells.length)&&e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&t.hasAttribute("dragged")){if(0===t.nonworkingDays.length&&0===t.nonworkingHours.length||!t._dragDetails._taskDuration)return;const s=e._task,i=t._getTaskWorkingDateEnd(s);let r=new Date(t._timelineCells[t._timelineCells.length-1].date);"year"===t.view?(r.setMonth(r.getMonth()+1),r.setDate(0),r.setHours(23,59,59,999)):"month"===t.view?(r.setDate(r.getDate()+6-r.getDay()),r.setHours(23,59,59,999)):"week"===t.view?r.setHours(23,59,59,999):r.setHours(r.getHours(),59,59,999),s.dateEnd=s.maxDateEnd?new Date(Math.min(i.getTime(),s.maxDateEnd.getTime())):i,s.dateEnd=new Date(Math.min(r.getTime(),s.dateEnd.getTime())),s.duration=t._convertDuration(t.nonworkingDays.length>0||t.nonworkingHours.length>0?t._getWorkingTime(s.dateStart,s.dateEnd):s.dateEnd.getTime()-s.dateStart.getTime(),!0),t._setTimelineTaskBar(e._task,!0),t._refreshTaskConnections(e._task),t._refreshTreeColumnsData(s,["dateEnd","duration"])}}_getTaskWorkingDateEnd(e,t){if(!e||!e.dateStart)return;const s=this;let i,r,n=new Date(e.dateStart);t||(t=s._dragDetails?s._dragDetails._taskDuration:s._getWorkingTime(e.dateStart,e.dateEnd));const a=t<0?-1:1;for(t=Math.abs(t);t>0;){const e=Math.min(t,36e5-(60*n.getMinutes()*1e3+1e3*n.getSeconds()+n.getMilliseconds()));if(s.nonworkingDays.indexOf(n.getDay())>-1)r=new Date(n),r.setHours(0,0,0,0),r.setDate(n.getDate()+1*a),i=Math.min(e,r.getTime()-n.getTime()),n=new Date(n.getTime()+i);else if(s.nonworkingHours.indexOf(n.getHours())>-1){r=new Date(n);const t=r.getTime();r.setHours(n.getHours()+1*a,0,0,0),t===r.getTime()&&r.setHours(n.getHours()+2*a,0,0,0),i=Math.min(e,r.getTime()-n.getTime()),n=new Date(n.getTime()+i)}else t-=e,n=new Date(n.getTime()+a*e)}return n}_createConnectingElement(e,t,s,i,r){const n=this;if(!n._connectionDetails||!n._connectionDetails.start)return;const a=n._connectionDetails,o=a.type,l=n.$.timelineConnectionsContainer;let d=a.connections.shift();d||(d=document.createElement("div"),d.classList.add("smart-task-connection")),d.style.width=d.style.width="","horizontal"===i?(d.style.width=Math.abs(s)+"px",d.style.height=""):(d.style.width="",d.style.height=Math.abs(s)+"px"),d.style[n.rightToLeft?"left":"right"]="",d.style[n.rightToLeft?"right":"left"]=e+"px",d.style.top=t+"px",d.setAttribute("connection-id",a.id);const c=a.start.task._task.label,m=0===o||3===o?"start":"end",u=a.end.task._task.label,f=0===o||1===o?"start":"end";if(d.setAttribute("aria-label","Connection between "+c+" ("+m+") and "+u+" ("+f+")"),r){let e=0===o||1===o?"right":"left";n.rightToLeft&&(e="left"===e?"right":"left"),d.setAttribute("arrow-direction",e)}else d.removeAttribute("arrow-direction");d.parentElement||l.appendChild(d)}_getConnectionType(e,t){if(!e||!t)return;let s=!e.classList.contains("end"),i=t.classList.contains("end");return s&&!i?0:s||i?!s&&i?2:s&&i?3:void 0:1}_setConnectionFeedback(e){const t=this;if(!t._dragDetails||!t._dragDetails.target||!e)return t._connectionFeedback&&t._connectionFeedback.parentElement&&(t._connectionFeedback.closest(".smart-timeline-task").removeAttribute("connection-point"),t._connectionFeedback.parentElement.removeChild(t._connectionFeedback)),t.removeAttribute("connecting-task"),void delete t._connectionFeedback;if(!t._dragDetails.target||!t._dragDetails.target.classList.contains("smart-task-connection-point"))return;const s=t._dragDetails.target.closest(".smart-timeline-task");if(!s)return;if(!t.hasAttribute("connecting-task")){if(t.$.fireEvent("connectionStart",{startIndex:t._tasks.indexOf(s._task)}).defaultPrevented)return void delete t._dragDetails.target;t.setAttribute("connecting-task",""),Smart.Utilities.Core.isMobile&&(t._scrollView.disableSwipeScroll=t._touchmoveInside=!0)}const i=s.classList.contains("milestone");let r=i?-1*s.offsetHeight/2:0;t._dragDetails.target.classList.contains("end")&&(s.setAttribute("connection-point","end"),r=i?-1*r:s.offsetWidth),t._connectionFeedback||(t._connectionFeedback=document.createElement("div"),t._connectionFeedback.classList.add("smart-task-connection-feedback"));const n=t._dragDetails.coordinates.x+(t.rightToLeft?-1:1)*r,a=t._dragDetails.coordinates.y,o=t._dragDetails.offset.x-(t.rightToLeft?s.offsetWidth:0),l=t._dragDetails.offset.y,d=e.pageX-window.pageXOffset+o,c=e.pageY-window.pageYOffset+l-s.offsetHeight/2;t._connectionFeedback.style.width=Math.sqrt(Math.pow(Math.abs(d-n),2)+Math.pow(Math.abs(c-a),2))+"px",t._connectionFeedback.style.transform=t.rightToLeft?"rotate("+180*(Math.atan2(a-c,n-d)||0)/Math.PI+"deg)":"rotate("+180*(Math.atan2(c-a,d-n)||0)/Math.PI+"deg)",t._connectionFeedback.parentElement||s.firstElementChild.appendChild(t._connectionFeedback)}_connectTask(e){const t=this;let s,i,r,n,a;if(e.originalEvent){const a=e.originalEvent;let o=Smart.Utilities.Core.isMobile?document.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset):a.target;if(!(t._dragDetails&&t._dragDetails.target&&o&&o.classList))return;if(t.shadowRoot&&o===t&&(o=Smart.Utilities.Core.isMobile?t.shadowRoot.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset):a.composedPath()[0]),s=t._dragDetails.target.classList.contains("smart-task-connection-point")?t._dragDetails.target:void 0,i=o.classList.contains("smart-task-connection-point")?o:void 0,s&&(r=s.closest(".smart-timeline-task")),i)n=i.closest(".smart-timeline-task");else if(Smart.Utilities.Core.isMobile&&o.classList.contains("smart-timeline-task-fill")&&(n=o.closest(".smart-timeline-task"),n)){const e=a.pageX-window.pageXOffset-n.getBoundingClientRect().left;i=n.querySelector(".smart-task-connection-point."+(e>=n.offsetWidth/2?"end":"start"))}}else{if(!e||e.length<3)return;if(e=(e+"").split("-"),void 0===(e=t._getValidConnectionId(e[0],e[1],e[2],"_connectTask")))return;const o=t._tasks,l=function(e){const s=t.$.timelineTasksContainer.children;for(let t=0;t<s.length;t++)if(s[t]._task===o[e])return s[t]},[d,c]=[o[parseInt(e[0])],o[parseInt(e[1])]];if(a=parseInt(e[2]),!d||!c)return;if(d.hidden||c.hidden){if(t._isAutoScheduled(d,c))return;return void(t.hasAttribute("dragged")||t.hasAttribute("resized")||t._updateConnection(o.indexOf(d)+"-"+o.indexOf(c)+"-"+a))}r=l([parseInt(e[0])]),n=l([parseInt(e[1])]),r&&n&&(s=r.querySelector(".smart-task-connection-point."+(0===a||3===a?"start":"end")),i=n.querySelector(".smart-task-connection-point."+(0===a||1===a?"start":"end")))}if(!s||!i||!r||!n||r===n||r.classList.contains("smart-visibility-hidden")||n.classList.contains("smart-visibility-hidden"))return;if(t._isAutoScheduled(r,n))return;void 0===a&&(a=t._getConnectionType(s,i)),t._connectionDetails={start:{point:s},end:{point:i},type:a},t._setConnectionDetails(),t._createTaskConnection();const o=t._tasks,l=o.indexOf(r._task),d=o.indexOf(n._task);return t.hasAttribute("dragged")||t.hasAttribute("resized")||t._updateConnection(l+"-"+d+"-"+t._connectionDetails.type),r.setAttribute("connected",""),n.setAttribute("connected",""),e.originalEvent&&t.$.fireEvent("itemInsert",{type:"connection",item:{source:l,target:d,type:t._connectionDetails.type}}),delete t._connectionDetails,{taskStart:r,taskEnd:n,type:a}}_isAutoScheduled(e,t,s){const i=this,r=i._tasks;let n={};if(i.autoSchedule)return e instanceof HTMLElement&&(e=e._task),t instanceof HTMLElement&&(t=t._task),function e(t,a){const o=t.connections||[],l=r.indexOf(t);n[l]=!0;for(let t=0;t<o.length;t++){const d=o[t],c=i._getTaskIndexById(d.target);if(c===a)return s&&i._removeConnection(l+"-"+c+"-"+d.type,!0),!0;if(!n[c]&&e(r[c],a))return!0}}(t,r.indexOf(e))}_setConnectionDetails(){const e=this;if(!e._connectionDetails)return;const t=e._connectionDetails,s=t.start.point,i=t.end.point,r=t.type;if(!s||!i)return;let n,a=s.closest(".smart-timeline-task"),o=i.closest(".smart-timeline-task"),l=a.offsetWidth,d=o.offsetWidth,c=a.offsetLeft,m=o.offsetLeft,u=a.offsetTop,f=o.offsetTop,h=s.offsetLeft,g=i.offsetLeft;const p=a.classList.contains("milestone"),_=o.classList.contains("milestone"),k=[].slice.call(e.$.timelineTasksContainer.children),T=k.indexOf(a),y=k.indexOf(o);if(e.rightToLeft){const t=e.$.timelineContent.offsetWidth;c=t-(c+l),m=t-(m+d)}if(t.id=T+"-"+y+"-"+r,p?(l=a.offsetHeight,c-=l/2):_&&(d=o.offsetHeight,m-=d/2),t.connectionStartOffset&&t.connectionEndOffset||(0===r?e.rightToLeft?(h-=p?l/2:l,g-=_?d/2:d):(h=Math.abs(h)-s.offsetWidth-(p?l/2:0),g=Math.abs(g)-i.offsetWidth-(_?d/2:0)):1===r?e.rightToLeft?(h=Math.abs(h)-s.offsetWidth-(p?l/2:0),g-=_?d/2:d):(h-=p?l/2:l,g=Math.abs(g)-i.offsetWidth-(_?d/2:0)):2===r?e.rightToLeft?(h=Math.abs(h)-s.offsetWidth-(p?l/2:0),g=Math.abs(g)-i.offsetWidth-(_?d/2:0)):(h-=p?l/2:l,g-=_?d/2:d):e.rightToLeft?(h-=p?l/2:l,g=Math.abs(g)-i.offsetWidth-(_?d/2:0)):(h=Math.abs(h)-s.offsetWidth-(p?l/2:0),g-=_?d/2:d),t.start.offset=h+=s.offsetWidth/2,t.end.offset=g+=i.offsetWidth/2),0===r&&c>m||1===r&&c+l+h>m-g&&f>u||2===r&&m+d>c+l||3===r&&(c-h<m+d+g&&f>u||c-h>m+d+g&&u>f)){n=!0;let e=a;a=o,o=e,e=h,h=g,g=e,e=l,l=d,d=e,e=c,c=m,m=e,e=u,u=f,f=e}let v=c,C=m;!n&&1===r||n&&3===r?v+=l:!n&&3===r||n&&1===r?C+=d:2===r&&(v+=l,C+=d);let S=e.$.timelineConnectionsContainer.querySelectorAll('.smart-task-connection[connection-id^="'+T+"-"+y+'-"]');0===S.length&&(S=e.$.timelineConnectionsContainer.querySelectorAll('.smart-task-connection[connection-id^="'+y+"-"+T+'"]')),t.connections=[].slice.call(S),t.start.x=v,t.start.y=u+s.offsetTop,t.start.task=a,t.end.x=C,t.end.y=f+i.offsetTop,t.end.task=o,t.type=r,t.inverted=n}_createTaskConnection(){const e=this,t=e._connectionDetails;if(!t)return;const s=2*(parseFloat(getComputedStyle(e).getPropertyValue("--smart-gantt-chart-timeline-task-connection-width"))||1),i=t.start.x,r=t.start.y,n=t.start.offset,a=t.start.point.offsetTop,o=t.end.x,l=t.end.y,d=t.end.offset,c=t.type,m=t.inverted,u=!m&&3===c||m&&1===c,f=!m&&1===c||m&&3===c;let h,g,p,_=i,k=o;u?(_=i-d,k=o+d):f&&(_=i+n,k=o-d);const T=_<=k&&u,y=_>=k&&f,v=2===c||f;!function d(u){h!==o&&(u?"horizontal"===u?(p=h-o+(T?-1:1)*n,h=_>k?h-Math.abs(p):h,e._createConnectingElement(h,g,(_===k?0:Math.abs(p))+(v?s:0),"horizontal"),h=_<k?h-p:h,d("vertical")):(p=Math.abs(g-l),g+=r<l?0:-1*p,h-=m&&1===c||!m&&3===c&&r>l?s:0,e._createConnectingElement(h,g,p,"vertical"),d()):(h?(p=Math.abs(h-o),h>=o&&(h+=-1*p,p+=s),e._createConnectingElement(h,g+(r<l?Math.abs(g-l):0),p,"horizontal",!t.inverted),h=o):(h=i,g=r,(0===c||!m&&3===c||m&&1===c)&&(h-=n),e._createConnectingElement(h,g,n,"horizontal",t.inverted),v&&(h+=n-s),T||y?(e._createConnectingElement(h,g-=r>l?a:0,a,"vertical"),g+=r<l?a:0):d("vertical")),d("horizontal")))}(),t.connections.map((e=>e.parentElement.removeChild(e)))}_getTaskIndexById(e,t){const s=this;t||(t=s._tasks);let i=t.find((t=>t.id===e));return i?t.indexOf(i):"number"==typeof e?isNaN(parseInt(e))?-1:parseInt(e):"object"==typeof e?s._getItemIndex(e,s._unsortedTasks?"unsortedTask":"task"):void 0}_refreshTaskConnections(e){const t=this,s=e instanceof HTMLElement?e._task:e,i=t._tasks.indexOf(s);if(void 0===i||e.classList&&e.classList.contains("smart-visibility-hidden"))return;let r;if(t._dragDetails&&(r=t._dragDetails.relatedConnections[i]),!r){r={};const e=t._tasks;for(let s=0;s<e.length;s++){const n=e[s].connections.filter((e=>t._getTaskIndexById(e.target)===i));n.length>0&&(r[s]=n)}t._dragDetails&&(t._dragDetails.relatedConnections[i]=r)}const n=s.connections;for(let e=0;e<n.length;e++){const s=n[e];t._connectTask(i+"-"+t._getTaskIndexById(s.target)+"-"+s.type)}if(Object.keys(r).length>0)for(const e in r){const s=r[e];for(let i=0;i<s.length;i++)t._connectTask(e+"-"+t._getTaskIndexById(s[i].target)+"-"+s[i].type)}}_dragStartHandler(e){const t=this,s=e.target.closest;(t._dragDetails||s&&s.call(t,"smart-gantt-chart")===t)&&e.preventDefault()}_getFirstCellObjInView(e){const t=this;if(e||(e=t._timelineCells),!e)return;const s=Math.abs(t.scrollLeft);let i,r;for(let t=0;t<e.length;t++){const n=e[t];if(n.left+n.width>s){i=n;break}r=n}return!i&&r&&(i=s>r.left?r:e[0]),i}_getSubTaskLimits(e){const t=this;if(!e)return;const s=e._task,i=s.tasks;let r,n;if(!s.tasks||0===s.tasks.length)return;let a=i[0],o=i[0];for(let e=0;e<i.length;e++){const t=i[e];i[e].dateEnd&&i[e].dateStart&&(a.dateStart||(a=t[e]),o.dateEnd||(o=t[e]),i[e].dateEnd.getTime()>o.dateEnd.getTime()&&(o=i[e]),i[e].dateStart.getTime()<a.dateStart.getTime()&&(a=i[e]))}const l=t.$.timelineContent.offsetWidth;let d,c,m;if(a&&(d=t._getTimelineSubTaskOffset(a),d&&(c=d.left,m=d.width,r=Math.max(0,t.rightToLeft?l-e.offsetLeft-e.offsetWidth-(l-c-m):e.offsetLeft-c))),o&&(d=t._getTimelineSubTaskOffset(o),d))if(c=d.left,m=d.width,t.rightToLeft){const t=l-e.offsetLeft-e.offsetWidth;n=Math.max(t,t+l-(l-c))}else n=Math.max(e.offsetLeft,e.offsetLeft+l-(c+m));return{min:r,max:n}}_getTimelineSubTaskOffset(e){const t=this,s=t.$.timelineTasksContainer.children[t._tasks.filter((e=>!e.hidden)).indexOf(e)];let i,r,n;if(s)i=s.offsetLeft,n=s.offsetWidth;else{const s=t._getTimelineTaskCellByDate(e.dateStart),a=t._getTimelineTaskCellByDate(e.dateEnd);s&&(i=s.left+t._getTimelineTaskOffset(s,e.dateStart)||0),a&&(r=a.left+t._getTimelineTaskOffset(a,e.dateEnd)||0),n=r-i}return{left:i,width:n}}_getTaskDragLimits(e){const t=this,s=t._getTaskBarPositionLimits(e._task,"DateStart"),i=t._getTaskBarPositionLimits(e._task,"DateEnd"),r=t._dragDetails.timelineTask;let n={};return(s.min||i.min)&&(n.min=Math.max(s.min||0,Math.max(0,(i.min||0)-r.offsetWidth))),i.max&&(n.max=Math.max(0,i.max-r.offsetWidth)),s.max&&(n.max=n.max?Math.min(s.max,n.max):s.max),n}_getTaskBarDateRange(e){if(!e)return;const t=this,s=t.rightToLeft?parseFloat(e.style.right)||t.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth:parseFloat(e.style.left)||e.offsetLeft,i=parseFloat(e.style.width)||e.offsetWidth,r=e._cellStart,n=e._cellEnd,a=e._task,o=a.minDateStart,l=a.maxDateEnd;let d,c;return d=t._getDateFromCell(s,r),!o||"project"===e._task.type&&e._task.synchronized||(d=new Date(Math.max(o.getTime(),d.getTime()))),c=t._getDateFromCell(s+i,n),!l||"project"===e._task.type&&e._task.synchronized||(c=new Date(Math.min(l.getTime(),c.getTime()))),{dateStart:d,dateEnd:c}}_getTaskBarDetails(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;const s=t.$.taskTimelineCellsContainer.children[t._tasks.filter((e=>!e.hidden)).indexOf(e._task)];if(!s)return;let i=new Date(s._task.dateStart);const r=new Date(s._task.dateEnd),n=e._cellStart,a=e._cellEnd;if(!n||!a)return void e.classList.add("smart-visibility-hidden");if(t.snapToNearest){let i,r,o=e._task.dateStart,l=e._task.dateEnd;const d=new Date(n.date),c=t._getDateFromCell(n.left+n.width,n),m=new Date(a.date),u=t._getDateFromCell(a.left+a.width,a);return c.getTime()-o.getTime()>=c.getTime()-d.getTime()?(o=d,i=n.left):(o=c,i=n.left+n.width),"milestone"!==e._task.type&&(u.getTime()-l.getTime()>=l.getTime()-m.getTime()?(l=m,r=a.left-i):(l=u,r=a.left-i+a.width)),e._task.dateEnd=l,l.getTime()<o.getTime()&&(o=new Date(l)),e._task.dateStart=o,{left:i,width:r,top:s.offsetTop}}let o,l,d,c,m,u;switch(t.view){case"year":{d=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),c=new Date(r.getFullYear(),r.getMonth()+1,0).getDate();const e=i.getHours()/24+i.getMinutes()/1440+i.getSeconds()/86400,t=r.getHours()/24+r.getMinutes()/1440+r.getSeconds()/86400;o=n.left+(i.getDate()-1+e)/d*n.width,l=a.left+(r.getDate()-1+t)/c*a.width-o;break}case"month":m=parseFloat(i.getHours()+"."+i.getMinutes()+i.getSeconds())/24*(n.width/7),u=parseFloat(r.getHours()+"."+r.getMinutes()+r.getSeconds())/24*(n.width/7),o=n.left+i.getDay()/7*n.width+m,l=a.left+r.getDay()/7*a.width-o+u;break;case"week":m=parseFloat(i.getHours()+"."+i.getMinutes()+i.getSeconds())/24*n.width,u=parseFloat(r.getHours()+"."+r.getMinutes()+r.getSeconds())/24*n.width,o=n.left+m,l=a.left+(u-m)-n.left;break;case"day":m=parseFloat(i.getMinutes()+i.getSeconds()/60)/60*n.width,u=parseFloat(r.getMinutes()+r.getSeconds()/60)/60*n.width,o=n.left+m,l=a.left+(u-m)-n.left}return{width:"milestone"===s._task.type?"":l,left:o,top:s.offsetTop}}_getTimelineTaskCellByDate(e){if(!e)return;const t=this,s=t._timelineCells;let i;e:for(let r=0;r<s.length;r++){const n=s[r];switch(t.view){case"year":if(n.date.getYear()===e.getYear()&&n.date.getMonth()===e.getMonth()){i=s[r];break e}break;case"month":{let t=new Date(n.date);if(t.setDate(t.getDate()+(6-t.getDay())+1),t.setMilliseconds(t.getMilliseconds()-1),e.getTime()>=n.date.getTime()&&e.getTime()<=t.getTime()){i=s[r];break e}break}case"week":if(n.date.getYear()===e.getYear()&&n.date.getMonth()===e.getMonth()&&n.date.getDate()===e.getDate()){i=s[r];break e}break;case"day":if(n.date.getYear()===e.getYear()&&n.date.getMonth()===e.getMonth()&&n.date.getDate()===e.getDate()&&n.date.getHours()===e.getHours()){i=s[r];break e}}}return i}_handleInverted(e){const t=this;function s(e){e||(e="task");const s=t.$[`${e}Splitter`],[i,r,n,a,o]="task"===e?[t.$.treeSplitterItem,t.$.timelineSplitterItem,t,t.$.timelineContent,"scrollTop"]:[t.$.resourceTreeItem,t.$.resourceTimelineSplitterItem,t.$.resourceVerticalScrollBar,t.$.resourceTimelineContent,"value"],l=t.treeSize!==i.size?i.style[s._measurements.dimension]:t.treeSize;i.size="",s.removeChild(r),t.inverted&&!t.rightToLeft||!t.inverted&&t.rightToLeft?s.insertBefore(r,i):s.appendChild(r),i.size=l,a.scrollTop=n[o]}(!e||t.inverted||t.rightToLeft)&&(s("task"),s("resource"))}_createResourceTimeline(){const e=this;if(!e._resources)return;const t=e._resources.filter((e=>!e.hidden));if(e._handleResourcePanelVisibility(),!e.$.mainSplitter.contains(e.$.resourceSplitterItem)){if(!e._resources.length){const t=e.$.resourceTreeSplitter.items,s=e.$.resourceTree;for(let e=0;e<t.length;e++){const i=t[e];if(i.contains(s))s.dataSource=[];else{const e=i.getElementsByClassName("smart-resource-tree-content")[0];e&&(e.innerHTML="")}}e.$.resourceTimelineCellsContainer.innerHTML=""}return}const s=e.$.resourceSplitterItemHeader.innerHTML;(e.resourcePanelHeaderTemplate&&!s||!e.resourcePanelHeaderTemplate&&s)&&e._handleHeaderTemplate("resource"),e._recycleResourceHeaderCells(),e.$.resourceTimelineCellsContainer.innerHTML="";const i=e.$.resourceTree.selectedIndexes.map((t=>e._getItemByTreeIndex("resource",t)));for(let s=0;s<t.length;s++){const r=document.createElement("div");r.classList.add("smart-timeline-resource-cell"),r._resource=t[s],i.includes(t[s])&&r.setAttribute("selected",""),e._refreshResourceTimeline(r),e.$.resourceTimelineCellsContainer.appendChild(r)}e.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",e.$.resourceTimelineCellsContainer.offsetHeight+"px"),e.$.resourceTimelineContent.style.width=e.$.timelineContent.style.width,Smart.Utilities.Core.Browser.Firefox&&!e.resourcePanelSize&&(e.$.resourceSplitter.resizeTrigger.style.display="none"),e._synchronizeSplitters(e.$.taskSplitter,e.$.resourceSplitter),e.$.resourceTimeline.scrollLeft=e.$.timeline.scrollLeft,e._createTreeColumns(e.$.resourceTreeSplitter),e.$.resourceTree.refresh(),e.$.resourceSplitter.resizeTrigger.style.display=null,e.$.resourceSplitter.refresh(),e._refresh(),e._highlightAssignedItem("task",e.selectedIndexes[0]),e._highlightAssignedItem("resource",e._resources.indexOf(i[0]))}_handleResourcePanelVisibility(){const e=this,t=e._resources.filter((e=>!e.hidden)),s=e.$.mainSplitter,i=e.$.resourceSplitterItem,r=e.$.taskSplitterItem;if(!t||!t.length||e.hideResourcePanel)return i.size||(i._size=i.style[s._measurements.dimension]),e._resourceScrollView&&(e._resourceScrollView.unlisten(),delete e._resourceScrollView),e._handleResourceTreeEvents(),s.contains(i)&&(s.removeChild(i),e._refresh()),r.size="",r.min="",e.$.resourceTree.selectedIndexes=[],void e._highlightAssignedItem("resource");s.contains(i)||(i.size=i._size||e.resourcePanelSize,e._handleResourceTreeEvents(!0),s.appendChild(i),e.$.taskSplitterItem._setSize("size",e.taskPanelSize),e._resourceScrollView=new Smart.Utilities.Scroll(e.$.resourceSplitterItem,e.$.horizontalScrollBar,e.$.resourceVerticalScrollBar)),e._synchronizeSplitters(e.$.taskSplitter,e.$.resourceSplitter)}_refreshResourceTimeline(e){const t=this;if(!t._resources)return;const s=t._resources.filter((e=>!e.hidden));!t.hideResourcePanel&&s.length&&(e?t._refreshResourceTimelineContent(e._resource,e):(t._recycleResourceHeaderCells(),t.$.resourceTimelineContent.style.width=t.$.timelineContent.style.width))}_refreshResourceTimelineContent(e,t){const s=this,i=s._resources.indexOf(e);if(i<0)return;const r=s.$.timelineTasksContainer.children,n=s.$.resourceTimelineCellsContainer,a=s._getResourceTasks(e,!0);function o(){const t=n.children;for(let s=0;s<t.length;s++)if(t[s]._resource===e)return t[s]}if(!r.length){const e=n.children;for(let t=0;t<e.length;t++)e[t].innerHTML="";return}if(!a.length||e.hidden){const e=o();return void(e&&(e.innerHTML=""))}if(!t&&!(t=o()))return;let l=t.children;if(!l)return;const d=s.$.timelineViewCells.children,c=d.length;let m;if(l.length!==c){for(m=document.createDocumentFragment();l.length;)m.appendChild(t.firstElementChild);if(l=m.children,l.length>c)for(;l.length&&l.length!==c;)m.removeChild(m.firstElementChild);else if(l.length<c)for(;l.length!==c;)m.appendChild(d[0].cloneNode());s.hasAnimation&&(t.appendChild(m),l=t.children)}for(let t=0;t<l.length;t++){const s=l[t],i=d[t];s.classList.remove("hide-left-border","hide-right-border"),s.classList.add("smart-resource-timeline-view-cell"),s.style.width=i.style.width,s.style.left=i.style.left,s.style.right=i.style.right,s.removeAttribute("load"),s.style.height="",s.innerHTML="",e.class&&s.classList.add(e.class)}function u(e,t){const i=e.dateStart,r=e.dateEnd,n=t._date,a=(e=>{switch(s._view||s.view){case"year":return new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59,999);case"month":return new Date(e.getFullYear(),e.getMonth(),e.getDate()+6-e.getDay(),23,59,59,999);case"week":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999);case"day":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),59,59,999)}})(n),o=e.dateStart.getTime()<n.getTime()?n:i,l=r.getTime()>a.getTime()?a:r,d=Math.round(s._getWorkingTime(o,l)/36e5);return{value:d,max:o.getTime()===n.getTime()&&l.getTime()===a.getTime()?d:Math.round(s._getWorkingTime(n,a)/36e5)}}let f={};const h=s._tasks.filter((e=>!e.hidden));for(let t=0;t<a.length;t++){const n=a[t];if(n.hidden)continue;const o=h.indexOf(n),c=r[o],m=c._cellStart.date,g=c._cellEnd.date;for(let t=0;t<d.length;t++){let r,a,c=d[t],h=c._date;if(!h)continue;if(h.getTime()<m.getTime()||h.getTime()>g.getTime()||n.dateEnd.getTime()===h.getTime())continue;if(f[t]&&f[t].indexOf(o)<0?f[t].push(o):f[c]||(f[t]=[o]),"custom"===s.resourceTimelineMode){if(!s.resourceTimelineFormatFunction)continue;c=l[t],c.innerHTML=s.resourceTimelineFormatFunction.call(s,f[t]||[],i,new Date(h))||"";continue}if("tasks"===s.resourceTimelineView)r=1,a=e.maxCapacity;else if("hours"===s.resourceTimelineView){const t=u(n,c),s=t.max/24;r=parseFloat((t.value/t.max*e.capacity*s).toFixed(2)),a=Math.min(t.max,parseFloat((e.maxCapacity*s).toFixed(2)))}else{if(!s.resourceTimelineFormatFunction)continue;let e=s.resourceTimelineFormatFunction.call(s,f[t]||[],i,new Date(h));if(c=l[t],null!=e)if(e="object"!=typeof e?[e]:Object.values(e),2===e.length)r=parseFloat(e[0])||0,a=parseFloat(e[1])||0;else if(1===e.length){c.setAttribute("load",e[0]);continue}}c=l[t];const p=parseFloat(((parseFloat(c.getAttribute("load"))||0)+(r||0)).toFixed(2));if(p>a?c.classList.add("warning"):c.classList.remove("warning"),"histogram"!==s.resourceTimelineMode)p&&c.setAttribute("load",p);else{const e=Math.min(100,100*parseFloat((p/a).toFixed(2))),t=c.previousElementSibling;if(t){const s=parseFloat(t.style.height)||0;e?s===e?(c.classList.add("hide-left-border"),t.classList.add("hide-right-border")):s>e?(c.classList.add("hide-left-border"),t.classList.remove("hide-right-border")):s<e&&(c.classList.remove("hide-left-border"),t.classList.add("hide-right-border")):(c.classList.remove("hide-left-border"),t.classList.remove("hide-right-border"))}c.style.height=e+"%",p&&c.setAttribute("load",p+"/"+a)}}}!s.hasAnimation&&m&&t.appendChild(m)}_handleResourceTreeEvents(e){const t=this;if(e){if(t._isResourceTreeListening)return;t.$resourceTree.listen("blur",t._treeBlurHandler.bind(t)),t.$resourceTree.listen("change",t._taskTreeChangeHandler.bind(t)),t._isResourceTreeListening=!0}else t.$resourceTree.unlisten("blur"),t.$resourceTree.unlisten("change"),delete t._isResourceTreeListening}_recycleResourceHeaderCells(){const e=this;if(!e.$.mainSplitter.contains(e.$.resourceSplitterItem))return;const t=e.$.resourceTimelineViewCells,s=t.children,i=e.$.timelineViewCells.children;let r=document.createDocumentFragment();if(i.length===s.length){for(;s.length;)r.appendChild(t.firstElementChild);for(let e=0;e<i.length;e++){const t=i[e],s=r.children[e];s.style.left=t.style.left,s.style.right=t.style.right,s.style.width=t.style.width,s.innerHTML=t.innerHTML,t.hasAttribute("weekend")?s.setAttribute("weekend",""):s.removeAttribute("weekend"),t.hasAttribute("nonworking")?s.setAttribute("nonworking",""):s.removeAttribute("nonworking","")}}else{t.innerHTML="";for(let e=0;e<i.length;e++)r.appendChild(i[e].cloneNode(!0))}t.appendChild(r),e.$.resourceTimelineCellsContainer.children.length&&e._resources.forEach((t=>e._refreshResourceTimelineContent(t)))}_refreshResourceScrollBar(){const e=this,t=e.$.resourceVerticalScrollBar;if(!e.$.mainSplitter.contains(e.$.resourceSplitter))return;const s=Math.max(0,e.$.resourceTimelineCellsContainer.offsetHeight-e.$.resourceTimelineContent.offsetHeight);0===s&&"visible"===e.verticalScrollBarVisibility?t.max=1:t.max=s,t.disabled="disabled"===e.verticalScrollBarVisibility||e.disabled||s<=0,!e.$.container.classList.contains("vscroll")&&t.disabled?t.classList.add("smart-hidden"):(t.classList.remove("smart-hidden"),t.refresh(),e.$.container.classList.contains("hscroll")?e.$.horizontalScrollBar.classList.add("bottom-corner"):e.$.container.classList.contains("vscroll")||e.$.horizontalScrollBar.classList.remove("bottom-corner"))}_handleResources(e){const t=this,s=e?[e]:t._tasks;t._resources||(t._resources=[]);for(let e=0;e<s.length;e++){let i=s[e].resources;Array.isArray(i)||(i=[i].reduce(((e,t)=>e.concat(t)),[]));for(let r=0;r<i.length;r++){let n=i[r];if("object"!=typeof n||!n||void 0===n.id||null===n.id){"number"==typeof n&&(i[r]=n+"");continue}let a=t._resources.find((e=>e.id&&e.id.toString()===n.id.toString()))||{};t._setResource(a,n,s[e]),i[r]=a.id,Object.values(a).length&&!t._resources.includes(a)&&(t._resources.push(a),t._refreshResource(a))}}t.sortable&&t._sortResources(!0)}_refreshAssignedResources(e,t=[]){const s=this;if(!e||s._tasks.indexOf(e)<0)return;const i=s._getTaskResources(e,!0);for(let e=0;e<i.length;e++){const r=i[e];let n=[];s.resourceColumns.forEach((e=>{void 0!==e.formatFunction&&n.push(e.value)})),n.concat(t),s._refreshResourceTimelineContent(r),t.includes("workload")?s._refreshResource(r,"workload"):t.includes("progress")&&s._refreshResource(r,"progress"),n.length&&s._refreshTreeColumnsData(r,n,"resource")}}_refreshResource(e,t){const s=this;if(!s._resources.length)return;const i=s._getResourceTasks(e,!0),r=864e5;switch(t){case"progress":e.progress=parseFloat((i.reduce(((e,t)=>e+t.progress),0)/i.length).toFixed(2));break;case"workload":e.workload=parseFloat((s._convertDuration(i.reduce(((e,t)=>e+t.duration),0))/r*e.maxCapacity).toFixed(2));break;default:e.progress=parseFloat((i.reduce(((e,t)=>e+t.progress),0)/i.length).toFixed(2)),e.workload=parseFloat((s._convertDuration(i.reduce(((e,t)=>e+t.duration),0))/r*e.maxCapacity).toFixed(2))}s._refreshResourceTimelineContent(e)}_setResource(e,t){if(t&&"object"==typeof t)return e.id?e.id=e.id.trim():e.id=(t.id+"").trim(),e.$||(e.$={}),e.class=t.class||e.class,e.minCapacity=t.minCapacity||e.minCapacity||0,e.maxCapacity=t.maxCapacity||e.maxCapacity||24,e.progress=t.progress||e.progress||0,e.capacity=t.capacity||e.capacity||8,e.type=t.type||e.type,e.hidden=!!("boolean"==typeof t.hidden?t.hidden:e.hidden),e.workload=e.workload||0,t.label?e.label=t.label:void 0===e.label&&(e.label=""),t.value&&(e.value=t.value),e}insertResource(e,t){const s=this,i=Array.from(arguments).filter((e=>void 0!==e));let r,n=s._resources;if(1===i.length&&(t=i[0]),"object"!=typeof t)return void s.error(s.localize("incorrectArgument",{elementType:s.nodeName.toLowerCase(),methodName:"insertResources",argumentName:"resource"}));if(t.id&&n.find((e=>e.id&&e.id.toString()===t.id.toString())))return void s.updateResource(t.id,t);if(t.assignedTo&&(r=[t.assignedTo].reduce(((e,t)=>e.concat(t,[])))),!(t=s._setResource({},t)))return;const a=!!s._unsortedResources;let o;s._unsortResources(),n=s._resources,"number"!=typeof e||isNaN(e)?"string"==typeof e?(o=n.find((t=>t.id&&t.id.toString()===e.toString())),o||(o=s._getItemByTreeIndex("resource",e))):"object"==typeof e&&(o=n[s._getItemIndex(e,"resource")]):o=n[e],(e=n.indexOf(o))<0?n.push(t):n.splice(e,0,t);const l=s._tasks;if(l.length){if(void 0!==r){let e=[];Array.isArray(r)||(r=[r]),r.forEach((t=>{"number"==typeof t?e.push(l[t]):e=e.concat(l.filter((e=>e.id&&t.toString()===e.id.toString())))}));for(let s=0;s<e.length;s++){const i=e[s];i.disableResources||i.resources.includes(t.id.toString())||i.resources.push(t.id)}if(s._isUpdating)return void(s._isUpdating.type.resource=!0);s._highlightAssignedItem("task",s.selectedIndexes[0]),s._refreshResource(t)}if(s.taskColumns.find((e=>"resources"===e.value))){if(s._isUpdating)return s._isUpdating.type.resource=!0,void(s._isUpdating.type.task=!0);if("resource"!==s.view&&s._view)s._refreshTimeline();else{const e=s._tasks.filter((e=>e.resources.includes(t.id)));for(let t=0;t<e.length;t++)s._refreshTreeColumnsData(e[t],["resources"])}}}if(s._isUpdating)s._isUpdating.type.resource=!0;else{if(a)return s._sortResources(),void s.$.fireEvent("itemInsert",{type:"resource",item:s._cloneObject(t)});s._createResourceTimeline(),s.$.fireEvent("itemInsert",{type:"resource",item:s._cloneObject(t)})}}_insertTimelineResource(e,t,s){const i=this,r=i.$.resourceTimelineCellsContainer,n=document.createElement("div");n.classList.add("smart-timeline-resource-cell"),n._resource=t,i._refreshResourceTimelineContent(t,n),i.$.resourceTimelineCellsContainer.insertBefore(n,e>-1?r.children[e]:void 0),i.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",r.offsetHeight+"px"),i._refreshResourceScrollBar(),i._insertNewTreeItem(e,t,s,"resource"),i.$.resourceTree.refresh(),i._highlightAssignedItem("task",i.selectedIndexes[0])}updateResource(e,t){const s=this,i=s._unsortedResources,r=s._unsortedResources||s._resources;if(void 0===e)return;const n=s._getValidTaskAndIndex(e,"resource");if(!n||!n.item)return;let a=n.item;const o=a.hidden;if(s._setResource(a,t),s._isUpdating)return void(s._isUpdating.type.resource=!0);if(s.taskColumns.find((e=>"resources"===e.value)))if("resource"!==s.view&&s._view)s._refreshTimeline();else{const e=s._tasks.filter((e=>e.resources.includes(a.id)));for(let t=0;t<e.length;t++)s._refreshTreeColumnsData(e[t],["resources"])}if(i)return s._sortResources(),void s.$.fireEvent("itemUpdate",{type:"resource",item:s._cloneObject(a)});if(o!==a.hidden){const e=s.$.resourceTimelineCellsContainer;if(a.hidden)for(let t=0;t<e.children.length;t++){const i=e.children[t];if(i._resource===a){e.removeChild(i),s._removeTreeItem(t,"resource"),s.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",s.$.resourceTimelineCellsContainer.offsetHeight+"px");break}}else s._insertTimelineResource(r.filter((e=>!e.hidden)).indexOf(a),a);return s._refresh(),s._handleResourcePanelVisibility(),void s.$.fireEvent("itemUpdate",{type:"resource",item:s._cloneObject(a)})}s._refreshTreeColumnsData(a,void 0,"resource");const l=s.$.resourceTimelineCellsContainer.children;for(let e=0;e<l.length;e++){const t=l[e];t._resource===a&&s._refreshResourceTimelineContent(a,t)}s.$.fireEvent("itemUpdate",{type:"resource",item:s._cloneObject(a)})}removeResource(e){const t=this,s=t._unsortedResources,i=t._unsortedResources||t._resources;if(void 0===e)return;let r;if("number"!=typeof e||isNaN(e)?"string"==typeof e?(r=i.find((t=>t.id&&t.id.toString()===e.toString())),r||(r=t._getItemByTreeIndex(t._unsortedResources?"unsortedResource":"resource",e))):"object"==typeof e&&(r=i[t._getItemIndex(e,t._unsortedResources?"unsortedResource":"resource")]):r=i[e],!r)return;const n=i.indexOf(r);if(t._isUpdating)return i.splice(i.indexOf(r),1),t._isUpdating.type.resource=!0,void(t._isUpdating.type.task=!0);if(i.splice(i.indexOf(r),1),t.taskColumns.find((e=>"resources"===e.value)))if("resource"!==t.view&&t._view)t._refreshTimeline();else{const e=t._tasks.filter((e=>e.resources.includes(r.id)));for(let s=0;s<e.length;s++)t._refreshTreeColumnsData(e[s],["resources"])}return s?(t._sortResources(),t._resizeEventHandler(),void t.$.fireEvent("itemRemove",{type:"resource",item:t._cloneObject(r)})):i.filter((e=>!e.hidden)).length?(t._removeTreeItem(n,"resource"),t.$.resourceTimelineCellsContainer.children[n]&&t.$.resourceTimelineCellsContainer.removeChild(t.$.resourceTimelineCellsContainer.children[n]),t.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",t.$.resourceTimelineCellsContainer.offsetHeight+"px"),void(t.$.mainSplitter.contains(t.$.resourceSplitter)?(t._refreshResourceScrollBar(),t._resizeEventHandler(),t.$.fireEvent("itemRemove",{type:"resource",item:t._cloneObject(r)})):t.$.fireEvent("itemRemove",{type:"resource",item:t._cloneObject(r)}))):(t._createResourceTimeline(),t._resizeEventHandler(),void t.$.fireEvent("itemRemove",{type:"resource",item:t._cloneObject(r)}))}_getResourceTasks(e,t){const s=this,i=s._resources,r=s._tasks;if(!i.length||!r.length)return;let n;if("object"==typeof e?n=i.find((t=>t.id&&t.id.toString()===e.id.toString())):"string"!=typeof e&&"number"!=typeof e||(n=i.find((t=>t.id&&t.id.toString()===e.toString()))||i[e]),!n)return;let a=[];const o=s._tasks.filter((e=>!e.hidden));for(let e=0;e<r.length;e++){if(!r[e].resources.includes(n.id))continue;const s=r[e];a.push(t?s:{id:s.id,index:o.indexOf(s),label:s.label,type:s.type,hidden:s.hidden,expanded:s.expanded,dateStart:s.dateStart,dateEnd:s.dateEnd,progress:s.progress,duration:s.duration})}return a}_getTaskResources(e,t){const s=this,i=s._tasks;let r;if(null==e||!i||!i.length)return[];if("string"==typeof e?(r=i.find((e=>e.id&&e.id.toString()===arguments[0].toString())),r||(r=i[s._tasks.indexOf(s._getItemByTreeIndex("task",e))])):"number"==typeof e?r=i[e]:"object"==typeof e&&(r=i[s._getItemIndex(e,s._unsortedTasks?"unsortedTask":"task")]),void 0===r)return[];const n=[r.resources].reduce(((e,t)=>e.concat(t)),[]);let a=[];const o=s._resources.filter((e=>!e.hidden));for(let e=0;e<n.length;e++){const i=s._resources.find((t=>t.id&&t.id.toString()===n[e].toString()));i&&a.push(t?i:{id:i.id,index:o.indexOf(i),label:i.label,value:i.value,hidden:i.hidden,type:i.type,capacity:i.capacity,maxCapacity:i.maxCapacity,minCapacity:i.minCapacity,progress:i.progress,formatFunction:i.formatFunction})}return a}_resourceValidator(e,t){const s=this;return Array.isArray(t)||t instanceof Smart.ObservableArray||"number"==typeof t||"string"==typeof t||null==t?t:(s.error(s.localize("invalidValue",{elementType:s.nodeName.toLowerCase(),property:"resources",typeOne:"array",typeTwo:"number"})),null)}_handleTaskProgressChange(e){const t=this,s=t._dragDetails.target.closest(".smart-timeline-task");if(t.disableTaskProgressChange)return;if(!t.hasAttribute("progress-change")){if(t.$.fireEvent("progressChangeStart",{index:t._tasks.indexOf(s._task),progress:s._task.progress||0}).defaultPrevented)return void delete t._dragDetails.target;t.setAttribute("progress-change",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0}const i=s.querySelector(".smart-timeline-task-progress"),r=i.parentElement,n=r.getBoundingClientRect().left,a=r.offsetWidth,o=e.pageX-window.pageXOffset;t._dragDetails.progress||(t._dragDetails.progress=i.offsetWidth),t._dragDetails.progress=Math.max(0,Math.min(a,t._dragDetails.progress+(t.rightToLeft?-1:1)*(o-t._dragDetails.coordinates.x))),t._dragDetails.coordinates.x=Math.max(n+t._dragDetails.offset.x,Math.min(n+a+t._dragDetails.offset.x,o));const l=t._dragDetails.timelineTask._task.progress=t._dragDetails.progress/a*100,d=t._dragDetails.timelineTask._task;d.progress=parseFloat(l.toFixed(2)),t._setTaskBarProgress(d,s),t._refreshTreeColumnsData(d,["progress"]),t._resourceTreeRefreshTimeout&&clearTimeout(t._resourceTreeRefreshTimeout),t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(d,["progress"]),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate)}_handleTaskBarDrag(e){const t=this;if(t.disableTaskDrag)return;if(Math.abs(e.pageX-t._dragDetails.coordinates.x)<=5)return void(t._scrollView.disableSwipeScroll=!0);const s=t._dragDetails.timelineTask,i=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._task===s._task));if(!t.hasAttribute("dragged")){if(t.$.fireEvent("dragStart",{index:t._tasks.indexOf(s._task),dateStart:s._task.dateStart,dateEnd:s._task.dateEnd}).defaultPrevented)return void delete t._dragDetails.timelineTask;t.setAttribute("dragged",""),t._touchmoveInside=!0;const e=t._createDelimiter("min-date"),r=t._createDelimiter("max-date");e&&i.appendChild(e),r&&i.appendChild(r)}t._dragDetails.position||(t._dragDetails.position={x:t._dragDetails.originalPosition.x,y:t._dragDetails.originalPosition.y});const r=i.getBoundingClientRect().left,n=i.offsetWidth,a=s.offsetWidth,o=t._dragDetails.min.left||0,l=t._dragDetails.max.left,d=e.pageX-window.pageXOffset;let c=0;t._dragDetails.position.x=Math.max(o,Math.min(n-a,t._dragDetails.position.x+(t.rightToLeft?-1:1)*(d-t._dragDetails.coordinates.x))),void 0!==l&&(t._dragDetails.position.x=Math.min(l,t._dragDetails.position.x),c=n-a-l),t.rightToLeft?t._dragDetails.coordinates.x=Math.max(r+t._dragDetails.offset.x+c,Math.min(r+n-(a-t._dragDetails.offset.x+o),d)):t._dragDetails.coordinates.x=Math.max(r+t._dragDetails.offset.x+o,Math.min(r+n-(a-t._dragDetails.offset.x+c),d));const m=t._dragDetails.position.x-(t.rightToLeft?i.offsetWidth-s.offsetLeft-s.offsetWidth:s.offsetLeft);s.style[t.rightToLeft?"right":"left"]=t._dragDetails.position.x+"px",t._refreshTask(s),t._refreshProject(s._task.$.project),"project"===s._task.type&&s._task.dragProject&&t._refreshProjectTasks(i,m),t.$.mainSplitter.contains(t.$.resourceSplitter)&&(t._resourceTreeRefreshTimeout&&clearTimeout(t._resourceTreeRefreshTimeout),t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(s._task),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate))}_handleTaskBarResize(e){const t=this;if(t.disableTaskResize)return;const s=t._dragDetails.timelineTask,i=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._task===s._task));if(!t.hasAttribute("resized")){if(t.$.fireEvent("resizeStart",{index:t._tasks.indexOf(s._task),dateStart:s._task.dateStart,dateEnd:s._task.dateEnd}).defaultPrevented)return void t.$.timeline.removeAttribute("task-bar-hovered");t.setAttribute("resized",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0}t._dragDetails.position||(t._dragDetails.position={x:t._dragDetails.originalPosition.x,y:t._dragDetails.originalPosition.y}),t._dragDetails.size||(t._dragDetails.size={width:t._dragDetails.originalSize.width});const r=t.$.timeline.getAttribute("task-bar-hovered"),n=i.getBoundingClientRect().left,a=t._dragDetails.min.width||0,o=t._dragDetails.max.width,l=e.pageX-window.pageXOffset;let d=t._dragDetails.size.width,c="object"==typeof e?l-t._dragDetails.coordinates.x:e;if("left"===r&&!t.rightToLeft||"right"===r&&t.rightToLeft)if(t.rightToLeft){c<0?c=-1*Math.min(Math.abs(c),d-(a||0)):void 0!==o&&(c=Math.min(o-d,Math.abs(c))),d=t._dragDetails.size.width=Math.max(a,Math.min(i.offsetWidth-s.offsetLeft,d+c));const e=s.offsetLeft;s.style.left="",s.style.right=Math.max(0,(parseFloat(s.style.right)||i.offsetWidth-s.offsetLeft-s.offsetWidth)-c)+"px",t._dragDetails.coordinates.x=Math.max(n+s.offsetLeft+a,Math.min(n+e+d,l))}else c>0?c=Math.min(c,d-(a||0)):void 0!==o&&(c=-1*Math.min(o-d,Math.abs(c))),d=t._dragDetails.size.width=Math.max(a,Math.min(s.offsetLeft+d,d-c)),s.style.right="",s.style.left=Math.max(0,(parseFloat(s.style.left)||s.offsetLeft)+c)+"px",t._dragDetails.coordinates.x=Math.max(n+s.offsetLeft,Math.min(n+s.offsetLeft+d-a,l));else t.rightToLeft?(c<0&&void 0!==o&&(c=-1*Math.min(o-d,Math.abs(c))),d=t._dragDetails.size.width=Math.max(a,Math.min(s.offsetLeft+s.offsetWidth,d-c)),s.style.width=t._dragDetails.size.width+"px",t._dragDetails.coordinates.x=Math.max(n+s.offsetLeft,Math.min(n+s.offsetLeft+d-a,l))):(c>0&&void 0!==o&&(c=Math.min(o-d,c)),d=t._dragDetails.size.width=Math.max(a,Math.min(i.offsetWidth-s.offsetLeft,d+c)),t._dragDetails.coordinates.x=Math.max(n+s.offsetLeft+a,Math.min(n+s.offsetLeft+(o||d),l)));s.style.width=t._dragDetails.size.width+"px",t._refreshTask(s),t._refreshProject(s._task.$.project),t._resourceTreeRefreshTimeout&&clearTimeout(t._resourceTreeRefreshTimeout),t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(s._task,["workload"]),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate)}_handleTimelineConnectionHover(e){const t=this;if(!(t.shadowRoot||t).contains(e))return;const s=t.$.timelineConnectionsContainer.children,i=e.closest(".smart-task-connection");if(i||!t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[hover]")){if(i){const e=i.getAttribute("connection-id");for(let t=0;t<s.length;t++){const i=s[t];i.getAttribute("connection-id")===e?i.setAttribute("hover",""):i.removeAttribute("hover")}t._hoveredConnectionTasks=i.tasks}}else for(let e=0;e<s.length;e++)s[e].removeAttribute("hover")}_handleTimelineHover(e,t){const s=this,i=e.originalEvent||e,r=s._tasks.filter((e=>!e.hidden));let n=i.pageX&&Smart.Utilities.Core.isMobile?document.elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset):i.target;function a(){if(s._hoveredTimelineTask){const e=r.indexOf(s._hoveredTimelineTask._task);e>-1&&s.$.taskTimelineCellsContainer.children[e].removeAttribute("hover"),s._hoveredTimelineTask.removeAttribute("hover"),s.$.timeline.removeAttribute("task-bar-hovered"),delete s._hoveredTimelineTask}}if(i.pageX&&s.shadowRoot&&n===s&&(n=i.pageX&&Smart.Utilities.Core.isMobile?s.shadowRoot.elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset):i.composedPath()[0]),!n||!n.closest)return;if(n===s)return a(),void s._handleResourceTimelineHover(n,!0);if(s.$.resourceSplitter.contains(n))return void s._handleResourceTimelineHover(n,t);s._handleTimelineConnectionHover(n);let o=n.closest(".smart-timeline-task-cell")||n.closest(".smart-timeline-task");if(t||!o||!(s.shadowRoot||s).contains(o))return void a();const l=r.indexOf(o._task),d=o&&s._connectionFeedback&&o.contains(s._connectionFeedback);if(o.classList.contains("smart-timeline-task-cell")&&(o=s.$.timelineTasksContainer.children[l]),!s._hoveredTimelineTask||s._hoveredTimelineTask!==o){if((o!==s._hoveredTimelineTask||d&&s._hoveredTimelineTask===o)&&a(),o&&!d){if(s._hoveredTimelineTask=o,d)return;o.setAttribute("hover",""),Smart.Utilities.Core.isMobile||s.$.taskTimelineCellsContainer.children[l].setAttribute("hover","")}o&&s._handleTreeItemHover(r.indexOf(o._task),n)}}_handleResourceTimelineHover(e,t){const s=this;function i(){s._hoveredTimelineResource&&(s._hoveredTimelineResource.removeAttribute("hover"),delete s._hoveredTimelineResource)}let r=e.closest(".smart-timeline-resource-cell");!t&&r&&(s.shadowRoot||s).contains(r)?s._hoveredTimelineResource&&s._hoveredTimelineResource===r||(i(),s._hoveredTimelineResource=r,r.setAttribute("hover",""),s._handleTreeItemHover(s._resources.filter((e=>!e.hidden)).indexOf(r._resource),e)):i()}_getScrollLeft(e){return this.rightToLeft?e*=-1:e}_synchronizeSplitters(e,t){if(this.$.mainSplitter.contains(this.$.resourceSplitter)){const s=e._measurements,i=e.items,r=t.items,[n,a,o]=[s.dimension,s.minDimension,s.maxDimension],[l,d]=[r[0],i[0]],[c,m]=[r[1],i[1]];t.keepProportionsOnResize=!0,t.setAttribute("orientation-change",""),[a,o,n].forEach((e=>{const t=e===n?"size":e===a?"min":"max";l.set(t,""),c.set(t,""),l[t]=d.style[e],c[t]=m.style[e]})),t.removeAttribute("orientation-change"),t.keepProportionsOnResize=!1}}_resizeEventHandler(e){const t=this,s=t.$.taskSplitter;function i(e){e.refresh(),e===s&&(i(t.$.taskTreeSplitter),t._synchronizeSplitters(s,t.$.resourceSplitter))}if(e&&"resizeEnd"===e.type){if(e.target===t.$.taskTreeSplitter||e.target===t.$.resourceTreeSplitter)return void i(e.target);e.target===t.$.resourceSplitter&&t._synchronizeSplitters(t.$.resourceSplitter,s)}const r=t.$.taskTimelineCellsContainer.children,n=t.offsetWidth!==t.$.timeline.offsetWidth;if(!t._timelineCells)return void t._refresh();n?(t.$.mainSplitter.refresh(),i(s),t._createTimelineCells(),t._refreshResourceTimeline()):t._refresh(),t._recycle();for(let e=0;e<r.length;e++)t._setTimelineTaskBar(r[e]._task,n),t._refreshTaskConnections(r[e]._task);t.$.timeline.scrollLeft=t._getScrollLeft(t.scrollLeft),t.$.timelineContent.scrollTop=t.scrollTop,t.$.taskTree.refresh(),i(t.$.taskTreeSplitter);const a=Smart.Utilities.Core.Browser.Firefox&&!t.resourcePanelSize,o=t.$.resourceSplitter.resizeTrigger;a&&o&&(o.style.display="none"),i(t.$.resourceSplitter),i(t.$.resourceTreeSplitter),o&&(o.style.display=null),t.$.resourceTree.refresh(),t.$.mainSplitter.refresh(),t._refreshTreeSplitterScrollTop(t.$.taskTreeSplitter),t._refreshTreeSplitterScrollTop(t.$.resourceTreeSplitter)}_recycle(e){const t=this;if(!e||"horizontal"===e.context.orientation)return t._recycleHeaderCells(t.$.timelineViewCells),t._recycleHeaderCells(t.$.timelineViewDetails),void t._recycleResourceHeaderCells();const s=Math.round(e.detail.value);t.$.mainSplitter.contains(t.$.resourceSplitter)&&e.target===t.$.resourceVerticalScrollBar?t._refreshTreeSplitterScrollTop(t.$.resourceTreeSplitter,s):(e||t._refreshTreeSplitterScrollTop(t.$.resourceTreeSplitter,s),t._refreshTreeSplitterScrollTop(t.$.taskTreeSplitter,s))}_refreshTreeSplitterScrollTop(e,t){const s=this;if(!s.$.mainSplitter.contains(e))return;const i=e._items,r=e===s.$.taskTreeSplitter?"task":"resource";void 0===t&&(t=s.$[r+"Tree"].$.scrollViewer.scrollTop);for(let e=0;e<i.length;e++){const n=i[e];n===s.$[r+"TreeSplitterItem"]?s.$[r+"Tree"].$.scrollViewer.scrollTop=t:n.getElementsByClassName(`smart-${r}-tree-content`)[0].scrollTop=t}}_recycleHeaderCells(e){const t=this,s=e.children,i=t.scrollLeft,r=e===t.$.timelineViewCells,n=r?t._timelineCells:t._timelineHeaderCells;if(!n.length)return;let a=document.createDocumentFragment();for(;s.length;)a.appendChild(e.firstElementChild);const o=t._getFirstCellObjInView(n),l=1-(o.left+o.width-Math.abs(i))/n[0].width,d=a.children.length,c=r?Math.ceil((parseFloat((t.$.timeline.offsetWidth/o.width).toFixed(2))+l).toFixed(2)):t._getHeaderVisibleCellsCount();if(d>c)for(;a.children.length&&a.children.length!==c;)a.removeChild(a.firstElementChild);else if(d<c){const e=t._createCells(c-d);for(;e.children.length;)a.appendChild(e.firstElementChild)}const m=r?t._getCellsViewType():t.view;let u=n.indexOf(o);for(let e=0;e<a.children.length;e++){const s=a.children[e],i=n[u];if(!i)break;let o=new Date(i.date);r||"week"!==t.view||(o.setDate(o.getDate()-o.getDay()),o=new Date(Math.max(i.date.getTime(),o.getTime()))),s.style[t.rightToLeft?"right":"left"]=i.left+"px",s.style.width=i.width+"px",s._date=o,s.innerHTML=`<div>${t._getDateString(o,m,!r)}</div>`,i.weekend?s.setAttribute("weekend",""):s.removeAttribute("weekend"),i.nonworking?s.setAttribute("nonworking",""):s.removeAttribute("nonworking"),u++}e.appendChild(a)}_refresh(){const e=this;function t(){const t=e.$.taskTimelineCellsContainer.offsetWidth-e.$.timeline.offsetWidth;return t>0&&"hidden"!==e.horizontalScrollBarVisibility||"visible"===e.horizontalScrollBarVisibility?e.$container.addClass("hscroll"):e.$container.removeClass("hscroll"),t}function s(){const t=e.$.taskTimelineCellsContainer.offsetHeight-e.$.timelineContent.offsetHeight;return t>0&&"hidden"!==e.verticalScrollBarVisibility||"visible"===e.verticalScrollBarVisibility?e.$container.addClass("vscroll"):e.$container.removeClass("vscroll"),t}const i=e.scrollWidth,r=e.scrollHeight;let n=t(),a=s();a&&r===a||(n=t()),n&&i===n||(a=s()),e.scrollWidth=n,e.scrollHeight=a,e.$.horizontalScrollBar.refresh(),e.$.verticalScrollBar.refresh(),e.$.mainSplitter.contains(e.$.resourceSplitter)&&(e._refreshResourceScrollBar(),e._refreshTreeSplitterScrollTop(e.$.resourceTreeSplitter))}_refreshProjectTasks(e,t){const s=this,i=e._task;if(!i.tasks||i.tasks instanceof Array&&0===i.tasks.length)return;const r=i.tasks,n=s._tasks.filter((e=>!e.hidden));for(let e=0;e<r.length;e++){const i=s.$.timelineTasksContainer.children[n.indexOf(r[e])];i&&(s.rightToLeft?i.style.right=s.$.timelineContent.offsetWidth-(i.offsetLeft+i.offsetWidth-t)+"px":i.style.left=i.offsetLeft+t+"px",s._refreshTask(i))}}_refreshProject(e){const t=this;function s(e){let s,i,r;if(e instanceof HTMLElement)s=e.offsetLeft,r=e.offsetWidth;else if(e){const n=t._getTimelineTaskCellByDate(e.dateStart),a=t._getTimelineTaskCellByDate(e.dateEnd);n&&a&&(s=n.left+t._getTimelineTaskOffset(n,e.dateStart)||0,i=a.left+t._getTimelineTaskOffset(a,e.dateEnd)||0,r=i-s)}return[s,r]}if(!e)return;if(!e.synchronized)return void t._refreshProject(e.$.project);const i=t._tasks.filter((e=>!e.hidden));for(;e&&e.synchronized;){const r=e.tasks;let n=r[0],a=r[0];for(let e=0;e<r.length;e++)n.dateStart.getTime()>=r[e].dateStart.getTime()&&(n=r[e]),a.dateEnd.getTime()<=r[e].dateEnd.getTime()&&(a=r[e]);const o=t.$.timelineTasksContainer.children,l=o[i.indexOf(e)],d=o[i.indexOf(n)],c=o[i.indexOf(a)],m=t.$.timelineContent.offsetWidth;if(!l){n&&(e.dateStart=n.dateStart),a&&(e.dateEnd=a.dateEnd),e=e.$.project;continue}n&&(e.dateStart=n.dateStart);let[u,f]=s(d||n);void 0!==u&&void 0!==f&&(t.rightToLeft?(l.style.width=l.offsetWidth-(m-u-f-(m-l.offsetLeft-l.offsetWidth))+"px",l.style.right=d?d.style.right:u+"px"):(l.style.width=l.offsetWidth-(u-l.offsetLeft)+"px",l.style.left=d?d.style.left:u+"px")),a&&(e.dateEnd=a.dateEnd),[u,f]=s(c||a),void 0!==u&&void 0!==f&&(t.rightToLeft?l.style.width=l.offsetWidth-(m-l.offsetLeft-(m-u))+"px":l.style.width=l.offsetWidth-(l.offsetLeft+l.offsetWidth-(u+f))+"px"),t._refreshTask(l),e=e.$.project}}_refreshTask(e){const t=this,s=t._getTaskBarCellRange(e),i=s.cellStart,r=s.cellEnd;if(!s||!i||!r)return;e._cellStart=i,e._cellEnd=r;const n=t._getTaskBarDateRange(e);if(!n)return;const a=e._task,o=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._task===a));if(!o)return;o._task.dateStart=a.dateStart=n.dateStart,o._task.dateEnd=a.dateEnd=n.dateEnd,o._task.duration=a.duration=t._convertDuration(t.nonworkingDays.length>0||t.nonworkingHours.length>0?t._getWorkingTime(a.dateStart,a.dateEnd):a.dateEnd.getTime()-a.dateStart.getTime(),!0);const l=e=>e.getFullYear()+"-"+(e.getMonth()<10?"0"+e.getMonth():e.getMonth())+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate());e.setAttribute("aria-label",a.label+" Start date: "+l(a.dateStart)+", End date: "+l(a.dateEnd)),t._refreshTaskConnections(e),t._refreshTreeColumnsData(a,["dateStart","dateEnd","duration"])}_refreshTaskResources(e,t=[]){const s=this;if(e&&(t||(t=s._getTaskResources(e,!0)),t.length))for(let e=0;e<t.length;e++){const i=t[e];s._refreshResource(i),s._refreshTreeColumnsData(i,void 0,"resource")}}_refreshTreeColumnsData(e,t,s){const i=this;s||(s="task");const r=i[`${s}Columns`];function n(e){for(let t=0;t<r.length;t++)if(r[t].value===e)return t}if(!e)return;const a=i.$[`${s}TreeSplitter`];if(!i.$.mainSplitter.contains(a))return;const o=i[`_${s}s`].filter((e=>!e.hidden)).indexOf(e);let l=[];if(t)for(let e=0;e<t.length;e++){const s=n(t[e]);void 0!==s&&l.push(s)}else l=r.map(((e,t)=>t));for(let t=0;t<l.length;t++){const n=a._items[l[t]],d=r[l[t]];let c;n&&(n===i.$[`${s}TreeSplitterItem`]?(c=n.querySelectorAll("smart-tree-item, smart-tree-items-group")[o],c&&(c.label=i._formatColumnData(e,d,!0))):(c=n.getElementsByClassName(`smart-${s}-label-container`)[o],c&&(c.innerHTML=i._formatColumnData(e,d))))}i.$[`${s}TreeSplitter`].refresh()}_removeTreeItem(e,t="task"){const s=this;if(void 0===e)return;const i=s.$[`${t}TreeSplitter`]._items,r=s.$[`${t}Tree`];for(let n=0;n<i.length;n++){const a=i[n];if(a.contains(r))r.removeItem(r.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]);else{const i=a.getElementsByClassName(`smart-${t}-tree-content`)[0],r=s[`${t}Columns`][n];if(!i||!r||!r.value)continue;const o=i.getElementsByClassName(`smart-${t}-item`)[e];o&&o.parentElement.removeChild(o)}}}_removeConnection(e,t){const s=this,i=s.$.connectionPopupWindow,r=i&&i._target===e,n=s.$.timelineConnectionsContainer;if(e.classList&&e.classList.contains("smart-task-connection")?e=e.getAttribute("connection-id"):e+="",void 0===e)return;const a=n.querySelectorAll('.smart-task-connection[connection-id^="'+e+(e.indexOf("-")<0?"-":"")+'"]'),o=s._tasks,l=function(e){const t=s.$.timelineTasksContainer.children,i=s._tasks;for(let s=0;s<t.length;s++)if(t[s]._task===i[e])return t[s]},d=e.split("-"),c=parseInt(d[0]),m=parseInt(d[1]);for(let e=0;e<a.length;e++)n.removeChild(a[e]);const u=l(c),f=l(m);s._updateConnection(e,!0),u&&0===o[c].connections.length&&!o.find((e=>e.connections.find((e=>s._getTaskIndexById(e.target)===c))))&&u.removeAttribute("connected"),f&&0===o[m].connections.length&&!o.find((e=>e.connections.find((e=>s._getTaskIndexById(e.target)===m))))&&f.removeAttribute("connected"),!t&&s.autoSchedule&&(s._autoScheduleRestore(o[m],parseInt(d[2])),s._autoSchedule(o[m])),r&&s.$.fireEvent("itemRemove",{type:"connection",item:{source:d[0],target:d[1],type:d[2]}})}_removeConnectionsToTask(e,t,s){const i=this;if(e){t||(t=i._tasks);for(let r=0;r<t.length;r++){const n=t[r];if(!n.connections||!n.connections.length||s&&s.indexOf(n)>-1)continue;const a=n.connections;for(let t=0;t<a.length;t++)a[t].target===e&&i._removeConnection(r,e)}}}_setConnectionPoints(e){const t=this;let s;if(e&&t._hoveredTimelineTask===e){s=e.getElementsByClassName("smart-task-connection-point");for(let e=0;e<s.length;e++)s[e].classList.remove("smart-visibility-hidden")}else{const e=t.$.taskTimelineCellsContainer.children;for(let t=0;t<e.length;t++){const i=e[t];if(i&&!i.hasAttribute("selected")){s=i.getElementsByClassName("smart-task-connection-point");for(let e=0;e<s.length;e++)s[e].classList.add("smart-visibility-hidden")}}}}_select(e="task",t,s){const i=this;if(i.disableSelection)return void i._unselectAll(e);const r=i[`_${e}s`],n=r.indexOf(t),a=r.filter((e=>!e.hidden)).indexOf(t);if(a<0)return void(n<0&&i._unselectAll(e));const o=i.$[e+"TimelineCellsContainer"].children[a],l=i.$.timelineTasksContainer.children[a];if(o&&o.hasAttribute("selected"))return void i._unselectAll(e);const d=i.selectedIndexes.slice(0);i._unselectAll(e,!0),o&&o.setAttribute("selected",""),"task"===e&&l&&(l.setAttribute("selected",""),l.setAttribute("aria-selected","true"));const c=document.scrollingElement||document.documentElement,m=c.scrollLeft,u=c.scrollTop;i.$[`${e}Tree`].focus({preventScroll:!0}),window.scrollTo(m,u),i.$[`${e}Tree`].select(i.$[`${e}Tree`].querySelectorAll("smart-tree-item, smart-tree-items-group")[a]);const f=i.$[`${e}TreeSplitter`]._items;for(let t=0;t<f.length;t++){const s=f[t];let r;s!==i.$[`${e}TreeSplitterItem`]&&(r=[].slice.call(s.getElementsByClassName(`smart-${e}-label-container`)),r[a]&&r[a].setAttribute("selected",""))}if(i._highlightAssignedItem(e,a),"resource"!==e){if(!s){const e=l._cellStart;if(i.scrollLeft>e.left||e.left+l.offsetWidth>i.scrollLeft+i.$.timeline.offsetWidth){const t=i._timelineCells.indexOf(e);i._scrollTo((i._timelineCells[t-1]?i._timelineCells[t-1]:e).date)}}d[0]!==n&&(i.selectedIndexes=[n],i._noChangeEvent||i.$.fireEvent("change",{value:[n],oldValue:d}))}}_highlightAssignedItem(e,t){const s=this,i=s[`_${e}s`].filter((e=>!e.hidden)),r="task"===e?"resource":"task",n=s.$[`${r}TreeSplitterItem`];let a;a=Array.from(s.$.mainSplitter.querySelectorAll(`.smart-timeline-${r}-cell[assigned], .smart-${r}-label-container[assigned],\n                                  .smart-timeline-${r}[assigned]`)).concat(Array.from(n.querySelectorAll(".smart-tree-item[assigned], smart-tree-items-group[assigned]")));for(let e=0;e<a.length;e++)a[e].removeAttribute("assigned");if(!i.length||s.hideResourcePanel)return;const o=i[t];if(!o||o.hidden)return;const l=s.$[`${r}TreeSplitter`]._items,d=s.$[`${r}TimelineCellsContainer`].children,c=s.$.timelineTasksContainer.children;if(!d.length)return;a=s["resource"===e?"_getResourceTasks":"_getTaskResources"](o).filter((e=>!e.hidden)).map((e=>e.index)),a.forEach((t=>{if(d[t]&&d[t].setAttribute("assigned",""),"resource"===e){const e=c[t];e&&e.setAttribute("assigned","")}}));for(let e=0;e<l.length;e++){const t=l[e];let s;s=t===n?t.querySelectorAll("smart-tree-item, smart-tree-items-group"):t.getElementsByClassName(`smart-${r}-label-container`);for(let e=0;e<a.length;e++)s[a[e]].setAttribute("assigned","")}const m=s[`_${r}s`].filter((e=>!e.hidden));s._ensureVisible(m[a[0]],r)}_selectResource(e){const t=this,s=t._resources.indexOf(e);if(s<0)return void t._unselectAll("resource");const i=t.$.resourceTimelineCellsContainer.children[s];i&&i.hasAttribute("selected")?t._unselectAllTasks():t.$.resourceTree.focus({preventScroll:!0})}_snapToNearest(e){const t=this;if(e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&t.snapToNearest){const s=t._getTaskBarCellRange(e);if(!s)return;const i=s.cellStart,r=s.cellEnd;let n=parseFloat(e.style.width)||e.offsetWidth,a=parseFloat(e.style[t.rightToLeft?"right":"left"])||e.offsetLeft;if(t.hasAttribute("dragged")){const s=r.width-(a+n-r.left);a-i.left<=s?e.style[t.rightToLeft?"right":"left"]=i.left+"px":e.style[t.rightToLeft?"right":"left"]=a+s+"px"}else if(t.hasAttribute("resized")){const s=i===r&&parseFloat(getComputedStyle(t).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;let o;"left"===t.$.timeline.getAttribute("task-bar-hovered")?(o=a-i.left,o-=o>=i.width/2?i.width-s:0,e.style[t.rightToLeft?"right":"left"]=(a-=o)+"px",o=a+n>r.left+r.width/2?r.left+r.width-(a+n):r.left-(a+n),e.style.width=Math.max(s,n+o)+"px"):(a>i.left+i.width/2?e.style[t.rightToLeft?"right":"left"]=i.left+i.width+"px":e.style[t.rightToLeft?"right":"left"]=i.left+"px",a=parseFloat(e.style[t.rightToLeft?"right":"left"])||e.offsetLeft,o=a+n-r.left,o=-1*(o-(o>=i.width/2?r.width:s)),e.style.width=n+o+"px")}t._refreshTask(e);const o=e._task;if("project"!==o.type||!o.dragProject)return;const l=o.tasks;if(!l||!Array.isArray(l))return;for(let e=0;e<l.length;e++){const s=t.$.timelineTasksContainer.children[t._tasks.indexOf(l[e])];s&&t._snapToNearest(s)}}}_setDragLimits(e){const t=this;if(!t._dragDetails)return;const s=t._dragDetails.timelineTask;if(!s||!e)return;const i=t.$.timeline.getAttribute("task-bar-hovered"),r=s._task;if(i){if(r.disableResize)return void delete t._dragDetails;const e=t._getTaskBarSizeLimits(s,i);t._dragDetails.min.width=e.min,t._dragDetails.max.width=e.max;const n=t._createDelimiter("min",i),a=t._createDelimiter("max",i);n&&s.appendChild(n),a&&s.appendChild(a)}else if(e.closest(".smart-task-connection-point"))t._dragDetails.timelineTask=void 0;else if(e.closest(".smart-timeline-task")===s){if(r.disableDrag||s.hasAttribute("connected")&&t.autoSchedule&&t.autoScheduleStrictMode)return void delete t._dragDetails.target;t._dragDetails._taskDuration=t._getWorkingTime(r.dateStart,r.dateEnd),s.classList.contains("milestone")&&(t._dragDetails.target=s.getElementsByClassName("smart-timeline-task-fill")[0]);const e=t._getTaskDragLimits(s),i=t.rightToLeft?t.$.timelineContent.offsetWidth-s.offsetLeft-s.offsetWidth:s.offsetLeft;if(void 0!==e.min&&(t._dragDetails.min.left=e.min,"project"===s._task.type&&e.min>i&&(t._dragDetails.min.left=i)),void 0!==e.max&&(t._dragDetails.max.left=e.max,"project"===s._task.type&&e.max<i&&(t._dragDetails.max.left=i)),"project"===r.type&&r.dragProject&&!t.synchronized){const e=t._getSubTaskLimits(s);void 0!==e.min&&(t._dragDetails.min.left=t._dragDetails.min.left?Math.max(t._dragDetails.min.left,e.min):e.min),void 0!==e.max&&(t._dragDetails.max.left=t._dragDetails.max.left?Math.min(t._dragDetails.max.left,e.max):e.max)}else"milestone"===r.type&&(t._dragDetails.target=s.getElementsByClassName("smart-timeline-task-fill")[0])}else t._dragDetails.timelineTask=void 0;t._dragDetails.relatedConnections={}}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.taskSplitterItem,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,s=e._scrollView.hScrollBar,i=e.$.resourceVerticalScrollBar;s.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),i.$.addClass("smart-hidden"),t.hasStyleObserver=!1,s.hasStyleObserver=!1,i.hasStyleObserver=!1,t.hasResizeObserver=!1,s.hasResizeObserver=!1,i.hasResizeObserver=!1,s.wait=!1,e._refresh()}_getWorkingTime(e,t){if(!e||!t)return;const s=this,i=s.nonworkingHours,r=s.nonworkingDays;function n(e,t){let s,n,a=t.getTime()-e.getTime(),o=new Date(e),l=0;for(;a>0;){const e=Math.min(a,36e5-(60*o.getMinutes()*1e3+1e3*o.getSeconds()+o.getMilliseconds()));if(r.indexOf(o.getDay())>-1)n=new Date(o),n.setHours(0,0,0,0),n.setDate(o.getDate()+1),s=Math.min(e,n.getTime()-o.getTime()),o=new Date(o.getTime()+s),a-=s;else if(i.indexOf(o.getHours())>-1){n=new Date(o);const t=n.getTime();n.setHours(o.getHours()+1,0,0,0),t===n.getTime()&&n.setHours(o.getHours()+2,0,0,0),s=Math.min(e,n.getTime()-o.getTime()),o=new Date(o.getTime()+s),a-=s}else l+=e,a-=e,o=new Date(o.getTime()+e)}return l}if(e.getFullYear()===t.getFullYear())return n(e,t);let a=new Date(e.getFullYear()+1,0,1,0,0,0,0),o=n(e,a);if(t.getFullYear()>a.getFullYear()){const e=Math.max(0,t.getFullYear()-a.getFullYear());for(let t=0;t<e;t++){let e=s._getWorkingDaysBetweenDays(a);o+=60*(24*e-e*s.nonworkingHours.length)*60*1e3,a.setFullYear(a.getFullYear()+1)}}return o+=n(a,t),o}_getWorkingDaysBetweenDays(e){const t=this,s=e.getFullYear(),i=(s%100==0?s%400==0:s%4==0)?366:365;let r=new Date(e),n=0;for(let e=0;e<i;e++)t.nonworkingDays.indexOf(r.getDay())<0&&n++,r.setDate(r.getDate()+1);return n}_setFocusable(){const e=this;e.disabled||e.unfocusable?e.tabIndex=-1:e.tabIndex=e.tabIndex>0?e.tabIndex:0}_setTaskBarLabel(e,t){const s=this,i=s._tasks.filter((e=>!e.hidden)),r=(s.shadowRoot||s).querySelectorAll(".smart-timeline-task")[i.indexOf(e)];if(!r)return;const n=r.getElementsByClassName("smart-timeline-task-label")[0];n&&(n.innerHTML=e.formatFunction?e.formatFunction(e.label,i.indexOf(e))||"":t||e.label)}_setTaskBarProgress(e,t){const s=this;if(t||(t=s.$.timelineTasksContainer.children[s._tasks.filter((e=>!e.hidden)).indexOf(e)]),!t||!e)return;let i=e.progress;const r=t.querySelector(".smart-timeline-task-progress"),n=t.querySelector(".smart-timeline-task-progress-thumb");if(r)if(i=Math.min(100,Math.max(0,i))||0,n.style[s.rightToLeft?"left":"right"]="",n.style[s.rightToLeft?"right":"left"]=r.style.width=i+"%",s.showProgressLabel){const e=s.progressLabelFormatFunction;r.setAttribute("value",e?e(i)+"":parseFloat(i.toFixed(2))+"%")}else r.removeAttribute("value")}_setTimelineTaskBar(e,t){const s=this,i=s._tasks.filter((e=>!e.hidden)).indexOf(e),r=s.$.timelineTasksContainer.children,n=r[i];let a,o;if(0===r.length||!n)return;a=!t&&n._cellStart||s._getTimelineCellByDate(e.dateStart instanceof Date?e.dateStart:new Date(e.dateStart)),o=!t&&n._cellEnd||s._getTimelineCellByDate(e.dateEnd instanceof Date?e.dateEnd:new Date(e.dateEnd)),n._cellStart=a,n._cellEnd=o;const l=s._getTaskBarDetails(n);l&&(n.style.top=l.top+"px",n.style[s.rightToLeft?"left":"right"]="",n.style[s.rightToLeft?"right":"left"]=l.left+"px",n.style.width=l.width+"px"),e.$.project&&!s._isTaskExpanded(e)?n.classList.add("smart-visibility-hidden"):n.classList.remove("smart-visibility-hidden")}_getTimelineCellByDate(e){const t=this,s=t._timelineCells;if(s&&0!==s.length)for(let i=0;i<s.length;i++){const r=s[i],n=r.date;switch(t.view){case"year":if(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth())return r;break;case"month":{const t=new Date(n);let s=new Date(n);if(s.setDate(s.getDate()+(6-s.getDay())+1),s.setMilliseconds(s.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=s.getTime())return r;break}case"week":if(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate())return r;break;case"day":if(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate()&&n.getHours()===e.getHours())return r}}}_refreshViewDetailCell(e,t,s){const i=this,r=i._timelineCells,n=e.date;let a=0,o=0===s?0:void 0;for(void 0===t&&(t=0);t<r.length;t++){const e=r[t],s=i._getCellWidth(e,n);if(s)void 0===o&&(o=e.left+e.width-s),a+=s;else if(e.date.getTime()>n.getTime())break}return i._isLastWeekCellNotFull&&(delete i._isLastWeekCellNotFull,t--),e.width=a,e.left=o,t}_getCellWidth(e,t){const s=this,i=e.date,r=(e,t)=>e.getFullYear()===t.getFullYear(),n=(e,t)=>e.getMonth()===t.getMonth(),a=e.width;switch(s.view){case"month":{let e=new Date(i),o=new Date(e),l=0;for(o.setDate(o.getDate()+(6-e.getDay())+1),o.setMilliseconds(o.getMilliseconds()-1);e.getTime()<=o.getTime();)r(e,t)&&n(e,t)&&l++,e.setDate(e.getDate()+1);if(0===l)return;return s._isLastWeekCellNotFull=l/7!=1,a*l/7}case"year":if(r(i,t))return a;break;case"week":{const e=new Date(t),s=new Date(t);if(e.setDate(t.getDate()-t.getDay()),s.setDate(t.getDate()+(6-t.getDay())),i.getTime()>=e.getTime()&&i.getTime()<=s.getTime())return a;break}case"day":if(r(i,t)&&n(i,t)&&i.getDate()===t.getDate())return a}}_getCellByOffsetLeft(e){const t=this._timelineCells;if(!e)return;let s;for(let i=0;i<t.length&&!(t[i].left>=e);i++)s=t[i];return s}_unselectAll(e,t){const s=this,i=s.$[`${e}TimelineCellsContainer`].querySelectorAll(`.smart-timeline-${e}-cell[selected]`);for(let e=0;e<i.length;e++)i[e].removeAttribute("selected");if("task"===e){const e=s.$.timelineTasksContainer.querySelectorAll(".smart-timeline-task[selected]");for(let t=0;t<e.length;t++)e[t].removeAttribute("selected"),e[t].setAttribute("aria-selected","false")}s[`_${e}TreeChangeEventFired`]||s.$[e+"Tree"].clearSelection();const r=s.$[`${e}TreeSplitter`].getElementsByClassName(`smart-${e}-label-container`);for(let e=0;e<r.length;e++)r[e].removeAttribute("selected");if(s._highlightAssignedItem(e),t||"task"!==e)return;const n=s.selectedIndexes.slice(0);n.length&&(s.selectedIndexes=[],s._noChangeEvent||s.$.fireEvent("change",{value:[],oldValue:n,type:e}))}_getTaskBarCellRange(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;let s=parseFloat(e.style.width)||e.offsetWidth;const i=t._timelineCells,r=t.$.timelineContent,n=parseFloat(e.style[t.rightToLeft?"right":"left"])||(t.rightToLeft?(parseFloat(r.style.width)||r.offsetWidth)-(e.offsetLeft+e.offsetWidth):e.offsetLeft);let a,o;!s&&e.classList.contains("milestone")&&(s=e.offsetHeight/2);for(let e=0;e<i.length;e++){const t=i[e],r=t.left,l=t.width,d=parseFloat((r+l).toFixed(2)),c=parseFloat((n+s).toFixed(2));if(n>=r&&n<=d&&(a=t),!o&&c>r&&c<=d&&(o=t),a&&o)break}return a||(a=e.classList.contains("milestone")&&o?o:i[0]),o||(o=i[i.length-1]),{cellStart:a,cellEnd:o}}_getDateFromCell(e,t,s){if(!t)return new Date;const i=this,r=new Date(t.date);let n,a=0,o=0;switch(s||(s=i.view),s){case"year":n=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),a=1;break;case"month":a=r.getDate(),n=7;break;case"week":n=1,a=r.getDate();break;case"day":n=1/24,a=r.getDate(),o=r.getHours()}const l=parseFloat(((e-t.left)/t.width*n).toFixed(12)),d=Math.min(n,Math.floor(l)),c=l%1*24,m=Math.floor(c),u=60*Math.abs(c-m),f=Math.floor(u),h=60*Math.abs(u-f),g=Math.floor(h),p=1e3*Math.abs(h-g),_=Math.floor(p);return new Date(r.getFullYear(),r.getMonth(),a+d,o+m,f,g,_)}_createTreeTasks(e,t){if(!e)return[];let s=[];for(let i=0;i<e.length;i++){const r={};r.label=e[i][t],e[i].tasks&&(r.items=this._createTreeTasks(e[i].tasks,t)),s.push(r)}return s}_getTasksJSON(e){const t=this;let s,i,r=t._tasks,n="project";return e&&("resource"!==t.view&&void 0!==t._view&&(n="_project",r=t.__tasks.slice(0),s=!0),t.sortable&&t._unsortedTasks&&(r=t._unsortedTasks.slice(0),t._unsortTasks(r),i=!0)),function e(a,o){if(!a)return;let l=[];for(let d=0;d<a.length;d++){const c=a[d];let m;(c.$[n]||o)&&c.$[n]!==o||(m=t._cloneObject(c,!0),m.tasks=e(c.tasks,c),s?(c.disableResources||(m.connections.map((e=>Object.assign({},e))),m.connections.forEach((e=>e.target=t.__tasks.indexOf(t._tasks[t._getTaskIndexById(e.target)])))),m.$._connections&&(m.connections.push.apply(m.connections,m.$._connections),delete m.$._connections)):i&&m.connections.forEach((e=>e.target=r.indexOf(t._tasks[t._getTaskIndexById(e.target)]))),delete m.$,l.push(m))}return l}(r)}_cloneObject(e,t){let s={};for(let i in e){let r=e[i];"tasks"!==i&&("connections"!==i?r instanceof Date?s[i]=t?r.toISOString():new Date(r):s[i]=r:s[i]=JSON.parse(JSON.stringify(r)))}return t||delete s.$,s}_createTreeColumns(e){const t=this,[s,i,r]=e===t.$.taskTreeSplitter?[t._getTasksJSON(),t.taskColumns,"task"]:[t._resources.map((e=>Object.assign({},e))),t.resourceColumns,"resource"],n=e.getElementsByClassName(`smart-${r}-tree-header`);if(!t.contains(e))return;if(i.length>n.length)for(;i.length>n.length;){const t=document.createElement("smart-splitter-item");t.innerHTML=`<div class="smart-${r}-tree-header"></div><div class="smart-${r}-tree-content">`,e.appendChild(t)}else{const t=e.items;for(;n.length>i.length&&1!==n.length;)e.removeChild(t[t.length-1])}if(!i.length)return t.$[r+"Tree"].dataSource=[],void(n[0].innerHTML="");const a=i.find((e=>!0===e.root)),o=i.indexOf(a),l=e._items,d=l.find((e=>e.contains(t.$.taskTree)||e.contains(t.$.resourceTree)));a&&l.indexOf(d)!==o?e.insert(o,d):a||0===l.indexOf(d)||e.insert(0,d);const c=i.length,m=parseFloat(getComputedStyle(t).getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0);for(let e=0;e<c;e++){const a=i[e],o=n[e],l=o.closest("smart-splitter-item");if(o.innerHTML=`<div>${t.localize(a.label)||a.label}</div>`,l&&!t[`_${r}SplitterItemSizeSet`]){a.size&&(t.shadowRoot?requestAnimationFrame((()=>l.size=a.size)):l.size=a.size),l.min=a.min?a.min:m,l.max=a.max?a.max:l.max,l.locked=a.locked?a.locked:l.locked;const e=l.nextElementSibling||l.previousElementSibling;e&&(a.hideResizeBar?e.hide():e.show())}t._createTreeColumnsData(l,a,s.filter((e=>!e.hidden)),r)}const u=e.closest("smart-splitter");u.isCompleted&&(u.refresh(),"auto"===t.treeSize&&t._resizeEventHandler()),t[`_${r}SplitterItemSizeSet`]=!0,t._setColumnHeadersSorting(r),t._refresh()}_refreshColumnsHeaders(e){const t=this;e||(e="task");const s=t[`${e}Columns`],i=t.$[`${e}TreeSplitter`].getElementsByClassName(`smart-${e}-tree-header`);for(let e=0;e<i.length;e++)i[e].innerHTML=`<div>${t.localize(s[e].label)||s[e].label}</div>`;!arguments.length&&t.$.mainSplitter.contains(t.$.resourceSplitter)&&t._refreshColumnsHeaders("resource")}_createTreeColumnsData(e,t,s,i){const r=this;function n(e,s){if(e.tasks&&(e.tasks=e.tasks.filter((e=>!e.hidden)),e.tasks.forEach((e=>n(e)))),!e.hidden)return e[t.value]=r._formatColumnData(e,t,!0),s?e:void 0}if(!e)return;i||(i="task");const a=t.value,o=e.querySelector("smart-tree");if(o){if(a){o.itemsMember=i+"s",o.displayMember=t.value;const e=s.map((e=>n(e,!0))).filter((e=>void 0!==e));e.length&&o.set("dataSource",[]),o.dataSource=e,r._unfocusTreeItems(o===r.$.taskTree?r.$.taskTreeSplitter:r.$.resourceTreeSplitter)}else o.dataSource=[];return void(o.$.scrollViewer.scrollTop="task"===i?r.scrollTop:r.$.resourceVerticalScrollBar.value)}const l=e.getElementsByClassName(`smart-${i}-tree-content`)[0];l&&(l.innerHTML="",a&&l.appendChild(r._createTreeItemContainers(s,t,i)))}_createTreeItemContainers(e,t,s){const i=this,r=document.createDocumentFragment();for(let n=0;n<e.length;n++){const a=e[n],o=document.createElement("div");o.innerHTML=`<div class="smart-${s}-label-container"></div>`,o.firstElementChild.innerHTML=i._formatColumnData(a,t),a.tasks&&a.tasks.length>0&&(o.setAttribute("group",""),o.innerHTML+=`<div class="smart-${s}-drop-down ${a.expanded?"":"smart-visibility-hidden"}"></div>`,o.lastElementChild.appendChild(i._createTreeItemContainers(a.tasks,t,s))),o.classList.add(`smart-${s}-item`),o.id||o.setAttribute("id",`${s}Item`+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),r.appendChild(o)}return r}_formatColumnData(e,t,s){const i=this;let r=i.taskColumns.includes(t)?"task":"resource";r="task"===r?i._unsortedTasks?"unsortedTask":r:i._unsortedResources?"unsortedResource":r;let n=e[t.value];function a(e){return s?e:"<span>"+e+"</span>"}if("function"==typeof t.formatFunction)return t.formatFunction.call(i,t.value.toLowerCase().indexOf("date")>-1?new Date(n):n,i._getItemIndex(e,r));if(t.value){const s=(t.value+"").toLowerCase();if(s.indexOf("date")>-1){const e=Date.parse(n);if(!isNaN(e))return a(new Intl.DateTimeFormat(i.locale,{year:"numeric",month:"2-digit",day:"numeric"}).format(new Date(e)))}else{if(s.indexOf("duration")>-1)return a(parseFloat(n.toFixed(1)));if("resources"===s){if(e.disableResources)return"";Array.isArray(n)||(n=[n].reduce(((e,t)=>e.concat(t)),[]));let t=[];for(let e=0;e<n.length;e++){const s=i._resources.find((t=>t.id&&t.id.toString()===n[e].toString()));s&&void 0!==s.label&&t.push(s.label)}n=t.length?t:void 0}}}return a(void 0!==n?n.toString():i.localize("unassigned"))}_validateTaskProperties(e,t){const s=this;function i(e,t){return e[t]=s._dateValidator(void 0,e[t]),e[t]&&!isNaN(e[t].getTime())||(e[t]=void 0),e[t]}void 0===e.id&&delete e.id,e.$||(e.$={});let r=s._convertDuration(parseInt(e.duration))||0,n=s._convertDuration(parseInt(e.minDuration))||0,a=s._convertDuration(parseInt(e.maxDuration))||0;if(n&&a&&(a=Math.max(n,a)),void 0===e.hidden&&t&&(e.hidden=t.hidden),e.hidden=!!e.hidden,r&&(n?r=Math.max(n,r):a&&(r=Math.min(r,a))),void 0===e.resources?e.resources=[]:e.resources=[e.resources].reduce(((e,t)=>e.concat(t)),[]),e.duration=s._convertDuration(r,!0),e.minDuration=s._convertDuration(n,!0),e.maxDuration=s._convertDuration(a,!0),e.minDateStart=i(e,"minDateStart"),e.maxDateStart=i(e,"maxDateStart"),e.minDateStart&&e.maxDateStart&&(e.maxDateStart=new Date(Math.max(e.minDateStart.getTime(),e.maxDateStart.getTime()))),e.minDateEnd=i(e,"minDateEnd"),e.maxDateEnd=i(e,"maxDateEnd"),e.minDateEnd&&e.maxDateEnd&&(e.maxDateEnd=new Date(Math.max(e.minDateEnd.getTime(),e.maxDateEnd.getTime()))),e.dateStart=i(e,"dateStart"),e.dateEnd=i(e,"dateEnd"),e.dateStart||(e.minDateStart?e.dateStart=e.minDateStart:e.maxDateStart?e.dateStart=e.maxDateStart:e.dateStart=s.dateStart),e.dateEnd||(e.minDateEnd?e.dateEnd=e.minDateEnd:e.maxDateEnd&&(e.dateEnd=e.maxDateEnd)),e.minDateStart&&(e.dateStart=new Date(Math.max(e.minDateStart.getTime(),e.dateStart.getTime()))),e.maxDateStart&&(e.dateStart=new Date(Math.min(e.maxDateStart.getTime(),e.dateStart.getTime()))),e.minDateEnd&&(e.dateEnd=new Date(Math.max(e.minDateEnd.getTime(),e.dateEnd.getTime()))),e.maxDateEnd&&(e.dateEnd=new Date(Math.min(e.maxDateEnd.getTime(),e.dateEnd.getTime()))),e.dateStart&&(s.min&&(r=Math.min(e.dateStart.getTime()-s.min.getTime(),r)),s.max&&(r=Math.min(s.max.getTime()-e.dateStart.getTime(),r))),!e.dateStart&&r&&e.dateEnd&&(e.dateStart=new Date(e.dateEnd.getTime()-r)),"task"!==e.type||e.dateStart&&!isNaN(e.dateStart.getTime())||!t||(e.dateStart=new Date(t.dateStart)),n&&e.dateStart)if(s.nonworkingDays.length>0||s.nonworkingHours.length>0){const t=s._getTaskWorkingDateEnd(e,n);e.dateEnd=new Date(Math.max(e.dateEnd?e.dateEnd.getTime():0,t.getTime()))}else e.dateEnd=new Date(Math.max(e.dateEnd?e.dateEnd.getTime():0,e.dateStart.getTime()+r));if(r&&e.dateStart&&(e.dateEnd=s.nonworkingDays.length>0||s.nonworkingHours.length>0?s._getTaskWorkingDateEnd(e,r):new Date(e.dateStart.getTime()+r)),r||a){let t;t=s.nonworkingDays.length>0||s.nonworkingHours.length>0?s._getTaskWorkingDateEnd(e,Math.max(r,a)):new Date(e.dateStart.getTime()+Math.max(r,a)),e.dateEnd.getTime()>t.getTime()&&(e.dateEnd=t)}if("task"===e.type&&!e.dateEnd&&t&&(e.dateEnd=new Date(t.dateEnd)),e.dateStart=s._minMaxDateValidator(e.dateStart),e.dateEnd=s._minMaxDateValidator(e.dateEnd),"milestone"===e.type&&(e.dateStart=i(e,"dateStart"),e.dateEnd=i(e,"dateEnd"),e.dateStart=e.dateEnd=new Date(Math.max(e.dateStart?e.dateStart.getTime():0,e.dateEnd?e.dateEnd.getTime():0))),t&&s._synchronizeProjectDates(t,e),void 0!==e.expanded&&(e.expanded=!!e.expanded),e.progress=Math.min(Math.max(0,parseFloat(e.progress)||0),100),!e.dateStart&&!e.dateEnd&&"project"===e.type&&!e.synchronized)return;"milestone"!==e.type&&e.dateStart&&(e.dateEnd&&e.dateStart.getTime()>e.dateEnd.getTime()||!e.dateEnd)&&(e.dateEnd=new Date(e.dateStart.getTime()+36e5*("day"===s.view?1:24))),e.dateStart&&e.dateEnd&&(e.duration=s._convertDuration(s.nonworkingDays.length>0||s.nonworkingHours.length>0?s._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0));const o=e.connections;if(o instanceof Array){for(let e=0;e<o.length;e++){const t=o[e],s=t.target="string"==typeof t.target?t.target:parseInt(t.target),i=t.type=parseInt(t.type);null==s||"number"==typeof s&&isNaN(s)||isNaN(i)?(o.splice(o.indexOf(t),1),e--):t.lag=parseInt(t.lag)||0}e.connections=e.connections.map((e=>Object.assign({},e)))}else e.connections=[];return e.class=e.class?e.class+"":"",e.class=void 0!==e.class&&null!==e.class?e.class:"",e}_synchronizeProjectDates(e,t){const s=this;function i(s,i){const r=e.tasks;let n=t[s];if(r)for(let e=0;e<r.length;e++){const t=r[e][s];t instanceof Date&&(n=new Date(Math[i](t.getTime(),n.getTime())))}return new Date(n)}e&&(e.synchronized&&(t.dateStart&&(e.dateStart=i("dateStart","min")),t.dateEnd&&(e.dateEnd=i("dateEnd","max")),t.minDateStart&&(e.minDateStart=i("minDateStart","max")),t.maxDateStart&&(e.maxDateStart=i("maxDateStart","min")),t.minDateEnd&&(e.minDateEnd=i("minDateEnd","max")),t.maxDateEnd&&(e.maxDateEnd=i("maxDateEnd","min")),e.dateStart&&e.dateEnd&&(e.duration=s._convertDuration(s.nonworkingDays.length>0||s.nonworkingHours.length>0?s._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0))),e.$&&s._synchronizeProjectDates(e.$.project,t))}_synchronizeProjectVisibility(e,t){const s=this;e&&e.hidden&&!t.hidden&&(e.hidden=t.hidden,e.$&&s._synchronizeProjectVisibility(e.$.project,e))}_mouseWheelHandler(e){const t=this,s=(t.shadowRoot||t).querySelector(".smart-task-popup-window");s&&s.modal&&s.opened?e.stopPropagation():t.disabled||!t.computedHorizontalScrollBarVisibility&&!t.computedVerticalScrollBarVisibility||(e.shiftKey?t._handleHorizontalScroll():t.$.resourceSplitterItem.contains(e.target)?t._handleVerticalScroll(!0):t.$.taskSplitterItem.contains(e.target)&&t._handleVerticalScroll())}_handleVerticalScroll(e){const t=this;let s,i,r,n;if(e){if(s=t.$.resourceVerticalScrollBar,s.classList.contains("smart-hidden"))return!0;i=s.value,r=s.max,n=t._resourceScrollView}else{if(!t.computedVerticalScrollBarVisibility)return!0;i=t.scrollTop,r=t.scrollHeight,n=t}0===i&&event.deltaY<0||i===r&&event.deltaY>0?event.stopPropagation():(event.stopPropagation(),event.preventDefault(),n.scrollTo(i+t._getScrollCoefficient(event,t.offsetHeight)))}_handleHorizontalScroll(){const e=this;if(!e.computedHorizontalScrollBarVisibility)return!0;const t=e.scrollLeft;(0===t&&event.deltaX<0||t===e.scrollHeight&&event.deltaX>0)&&event.stopPropagation(),event.stopPropagation(),event.preventDefault(),e.scrollWidth>0&&e.scrollTo(void 0,e.scrollLeft+e._getScrollCoefficient(event,e.offsetWidth))}_handleHeaderTemplate(e="task"){const t=this;if(!("content"in document.createElement("template")))return void t.error(t.localize("htmlTemplateNotSuported",{elementType:t.nodeName.toLowerCase()}));const s=t.$[`${e}SplitterItemHeader`],i=t.$[`${e}SplitterItem`],r="task"===e?"headerTemplate":"resourcePanelHeaderTemplate";let n=t[r];if(i.removeAttribute("show-header"),s.innerHTML="",!n)return;if("function"==typeof n)return n(s,{}),void(s.innerHTML?i.setAttribute("show-header",""):i.removeAttribute("show-header"));if("string"==typeof n&&(n=document.getElementById(n)),null===n||!("content"in n))return void t.error(t.localize("invalidTemplate",{elementType:t.nodeName.toLowerCase(),property:r}));let a=document.importNode(n.content,!0);if(i.setAttribute("show-header",""),t.shadowRoot)return s.innerHTML="<slot></slot>",void t.appendChild(a);s.appendChild(a)}_horizontalScrollbarHandler(e){const t=this;e.stopPropagation&&e.stopPropagation(),t.$.timeline.scrollLeft=t.$.resourceTimeline.scrollLeft=t._getScrollLeft(e.detail.value),t._recycle(e)}_verticalScrollbarHandler(e){const t=this;e.stopPropagation&&e.stopPropagation(),e.target===t.$.resourceVerticalScrollBar?t.$.resourceTimelineContent.scrollTop=Math.round(e.detail.value):t.$.timelineContent.scrollTop=Math.round(e.detail.value),t._recycle(e),e.context.max!==e.context.value?e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"):t.$.fireEvent("scrollBottomReached")}sort(e){const t=this;if(!t.sortable)return;Array.isArray(e)||(e="object"==typeof e?[e]:[]);const s=t.taskColumns,i=t.resourceColumns;s.forEach((e=>delete e.sort)),i.forEach((e=>delete e.sort));for(let t=0;t<e.length;t++){const r=e[t],n=("resource"===r.type?i:s).find((e=>r.value&&e.value===r.value));if(!n)continue;let a=r.sortOrder;"number"!=typeof a&&(a=parseInt(a+""),a=isNaN(a)?void 0:a),n.sort="desc"===r.direction?"desc":"asc",void 0!==a&&(n.sortOrder=a)}t._sortTasks(),t._sortResources()}_sortTasks(e){const t=this;if(!t.sortable&&!t._unsortedTasks)return;const s=!!t._unsortedTasks,i=t.selectedIndexes.map((e=>t._tasks[e]));if(t._unsortTasks(),"resource"!==t.view&&void 0!==t._view){t._refreshTimeline();const e=t.selectedIndexes;return i.every((s=>e.includes(t._tasks.indexOf(s))))||(t.set("selectedIndexes",i.map((e=>t._tasks.indexOf(e)))),t._applySelection()),void t._createResourceTimeline()}if(t._sortItems("task"),!s&&!t._unsortedTasks)return;t.$.timelineTasksContainer.innerHTML="",delete t._hoveredTimelineTask,t.$.timelineConnectionsContainer.innerHTML="",e||(t._noChangeEvent=!0,t._unselectAll("task"),t._createTreeColumns(t.$.taskTreeSplitter),t._createTimeline(),t.$.resourceTimelineCellsContainer.children.length&&(t._resources.forEach((e=>t._refreshResourceTimelineContent(e))),t._highlightAssignedItem("resource",t._resources.indexOf(t._getItemByTreeIndex("resource",t.$.resourceTree.selectedIndexes[0])))),t.taskColumns.length||t._setColumnHeadersSorting("task"),delete t._noChangeEvent);const r=t.selectedIndexes;i.every((e=>r.includes(t._tasks.indexOf(e))))||(t.set("selectedIndexes",i.map((e=>t._tasks.indexOf(e)))),t._applySelection())}_sortResources(e){const t=this;if(!t.sortable&&!t._unsortedResources)return;const s=!!t._unsortedResources,i=t.$.resourceTree.selectedIndexes.map((e=>t._getItemByTreeIndex("resource",e)));if(t._unsortResources(),t._sortItems("resource"),(s||t._unsortedResources)&&(delete t._hoveredTimelineResource,!e)){const e=t._resourceAPIManipulation;t._resourceAPIManipulation=!0,t.$.resourceTree.selectedIndexes=[],t._createResourceTimeline(),i.length&&t._select("resource",i[0]),t._resourceAPIManipulation=e,t.resourceColumns.length||t._setColumnHeadersSorting("resource")}}_setColumnHeadersSorting(e){const t=this,s=t.$[`${e}TreeSplitter`];if(!t.$.mainSplitter.contains(s))return;const i=s.items,r=t[`${e}Columns`],n=r.filter((e=>e.sort));if(i.forEach((e=>e.removeAttribute("sort"))),t.sortable)for(let e=0;e<n.length;e++)if(i[r.indexOf(n[e])].setAttribute("sort",n[e].sort),"one"===t.sortMode)return}_unsortTasks(e=this._unsortedTasks){const t=this,s=arguments[0];if(!e)return;let i;"resource"!==t.view&&void 0!==t._view&&t.__tasks&&(i=!0,s||t._restoreTaskFromResourceView()),s||(e.forEach((s=>s.connections.forEach((s=>s.target=e.indexOf(t._tasks[t._getTaskIndexById(s.target)]))))),t._tasks=e);const r=e.filter((e=>e.tasks)),n=s&&i?"_project":"project";r.forEach((t=>t.tasks=e.filter((e=>e.$[n]===t))));for(let e=0;e<r.length;e++){const t=r[e];let s=t.$.project;for(;s;)s.tasks.indexOf(t)>-1&&Array.prototype.splice.apply(s.tasks,[s.tasks.indexOf(t)+1,0].concat(t.tasks)),s=s.$.project}s||delete t._unsortedTasks}_unsortResources(){const e=this;e._unsortedResources&&(e._resources=e._unsortedResources,delete e._unsortedResources)}_sortItems(e="task"){const t=this;if(!t.sortable)return;const s=t[`_${e}s`];if(!s)return;const i=s.filter((e=>!e.$.project));if(!i.length)return;let r=[];const n=t[`${e}Columns`];for(let e=0;e<n.length;e++){const s=n[e];if(s.sort){if(r.push(s),"one"===t.sortMode)break;s.sortOrder||(s.sortOrder=0)}}if(!r.length)return void("task"===e?t._unsortTasks():t._unsortResources());const a=i[0];let o=[];const l=r.map((e=>{const t=e.value,s=parseInt(e.sortOrder+"");let i="";return"number"==typeof a[t]?i="number":a[t]instanceof Date&&(i="date"),e.sort="desc"===e.sort?"desc":"asc",{value:t,type:i,direction:e.sort,order:isNaN(s)?0:s}})).sort(((e,t)=>t.order-e.order)),d=e=>{t._applySorting(e,l);let s=e.slice(0);for(let t=0;t<e.length;t++){const i=e[t];i.tasks&&(i.tasks=d(i.tasks.filter((e=>e.$.project===i))),Array.prototype.splice.apply(s,[s.indexOf(i)+1,0].concat(i.tasks)))}return s};t._applySorting(i,l);for(let e=0;e<i.length;e++){const t=i[e];t.$.project||(o.push(t),t.tasks&&(t.tasks=d(t.tasks.filter((e=>e.$.project===t))),o=o.concat(t.tasks)))}if("resource"===e)return t._unsortedResources=t._resources,void(t._resources=o);t._unsortedTasks=t.__tasks||t._tasks,o.forEach((e=>e.connections.forEach((e=>e.target=o.indexOf(t._tasks[t._getTaskIndexById(e.target)]))))),t._tasks=o}_applySorting(e,t=[]){const s=(e,t,s,i)=>"date"===i?e[s].getTime()-t[s].getTime():"number"===i?e[s]-t[s]:(e[s]+"").localeCompare(t[s]+"");e.sort(((e,i)=>{let r=0;for(let n=0;n<t.length&&(r="asc"===t[n].direction?s(e,i,t[n].value,t[n].type):s(i,e,t[n].value,t[n].type),0===r);n++);return r}))}});