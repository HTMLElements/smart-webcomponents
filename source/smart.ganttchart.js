
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-gantt-chart",class extends Smart.ScrollViewer{static get properties(){return{autoSchedule:{value:!1,type:"boolean"},autoScheduleStrictMode:{value:!1,type:"boolean"},autoScrollStep:{value:5,type:"number"},dataExport:{value:{header:{value:!0,type:"boolean"},style:{value:null,type:"object"},fileName:{value:"smartGanttChart",type:"string?"},pageOrientation:{value:"portrait",type:"string"},expandChar:{value:"+",type:"string"},collapseChar:{value:"-",type:"string"}},type:"object"},dataSource:{value:[],type:"any",reflectToAttribute:!1},dayFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},dateEnd:{value:"",type:"any",validator:"_dateValidator"},dateStart:{value:"",type:"any",validator:"_dateValidator"},disableAutoScroll:{value:!1,type:"boolean"},durationUnit:{value:"milisecond",allowedValues:["day","week","hour","minute","second","milisecond"],type:"string"},inverted:{value:!1,type:"boolean"},messages:{extend:!0,value:{en:{incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",outOfBounds:"{{elementType}}: Out of bounds argument {{argumentName}} in method {{methodName}}.",missingReference:"{{elementType}}: Missing reference to {{file}} in method {{methodName}}.",noId:"smartGanttChart requires an id in order to save/load/clear a state.",ok:"Ok",cancel:"Cancel",delete:"Delete",confirm:"{{componentName}} will be deleted permanently, <b>are you sure? </b>",columnLabel:"Task Name",deleteLink:"Delete link"}},type:"object"},monthFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},nonworkingDays:{value:[],type:"array"},nonworkingHours:{value:[],type:"array"},popupWindowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"},resizeHandlesVisibility:{allowedValues:["auto","hidden","visible"],value:"auto",type:"string"},selectedIndexes:{value:[],type:"array"},snapToNearest:{value:!1,type:"boolean"},taskColumns:{value:[{label:"columnLabel",value:"label"}],type:"array",reflectToAttribute:!1},timelineMin:{value:200,type:"any"},treeMin:{value:100,type:"any"},treeSize:{value:"20%",type:"any"},hourFormat:{value:"default",allowedValues:["default","2-digit","numeric"],type:"string"},timelineHeaderFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},verticalScrollBarVisibility:{type:"string",value:"auto",allowedValues:["auto","disabled","hidden","visible"]},view:{value:"year",allowedValues:["day","week","month","year"],type:"any"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},weekFormat:{value:"long",allowedValues:["long","numeric"],type:"string"}}}template(){return`<div id="container" role="presentation">
                    <smart-splitter id="mainSplitter" auto-fit-mode="end" keep-proportions-on-resize right-to-left="[[rightToLeft]]">
                        <smart-splitter-item id="treeSplitterItem" class="smart-task-tree-splitter-item" min="[[treeMin]]">
                            <smart-splitter id="treeSplitter" auto-fit-mode="end" class="smart-task-tree-splitter" unfocusable right-to-left="[[rightToLeft]]">
                                <smart-splitter-item id="taskTreeSplitterItem">
                                    <div class="smart-task-tree-header"></div>
                                    <div class="smart-task-tree-content">
                                        <smart-tree id="taskTree" selection-mode="zeroOrOne" overflow="hidden" toggle-mode="arrow" 
                                            aria-controls="[[id]]" right-to-left="[[rightToLeft]]">
                                        </smart-tree>
                                    </div>
                                </smart-splitter-item>                               
                            <smart-splitter>
                        </smart-splitter-item>
                        <smart-splitter-item id="timelineSplitterItem" class="smart-timeline-splitter-item" min="[[timelineMin]]">
                                <div id="timeline" class="smart-timeline">
                                    <div id="timelineContainer" class="smart-timeline-container" role="presentation">
                                        <div id="timelineHeader" class="smart-timeline-header" role="rowgroup">
                                            <div class="smart-timeline-view-details" id="timelineViewDetails" role="row"></div>
                                            <div class="smart-timeline-view-cells" id="timelineViewCells" role="row"></div>
                                        </div>
                                        <div id="timelineContent" class="smart-timeline-content">
                                            <div id="timelineCellsContainer" class="smart-timeline-cells-container" aria-hidden="true"></div>
                                            <div id="timelineConnectionsContainer" class="smart-timeline-connections-container" role="group"></div>
                                            <div id="timelineTasksContainer" class="smart-timeline-tasks-container" role="group"></div>
                                        </div>
                                        <div id="timelineAnimationContainer" class="smart-timeline-animation-container smart-visibility-hidden" aria-hidden="true">
                                            <div class="smart-timeline-animation-inner-container">
                                                <div><div></div><div></div></div><div><div></div><div></div></div><div><div></div><div></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <smart-scroll-bar id="verticalScrollBar" class="smart-timeline-scroll-bar" orientation="vertical">
                                    right-to-left="[[rightToLeft]]" aria-controls="[[id]]" 
                                </smart-scroll-bar>
                        </smart-splitter-item>
                    </smart-splitter>
                    <smart-scroll-bar wait right-to-left="[[rightToLeft]]" id="horizontalScrollBar" class="smart-timeline-scroll-bar"></smart-scroll-bar>
                </div>`}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.wheel":"_mouseWheelandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler","mainSplitter.resizeEnd":"_resizeEventHandler",move:"_moveHandler",resize:"_resizeEventHandler","taskTree.change":"_taskTreeChangeHandler","taskTree.collapse":"_taskTreeExpandHandler","taskTree.expand":"_taskTreeExpandHandler","taskTree.blur":"_taskTreeBlurHandler","timelineAnimationContainer.transitionend":"_timelineAnimationContainerTransitionendHandler"}}static get styleUrls(){return["smart.ganttchart.css"]}attached(){const e=this;super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];for(let a=0;a<t.length;a++){const i=t[a];e.$[i]&&e.$[i].opened&&(e._handleModal(!0),e["$"+i].listen("close",e._popupWindowCloseHandler.bind(e)),e["$"+i].listen("closing",e._popupWindowClosingHandler.bind(e)),e["$"+i].listen("open",e._popupWindowOpenHandler.bind(e)),e["$"+i].listen("click",e._popupWindowClickHandler.bind(e)),e["$"+i].listen("transitionend",e._popupWindowTransitionendHandler.bind(e)),document.body.appendChild(e.$[i]))}}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView);const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];e._handleModal();for(let a=0;a<t.length;a++){const i=t[a];e.$[i]&&e.$[i].parentElement&&e.$[i].parentElement.removeChild(e.$[i]),e["$"+i]&&(e["$"+i].unlisten("open"),e["$"+i].unlisten("close"),e["$"+i].unlisten("closing"),e["$"+i].unlisten("transitionend"))}}propertyChangedHandler(e,t,i){const a=this;switch(e){case"autoSchedule":i?a._autoSchedule():a._autoScheduleRestore();break;case"autoScheduleStrictMode":i&&(a._autoSchedule(),a._refreshTimeline(a.view));break;case"dataSource":a.$.mainSplitter._resizeEventHandler(),a._createTasks(),a._createTaskColumns(),a._createTimeline(),a._setAriaControls(),a._refresh();break;case"durationUnit":for(let e=0;e<a._tasks.length;e++){const t=a._tasks[e];a._validateTaskProperties(t,t.project)}a._createTimelineCells();for(let e=0;e<a._tasks.length;e++){const t=a._tasks[e];a._setTimelineTaskBar(t,!0),a._refreshTaskConnections(t)}break;case"inverted":a._handleInverted(),a.scrollLeft&&(a.$.timeline.scrollLeft=a._getScrollLeft(a.scrollLeft));break;case"rightToLeft":a._handleInverted(),a._refreshTimeline(),a._tasks.forEach(e=>a._setTaskBarProgress(e));break;case"dateStart":case"dateEnd":case"nonworkingDays":case"nonworkingHours":a._refreshTimeline();break;case"messages":case"locale":case"dayFormat":case"hourFormat":case"timelineHeaderFormatFunction":case"monthFormat":case"yearFormat":a._refreshHeaderDate(),a._refreshColumnsHeaders();break;case"selectedIndexes":a._applySelection(t);break;case"taskColumns":a._createTaskColumns();break;case"timelineMin":a.$.timelineSplitterItem.min=i,a.$.treeSplitter.refresh();break;case"treeMin":a.$.treeSplitterItem.min=i,a.$.treeSplitter.refresh();break;case"treeSize":a.$.treeSplitterItem.size=i,a.$.treeSplitter.refresh();break;case"unfocusable":a._setFocusable();break;case"view":a._refreshTimeline(t);break;default:super.propertyChangedHandler(e,t,i);}}_predefPropertyGetter(e){const t=this;Object.defineProperty(t,e,{get:function(){const i=t._timelineCells;return i.length?new Date("dateStart"===e?i[0].date:i[i.length-1].date):void t.properties[e].value},set(i){t.updateProperty(t,t._properties[e],i)}})}ready(){super.ready()}render(){const e=this;e.setAttribute("role","treegrid"),e._predefPropertyGetter("dateStart"),e._predefPropertyGetter("dateEnd"),e.shadowRoot?requestAnimationFrame(()=>e.$.treeSplitterItem.size=e.treeSize):e.$.treeSplitterItem.size=e.treeSize,e.rightToLeft||e.$.verticalScrollBar.removeAttribute("right-to-left"),e.$.taskTree._ensureVisibleCallback=e._ensureVisible.bind(e),e.$.taskTree._hoverViaKeyboardCallback=e._hoverViaKeyboardCallback.bind(e),e.$.taskTree._waitAnimation=!0,e.$.taskTree.$.scrollViewer._scrollView.disableSwipeScroll=!0,e.$.taskTree.$.scrollViewer.disabled=!0,e._setScrollBars(),e.$.treeSplitter.refresh(),e._handleInverted(!0),e._createTasks(),e._createTaskColumns(),e._createTimeline(),e._applySelection(),e._setAriaControls(),e._setFocusable(),e.checkLicense(),e.shadowRoot&&requestAnimationFrame(()=>e.refresh()),super.render()}_setAriaControls(){function e(e){const a=t.$.timelineTasksContainer.children;for(let n=0;n<e.length;n++){let i,s=e[n];s.path?i=a[t._tasks.indexOf(t._getTaskByTreeIndex(s.path))]:(i=a[t._getTaskItemIndex(s)],s=s.parentElement),i&&(s.setAttribute("aria-controls",i.id),i.setAttribute("aria-controls",((i.getAttribute("aria-controls")||"")+" "+(s.id||"")).trim()))}}const t=this,a=t.$.treeSplitter._items;for(let n=0;n<a.length;n++){const i=a[n];let s;if(t.$.taskTreeSplitterItem===i)s=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group");else{const e=i.querySelector(".smart-task-tree-content");if(!e)continue;s=e.querySelectorAll(".smart-task-label-container")}e(s)}}refresh(){this._resizeEventHandler()}static get requires(){return{"Smart.Splitter":"smart.splitter.js","Smart.Tree":"smart.tree.js","Smart.Window":"smart.window.js"}}ensureVisible(e){const t=this,i=t._tasks;if(void 0!==e&&null!==e&&i.length){if("number"==typeof e)e=i[e];else if("string"==typeof e)e=t._tasks.indexOf(t._getTaskByTreeIndex(e));else return;e&&(t._ensureVisible(e),t._scrollTo(e.dateStart))}}removeAllConnections(){const e=this;e.isCompleted&&(e.$.timelineConnectionsContainer.innerHTML="",e._tasks.map(e=>e.connections=[]))}removeConnection(){const e=this;if(!e.isCompleted)return;let t;if(1===arguments.length){if("string"==typeof arguments[0]){const e=document.getElementById(arguments[0]);e&&(t=e.getAttribute("connection-id"))}t||(t=(arguments[0]+"").split("-"),t=e._getValidConnectionId(t[0],t[1],t[2],"removeConnection"))}else 3===arguments.length&&(t=e._getValidConnectionId(arguments[0],arguments[1],arguments[2],"removeConnection"));t&&e._removeConnection(t)}removeTaskConnection(e,t){const i=this;if(i.isCompleted){if(e+="",-1<e.indexOf("-")&&!t){const i=e.split("-");t=i[1],e=i[0]}return e=i._getTaskIndexById(e),t=i._getTaskIndexById(t),isNaN(e)?void i.error(i.localize("incorrectArgument",{elementType:i.nodeName.toLowerCase(),methodName:"removeTaskConnection",argumentName:"taskEndIndex"})):void i._removeConnection(""+e+(isNaN(t)?"":t))}}clearTasks(){const e=this;e._tasks=[],e._timelineCells=[],e._timelineHeaderCells=[],e.$.timelineContent.style.width=e.$.timelineAnimationContainer.style.width="",e.$.container.style.removeProperty("--smart-gantt-chart-timeline-content-height"),e.$.timelineViewDetails.innerHTML="",e.$.timelineViewCells.innerHTML="",e.$.timelineCellsContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="";const t=e.$.treeSplitter._items;for(let a=0;a<t.length;a++){const i=t[a];if(i===e.$.taskTreeSplitterItem)e.$.taskTree.dataSource=[];else{const e=i.getElementsByClassName("smart-task-tree-content")[0];e&&(e.innerHTML="")}}e._refresh()}createConnection(){const e=this,t=e._tasks;let i;e.isCompleted&&0!==t.length&&(1===arguments.length?i=(arguments[0]+"").split("-"):3===arguments.length&&(i=arguments),i=e._getValidConnectionId(i[0],i[1],i[2],"createConnection"),i&&e._connectTask(i))}collapse(e){const t=this;return"number"==typeof e&&(e=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]),void 0===e?void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"collapse",argumentName:"taskIndex"})):void t.$.taskTree.collapseItem(e instanceof Smart.TreeItemsGroup?e:e.parentItem)}expand(e){const t=this;return"number"==typeof e&&(e=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]),void 0===e?void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"expand",argumentName:"taskIndex"})):void t.$.taskTree.expandItem(e instanceof Smart.TreeItemsGroup?e:e.parentItem)}exportData(e,t){function i(e){function t(e){const t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]}return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),e?"#"+t(e[1])+t(e[2])+t(e[3]).toUpperCase():"#ffffff"}function a(e){let t={};for(let i=0;i<l.length;i++){const a=l[i];e?(t[a.value]=e[a.value],t._keyDataField=s.indexOf(e),e.tasks&&(t._expanded=!!e.expanded),e.project&&(t._parentDataField=s.indexOf(e.project))):t[a.value]=a.label}return t}const n=this;if(!Smart.Utilities.DataExporter)return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",file:"smart.export.js"}));try{new JSZip}catch(e){return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",file:"jszip.min.js"}))}if("pdf"===e&&!window.pdfMake)return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",file:"pdfMake.min.js"}));const s=n._tasks,l=n.taskColumns;if(!s||!s.length||!l.length)return;const r=new Smart.Utilities.DataExporter({collapseChar:n.dataExport.collapseChar,exportHeader:n.dataExport.header,expandChar:n.dataExport.expandChar,hierarchical:!0,pageOrientation:n.dataExport.pageOrientation,style:n.dataExport.style}),o=a();let d={columns:[]};for(let i in o)d.columns.push({label:o[i],dataField:i});if(r.header=d,!r.style){const e=window.getComputedStyle(n),t=window.getComputedStyle(n.$.timelineHeader),a={height:n.$.treeSplitter.querySelector(".smart-task-tree-header").offsetHeight+"px",border:"1px solid "+i(t.borderRightColor),fontFamily:"Helvetica",fontSize:t.fontSize,color:i(t.color),backgroundColor:i(t.backgroundColor),fontWeight:"400"},s={border:"1px solid "+i(e.borderColor),fontFamily:e.fontFamily,fontSize:e.fontSize},o=d.columns,m=n.$.treeSplitter.items;for(let e=0;e<o.length;e++){const i=o[e],n=l.find(e=>e.value===i.dataField),r=m[e].querySelector(".smart-tree-item-label-container")||m[e].querySelector(".smart-task-label-container");a[i.dataField]={textAlign:t.textAlign,width:m[e].offsetWidth+"px"};let d;r&&(d=getComputedStyle(r).justifyContent||getComputedStyle(r).textAlign),s[i.dataField]={textAlign:0>["left","center","right","justify"].indexOf(d)?"start":d,format:n.exportFormat||(-1<i.dataField.indexOf("date")?"d":"")}}r.style={border:"1px solid "+i(e.borderColor),borderCollapse:"collapse",header:a,columns:s,rows:{height:(parseFloat(e.getPropertyValue("--smart-gantt-chart-task-default-height"))||0)+"px"}}}let m=[];for(let i=0;i<s.length;i++)m.push(a(s[i]));return r.exportData(m,e,n.dataExport.fileName,t)}print(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const i=e.exportData("html"),a=window.open("","","width=800,height=500"),n=a.document.open();try{n.write("<!DOCTYPE html><html><head><meta charset=\"utf-8\" /><title>"+t+"</title></head><body>"+i+"</body></html>"),n.close(),setTimeout(function(){a.print(),a.close()},100)}catch(e){}e.dataExport.fileName=t}getState(){return this._getTasksJSON()}get tasks(){const e=this;return e.isReady&&e._tasks&&e._tasks.length?e._tasks:void 0}getTaskIndex(e){const t=this;return e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup?[].slice.call(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e):t._tasks?e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")?t._tasks.index(e._task):t._tasks.index(e):void 0}clearState(){const e=this;return e.id?void window.localStorage.removeItem("smartGanttChart"+e.id):void e.warn(e.localize("noId"))}loadState(e){const t=this;if(!e){if(!t.id)return;e=JSON.parse(window.localStorage.getItem("smartGanttChart"+t.id))}Array.isArray(e)&&(t._createTasks(e),t._createTimeline(),t._createTaskColumns(),t.set("dataSource",e))}saveState(){const e=this;return e.id?void window.localStorage.setItem("smartGanttChart"+e.id,JSON.stringify(e.getState())):void e.warn(e.localize("noId"))}insertTask(e,t){const a=this;if("object"!=typeof t)return void a.error(a.localize("incorrectArgument",{elementType:a.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"newTask"}));if(!a._tasks)return;const n=a._tasks.slice(0);let i;if("string"==typeof e)i=a._getTaskByTreeIndex(e),e=a._tasks.indexOf(i);else if("number"==typeof e)i=a._tasks[e];else return void a.error(a.localize("incorrectArgument",{elementType:a.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"index"}));i||(e=a._tasks.length);const s=a._createTasks([t],!0);a.$.timelineConnectionsContainer.innerHTML="";for(let a=0;a<n.length;a++){const t=n[a];if(t.connections)for(let i=0;i<t.connections.length;i++){const a=t.connections[i];"number"==typeof a.target&&a.target>=e&&(a.target+=s.length)}}for(let i=0;i<s.length;i++)n.splice(e+i,0,s[i]);if(i&&i.project){t.project=i.project;for(let e=0;e<s.length;e++)i.project.tasks.splice(i.project.tasks.indexOf(i),0,s[e])}a._tasks=n,a._taskAPIManipulation=!0;const l=a.$.treeSplitter._items;for(let n=0;n<l.length;n++){const i=l[n];if(a.$.taskTreeSplitterItem===i)a.$.taskTree.insert(t,"number"==typeof e?a.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]:e);else{const s=i.getElementsByClassName("smart-task-tree-content")[0],l=a.taskColumns[n];if(!s||!l||!l.value)continue;const r=s.getElementsByClassName("smart-task-item")[e];r?r.parentElement.insertBefore(a._createTaskContainers([t],l),r):s.appendChild(a._createTaskContainers([t],l))}}a._autoSchedule(s),a._noAnimation=!0;for(let n=0;n<s.length;n++){const t=s[n];a._createTimelineTask(t,e+n),a._setTaskBarProgress(t),a._setTaskBarLabel(t),!a._expandTask(t)}delete a._noAnimation,a._refreshTimeline(a.view),a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",a.$.timelineCellsContainer.offsetHeight+"px");const r=a.$.taskTree.selectedIndexes[0];r&&a._selectTask(a._getTaskByTreeIndex(r)),delete a._taskAPIManipulation}openWindow(e){const t=this;if("string"==typeof e){let e=(arguments[0]+"").split("-");if(e=t._getValidConnectionId(e[0],e[1],e[2],"openEditor"),e)return void t._openPopupWindow(t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[connection-id^=\""+e+"\"]"))}const i=t._getTaskIndexById(e);if(-1<i)return void t._openPopupWindow(t.$.timelineTasksContainer.children[i])}closeWindow(){const e=this,t=["confirm","task","connection"];for(let a=0;a<t.length;a++){const i=e.$[t[a]+"PopupWindow"];i&&(i.close(),delete i._target)}}updateTask(e,t){const i=this,a=i._tasks;let n;if(("string"==typeof e&&(e=i._tasks.indexOf(i._getTaskByTreeIndex(e)),n=a[e]),"number"==typeof e?n=i._tasks[e]:"object"==typeof e&&(n=e,e=a.indexOf(e)),"object"==typeof t)&&void 0!==n&&void 0!==e&&null!==e&&a&&a.length){e=Math.max(0,Math.min(a.length-1,e));const s=i.$.timelineTasksContainer.children[e];for(let e in t){let i=n[e],a=t[e];a instanceof Date&&a.getTime()===new Date(i).getTime()||a===i||(s&&"class"==e&&(s.classList.remove(n.class),a&&s.classList.add(a)),!("project"===n.type&&"type"==e||"project"===n.type&&n.synchronized&&(-1<e.toLowerCase().indexOf("date")||-1<e.toLowerCase().indexOf("duration"))))&&("dateEnd"==e&&(n.duration=void 0),n[e]=a,"milestone"===n.type&&("dateStart"==e||"dateEnd"==e)&&(n.dateEnd=n.dateStart=a))}i._validateTaskProperties(n,n.project),i._setTaskBarProgress(n),i._setTaskBarLabel(n),i._refreshTimeline(i.view),i._refreshTaskColumnsData(n),i._refreshTaskConnections(n),i._autoSchedule()}}removeTask(e){const t=this,a=t._tasks.slice(0);let i;if("string"==typeof e)i=t._getTaskByTreeIndex(e),e=t._tasks.indexOf(i);else if("number"==typeof e)i=t._tasks[e];else return void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"index"}));if(!i)return;t._taskAPIManipulation=!0,t._removeConnection(e),t._removeConnectionsToTask(e,a);let n=1;if("project"===i.type){const e=i.tasks,s=a.slice(0);for(let l=e.length-1;-1<l;l--){const i=s.indexOf(e[l]);t._removeConnectionsToTask(i,s,e),t._removeConnection(i),t.$.timelineTasksContainer.removeChild(t.$.timelineTasksContainer.children[i]),t.$.timelineCellsContainer.removeChild(t.$.timelineCellsContainer.children[i]),a.splice(i,1),e.splice(i,1),n++}}i.project&&i.project.tasks.splice(i.project.tasks.indexOf(i),1+(i.tasks?i.tasks.length:0)),a.splice(a.indexOf(i),1),t.$.timelineTasksContainer.removeChild(t.$.timelineTasksContainer.children[e]),t.$.timelineCellsContainer.removeChild(t.$.timelineCellsContainer.children[e]);const s=t.$.treeSplitter._items;for(let a=0;a<s.length;a++){const i=s[a];if(t.$.taskTreeSplitterItem===i)t.$.taskTree.removeItem(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]);else{const n=i.getElementsByClassName("smart-task-tree-content")[0],s=t.taskColumns[a];if(!n||!s||!s.value)continue;const l=n.getElementsByClassName("smart-task-item")[e];l&&l.parentElement.removeChild(l)}}for(let s=0;s<a.length;s++){const i=a[s];if(i.connections)for(let a=0;a<i.connections.length;a++){const l=i.connections[a],r=t._getTaskIndexById(l.target);if(r>=e){const a=t.$.timelineConnectionsContainer,o=a.querySelectorAll(".smart-task-connection[connection-id^=\""+(s>=e?s+n:s)+"-"+r+"\"]");for(let e=0;e<o.length;e++)a.removeChild(o[e]);"number"==typeof l.target&&(l.target-=n)}}}t.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",t.$.timelineCellsContainer.offsetHeight+"px"),t._tasks=a,t._refreshTimeline(t.view),t.$.treeSplitter._resizeEventHandler();const l=t.$.taskTree.selectedIndexes[0];l&&t._selectTask(t._getTaskByTreeIndex(l)),delete t._taskAPIManipulation}_getValidConnectionId(e,t,i,a){const n=this,s=n._tasks,l=0===a.indexOf("_");let r;return"string"==typeof e&&(r=n._getTaskIndexById(e),0<=r&&(e=r)),"string"==typeof t&&(r=n._getTaskIndexById(t),0<=r&&(t=r)),e=parseInt(e),t=parseInt(t),i=parseInt(i),isNaN(e)||isNaN(t)||e===t?void(l||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:a,argumentName:"taskIndex"}))):e>=s.length||0>e||t>=s.length||0>t?void(l||n.error(n.localize("outOfBounds",{elementType:n.nodeName.toLowerCase(),methodName:a,argumentName:"taskIndex"}))):isNaN(i)||0>i||3<i?void(l||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:a,argumentName:"connectionType"}))):l?[e,t,i]:e+"-"+t+"-"+i}_applySelection(e){const t=this,a=t.selectedIndexes.slice(0);let n=[];e&&0<e.length&&(n=e.filter(e=>t._tasks[e])),t._taskAPIManipulation=!0;for(let s,l=0;l<a.length;l++)s=a[l],s="string"==typeof s&&-1<s.indexOf(".")?t._getTaskByTreeIndex(s):t._tasks[s],s&&0>n.indexOf(s)&&t._selectTask(s);a.length||t._selectTask(),delete t._taskAPIManipulation,e&&t.$.fireEvent("change",{value:a,oldValue:e})}_autoSchedule(e){const a=this,t=a._tasks;if(a.autoSchedule){e?!Array.isArray(e)&&(e=[e]):e=t;for(let i=0;i<e.length;i++){const t=e[i];t.minDateStart=t.minDateEnd=void 0,a._autoScheduleTasks(t)}if(a._isUpdateRequired){a._createTimelineCells();for(let e=0;e<t.length;e++)a._setTimelineTaskBar(t[e],!0),a._refreshTaskConnections(t[e]);delete a._isUpdateRequired}}}_autoScheduleTasks(e){var t=Math.max;const a=this,n=a._tasks,i=n.indexOf(e),s=e.connections;for(let t=0;t<s.length;t++)a._isAutoScheduled({_task:e},{_task:n[a._getTaskIndexById(s[t].target)]},!0);const l=a._getConnectedTasks(i);let r,o,d;for(let n=0;n<l.length;n++){const s=l[n],m=s.connections.find(e=>a._getTaskIndexById(e.target)===i),c=m.type,g=m.lag||0;0===c||1===c?(d=new Date((0===c?s.dateStart:s.dateEnd).getTime()+g),e.minDateStart=new Date(e.minDateStart?t(e.minDateStart.getTime(),d.getTime()):d),o=e.minDateStart.getTime()-e.dateStart.getTime(),r=new Date(e.dateEnd.getTime()+(a.autoScheduleStrictMode?o:t(0,o))),r.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=r,a._isUpdateRequired=!0),a.autoScheduleStrictMode&&e.minDateStart.getTime()!==e.dateStart.getTime()&&(e.dateStart=e.minDateStart,a._isUpdateRequired=!0)):(d=new Date((2===c?s.dateEnd:s.dateStart).getTime()+g),e.minDateEnd=new Date(e.minDateEnd?Math.min(e.minDateEnd.getTime(),d.getTime()):d),o=e.minDateEnd.getTime()-e.dateEnd.getTime(),r=new Date(e.dateStart.getTime()+(a.autoScheduleStrictMode?o:t(0,o))),r.getTime()!==e.dateStart.getTime()&&(e.dateStart=r,a._isUpdateRequired=!0),a.autoScheduleStrictMode&&e.minDateEnd.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=e.minDateEnd,a._isUpdateRequired=!0)),a._validateTaskProperties(e,e.project)}for(let i=0;i<s.length;i++){const e=n[s[i].target];e&&(e.minDateStart=e.minDateEnd=void 0,a._autoScheduleTasks(e))}}_getConnectedTasks(e){const t=this,a=t._tasks;if(a&&0!==a.length){let t=[];for(let n=0;n<a.length;n++){const i=a[n],s=i.connections;if(s)for(let a=0;a<s.length;a++)s[a].target===e&&t.push(i)}return t}}_autoScheduleRestore(e,t){const i=this,a=i._tasks;e||(e=a),Array.isArray(e)||(e=[e]);for(let n=0;n<e.length;n++){const i=e[n];-1<a.indexOf(e[n])&&(t?0===t||1===t?i.minDateStart=void 0:i.minDateEnd=void 0:i.minDateStart=i.minDateEnd=void 0)}}_autoScroll(e){function t(t){return i._dragDetails?void(i._autoScrolling=!0,i.scrollLeft-=(i.rightToLeft?-1:1)*i.autoScrollStep*t,i._dragDetails.coordinates.x+=i.autoScrollStep*t,i.hasAttribute("dragged")?i._handleTaskBarDrag(e):i.hasAttribute("resized")&&i._handleTaskBarResize(e)):(clearInterval(i._scrollInterval),i._scrollInterval=void 0,void delete i._autoScrolling)}const i=this;if(i.disableAutoScroll||!e||!i.hasAttribute("dragged")&&!i.hasAttribute("resized")&&!i.hasAttribute("connecting-task"))return;const a=i.$.timeline.getBoundingClientRect();i._scrollInterval&&clearInterval(i._scrollInterval),i._scrollInterval=setInterval(function(){(i.scrollLeft||i.rightToLeft)&&e.clientX<=a.left+20?t(1):i.scrollLeft!==(i.rightToLeft?0:i.scrollWidth)&&e.clientX>=a.left+a.width-20?t(-1):(clearInterval(i._scrollInterval),i._scrollInterval=void 0,delete i._autoScrolling)},1)}_checkTaskBarResizability(e){var t=Math.round,i=Math.min;const a=this;let n=e.originalEvent.target;a.shadowRoot&&n===a&&(n=e.originalEvent.composedPath()[0]);const s=a.$.timeline;let l,r=n.closest(".smart-timeline-task-cell")||n.closest(".smart-timeline-task");if(r&&s.contains(r)&&(r.classList.contains("smart-timeline-task-cell")?l=a.$.timelineTasksContainer.children[a._tasks.indexOf(r._task)]:r.classList.contains("smart-timeline-task")&&(l=r,r=a.$.timelineCellsContainer.children[a._tasks.indexOf(r._task)]),!(!l||l.classList.contains("milestone")||l._task.synchronized||l._task.disableResize))){if(n.classList&&n.classList.contains("smart-task-connection-point"))return void s.removeAttribute("task-bar-hovered");const o=e.pageX-window.pageXOffset,d="visible"===a.resizeHandlesVisibility||Smart.Utilities.Core.isMobile?20:5,m=l.getBoundingClientRect(),c=r.getBoundingClientRect(),g=i(d,o-c.left),h=i(d,c.left+c.width-o);t(m.left)+g>=o&&t(m.left)-g<=o?s.setAttribute("task-bar-hovered","left"):t(m.left+m.width)+h>=o&&t(m.left+m.width)-h<=o?s.setAttribute("task-bar-hovered","right"):s.removeAttribute("task-bar-hovered")}}_onShadowDomLoaded(e,t,a){function i(){const n=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<n.length;e++)if(-1!==n[e].href.indexOf(t))return void a();requestAnimationFrame(i)}requestAnimationFrame(i)}_openPopupWindow(e,t){function i(){function t(){const e=n.getBoundingClientRect();l.style.left=a(e.left+window.pageXOffset,e.left+window.pageXOffset+e.width/2-l.offsetWidth/2)+"px",l.style.top=a(e.top+window.pageYOffset,e.top+window.pageYOffset+e.height/2-l.offsetHeight/2)+"px",l.opened?(l.bringToFront(),l._handleActiveState()):l.open()}if(n.popupWindowCustomizationFunction&&n.popupWindowCustomizationFunction(l,s,n._tasks.indexOf(e._task)),n._setPopupWindowTemplate("header",s,e),n._setPopupWindowTemplate("footer",s,e),n._setPopupWindowTemplate("content",s,e),!n._popupWindow[s+"PopupWindow"]){const e=n["$"+s+"PopupWindow"];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.listen("transitionend",n._popupWindowTransitionendHandler.bind(n)),e.listen("open",n._popupWindowOpenHandler.bind(n)),e.listen("close",n._popupWindowCloseHandler.bind(n)),e.listen("closing",n._popupWindowClosingHandler.bind(n)),e.listen("click",n._popupWindowClickHandler.bind(n))}l.shadowRoot?(l.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),n._onShadowDomLoaded(l,"smart.window.css",t)):t(),n._popupWindow[s+"PopupWindow"]=l}var a=Math.max;const n=this;if(!e)return;if(!t){const e=n.$.fireEvent("opening").defaultPrevented;if(e)return}const s=t?"confirm":e.classList.contains("smart-task-connection")?"connection":"task",l=n._createPopupWindow(s);l._target=e,l.parentElement||document.body.appendChild(l),n._popupWindow||(n._popupWindow={}),l.isCompleted?i():l.whenReady(()=>i())}_createPopupWindow(e){const t=this,i=e+"PopupWindow";if(t.$[i])return t.$[i];const a=document.createElement("smart-window");return a.classList.add("smart-"+e+"-popup-window"),a.classList.add("smart-gantt-chart-popup-window"),a.setAttribute("smart-id",i),t.$[i]=a,t["$"+i]=Smart.Utilities.Extend(a),a.rightToLeft=t.rightToLeft,a.theme=t.theme,a.animation=t.animation,a.disableSnap=!0,a.headerButtons=["close"],a}_popupWindowOpenHandler(e){const t=this,i=t["$"+e.target.getAttribute("smart-id")];i&&(t._handleModal(!0),t.$.fireEvent(e.type,e.detail),i.unlisten("open"))}_popupWindowClosingHandler(e){const t=this,i=e.target.getAttribute("smart-id"),a=t["$"+i];if(a){const i=t.$.fireEvent(e.type,e.detail);i.defaultPrevented&&e.preventDefault(),a.unlisten(e.type)}}_popupWindowCloseHandler(e){const t=this,i=e.target.getAttribute("smart-id"),a=t["$"+i];if(a){t._handleModal(),t.$.fireEvent(e.type,e.detail),a.unlisten("close"),a.unlisten("click"),delete t._popupWindow[i];const n=Object.keys(t._popupWindow);if(1===n.length&&t._popupWindow.confirmPopupWindow)return delete t._popupWindow.confirmPopupWindow._target,void t._popupWindow.confirmPopupWindow.close();"confirmPopupWindow"===i&&n.length&&requestAnimationFrame(()=>{const e=t._popupWindow[n[n.length-1]];e&&e.focus()})}}_popupWindowTransitionendHandler(e){const t=this,i=e.target;i.opened||"visibility"!==e.propertyName||(t["$"+i.getAttribute("smart-id")].unlisten("transitionend"),i.parentElement&&i.parentElement.removeChild(i))}_handleModal(e){const t=this;let i=(t.shadowRoot||t).querySelector(".smart-popup-window-modal");e?(!i&&(i=document.createElement("div"),i.classList.add("smart-popup-window-modal")),!i.parentElement&&t.$.container.appendChild(i)):i&&i.parentElement&&2>Object.keys(t._popupWindow).length&&i.parentElement.removeChild(i)}_createTaskEditor(e,t,i){const a=this,n=e.value,s=t[e.value];let l,r,o=i.find(e=>e._label===n);if(o)l=o.firstElementChild,r=o.lastElementChild;else{if(o=document.createElement("div"),o.classList.add("smart-gantt-chart-popup-window-editor"),o._label=n,e.customEditor)return o.appendChild(e.customEditor(n,s)),o;l=document.createElement("label"),l.id||(l.id="editorLabel"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),"number"==typeof s||"string"==typeof s?(r=document.createElement("input"),r.classList.add("smart-input")):s instanceof Date&&(Smart.DateTimePicker?(r=document.createElement("smart-date-time-picker"),r.locale=a.locale,r.dropDownAppendTo="body",r.calendarButton=!0,r.dropDownDisplayMode="auto",r.enableMouseWheelAction=!0,r.formatString="yyyy-MMM-dd HH:mm:ss"):(r=document.createElement("input"),r.type="datetime-local")),r.setAttribute("aria-labelledby",l.id)}return o.parentElement?void a._setPopupWindowEditors(e,t,o):(o.appendChild(l),o.appendChild(r),o)}_setPopupWindowEditors(e,t,i){const a=this,n=i.firstElementChild,s=i.lastElementChild,l=(e.value+"").split(/(?=[A-Z])/).join(" "),r=t[e.value];e.customEditor?e.setCustomEditorValue&&e.setCustomEditorValue(i,l,r):(n.innerHTML=a.localize(e.value)||l.charAt(0).toUpperCase()+l.slice(1),"number"==typeof r?s.value=parseFloat(r.toFixed(2)):"string"==typeof r?s.value=r:r instanceof Date&&(s.value=new Date(r)),s.disabled=!!("project"===t.type&&t.synchronized&&(-1<l.toLowerCase().indexOf("date")||-1<l.toLowerCase().indexOf("duration"))),s.rightToLeft=a.rightToLeft,s.animation=a.animation,s.theme=a.theme)}_setPopupWindowContent(e,t){const a=this,n=a.$[e+"PopupWindow"],s=t._task,l=[].slice.call(n.getElementsByClassName("smart-gantt-chart-popup-window-editor"));if(n.content&&(!n.content.innerHTML||l.length))if("task"===e&&s){const e=a.taskColumns;for(let t=0;t<e.length;t++){const i=e[t];if(!s[i.value])continue;const r=a._createTaskEditor(i,s,l);r&&(n.appendChild(r),a._setPopupWindowEditors(i,s,r))}t.id&&n.setAttribute("aria-controls",t.id)}else if("confirm"!==e){const e=t.getAttribute("connection-id").split("-"),i=a._tasks[e[0]],s=a._tasks[e[1]];n.innerHTML="<div class=\"smart-gantt-chart-popup-window-editor\">"+a.localize("deleteLink")+"<b> "+i.label+" - "+s.label+"?</b></div>"}else if(n.innerHTML="<div class=\"smart-gantt-chart-popup-window-editor\">"+a.localize("confirm",{componentName:"The task"})+"</div >",a._popupWindow){const e=Object.keys(a._popupWindow);n.setAttribute("aria-controls",a._popupWindow[e[e.length-1]].id)}}_setPopupWindowTemplate(e,t,i){const a=this,n=a.$[t+"PopupWindow"];if("content"===e)return void a._setPopupWindowContent(t,i);if(n[e+"Template"]||(n[e+"Template"]=a._createPopupWindowTemplate(e,t,i)),"header"===e&&i&&i._task){const e=(n.shadowRoot||n).querySelector(".smart-popup-window-label");e&&(e.innerHTML=i._task.label)}else if("footer"===e){const e=(n.shadowRoot||n).querySelectorAll(".smart-popup-window-button");for(let i=0;i<e.length;i++){const n=e[i];n.innerHTML="task"===t?"<span class=\"smart-icon\"></span>":"",n.theme=a.theme,n.rightToLeft=a.rightToLeft,n.animation=a.animation,n.classList.contains("ok")?(n.innerHTML+=a.localize("ok"),n.setAttribute("aria-label","ok")):n.classList.contains("cancel")?(n.innerHTML+=a.localize("cancel"),n.setAttribute("aria-label","cancel")):n.classList.contains("delete")&&(n.innerHTML+=a.localize("delete"),n.setAttribute("aria-label","delete"));const s=n.querySelector(".smart-ripple");s&&s.parentElement.removeChild(s)}}}_createPopupWindowTemplate(e,t){const i=this,a=document.createElement("template");return"footer"===e?"task"===t?a.innerHTML=`<smart-button class="smart-popup-window-button ok primary" 
                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>
                        </smart-button>
                        <smart-button class="smart-popup-window-button cancel" 
                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>
                        </smart-button>
                        <smart-button class="smart-popup-window-button delete secondary"  
                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>
                        </smart-button>`:"connection"===t||"confirm"===t?a.innerHTML=`<smart-button class="smart-popup-window-button ok primary"  
                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>
                        </smart-button>
                    <smart-button class="smart-popup-window-button cancel"
                        animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>
                    </smart-button>`:void 0:"header"===e&&("task"===t||"confirm"===t)&&(a.innerHTML="<span class=\"smart-popup-window-label\"></span>"),a}_popupWindowClickHandler(e){const t=this;let i=(e.originalEvent||e).target;i.shadowRoot&&(i=(e.originalEvent||e).composedPath()[0]);const a=i.closest("smart-window")||(i.getRootNode()&&i.getRootNode().host?i.getRootNode().host:void 0),n=a._target;if(i.closest(".smart-popup-window-button.cancel"))return t._popupWindow&&t._popupWindow.confirmPopupWindow&&a!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),a.close(),void delete a._target;if(i.closest(".smart-popup-window-button.ok")){if(a===t.$.connectionPopupWindow&&n.classList.contains("smart-task-connection"))t._removeConnection(n);else if(a===t.$.confirmPopupWindow)t.removeTask(t._tasks.indexOf(n._task)),a.close(),t.$.taskPopupWindow&&t.$.taskPopupWindow.close(),delete a._target;else{const i=(a.shadowRoot||a).querySelectorAll(".smart-gantt-chart-popup-window-editor");let s={};for(let a=0;a<i.length;a++){const e=i[a]._label,n=t.taskColumns.find(t=>t.value===e);if(n.customEditor)s[e]=n.getCustomEditorValue(i[a]);else{const t=i[a].lastElementChild;let n;n=Smart.DateTimePicker&&t instanceof Smart.DateTimePicker?t.value.toDate():t instanceof HTMLInputElement&&"datetime-local"===t.type?new Date(t.value):Smart.DropDownList&&t instanceof Smart.DropDownList?t.selectedValue[0]:t.value,n instanceof Date&&isNaN(n.getTime())&&(n=void 0),void 0!==n&&null!==n&&(s[e]=n)}}t.updateTask(t._tasks.indexOf(n._task),s)}return t._popupWindow&&t._popupWindow.confirmPopupWindow&&a!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),a.close(),void delete a._target}return i.closest(".smart-popup-window-button.delete")?void t._openPopupWindow(a._target,!0):void 0}_createTasks(e,t){function i(e,t){let s=[];if(0!==e.length){for(let l,r=0;r<e.length;r++)if((l=e[r],"object"==typeof l)&&(l=a._validateTaskProperties(l,t),!!l)){if(l.project=t,l.tasks instanceof Array&&0<l.tasks.length&&(l.synchronized&&(l.dateStart=l.minDateStart=l.maxDateStart=void 0,l.dateEnd=l.minDateEnd=l.maxDateEnd=void 0),l.type="project",l.tasks=i(l.tasks,l),0===l.tasks.length&&delete l.tasks),(!l.type||0>["project","task","milestone"].indexOf(l.type))&&(l.type="task"),t&&"project"===l.type&&0<l.tasks.length){s.push(l),s=s.concat(l.tasks);continue}t||(l.dateStart&&l.dateEnd&&!isNaN(l.dateStart.getTime())&&!isNaN(l.dateEnd.getTime())&&n.push(l),l.tasks&&(n=n.concat(l.tasks))),s.push(l)}return s}}const a=this;t||a.clearTasks();let n=[];return i(e||a.dataSource),t?n.slice(0):void(a._tasks=n.slice(0))}_createTimeline(){const e=this;e._tasks&&0!==e._tasks.length&&(e._autoSchedule(),e._createTimelineCells(),e._resetTimeline(),e._insertTimelineTasks(e._tasks))}_insertTimelineTasks(e,i,a){const n=this,s=function(e){for(let t=e.project;t;){if(!t.expanded)return!1;t=t.project}return!0};let r={};for(let o=0;o<e.length;o++){const t=e[o],l=t.connections;if((n._createTimelineTask(t,i?i+o:void 0),n._setTimelineTaskBar(t),n._setTaskBarProgress(t),n._setTaskBarLabel(t),!a)&&(n._expandTask(t),!!s(t))){for(let t,i=0;i<l.length;i++){if(t=l[i].target,"string"==typeof t){let e=n._getTaskIndexById(t);t=void 0===e?parseInt(t):e}if(!t||isNaN(t)||0>t||t>=e.length||t===o){l.splice(l.indexOf(l[i]),1);continue}const a=o+"-"+t+"-"+l[i].type;if(t>o){r[t]||(r[t]=[]),0>r[t].indexOf(a)&&r[t].push(a);continue}n._connectTask(a)}if(r[o]){for(let e=0;e<r[o].length;e++)n._connectTask(r[o][e]);delete r[o]}}}n._refresh(),n.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",n.$.timelineCellsContainer.offsetHeight+"px")}_ensureVisible(e){var t=Math.max;const i=this;if(void 0!==e&&null!==e){const a=Array.from(i.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")),n=a.indexOf(e);if(a.length){"number"==typeof e?(e=Math.min(t(0,e),a.length-1),i.$.taskTree.ensureVisible(a[e])):"string"==typeof e&&i.$.taskTree.ensureVisible(e);const s=i.$.timelineCellsContainer.children[n];s&&(s.offsetTop+s.offsetHeight>i.scrollTop+i.$.timelineContent.offsetHeight?i.scrollTop=t(0,s.offsetTop+s.offsetHeight-i.$.timelineContent.offsetHeight):s.offsetTop<i.scrollTop&&(i.scrollTop=t(0,s.offsetTop)),i.$.timelineContent.scrollTop=i.scrollTop)}}}_expandTask(e,t){const i=this;if(!e)return!0;const a=e.tasks&&e.tasks.length?e:e.project;return!a||((i.$.timelineContent.style.minHeight="",i.$.timelineContent.style.maxHeight="",void 0!==t)?void i._animateTimelineExpanding(a,t):(t=a.expanded,!!(t&&t===a.expanded))||(i._handleExpanding(a,t),a.expanded))}_handleExpanding(e,t){const a=this,n=a._tasks,i=a.$.timelineConnectionsContainer,s=[].slice.call(i.children),l=a.$.timelineCellsContainer.children,r=a.$.timelineTasksContainer.children,o=e.tasks,d=parseFloat(window.getComputedStyle(a).getPropertyValue("--smart-gantt-chart-task-default-height"))||0;let m=a.$.timelineCellsContainer.offsetHeight,g=0;a._handleTaskItemExpanding(e,t);for(let c=0;c<o.length;c++){g=n.indexOf(o[c]);const h=r[g],p=l[g];if(h){for(let e=0;e<s.length;e++){const t=s[e],a=t.getAttribute("connection-id").split("-");(parseInt(a[1])===g||parseInt(a[0])===g)&&t.parentElement&&i.removeChild(t)}if(t){if(!h.classList.contains("smart-visibility-hidden"))continue;const t=h._task.project;if(t&&t!==e&&!a._isTaskExpanded(h._task,e))continue;h.classList.remove("smart-visibility-hidden"),p.classList.remove("smart-visibility-hidden"),m+=d,a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",m+"px"),a._refreshTaskConnections(h)}else{if(h.classList.contains("smart-visibility-hidden"))continue;h.classList.add("smart-visibility-hidden"),p.classList.add("smart-visibility-hidden"),m-=d,a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",m+"px")}}}for(let s=n.indexOf(e)+1;s<r.length;s++){const e=r[s];e.style.top=l[s].offsetTop+"px",a._refreshTaskConnections(e)}e.expanded=t,a._refresh()}_handleTaskItemExpanding(e,t){function i(e){const t=this;"visibility"===e.propertyName||(t.style.height="",t.removeEventListener("transitionend",i))}const a=this,n=a._tasks,s=n.indexOf(e),l=a.$.treeSplitter._items;for(let n=1;n<l.length;n++){const e=l[n].getElementsByClassName("smart-task-item");if(!e.length||!e[s])continue;const r=e[s].lastElementChild;if(a._noAnimation)return void(t?r.classList.remove("smart-visibility-hidden"):r.classList.add("smart-visibility-hidden"));requestAnimationFrame(function(){let e=0;for(let t=0;t<r.children.length;t++)e+=r.children[t].offsetHeight;r.style.height=e+"px",r.addEventListener("transitionend",i),t?r.classList.remove("smart-visibility-hidden"):(r.classList.add("smart-visibility-hidden"),requestAnimationFrame(function(){r.style.height="0"}))})}}_isTaskExpanded(e,t){if(!e)return;let i,a=e.project;for(;a;){if(i=a.expanded,!i)return;if(a=a.project,a===t)break}return i}_hoverViaKeyboardCallback(e){const a=this;if(a._unfocusTaskTreeItems(),!e)return;const i=Array.from(a.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e),t=a.$.timelineCellsContainer.children[i];if(t&&t.setAttribute("focus",""),!a.$.timelineAnimationContainer.classList.contains("smart-visibility-hidden")){const e=a.$.timelineAnimationContainer.getElementsByClassName("smart-timeline-task");for(let n=0;n<e.length;n++){const t=e[n];if(a._tasks.indexOf(t._task)===i){t.setAttribute("focus","");break}}}const n=a.$.treeSplitter._items;for(let t=0;t<n.length;t++){const e=n[t];if(e!==a.$.taskTreeSplitterItem){const t=e.getElementsByClassName("smart-task-label-container")[i];t&&t.setAttribute("focus","")}}a._focusedItem=i}_unfocusTaskTreeItems(){const e=this,t=e.$.treeSplitter._items;for(let a=0;a<t.length;a++){const i=t[a];if(i!==e.$.taskTreeSplitterItem){const e=i.getElementsByClassName("smart-task-label-container");for(let i=0;i<e.length;i++)e[i].removeAttribute("focus")}}const a=e.$.timelineCellsContainer.children;for(let e=0;e<a.length;e++){const t=a[e];t.hasAttribute("focus")&&t.removeAttribute("focus")}delete e._focusedItem}_emptyAnimationContainer(){const e=this.$.timelineAnimationContainer.firstElementChild.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML="",e[t].lastElementChild.innerHTML=""}_animateTimelineExpanding(e,t){const a=this,i=a.$.timelineAnimationContainer,n=i.firstElementChild,s=n.children[0],l=n.children[1],r=n.children[2];if("none"===a.animation)return i.classList.add("smart-visibility-hidden"),a._emptyAnimationContainer(),void a._handleExpanding(e,t);const o=a._tasks,d=a.$.timelineTasksContainer.children,m=a.$.timelineConnectionsContainer.children,c=function(t){for(let i=t.project;i;){if(i===e)return!0;i=i.project}},g=e.tasks.filter(t=>t.project===e||a._isTaskExpanded(t,e));let h=o.indexOf(e);const p=d[h].offsetHeight,f=a.$.timelineContent.offsetTop;a._emptyAnimationContainer(),t?l.classList.add("animate"):l.classList.remove("animate");let _=[],u=[],k=[],T=0;for(let n=0;n<d.length;n++){const t=d[n],i=t.cloneNode(!0),m=o.indexOf(t._task),g=t._task.project;(!g||g===e||a._isTaskExpanded(t._task,e))&&(i.style["margin"+(a.rightToLeft?"Right":"Left")]=i.style[a.rightToLeft?"right":"left"],i.classList.remove("smart-visibility-hidden"),m<=h?(s.lastElementChild.appendChild(i),_.push(m)):c(t._task)?(l.lastElementChild.appendChild(i),u.push(m),T+=i.offsetHeight):(r.lastElementChild.appendChild(i),k.push(m)),void 0!==a._focusedItem&&a._focusedItem===h&&m===h&&i.setAttribute("focus",""))}l.style.transition="none",t&&a._handleExpanding(e,t);for(let a=0;a<m.length;a++){const e=m[a],t=e.cloneNode(),i=t.getAttribute("connection-id").split("-");-1<_.indexOf(parseInt(i[0]))&&-1<_.indexOf(parseInt(i[1]))?s.firstElementChild.appendChild(t):-1<u.indexOf(parseInt(i[0]))&&-1<u.indexOf(parseInt(i[1]))?l.firstElementChild.appendChild(t):-1<k.indexOf(parseInt(i[0]))&&-1<k.indexOf(parseInt(i[1]))&&r.firstElementChild.appendChild(t)}l.firstElementChild.style.transform="translateY(-"+s.offsetHeight+"px)",r.firstElementChild.style.transform="translateY(-"+(T+s.offsetHeight)+"px)";let y;t||a._handleExpanding(e,t),y=a.$.timelineContent.offsetHeight,y!==n.offsetHeight&&(a.$.timelineContent.style[(t?"max":"min")+"Height"]=n.offsetHeight+"px"),i.style.top=f+"px",n.style.top=-a.scrollTop+"px",i.classList.remove("smart-visibility-hidden"),a.$.timelineContent.classList.add("smart-visibility-hidden"),requestAnimationFrame(function(){l.style.height=g.length*p+"px",l.style.transition="",t?(l.classList.remove("animate"),a.$.timelineContent.style.maxHeight=y+"px"):(l.classList.add("animate"),requestAnimationFrame(function(){l.style.height="0",a.$.timelineContent.style.minHeight=y+"px"}))})}_timelineAnimationContainerTransitionendHandler(e){const t=this;if("height"===e.propertyName){const e=t.$.timelineAnimationContainer;e.classList.add("smart-visibility-hidden"),t.$.timelineContent.classList.remove("smart-visibility-hidden"),t._emptyAnimationContainer(),t.$.timelineContent.style.minHeight="",t.$.timelineContent.style.maxHeight="",e.firstElementChild.children[1].style.height=""}}_getTaskByTreeIndex(e,t){const i=this;if(!e)return;const a=e.split(".");let n=i._tasks.filter(e=>!e.project)[e.split(".")[0]];if(n){if(!n.tasks||!n.tasks.length)return t?null:n;for(let e=1;e<a.length;e++){const i=n.tasks.filter(e=>e.project===n)[a[e]];if(!i||t&&(!i.tasks||!i.tasks.length))break;n=i}return t?n&&"project"===n.type?n:void 0:n}}_taskTreeBlurHandler(){const e=this;e._unfocusTaskTreeItems()}_taskTreeChangeHandler(e){const t=this;e.stopPropagation();t._taskAPIManipulation||void 0!==t._itemIndexClicked||t._dragDetails||(t._treeChangeEventFired=!0,t._selectTask(t._getTaskByTreeIndex(e.detail.selectedIndexes[0])),delete t._treeChangeEventFired)}_taskTreeExpandHandler(e){const t=this;if(t._tasks&&t._tasks.length){const i=e.detail.item.path,a=t._getTaskByTreeIndex(i,!0);a&&("collapse"===e.type?t._expandTask(a,!1):t._expandTask(a,!0))}}_resetTimeline(){const e=this;e.$.timelineCellsContainer.innerHTML="";const t=e.$.timelineTasksContainer.children;for(let e=0;e<t.length;e++)delete t[e]._cellStart,delete t[e]._cellEnd}_refreshTimeline(e){const i=this,a=i._tasks;e||(e=i.view);const t=i._getDateFromCell(i.scrollLeft,i._getFirstCellObjInView(),e);i.scrollLeft=0,i._resetTimeline(),i._createTimelineCells();for(let n=0;n<a.length;n++){const e=a[n];i._createTimelineTaskCells(e),i._setTimelineTaskBar(e),i._refreshTaskConnections(e)}i._refresh(),i._scrollTo(t)}_scrollTo(e){const t=this,a=t._timelineCells;let n;for(let s=0;s<a.length;s++){const i=a[s],l=i.date;switch(t.view){case"year":if(l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()){let t=new Date(e);t.setMonth(e.getMonth()+1),t.setDate(0),t=t.getDate(),n=i.left+(e.getDate()-1)/t*i.width}break;case"month":{let t=new Date(l),a=new Date(l);t.setDate(t.getDate()-t.getDay()),a.setDate(a.getDate()+(6-a.getDay())+1),a.setMilliseconds(a.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=a.getTime()&&(n=i.left+e.getDay()/7*i.width);break}case"week":l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()&&l.getDate()===e.getDate()&&(n=i.left+parseFloat(e.getHours()+"."+e.getMinutes()+e.getSeconds())/24*i.width);break;case"day":l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()&&l.getDate()===e.getDate()&&l.getHours()===e.getHours()&&(n=i.left+parseFloat(e.getMinutes()+e.getSeconds())/60*i.width);}if(void 0!==n)return void(t.scrollLeft=n)}}_updateConnection(e,t){function i(e,i,a){const s=e.connections;let l;for(let r,o=0;o<s.length;o++){if(r=s[o].target,"string"==typeof r){let e=n.indexOf(n.find(e=>e.id===r));0<=e&&(r=e)}if(r===i){if(!t&&void 0!==a&&s[o].type===a&&!l){l=!0;continue}s.splice(o,1)}}return l}const a=this;e+="",e=e.split("-");const n=a._tasks,s=parseInt(e[0]),l=parseInt(e[1]),r=parseInt(e[2]),o=n[s],d=n[l];if(o){if(!d)return void(o.connections=[]);if(void 0!==r){const e=i(o,l,r);if(i(n[l],s),!(t||e)){o.connections.push({target:l,type:r});const e=d.connections.find(e=>a._getTaskIndexById(e.target)===s&&e.type===r);e&&d.connections.splice(d.connections.indexOf(e),1)}}}}_createTimelineCells(){const e=this,i=e._tasks,t=e.properties.dateStart.value,a=e.properties.dateEnd.value;let n,s;if(t&&(n=t),a&&(s=a),0<i.length){let e=i[0].dateStart,a=i[0].dateEnd;for(let n=0;n<i.length;n++)i[n].dateStart&&i[n].dateEnd&&(e||(e=i[n].dateStart),a||(a=i[n].dateEnd),e.getTime()>i[n].dateStart.getTime()&&(e=i[n].dateStart),a.getTime()<i[n].dateEnd.getTime()&&(a=i[n].dateEnd));(!n||n.getTime()>e.getTime())&&(n=e),(!s||s.getTime()<a.getTime())&&(s=a)}n&&s&&(n=e._minMaxDateValidator(n),s=e._minMaxDateValidator(s),e._createTimelineHeader(n,e._getCellsCount(n,s)))}_getCellsCount(e,t,i){var a=Math.round;let n,s,l,r,o,d,m=new Date(e),c=new Date(t);const g=t.getFullYear()-e.getFullYear();if(s=n=a(g)+1,"year"===i)return{year:s};if(m.setHours(m.getHours(),0,0,0),c.setHours(c.getHours(),0,0,0),d=Math.floor((t.getTime()-e.getTime())/3600000),0<d){let e=new Date(m);if(d=1,m.getFullYear()!==c.getFullYear()){let t=new Date(m.getFullYear()+1,0,1,0,0,0,0);for(;e.getTime()!==t.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),d++}const i=c.getFullYear()-t.getFullYear();for(let t=0;t<i;t++){const t=e.getFullYear();d+=24*((0==t%100?0==t%400:0==t%4)?366:365)-1,e.setFullYear(t+1)}}for(;e.getTime()!==c.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),d++}}if("hour"===i)return{hour:d};if(m.setHours(0,0,0,0),c.setHours(23,59,59,999),o=n=a((c.getTime()-m.getTime())/86400000),"day"===i)return{day:o};if(m.setDate(m.getDate()-m.getDay()),c.setDate(c.getDate()+6-c.getDay()),r=n=a((c.getTime()-m.getTime())/604800000),"week"===i)return{week:r};if("month"===this.view&&(0!==e.getDay()&&(e=new Date(e.setDate(e.getDate()-e.getDay()))),6!==t.getDay()&&(t=new Date(t.setDate(t.getDate()+6-t.getDay())))),e.getFullYear()!==t.getFullYear()){n=12-e.getMonth();const i=t.getFullYear();for(let a=e.getFullYear()+1;a<=i;a++)n+=a===t.getFullYear()?t.getMonth()+1:12}else n=t.getMonth()-e.getMonth()+1;return l=Math.ceil(n),"months"===i?{month:l}:{year:s,month:l,week:r,day:o,hour:d}}_createTimelineTask(e,t){const i=this,a=i._createTaskBar(e.type),n="project"===e.type&&e.synchronized;e.disableDrag||n&&!e.dragProject?a.setAttribute("disable-drag",""):a.removeAttribute("disable-drag"),e.disableResize||n?a.setAttribute("disable-resize",""):a.removeAttribute("disable-resize"),a.id=e.id?e.id:"ganttTask"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),i._createTimelineTaskCells(e,t),a._task=e,a.classList.add("smart-timeline-task"),e.class&&a.classList.add(e.class);const s=e=>e.getFullYear()+"-"+(10>e.getMonth()?"0"+e.getMonth():e.getMonth())+"-"+(10>e.getDate()?"0"+e.getDate():e.getDate());a.setAttribute("aria-label",e.label+" Start date: "+s(e.dateStart)+", End date: "+s(e.dateEnd)),a.setAttribute("aria-selected","false"),i.$.timelineTasksContainer.insertBefore(a,i.$.timelineTasksContainer.children[t])}_createTimelineTaskCells(e,t){const i=this,a=document.createElement("div");e.project&&!i._isTaskExpanded(e)&&a.classList.add("smart-visibility-hidden"),a._task=e,a.classList.add("smart-timeline-task-cell"),i.$.timelineCellsContainer.insertBefore(a,i.$.timelineCellsContainer.children[t])}_createCells(e){let t,i=document.createDocumentFragment();for(let a=0;a<e;a++)t=document.createElement("div"),t.classList.add("smart-timeline-view-cell"),t.setAttribute("role","columnheader"),i.appendChild(t);return i}_getTimelineVisibleCellsCount(){const e=this,t=e._timelineCells;if(t){const i=e._getFirstCellObjInView(),a=1-(i.left+i.width-e.scrollLeft)/t[0].width;return Math.ceil(parseFloat((e.$.timeline.offsetWidth/i.width).toFixed(2))+a)}}_getHeaderVisibleCellsCount(){const e=this;if(!e._timelineHeaderCells)return;const t=Math.abs(e.scrollLeft),a=e.$.timeline.parentElement.offsetWidth,n=e._timelineHeaderCells;let s=0;for(let e=0;e<n.length;e++){const i=n[e];i.left+i.width>t&&i.left<a+t&&s++}return s}_refreshHeaderDate(){const e=this,t=e._getCellsViewType(),a=e.scrollLeft,i=e.$.timelineViewCells.children,n=e._timelineCells;let s;e._refreshHeaderDetailsDate();for(let e=0;e<n.length;e++){const t=n[e];if(a<=t.left+t.width){s=e;break}}for(let a=0;a<i.length;a++){const l=i[a],r=n[s];if(!r)break;const o=r.date;l._date=new Date(o),l.innerHTML=e._getDateString(new Date(o),t),l.style.width=r.width+"px",l.style[e.rightToLeft?"right":"left"]=r.left+"px",r.weekend?l.setAttribute("weekend",""):l.removeAttribute("weekend"),r.nonworking?l.setAttribute("nonworking",""):l.removeAttribute("nonworking"),s++}}_getDateString(e,t,i){const a=this,n=["2-digit","numeric"][a.dayFormat]||"numeric";if(a.timelineHeaderFormatFunction)return a.timelineHeaderFormatFunction(e,t,i);return"year"===t?e.toLocaleDateString(a.locale,{year:a.yearFormat}):"month"===t?e.toLocaleDateString(a.locale,{month:a.monthFormat}):"week"===t?"numeric"!==a.weekFormat&&i?e.toLocaleDateString(a.locale,{day:n,month:a.monthFormat,year:a.yearFormat}):a._getWeekNumber(e):"day"===t?e.toLocaleDateString(a.locale,"day"===a.view?{day:n,month:a.monthFormat,year:a.yearFormat}:-1<["long","short","narrow"].indexOf(a.dayFormat)?{weekday:a.dayFormat}:{day:a.dayFormat}):"hour"===t?"default"===a.hourFormat?e.toLocaleTimeString(a.locale,{hour12:!1}):e.toLocaleDateString(a.locale,{hour:a.hourFormat}):void 0}_refreshHeaderDetailsDate(){const e=this,t=e.view,a=e.scrollLeft,n=e.$.timelineViewDetails.children,s=e._timelineHeaderCells;let l;for(let e=0;e<s.length;e++){const t=s[e];if(a<=t.left+t.width){l=e;break}}for(let a=0;a<n.length;a++){const i=s[l],r=n[a];let o=new Date(i.date);"week"===e.view&&o.setDate(o.getDate()-o.getDay()),o=new Date(Math.max(i.date.getTime(),o.getTime())),r._date=o,r.innerHTML=e._getDateString(o,t,!0),r.style[e.rightToLeft?"right":"left"]=i.left+"px",r.style.width=i.width+"px",l++}}_getWeekNumber(e){var t=Math.round;let i,a=new Date(e.getFullYear(),0,1),n=t((e.getTime()-a.getTime()-6e4*(e.getTimezoneOffset()-a.getTimezoneOffset()))/864e5)+1,s=a.getDay();return s=0<=s?s:s+7,4>s?(i=Math.floor((n+s-1)/7)+1,52<i&&(a=new Date(e.getFullYear()+1,0,1),s=a.getDay(),s=0<=s?s:s+7,i=4>s?1:53)):i=t((n+s-1)/7),i}_convertDuration(e,t){if(!e)return 0;let i;switch(this.durationUnit){case"day":i=86400000;break;case"hour":i=3600000;break;case"minute":i=60000;break;case"second":i=1e3;break;case"milisecond":return e;case"week":i=604800000;}return t?e/i:e*i}_createTaskBar(e){const t=document.createElement("div");return t.classList.add("smart-timeline-task"),t.classList.add(e),t.innerHTML="milestone"===e?`<div class="smart-task-container" aria-hidden="true">
                <div class="smart-task-connection-point start"></div>
                <div class="smart-timeline-task-fill"></div>
                <div class="smart-task-connection-point end"></div>
            </div>`:`<div class="smart-task-container" aria-hidden="true">
                <div class="smart-task-connection-point start"></div>
                <div class="smart-timeline-task-fill">
                    <div class="smart-timeline-task-progress"></div>
                </div>
                <div class="smart-timeline-task-progress-thumb"></div>
                <div class="smart-timeline-task-label"></div> 
                <div class="smart-task-connection-point end"></div>
            </div>`,t}_createTimelineHeader(e,t){const i=this,a=i._getCellsViewType();if(!e){const t=i.$.timelineViewCells.children;if(0===t.length)return;e=t[0]._date}return"day"!==i.view&&e.setHours(0,0,0,0),i.$.timelineContent.offsetWidth===i.$.timeline.offsetWidth&&i._timelineCells&&i._timelineCells[0]&&i._timelineCells[0].date.getTime()===e.getTime()&&i._timelineCells.length===t[i._getCellsViewType()]?void i._refresh():void(i.$.timelineContent.style.width=i.$.timelineAnimationContainer.style.width="",i._createTimelineCellsObj(e,t),i._createTimelineHeaderCellsObj(e,t),i.$.timelineViewDetails.innerHTML="",i.$.timelineViewDetails.appendChild(i._createCells(i._getHeaderVisibleCellsCount())),i.$.timelineViewCells.innerHTML="",i.$.timelineViewCells.appendChild(i._createCells(i._getTimelineVisibleCellsCount())),i._refreshHeaderDate(),i.$.timelineContent.style.width=i.$.timelineAnimationContainer.style.width=Math.max(t[a]*i._timelineCells[0].width,i.$.timeline.parentElement.offsetWidth)+"px",i._refresh(),i.scrollLeft&&(i.$.timeline.scrollLeft=i._getScrollLeft(i.scrollLeft)),i.scrollTop&&(i.$.timelineContent.scrollTop=i.scrollTop))}_getCellsViewType(){switch(this.view){case"year":return"month";case"month":return"week";case"week":return"day";case"day":return"hour";}}_createTimelineCellsObj(e,t){const i=this,a=i._getCellsViewType();t=t[a];const n=window.getComputedStyle(i),s=i.$.timeline.parentElement.offsetWidth;let l=Math.max(parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-size"))||0,parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0)),r=0,o=new Date(e);t*l<s&&(l=s/t),l=parseFloat(l.toFixed(2)),i._timelineCells=[];for(let n=0;n<t;n++){const e={left:r,width:l};if("year"===a)o.setMonth(0),e.date=new Date(o),o.setFullYear(o.getFullYear()+1);else if("month"===a)o.setDate(1),e.date=new Date(o),o.setMonth(o.getMonth()+1);else if("week"===a)o.setHours(0,0,0,0),o.setDate(o.getDate()-o.getDay()),e.date=new Date(o),o.setDate(o.getDate()+7);else if("day"===a)-1<i.nonworkingDays.indexOf(o.getDay())&&(e.nonworking=!0),o.setHours(0,0,0,0),e.date=new Date(o),o.setDate(o.getDate()+1),e.weekend=0===e.date.getDay()||6===e.date.getDay();else if("hour"===a){(-1<i.nonworkingHours.indexOf(o.getHours())||-1<i.nonworkingDays.indexOf(o.getDay()))&&(e.nonworking=!0),o.setHours(o.getHours(),0,0,0),e.date=new Date(o);const t=o.getTime();o.setHours(o.getHours()+1),t===o.getTime()&&o.setHours(o.getHours()+2),e.weekend=0===e.date.getDay()||6===e.date.getDay()}i._timelineCells.push(e),r=parseFloat((r+l).toFixed(2))}}_createTimelineHeaderCellsObj(e,t){const a=this,n=a.view;let s=0,l=new Date(e);t=t[n],a._timelineHeaderCells=[];for(let r=0;r<t;r++){const e={date:new Date(l)};"year"===n?l.setFullYear(l.getFullYear()+1):"month"===n?(l.setDate(1),l.setMonth(l.getMonth()+1)):"week"===n?l.setDate(l.getDate()+7):"day"===n?l.setDate(l.getDate()+1):void 0;s=a._refreshViewDetailCell(e,s,r),a._timelineHeaderCells.push(e)}}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=this,i=new Date(t.min),a=new Date(t.max);return i&&(e=new Date(Math.max(i.getTime(),e.getTime()))),a&&(e=new Date(Math.min(a.getTime(),e.getTime()))),e}_dateValidator(e,t){const i=this;if(t instanceof Date)return i._minMaxDateValidator(t);if(Smart.Utilities.DateTime&&t instanceof Smart.Utilities.DateTime)return i._minMaxDateValidator(t.toDate());if("string"==typeof t){if("new Date()"===t.trim()||"new Smart.Utilities.DateTime()"===t.trim())return i._minMaxDateValidator(new Date);let e,a=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(a.test(t)){const i=a.exec(t)[0].replace(/[,-.\/]/g,",").split(",");if(3===i.length){if(e=new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2])),a=/\d+:\d+:\d+/,a.test(t)){const i=a.exec(t)[0].split(":");e.setHours(i[0]||0,i[1]||0,i[2]||0)}t=e}}}else return i._minMaxDateValidator(e);return i._minMaxDateValidator(new Date(t))}_getTaskBarPositionLimits(e,t){function i(t){const i=a._getTimelineTaskCellByDate(e,t);if(i)return i.left+a._getTimelineTaskOffset(i,t)||0}const a=this;return{min:i(e._task["min"+t]),max:i(e._task["max"+t])}}_getTimelineTaskOffset(e,t){const i=this;if(!e)return;let a,n;switch(i.view){case"year":{const i=t.getHours()/24+t.getMinutes()/1440+t.getSeconds()/86400;a=new Date(e.date.getFullYear(),e.date.getMonth()+1,0),n=(t.getDate()-1+i)/a.getDate()*e.width;break}case"month":n=t.getDay()/7*e.width;break;case"week":n=parseFloat(t.getHours()+t.getMinutes()/60+t.getSeconds()/3600)/24*e.width;break;case"day":n=parseFloat(t.getMinutes()+t.getSeconds()/60)/60*e.width;}return n}_getTaskBarSizeLimits(e,t){function i(i,n){if(!i)return;let s,o;"left"===t&&!l.rightToLeft||"right"===t&&l.rightToLeft?(i=-1*i,o=r.dateEnd):o=r.dateStart,n&&a(s)===a(i)&&(s=0);let d=l._getTaskWorkingDateEnd({dateStart:o},i);const m=d.getTime()+1e3*(60*(d.getTimezoneOffset()-o.getTimezoneOffset())),c=l._getTimelineTaskCellByDate(e,new Date(m));if(c){const i=l._getTimelineTaskOffset(c,new Date(m));return l.rightToLeft?"left"===t?i-(l.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth-c.left):l.$.timelineContent.offsetWidth-e.offsetLeft-c.left-i:"left"===t?e.offsetLeft+e.offsetWidth-c.left-i:c.left-e.offsetLeft+i}}var a=Math.abs,n=Math.max,s=Math.min;const l=this,r=l._getTaskBarDateRange(e);let o,d=0,m=l._convertDuration(e._task.minDuration)||l._getMinDuration(e,t),c=l._convertDuration(e._task.maxDuration);if("left"===t&&!l.rightToLeft||"right"===t&&l.rightToLeft){const t=e._task.maxDateStart,i=e._task.minDateStart;i&&(d=1e3*(60*(i.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())),o=a(i.getTime()-r.dateEnd.getTime())+d,c=c?s(o,c):o),t&&(d=1e3*(60*(t.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())),o=a(t.getTime()-r.dateEnd.getTime())+d,m=m?n(o,m):o)}else{const t=e._task.maxDateEnd,i=e._task.minDateEnd;i&&(d=1e3*(60*(i.getTimezoneOffset()-r.dateStart.getTimezoneOffset())),o=a(i.getTime()-r.dateStart.getTime())+d,m=m?n(o,m):o),t&&(d=1e3*(60*(t.getTimezoneOffset()-r.dateStart.getTimezoneOffset())),o=a(t.getTime()-r.dateStart.getTime())+d,c=c?s(o,c):o)}return c&&(m=s(m,c)),{min:i(m,!0),max:i(c)}}_getMinDuration(e,t){const a=this,i=parseFloat(getComputedStyle(a).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;if(!i||!a._timelineCells||0===a._timelineCells.length)return;const n=e._task;let s,l,r=1;l=a.rightToLeft?parseFloat(e.style.right)||a.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth:parseFloat(e.style.left)||e.offsetLeft,"left"===t?(s=n.dateEnd,l+=parseFloat(e.style.width)||e.offsetWidth,r=-1):s=n.dateStart;const o=l+r*i;let d;for(let n=0;n<a._timelineCells.length;n++){const e=a._timelineCells[n];if(o<e.left)break;d=e}const m=a._getDateFromCell(o,d);return m?Math.abs(s.getTime()-m.getTime()):void 0}_createDelimiter(e,t){const i=this,a=e.slice(0,3),n=document.createElement("div");if(n.classList.add("smart-task-bar-limitter-"+e),-1<e.indexOf("date")){if(!this._dragDetails[a].left)return;const e=i._dragDetails.timelineTask,t=i.$.timelineCellsContainer.children[i._tasks.indexOf(e._task)];n.style.width=-1<a.indexOf("max")?t.offsetWidth-i._dragDetails[a].left-e.offsetWidth+"px":i._dragDetails[a].left+"px"}else{if(!this._dragDetails[a].width)return;n.style["left"===t?"right":"left"]=i._dragDetails[a].width+"px"}return n}_doubleClickHandler(e){const t=this;let i=e.target;t.shadowRoot&&i===t&&(i=e.composedPath()[0]);let a=i.closest?i.closest(".smart-task-connection"):void 0;return a?void t._openPopupWindow(a):(a=i.closest(".smart-timeline-task")||i.closest(".smart-task-label-container")||i.closest(".smart-tree-item-label-container"),a)?void(a.classList.contains("smart-timeline-task")?t._openPopupWindow(a):t._openPopupWindow(t.$.timelineTasksContainer.children[t._getTaskItemIndex(a)])):void 0}_checkDoubleClick(e){const t=this;let i=e.target;if(t.shadowRoot&&i===t&&(i=e.composedPath()[0]),void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),i!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=i,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout(function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0)},300),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,!0}_downHandler(e){const t=this,i=e.originalEvent,a=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target,n=a.closest?a.closest(".smart-timeline-task-cell")||a.closest(".smart-timeline-task"):null;if(e.stopPropagation(),t._dragDetails)return delete t._dragDetails,void t._setConnectionFeedback();if(Smart.Utilities.Core.isMobile||0===e.button){if(!n){if(a.classList.contains("smart-popup-window-modal")){if(t._popupWindow){const e=Object.keys(t._popupWindow);requestAnimationFrame(()=>t._popupWindow[e[e.length-1]].focus())}return}return(a.closest(".smart-tree-item-label-container")&&!a.classList.contains("smart-arrow-down")||a.closest(".smart-task-connection")||a.closest(".smart-task-label-container"))&&t._checkDoubleClick(i)?void 0:void(a.closest(".smart-tree-item-label-container")||a.closest("smart-scroll-bar")||(t._itemIndexClicked=t._getTaskItemIndex(a),t._selectTask(void 0===t._itemIndexClicked?null:t._tasks[t._itemIndexClicked]),t.$.taskTree.focus(),t.$.mainSplitter.contains(a)&&i.preventDefault()))}const s=t.$.timelineTasksContainer.children[t._tasks.indexOf(n._task)],l=s._task;if(l&&(s.getElementsByClassName("smart-timeline-task-fill")[0]||t.$.timeline.hasAttribute("task-bar-hovered"))){if((a.closest(".smart-timeline-task-fill")||s.classList.contains("milestone")&&a.closest(".smart-task-container"))&&t._checkDoubleClick(i))return;const n=a.closest(".smart-timeline-task-progress-thumb"),r=e.pageX-window.pageXOffset,o=e.pageY-window.pageYOffset;t._dragDetails={},t._dragDetails.target=n||a,t._dragDetails.timelineTask=s,t._dragDetails.coordinates={x:r,y:o};const d=(n||s).getBoundingClientRect();if(t._dragDetails.offset={x:r-d.left,y:o-d.top},n||!n&&"project"===l.type&&l.synchronized&&!l.dragProject)return;("visible"===t.resizeHandlesVisibility||Smart.Utilities.Core.isMobile&&"auto"===t.resizeHandlesVisibility)&&(a.closest(".smart-timeline-task-fill")?t._checkTaskBarResizability(e):t.$.timeline.removeAttribute("task-bar-hovered")),t._dragDetails.originalPosition=t.rightToLeft?{x:t.$.timelineContent.offsetWidth-(s.offsetLeft+s.offsetWidth),y:s.offsetTop}:{x:s.offsetLeft,y:s.offsetTop},t._dragDetails.originalSize={width:s.offsetWidth,height:s.offsetHeight},t._dragDetails.min={},t._dragDetails.max={},t._setDragLimits(a)}}}_documentMoveHandler(e){const t=this;if(!t._dragDetails||!t._dragDetails.target){let i=e.originalEvent.target;return t.shadowRoot&&i===t&&(i=e.originalEvent.composedPath()[0]),t._hoverTask(t._getTaskItemIndex(i)),void 0===t._hoveredIndex&&t._handleTimelineHover(e),void t._checkTaskBarResizability(e)}return t._dragDetails.target.classList.contains("smart-task-connection-point")?(t._setConnectionFeedback(e),t._handleTimelineHover(e),void t._autoScroll(e)):t._dragDetails.target.classList.contains("smart-timeline-task-progress-thumb")?void t._handleTaskProgressChange(e):(t._autoScroll(e),t._autoScrolling?void 0:t.$.timeline.hasAttribute("task-bar-hovered")?void t._handleTaskBarResize(e):t._dragDetails.target.closest(".smart-timeline-task-fill")&&t._dragDetails.timelineTask&&!t._dragDetails.timelineTask.hasAttribute("disable-drag")?void t._handleTaskBarDrag(e):void 0)}_documentUpHandler(e){const t=this,i=e.originalEvent;let a=i.target;if(void 0!==t._itemIndexClicked)return void(t._itemIndexClicked=void 0);if(!t._dragDetails)return;t.shadowRoot&&a===t&&(a=i.composedPath()[0]);let n;const s=t._dragDetails.timelineTask;if(s&&(n=t.$.timelineCellsContainer.children[t._tasks.indexOf(s._task)]),t.hasAttribute("dragged")){t._snapToNearest(s),t._checkWorkingDays(s),t._refreshProject(n._task.project),t.removeAttribute("dragged"),t.$.fireEvent("dragEnd",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd});const e=n.getElementsByClassName("smart-task-bar-limitter-min-date")[0],i=n.getElementsByClassName("smart-task-bar-limitter-max-date")[0];e&&e.parentElement.removeChild(e),i&&i.parentElement.removeChild(i),t._autoSchedule(s._task),t._scrollView.disableSwipeScroll=!1}else if(t.hasAttribute("progress-change"))t.removeAttribute("progress-change"),t.$.fireEvent("progressChangeEnd",{taskId:t._tasks.indexOf(n._task),progress:n._task.progress||0}),t._scrollView.disableSwipeScroll=!1;else if(t.hasAttribute("resized"))t._snapToNearest(s),t._refreshProject(n._task.project),t.removeAttribute("resized"),t.$.fireEvent("resizeEnd",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}),t._autoSchedule(s._task),t._scrollView.disableSwipeScroll=!1;else if(t.hasAttribute("connecting-task")){const i=t._connectTask(e),a=t._tasks;t._setConnectionFeedback(),i&&(t.$.fireEvent("connectionEnd",{source:a.indexOf(i.taskStart),target:a.indexOf(i.target),type:i.type}),t._autoSchedule(i.taskStart._task)),Smart.Utilities.Core.isMobile&&(t._handleTimelineHover(e,!0),t._scrollView.disableSwipeScroll=!1)}else{const e=a.closest(".smart-timeline-task");e===s?t._selectTask(n._task):t._selectTask()}if(s){const e=s.getElementsByClassName("smart-task-bar-limitter-max")[0],t=s.getElementsByClassName("smart-task-bar-limitter-min")[0];e&&e.parentElement.removeChild(e),t&&t.parentElement.removeChild(t)}delete t._dragDetails}_moveHandler(e){const t=this;Smart.Utilities.Core.isMobile||e.stopPropagation(),(t.hasAttribute("dragged")||t.hasAttribute("progress-change"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_getTaskItemIndex(e){const t=this;if(!e||!e.closest||!(t.shadowRoot||t).contains(e))return;let i=e.closest(".smart-task-label-container");return i?[].slice.call(i.closest("smart-splitter-item").getElementsByClassName("smart-task-label-container")).indexOf(i):(i=e.closest(".smart-tree-item-label-container"),i)?[].slice.call(t.$.taskTree.getElementsByClassName("smart-tree-item-label-container")).indexOf(i):void 0}_hoverTask(e){const t=this;if(t._hoveredIndex!==e){const a=t.$.treeSplitter.querySelectorAll("smart-tree-item, smart-tree-items-group, .smart-task-label-container");for(let e=0;e<a.length;e++)a[e].removeAttribute("hover");if(void 0===e||0>e)return t._hoveredIndex=void 0,void t._handleTimelineHover({target:t});if(!Smart.Utilities.Core.isMobile&&t.taskColumns.length){const a=t.$.treeSplitter._items;for(let n=0;n<a.length;n++){const i=a[n];let s;s=i===t.$.taskTreeSplitterItem?[].slice.call(i.querySelectorAll("smart-tree-item, smart-tree-items-group")):[].slice.call(i.getElementsByClassName("smart-task-label-container")),s[e]&&s[e].setAttribute("hover","")}t._hoveredIndex=e,t._handleTimelineHover({target:t.$.timelineTasksContainer.children[e]})}}}_checkWorkingDays(e){var t=Math.min;const i=this;if((i._dragDetails._taskDuration||i._timelineCells.length)&&e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&i.hasAttribute("dragged")){if(0===i.nonworkingDays.length&&0===i.nonworkingHours.length||!i._dragDetails._taskDuration)return;const a=e._task,n=i._getTaskWorkingDateEnd(a);let s=new Date(i._timelineCells[i._timelineCells.length-1].date);"year"===i.view?(s.setMonth(s.getMonth()+1),s.setDate(0),s.setHours(23,59,59,999)):"month"===i.view?(s.setDate(s.getDate()+6-s.getDay()),s.setHours(23,59,59,999)):"week"===i.view?s.setHours(23,59,59,999):s.setHours(s.getHours(),59,59,999),a.dateEnd=a.maxDateEnd?new Date(t(n.getTime(),a.maxDateEnd.getTime())):n,a.dateEnd=new Date(t(s.getTime(),a.dateEnd.getTime())),a.duration=i._convertDuration(0<i.nonworkingDays.length||0<i.nonworkingHours.length?i._getWorkingTime(a.dateStart,a.dateEnd):a.dateEnd.getTime()-a.dateStart.getTime(),!0),i._setTimelineTaskBar(e._task,!0),i._refreshTaskConnections(e._task),i._refreshTaskColumnsData(a,["dateEnd","duration"])}}_getTaskWorkingDateEnd(e,t){var i=Math.min;if(!e||!e.dateStart)return;const a=this;let n,s,l=new Date(e.dateStart);t||(t=a._dragDetails?a._dragDetails._taskDuration:a._getWorkingTime(e.dateStart,e.dateEnd));const r=0>t?-1:1;for(t=Math.abs(t);0<t;){const e=i(t,3600000-(1e3*(60*l.getMinutes())+1e3*l.getSeconds()+l.getMilliseconds()));if(-1<a.nonworkingDays.indexOf(l.getDay())){s=new Date(l),s.setHours(0,0,0,0),s.setDate(l.getDate()+1*r),n=i(e,s.getTime()-l.getTime()),l=new Date(l.getTime()+n);continue}if(-1<a.nonworkingHours.indexOf(l.getHours())){s=new Date(l);const t=s.getTime();s.setHours(l.getHours()+1*r,0,0,0),t===s.getTime()&&s.setHours(l.getHours()+2*r,0,0,0),n=i(e,s.getTime()-l.getTime()),l=new Date(l.getTime()+n);continue}t-=e,l=new Date(l.getTime()+r*e)}return l}_createConnectingElement(e,t,i,a,n){var s=Math.abs;const l=this;if(!l._connectionDetails||!l._connectionDetails.start)return;const r=l._connectionDetails,o=r.type,d=l.$.timelineConnectionsContainer;let m=r.connections.shift();m||(m=document.createElement("div"),m.classList.add("smart-task-connection")),m.style.width=m.style.width="","horizontal"===a?(m.style.width=s(i)+"px",m.style.height=""):(m.style.width="",m.style.height=s(i)+"px"),m.style[l.rightToLeft?"left":"right"]="",m.style[l.rightToLeft?"right":"left"]=e+"px",m.style.top=t+"px",m.setAttribute("connection-id",r.id);const c=r.start.task._task.label,g=0===o||3===o?"start":"end",h=r.end.task._task.label,p=0===o||1===o?"start":"end";if(m.setAttribute("aria-label","Connection between "+c+" ("+g+") and "+h+" ("+p+")"),n){let e=0===o||1===o?"right":"left";l.rightToLeft&&(e="left"===e?"right":"left"),m.setAttribute("arrow-direction",e)}else m.removeAttribute("arrow-direction");m.parentElement||d.appendChild(m)}_getConnectionType(e,t){if(e&&t){let i=!e.classList.contains("end"),a=t.classList.contains("end");return i&&!a?0:i||a?!i&&a?2:i&&a?3:void 0:1}}_setConnectionFeedback(e){var t=Math.PI,i=Math.atan2,a=Math.pow,n=Math.abs;const s=this;if(!s._dragDetails||!s._dragDetails.target||!e)return s._connectionFeedback&&s._connectionFeedback.parentElement&&(s._connectionFeedback.closest(".smart-timeline-task").removeAttribute("connection-point"),s._connectionFeedback.parentElement.removeChild(s._connectionFeedback)),s.removeAttribute("connecting-task"),void delete s._connectionFeedback;if(!s._dragDetails.target||!s._dragDetails.target.classList.contains("smart-task-connection-point"))return;const l=s._dragDetails.target.closest(".smart-timeline-task");if(!l)return;if(!s.hasAttribute("connecting-task")){if(s.$.fireEvent("connectionStart",{source:l}).defaultPrevented)return void delete s._dragDetails.target;s.setAttribute("connecting-task",""),Smart.Utilities.Core.isMobile&&(s._scrollView.disableSwipeScroll=!0)}const r=l.classList.contains("milestone");let o=r?-1*l.offsetHeight/2:0;s._dragDetails.target.classList.contains("end")&&(l.setAttribute("connection-point","end"),o=r?-1*o:l.offsetWidth),s._connectionFeedback||(s._connectionFeedback=document.createElement("div"),s._connectionFeedback.classList.add("smart-task-connection-feedback"));const d=s._dragDetails.coordinates.x+(s.rightToLeft?-1:1)*o,m=s._dragDetails.coordinates.y,c=s._dragDetails.offset.x-(s.rightToLeft?l.offsetWidth:0),g=s._dragDetails.offset.y,h=e.pageX-window.pageXOffset+c,p=e.pageY-window.pageYOffset+g-l.offsetHeight/2;s._connectionFeedback.style.width=Math.sqrt(a(n(h-d),2)+a(n(p-m),2))+"px",s._connectionFeedback.style.transform=s.rightToLeft?"rotate("+180*(i(m-p,d-h)||0)/t+"deg)":"rotate("+180*(i(p-m,h-d)||0)/t+"deg)",s._connectionFeedback.parentElement||l.firstElementChild.appendChild(s._connectionFeedback)}_connectTask(e){const t=this;let i,a,n,s,l;if(e.originalEvent){const l=e.originalEvent;let r=Smart.Utilities.Core.isMobile?document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset):l.target;if(!t._dragDetails||!t._dragDetails.target||!r||!r.classList)return;if(t.shadowRoot&&r===t&&(r=Smart.Utilities.Core.isMobile?t.shadowRoot.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset):l.composedPath()[0]),i=t._dragDetails.target.classList.contains("smart-task-connection-point")?t._dragDetails.target:void 0,a=r.classList.contains("smart-task-connection-point")?r:void 0,i&&(n=i.closest(".smart-timeline-task")),a)s=a.closest(".smart-timeline-task");else if(Smart.Utilities.Core.isMobile&&r.classList.contains("smart-timeline-task-fill")&&(s=r.closest(".smart-timeline-task"),s)){const e=l.pageX-window.pageXOffset-s.getBoundingClientRect().left;a=s.querySelector(".smart-task-connection-point."+(e>=s.offsetWidth/2?"end":"start"))}}else{if(!e||3>e.length)return;if(e=(e+"").split("-"),e=t._getValidConnectionId(e[0],e[1],e[2],"_connectTask"),void 0===e)return;const r=t.$.timelineTasksContainer.children;n=r[parseInt(e[0])],s=r[parseInt(e[1])],l=parseInt(e[2]),n&&s&&(i=n.querySelector(".smart-task-connection-point."+(0===l||3===l?"start":"end")),a=s.querySelector(".smart-task-connection-point."+(0===l||1===l?"start":"end")))}return i&&a&&n&&s&&n!==s&&!n.classList.contains("smart-visibility-hidden")&&!s.classList.contains("smart-visibility-hidden")?t._isAutoScheduled(n,s)?void 0:(void 0===l&&(l=t._getConnectionType(i,a)),t._connectionDetails={start:{point:i},end:{point:a},type:l},t._setConnectionDetails(),t._createTaskConnection(),t.hasAttribute("dragged")||t.hasAttribute("resized")||t._updateConnection(t._tasks.indexOf(n._task)+"-"+t._tasks.indexOf(s._task)+"-"+t._connectionDetails.type),delete t._connectionDetails,n.setAttribute("connected",""),s.setAttribute("connected",""),{taskStart:n,taskEnd:s,type:l}):void 0}_isAutoScheduled(e,t,a){function n(e,t){const o=e.connections,d=l.indexOf(e);r[d]=!0;for(let m=0;m<o.length;m++){const e=o[m],i=s._getTaskIndexById(e.target);if(i===t)return a&&s._removeConnection(d+"-"+i+"-"+e.type,!0),!0;if(!r[i]&&n(l[i],t))return!0}}const s=this,l=s._tasks;let r={};return s.autoSchedule?n(t._task,l.indexOf(e._task)):void 0}_setConnectionDetails(){var e=Math.abs;const t=this;if(!t._connectionDetails)return;const i=t._connectionDetails,a=i.start.point,n=i.end.point,s=i.type;if(!a||!n)return;let l,r=a.closest(".smart-timeline-task"),o=n.closest(".smart-timeline-task"),d=r.offsetWidth,m=o.offsetWidth,c=r.offsetLeft,g=o.offsetLeft,h=r.offsetTop,p=o.offsetTop,f=a.offsetLeft,_=n.offsetLeft;const u=r.classList.contains("milestone"),k=o.classList.contains("milestone"),T=[].slice.call(t.$.timelineTasksContainer.children),y=T.indexOf(r),C=T.indexOf(o);if(t.rightToLeft){const e=t.$.timelineContent.offsetWidth;c=e-(c+d),g=e-(g+m)}if(i.id=y+"-"+(C+"-")+s,u?(d=r.offsetHeight,c-=d/2):k&&(m=o.offsetHeight,g-=m/2),i.connectionStartOffset&&i.connectionEndOffset||(0===s?t.rightToLeft?(f-=u?d/2:d,_-=k?m/2:m):(f=e(f)-a.offsetWidth-(u?d/2:0),_=e(_)-n.offsetWidth-(k?m/2:0)):1===s?t.rightToLeft?(f=e(f)-a.offsetWidth-(u?d/2:0),_-=k?m/2:m):(f-=u?d/2:d,_=e(_)-n.offsetWidth-(k?m/2:0)):2===s?t.rightToLeft?(f=e(f)-a.offsetWidth-(u?d/2:0),_=e(_)-n.offsetWidth-(k?m/2:0)):(f-=u?d/2:d,_-=k?m/2:m):t.rightToLeft?(f-=u?d/2:d,_=e(_)-n.offsetWidth-(k?m/2:0)):(f=e(f)-a.offsetWidth-(u?d/2:0),_-=k?m/2:m),i.start.offset=f+=a.offsetWidth/2,i.end.offset=_+=n.offsetWidth/2),0===s&&c>g||1===s&&c+d+f>g-_&&p>h||2===s&&g+m>c+d||3===s&&(c-f<g+m+_&&p>h||c-f>g+m+_&&h>p)){l=!0;let e=r;r=o,o=e,e=f,f=_,_=e,e=d,d=m,m=e,e=c,c=g,g=e,e=h,h=p,p=e}let D=c,x=g;!l&&1===s||l&&3===s?D+=d:!l&&3===s||l&&1===s?x+=m:2===s&&(D+=d,x+=m);let w=t.$.timelineConnectionsContainer.querySelectorAll(".smart-task-connection[connection-id^=\""+y+"-"+C+"-\"]");0===w.length&&(w=t.$.timelineConnectionsContainer.querySelectorAll(".smart-task-connection[connection-id^=\""+(C+"-"+y)+"\"]")),i.connections=[].slice.call(w),i.start.x=D,i.start.y=h+a.offsetTop,i.start.task=r,i.end.x=x,i.end.y=p+n.offsetTop,i.end.task=o,i.type=s,i.inverted=l}_createTaskConnection(){function e(c){_===d||(c?"horizontal"===c?(k=_-d+(D?-1:1)*r,_=T>C?_-t(k):_,i._createConnectingElement(_,u,(T===C?0:t(k))+(b?n:0),"horizontal"),_=T<C?_-k:_,e("vertical")):(k=t(u-m),u+=l<m?0:-1*k,_-=h&&1===g||!h&&3===g&&l>m?n:0,i._createConnectingElement(_,u,k,"vertical"),e()):(_?(k=t(_-d),_>=d&&(_+=-1*k,k+=n),i._createConnectingElement(_,u+(l<m?t(u-m):0),k,"horizontal",!a.inverted),_=d):(_=s,u=l,(0===g||!h&&3===g||h&&1===g)&&(_-=r),i._createConnectingElement(_,u,r,"horizontal",a.inverted),b&&(_+=r-n),D||w?(i._createConnectingElement(_,u-=l>m?o:0,o,"vertical"),u+=l<m?o:0):e("vertical")),e("horizontal")))}var t=Math.abs;const i=this,a=i._connectionDetails;if(!a)return;const n=2*(parseFloat(getComputedStyle(i).getPropertyValue("--smart-gantt-chart-timeline-task-connection-width"))||1),s=a.start.x,l=a.start.y,r=a.start.offset,o=a.start.point.offsetTop,d=a.end.x,m=a.end.y,c=a.end.offset,g=a.type,h=a.inverted,p=!h&&3===g||h&&1===g,f=!h&&1===g||h&&3===g;let _,u,k,T=s,C=d;p?(T=s-c,C=d+c):f&&(T=s+r,C=d-c);const D=T<=C&&p,w=T>=C&&f,b=2===g||f;e(),a.connections.map(e=>e.parentElement.removeChild(e))}_getTaskIndexById(e){const t=this;if("number"==typeof e)return e;const i=t._tasks;if("object"==typeof e)return i.indexOf(e);if("string"==typeof e){for(let a=0;a<i.length;a++){const t=i[a];if(t.id===e)return a}return isNaN(parseInt(e))?-1:parseInt(e)}}_refreshTaskConnections(e){const t=this,i=e instanceof HTMLElement?e._task:e,a=t._tasks.indexOf(i);if(void 0===a||e.classList&&e.classList.contains("smart-visibility-hidden"))return;let n;if(t._dragDetails&&(n=t._dragDetails.relatedConnections[a]),!n){n={};const e=t._tasks;for(let i=0;i<e.length;i++){const s=e[i].connections.filter(e=>t._getTaskIndexById(e.target)===a);0<s.length&&(n[i]=s)}t._dragDetails&&(t._dragDetails.relatedConnections[a]=n)}const s=i.connections;for(let i=0;i<s.length;i++){const e=s[i];t._connectTask(a+"-"+t._getTaskIndexById(e.target)+"-"+e.type)}if(0<Object.keys(n).length)for(const e in n){const i=n[e];for(let a=0;a<i.length;a++)t._connectTask(e+"-"+t._getTaskIndexById(i[a].target)+"-"+i[a].type)}}_dragStartHandler(e){const t=this,i=e.target.closest;(t._dragDetails||i&&i.call(t,"smart-gantt-chart")===t)&&e.preventDefault()}_getFirstCellObjInView(e){const t=this;if(e||(e=t._timelineCells),!e)return;const a=Math.abs(t.scrollLeft);let i;for(let t=0;t<e.length;t++){const n=e[t];if(n.left+n.width>a){i=n;break}}return i}_getSubTaskLimits(e){var t=Math.max;const i=this;if(!e)return;const a=e._task,n=a.tasks;let s,l;if(!a.tasks||0===a.tasks.length)return;let r=n[0],o=n[0];for(let t=0;t<n.length;t++){const e=n[t];n[t].dateEnd&&n[t].dateStart&&(r.dateStart||(r=e[t]),o.dateEnd||(o=e[t]),n[t].dateEnd.getTime()>o.dateEnd.getTime()&&(o=n[t]),n[t].dateStart.getTime()<r.dateStart.getTime()&&(r=n[t]))}const d=i.$.timelineTasksContainer.children,m=i.$.timelineContent.offsetWidth;let c;if(r&&(c=d[i._tasks.indexOf(r)],c&&(s=t(0,i.rightToLeft?m-e.offsetLeft-e.offsetWidth-(m-c.offsetLeft-c.offsetWidth):e.offsetLeft-c.offsetLeft))),o&&(c=d[i._tasks.indexOf(o)],c)){const a=i.$.timelineCellsContainer.children[i._tasks.indexOf(o)];if(i.rightToLeft){const i=m-e.offsetLeft-e.offsetWidth;l=t(i,i+a.offsetWidth-(m-c.offsetLeft))}else l=t(e.offsetLeft,e.offsetLeft+a.offsetWidth-(c.offsetLeft+c.offsetWidth))}return{min:s,max:l}}_getTaskDragLimits(e){var t=Math.max;const i=this,a=i._getTaskBarPositionLimits(e,"DateStart"),n=i._getTaskBarPositionLimits(e,"DateEnd"),s=i._dragDetails.timelineTask;let l={};return(a.min||n.min)&&(l.min=t(a.min||0,t(0,(n.min||0)-s.offsetWidth))),n.max&&(l.max=t(0,n.max-s.offsetWidth)),a.max&&(l.max=l.max?Math.min(a.max,l.max):a.max),l}_getTaskBarDateRange(e){if(!e)return;const t=this,i=t.rightToLeft?parseFloat(e.style.right)||t.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth:parseFloat(e.style.left)||e.offsetLeft,a=parseFloat(e.style.width)||e.offsetWidth,n=e._cellStart,s=e._cellEnd,l=e._task,r=l.minDateStart,o=l.maxDateEnd;let d,m;return d=t._getDateFromCell(i,n),r&&!("project"===e._task.type&&e._task.synchronized)&&(d=new Date(Math.max(r.getTime(),d.getTime()))),m=t._getDateFromCell(i+a,s),o&&!("project"===e._task.type&&e._task.synchronized)&&(m=new Date(Math.min(o.getTime(),m.getTime()))),{dateStart:d,dateEnd:m}}_getTaskBarDetails(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;const i=t.$.timelineCellsContainer.children[t._tasks.indexOf(e._task)];if(!i)return;let a=new Date(i._task.dateStart);const n=new Date(i._task.dateEnd),s=e._cellStart,l=e._cellEnd;if(!s||!l)return void e.classList.add("smart-visibility-hidden");if(t.snapToNearest){let a,n,r=e._task.dateStart,o=e._task.dateEnd;const d=new Date(s.date),m=t._getDateFromCell(s.left+s.width,s),c=new Date(l.date),g=t._getDateFromCell(l.left+l.width,l);return m.getTime()-r.getTime()>=m.getTime()-d.getTime()?(r=d,a=s.left):(r=m,a=s.left+s.width),"milestone"!==e._task.type&&(g.getTime()-o.getTime()>=o.getTime()-c.getTime()?(o=c,n=l.left-a):(o=g,n=l.left-a+l.width)),e._task.dateEnd=o,e._task.dateStart=r,{left:a,width:n,top:i.offsetTop}}let r,o,d,m,c,g;switch(t.view){case"year":{d=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),m=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();const e=a.getHours()/24+a.getMinutes()/1440+a.getSeconds()/86400,t=n.getHours()/24+n.getMinutes()/1440+n.getSeconds()/86400;r=s.left+(a.getDate()-1+e)/d*s.width,o=l.left+(n.getDate()-1+t)/m*l.width-r;break}case"month":{c=parseFloat(a.getHours()+"."+a.getMinutes()+a.getSeconds())/24*(s.width/7),g=parseFloat(n.getHours()+"."+n.getMinutes()+n.getSeconds())/24*(s.width/7),r=s.left+a.getDay()/7*s.width+c,o=l.left+n.getDay()/7*l.width-r+g;break}case"week":{c=parseFloat(a.getHours()+"."+a.getMinutes()+a.getSeconds())/24*s.width,g=parseFloat(n.getHours()+"."+n.getMinutes()+n.getSeconds())/24*s.width,r=s.left+c,o=l.left+(g-c)-s.left;break}case"day":c=parseFloat(a.getMinutes()+a.getSeconds()/60)/60*s.width,g=parseFloat(n.getMinutes()+n.getSeconds()/60)/60*s.width,r=s.left+c,o=l.left+(g-c)-s.left;}return{width:"milestone"===i._task.type?"":o,left:r,top:i.offsetTop}}_getTimelineTaskCellByDate(e,t){if(!t||!e)return;const i=this;e.classList&&e.classList.contains("smart-timeline-task")&&(e=i.$.timelineCellsContainer.children[i._tasks.indexOf(e._task)]);const a=i._timelineCells;let n;dateCellsLoop:for(let e=0;e<a.length;e++){const s=a[e];switch(i.view){case"year":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()){n=a[e];break dateCellsLoop}break;case"month":{let i=new Date(s.date);if(i.setDate(i.getDate()+(6-i.getDay())+1),i.setMilliseconds(i.getMilliseconds()-1),t.getTime()>=s.date.getTime()&&t.getTime()<=i.getTime()){n=a[e];break dateCellsLoop}break}case"week":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()&&s.date.getDate()===t.getDate()){n=a[e];break dateCellsLoop}break;case"day":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()&&s.date.getDate()===t.getDate()&&s.date.getHours()===t.getHours()){n=a[e];break dateCellsLoop}}}return n}_handleInverted(e){const t=this;if(!e||t.inverted||t.rightToLeft){const e=t.$.mainSplitter,i=t.$.timelineSplitterItem;i.size=i.offsetWidth,e.removeChild(i),t.inverted&&!t.rightToLeft||!t.inverted&&t.rightToLeft?e.insertBefore(i,t.$.treeSplitterItem):e.appendChild(i)}}_handleTaskProgressChange(e){var t=Math.max,i=Math.min;const a=this,n=a._dragDetails.target,s=n.closest(".smart-timeline-task");if(!a.hasAttribute("progress-change")){if(a.$.fireEvent("progressChangeStart",{taskId:a._tasks.indexOf(s._task),progress:s._task.progress||0}).defaultPrevented)return void delete a._dragDetails.target;a.setAttribute("progress-change",""),a._scrollView.disableSwipeScroll=!0}const l=s.querySelector(".smart-timeline-task-progress"),r=l.parentElement,o=r.getBoundingClientRect().left,d=r.offsetWidth,m=e.pageX-window.pageXOffset;a._dragDetails.progress||(a._dragDetails.progress=l.offsetWidth),a._dragDetails.progress=t(0,i(d,a._dragDetails.progress+(a.rightToLeft?-1:1)*(m-a._dragDetails.coordinates.x)));const c=a._dragDetails.timelineTask._task.progress=100*(a._dragDetails.progress/d);a._dragDetails.coordinates.x=t(o+a._dragDetails.offset.x,i(o+d+a._dragDetails.offset.x,m)),n.style[a.rightToLeft?"left":"right"]="",n.style[a.rightToLeft?"right":"left"]=l.style.width=c+"%",a._dragDetails.timelineTask._task.progress=c.toFixed(2)}_handleTaskBarDrag(e){var t=Math.max,i=Math.min;const a=this;if(5>=Math.abs(e.pageX-a._dragDetails.coordinates.x))return;const n=a._dragDetails.timelineTask,s=a.$.timelineCellsContainer.children[a._tasks.indexOf(n._task)];if(!a.hasAttribute("dragged")){if(a.$.fireEvent("dragStart",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}).defaultPrevented)return void delete a._dragDetails.timelineTask;a.setAttribute("dragged",""),a._scrollView.disableSwipeScroll=!0;const e=a._createDelimiter("min-date"),t=a._createDelimiter("max-date");e&&s.appendChild(e),t&&s.appendChild(t)}a._dragDetails.position||(a._dragDetails.position={x:a._dragDetails.originalPosition.x,y:a._dragDetails.originalPosition.y});const l=s.getBoundingClientRect().left,r=s.offsetWidth,o=n.offsetWidth,d=a._dragDetails.min.left||0,m=a._dragDetails.max.left,c=e.pageX-window.pageXOffset;let g=0;a._dragDetails.position.x=t(d,i(r-o,a._dragDetails.position.x+(a.rightToLeft?-1:1)*(c-a._dragDetails.coordinates.x))),m!==void 0&&(a._dragDetails.position.x=i(m,a._dragDetails.position.x),g=r-o-m),a._dragDetails.coordinates.x=a.rightToLeft?t(l+a._dragDetails.offset.x+g,i(l+r-(o-a._dragDetails.offset.x+d),c)):t(l+a._dragDetails.offset.x+d,i(l+r-(o-a._dragDetails.offset.x+g),c));const h=a._dragDetails.position.x-(a.rightToLeft?s.offsetWidth-n.offsetLeft-n.offsetWidth:n.offsetLeft);n.style[a.rightToLeft?"right":"left"]=a._dragDetails.position.x+"px",a._refreshTask(n),a._refreshProject(n._task.project),"project"===n._task.type&&n._task.dragProject&&a._refreshProjectTasks(s,h)}_handleTaskBarResize(e){var t=Math.abs,i=Math.max,a=Math.min;const n=this,s=n._dragDetails.timelineTask,l=n.$.timelineCellsContainer.children[n._tasks.indexOf(s._task)];let r;if(!n.hasAttribute("resized")){if(n.$.fireEvent("resizeStart",{dateStart:s._task.dateStart,dateEnd:s._task.dateEnd}).defaultPrevented)return void n.$.timeline.removeAttribute("task-bar-hovered");n.setAttribute("resized",""),n._scrollView.disableSwipeScroll=!0}if(n._dragDetails.position||(n._dragDetails.position={x:n._dragDetails.originalPosition.x,y:n._dragDetails.originalPosition.y}),n._dragDetails.size||(n._dragDetails.size={width:n._dragDetails.originalSize.width}),r)return;const o=n.$.timeline.getAttribute("task-bar-hovered"),d=l.getBoundingClientRect().left,m=n._dragDetails.min.width||0,c=n._dragDetails.max.width,g=e.pageX-window.pageXOffset;let h=n._dragDetails.size.width,p="object"==typeof e?g-n._dragDetails.coordinates.x:e;if(("left"!==o||n.rightToLeft)&&("right"!==o||!n.rightToLeft))n.rightToLeft?(0>p&&void 0!==c&&(p=-1*a(c-h,t(p))),h=n._dragDetails.size.width=i(m,a(s.offsetLeft+s.offsetWidth,h-p)),s.style.width=n._dragDetails.size.width+"px",n._dragDetails.coordinates.x=i(d+s.offsetLeft,a(d+s.offsetLeft+h-m,g))):(0<p&&void 0!==c&&(p=a(c-h,p)),h=n._dragDetails.size.width=i(m,a(l.offsetWidth-s.offsetLeft,h+p)),n._dragDetails.coordinates.x=i(d+s.offsetLeft+m,a(d+s.offsetLeft+(c||h),g)));else if(n.rightToLeft){0>p?p=-1*a(t(p),h-(m||0)):void 0!==c&&(p=a(c-h,t(p))),h=n._dragDetails.size.width=i(m,a(l.offsetWidth-s.offsetLeft,h+p));const e=s.offsetLeft;s.style.left="",s.style.right=i(0,(parseFloat(s.style.right)||l.offsetWidth-s.offsetLeft-s.offsetWidth)-p)+"px",n._dragDetails.coordinates.x=i(d+s.offsetLeft+m,a(d+e+h,g))}else 0<p?p=a(p,h-(m||0)):void 0!==c&&(p=-1*a(c-h,t(p))),h=n._dragDetails.size.width=i(m,a(s.offsetLeft+h,h-p)),s.style.right="",s.style.left=i(0,(parseFloat(s.style.left)||s.offsetLeft)+p)+"px",n._dragDetails.coordinates.x=i(d+s.offsetLeft,a(d+s.offsetLeft+h-m,g));s.style.width=n._dragDetails.size.width+"px",n._refreshTask(s),n._refreshProject(s._task.project)}_handleTimelineConnectionHover(e){const t=this;if((t.shadowRoot||t).contains(e)){const a=t.$.timelineConnectionsContainer.children,i=e.closest(".smart-task-connection");if(!i&&t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[hover]")){for(let e=0;e<a.length;e++)a[e].removeAttribute("hover");return}if(i){const e=i.getAttribute("connection-id");for(let t=0;t<a.length;t++){const i=a[t];i.getAttribute("connection-id")===e?i.setAttribute("hover",""):i.removeAttribute("hover")}t._hoveredConnectionTasks=i.tasks}}}_handleTimelineHover(e,t){function i(){a._hoveredTimelineTask&&(a._hoveredTimelineTask.removeAttribute("hover"),a.$.timeline.removeAttribute("task-bar-hovered"),delete a._hoveredTimelineTask)}const a=this,n=e.originalEvent||e;let s=n.pageX&&Smart.Utilities.Core.isMobile?document.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.target;if(n.pageX&&a.shadowRoot&&s===a&&(s=n.pageX&&Smart.Utilities.Core.isMobile?a.shadowRoot.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.composedPath()[0]),!s||!s.closest)return;a._handleTimelineConnectionHover(s);let l=s.closest(".smart-timeline-task-cell")||s.closest(".smart-timeline-task");if(t||!l||!(a.shadowRoot||a).contains(l))return void i();l.classList.contains("smart-timeline-task-cell")&&(l=a.$.timelineTasksContainer.children[a._tasks.indexOf(l._task)]);const r=l&&a._connectionFeedback&&l.contains(a._connectionFeedback);if((l!==a._hoveredTimelineTask||r&&a._hoveredTimelineTask===l)&&i(),l&&!r){if(a._hoveredTimelineTask=l,r)return;l.setAttribute("hover","")}a._hoverTask(a._tasks.indexOf(l._task))}_getScrollLeft(e,t){const i=this;return i.rightToLeft?(Smart.Utilities.Core.Browser.Chrome?(!t&&(t=i.scrollWidth),e=t-e):e*=-1,e):e}_resizeEventHandler(){const e=this,t=e.$.timelineCellsContainer.children,i=e.offsetWidth!==e.$.timeline.offsetWidth;if(!e._timelineCells)return void e._refresh();i?(e.$.mainSplitter._resizeEventHandler(),e._createTimelineCells()):e._refresh(),e._recycle();for(let a=0;a<t.length;a++)e._setTimelineTaskBar(t[a]._task,i),e._refreshTaskConnections(t[a]._task);e.$.timeline.scrollLeft=e._getScrollLeft(e.scrollLeft),e.$.timelineContent.scrollTop=e.scrollTop,e.$.taskTree._checkOverflow(),e.$.treeSplitter._resizeEventHandler(),e.$.mainSplitter._resizeEventHandler()}_recycle(e){const t=this;if(!e||"horizontal"===e.context.orientation)return t._recycleHeaderCells(t.$.timelineViewCells),void t._recycleHeaderCells(t.$.timelineViewDetails);const a=t.$.treeSplitter._items;for(let n=0;n<a.length;n++){const i=a[n];if(i===t.$.taskTreeSplitterItem)t.$.taskTree.$.scrollViewer.scrollTop=e.detail.value;else{const t=i.getElementsByClassName("smart-task-tree-content")[0];t.scrollTop=e.detail.value}}}_recycleHeaderCells(e){const t=this,i=e.children,a=t.scrollLeft,n=e===t.$.timelineViewCells,s=n?t._timelineCells:t._timelineHeaderCells;if(!s.length)return;let l=document.createDocumentFragment();for(;i.length;)l.appendChild(e.firstElementChild);const r=t._getFirstCellObjInView(s),o=1-(r.left+r.width-Math.abs(a))/s[0].width,d=l.children.length,m=n?Math.ceil((parseFloat((t.$.timeline.offsetWidth/r.width).toFixed(2))+o).toFixed(2)):t._getHeaderVisibleCellsCount();if(d>m)for(;l.children.length&&l.children.length!==m;)l.removeChild(l.firstElementChild);else if(d<m)for(const e=t._createCells(m-d);e.children.length;)l.appendChild(e.firstElementChild);const c=n?t._getCellsViewType():t.view;let g=s.indexOf(r);for(let a=0;a<l.children.length;a++){const e=l.children[a],i=s[g];if(!i)break;let r=new Date(i.date);n||"week"!==t.view||r.setDate(r.getDate()-r.getDay()),e.style[t.rightToLeft?"right":"left"]=i.left+"px",e.style.width=i.width+"px",e._date=r,e.innerHTML=t._getDateString(r,c,!n),i.weekend?e.setAttribute("weekend",""):e.removeAttribute("weekend"),i.nonworking?e.setAttribute("nonworking",""):e.removeAttribute("nonworking"),g++}e.appendChild(l)}_refresh(){function e(){const e=i.$.timelineCellsContainer.offsetWidth-i.$.timeline.offsetWidth;return 0<e&&"hidden"!==i.horizontalScrollBarVisibility||"visible"===i.horizontalScrollBarVisibility?i.$container.addClass("hscroll"):i.$container.removeClass("hscroll"),e}function t(){const e=i.$.timelineCellsContainer.offsetHeight-i.$.timelineContent.offsetHeight;return 0<e&&"hidden"!==i.verticalScrollBarVisibility||"visible"===i.verticalScrollBarVisibility?i.$container.addClass("vscroll"):i.$container.removeClass("vscroll"),e}const i=this;let a=i.scrollWidth,n=i.scrollHeight;i.scrollWidth=e(),i.scrollHeight=t(),i.scrollHeight&&n===i.scrollHeight||(i.scrollWidth=e()),i.scrollWidth&&a===i.scrollWidth||(i.scrollHeight=t())}_refreshProjectTasks(e,i){const a=this,t=e._task;if(t.tasks&&(!(t.tasks instanceof Array)||0!==t.tasks.length)){const e=t.tasks;for(let n=0;n<e.length;n++){const t=a.$.timelineTasksContainer.children[a._tasks.indexOf(e[n])];t&&(a.rightToLeft?t.style.right=a.$.timelineContent.offsetWidth-(t.offsetLeft+t.offsetWidth-i)+"px":t.style.left=t.offsetLeft+i+"px",a._refreshTask(t))}}}_refreshProject(e){const t=this;if(e){if(!e.synchronized)return void t._refreshProject(e.project);for(;e;){const i=e.tasks;let a=i[0],n=i[0];for(let e=0;e<i.length;e++)a.dateStart.getTime()>=i[e].dateStart.getTime()&&(a=i[e]),n.dateEnd.getTime()<=i[e].dateEnd.getTime()&&(n=i[e]);const s=t.$.timelineTasksContainer.children[t._tasks.indexOf(e)],l=t.$.timelineTasksContainer.children[t._tasks.indexOf(a)],r=t.$.timelineTasksContainer.children[t._tasks.indexOf(n)],o=t.$.timelineContent.offsetWidth;if(!s)return;l&&(e.dateStart=a.dateStart,t.rightToLeft?(s.style.width=s.offsetWidth-(o-l.offsetLeft-l.offsetWidth-(o-s.offsetLeft-s.offsetWidth))+"px",s.style.right=l.style.right):(s.style.width=s.offsetWidth-(l.offsetLeft-s.offsetLeft)+"px",s.style.left=l.style.left)),r&&(e.dateEnd=n.dateEnd,s.style.width=t.rightToLeft?s.offsetWidth-(o-s.offsetLeft-(o-r.offsetLeft))+"px":s.offsetWidth-(s.offsetLeft+s.offsetWidth-(r.offsetLeft+r.offsetWidth))+"px"),t._refreshTask(s),e=e.project}}}_refreshTask(e){const t=this,i=t._getTaskBarCellRange(e),a=i.cellStart,n=i.cellEnd;if(i&&a&&n){e._cellStart=a,e._cellEnd=n;const i=t._getTaskBarDateRange(e);if(i){const a=e._task,n=t._tasks.indexOf(a),s=t.$.timelineCellsContainer.children[n];if(s){s._task.dateStart=a.dateStart=i.dateStart,s._task.dateEnd=a.dateEnd=i.dateEnd,s._task.duration=a.duration=t._convertDuration(0<t.nonworkingDays.length||0<t.nonworkingHours.length?t._getWorkingTime(a.dateStart,a.dateEnd):a.dateEnd.getTime()-a.dateStart.getTime(),!0);const n=e=>e.getFullYear()+"-"+(10>e.getMonth()?"0"+e.getMonth():e.getMonth())+"-"+(10>e.getDate()?"0"+e.getDate():e.getDate());e.setAttribute("aria-label",a.label+" Start date: "+n(a.dateStart)+", End date: "+n(a.dateEnd)),t._refreshTaskConnections(e),t._refreshTaskColumnsData(a,["dateStart","dateEnd","duration"])}}}}_refreshTaskColumnsData(e,t){function a(e){for(let t=0;t<s.length;t++)if(s[t].value===e)return t}const n=this,s=n.taskColumns;if(!e)return;const l=n.$.treeSplitter,r=n._tasks.indexOf(e);let o=[];if(t)for(let e=0;e<t.length;e++){const i=a(t[e]);void 0!==i&&o.push(i)}else o=s.map((e,t)=>t);for(let a=0;a<o.length;a++){const t=l._items[o[a]],i=s[o[a]];let d;t&&(t===n.$.taskTreeSplitterItem?(d=t.querySelectorAll("smart-tree-item, smart-tree-items-group")[r],d&&(d.label=n._formatColumnData(e,i))):(d=t.getElementsByClassName("smart-task-label-container")[r],d.innerHTML=n._formatColumnData(e,i)))}}_removeConnection(e,t){const i=this,a=i.$.timelineConnectionsContainer;if(e.classList&&e.classList.contains("smart-task-connection")?e=e.getAttribute("connection-id"):e+="",void 0===e)return;const n=a.querySelectorAll(".smart-task-connection[connection-id^=\""+e+"\"]"),s=i._tasks,l=i.$.timelineTasksContainer.children,r=e.split("-"),o=parseInt(r[0]),d=parseInt(r[1]);for(let s=0;s<n.length;s++)a.removeChild(n[s]);i._updateConnection(e,!0),l[o]&&0===s[o].connections.length&&!s.find(e=>e.connections.find(e=>i._getTaskIndexById(e.target)===o))&&l[o].removeAttribute("connected"),l[d]&&0===s[d].connections.length&&!s.find(e=>e.connections.find(e=>i._getTaskIndexById(e.target)===d))&&l[d].removeAttribute("connected"),!t&&i.autoSchedule&&(i._autoScheduleRestore(s[d],parseInt(r[2])),i._autoSchedule(s[d]))}_removeConnectionsToTask(e,i,a){const n=this;if(e){i||(i=n._tasks);for(let s=0;s<i.length;s++){const t=i[s];if(!t.connections||!t.connections.length||a&&-1<a.indexOf(t))continue;const l=t.connections;for(let t=0;t<l.length;t++)l[t].target===e&&n._removeConnection(s,e)}}}_setConnectionPoints(e){const t=this;let i;if(!e||t._hoveredTimelineTask!==e){const e=t.$.timelineCellsContainer.children;for(let a=0;a<e.length;a++){const t=e[a];if(t&&!t.hasAttribute("selected")){i=t.getElementsByClassName("smart-task-connection-point");for(let e=0;e<i.length;e++)i[e].classList.add("smart-visibility-hidden")}}return}i=e.getElementsByClassName("smart-task-connection-point");for(let t=0;t<i.length;t++)i[t].classList.remove("smart-visibility-hidden")}_selectTask(e){const t=this,a=t._tasks.indexOf(e);if(0>a)return void t._unselectAllTasks();const i=t.$.timelineCellsContainer.children[a],n=t.$.timelineTasksContainer.children[a];if(i&&i.hasAttribute("selected"))return void t._unselectAllTasks();const s=t.selectedIndexes.slice(0);t._unselectAllTasks(!0),i&&i.setAttribute("selected",""),n&&(n.setAttribute("selected",""),n.setAttribute("aria-selected","true"));const l=document.scrollingElement||document.documentElement,r=l.scrollLeft,o=l.scrollTop;t.$.taskTree.focus(),window.scrollTo(r,o),t.$.taskTree.select(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[a]);const d=t.$.treeSplitter._items;for(let n=0;n<d.length;n++){const e=d[n];let i;e!==t.$.taskTreeSplitterItem&&(i=[].slice.call(e.getElementsByClassName("smart-task-label-container")),i[a]&&i[a].setAttribute("selected",""))}const m=n._cellStart;if(t.scrollLeft>m.left&&t.scrollLeft>m.left+n.offsetWidth||t.scrollLeft+t.$.timeline.offsetWidth<m.left){const e=t._timelineCells.indexOf(m);t._scrollTo((t._timelineCells[e-1]?t._timelineCells[e-1]:m).date)}s[0]!==a&&(t.selectedIndexes=[a],t.$.fireEvent("change",{value:[a],oldValue:s}))}_snapToNearest(e){const i=this;if(e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&i.snapToNearest){const t=i._getTaskBarCellRange(e);if(!t)return;const a=t.cellStart,n=t.cellEnd;let s=parseFloat(e.style.width)||e.offsetWidth,l=parseFloat(e.style[i.rightToLeft?"right":"left"])||e.offsetLeft;if(i.hasAttribute("dragged")){const t=n.width-(l+s-n.left);e.style[i.rightToLeft?"right":"left"]=l-a.left<=t?a.left+"px":l+t+"px"}else if(i.hasAttribute("resized")){const t=a===n?parseFloat(getComputedStyle(i).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0:0;let r;"left"===i.$.timeline.getAttribute("task-bar-hovered")?(r=l-a.left,r-=r>=a.width/2?a.width-t:0,e.style[i.rightToLeft?"right":"left"]=(l-=r)+"px",r=l+s>n.left+n.width/2?n.left+n.width-(l+s):n.left-(l+s),e.style.width=Math.max(t,s+r)+"px"):(e.style[i.rightToLeft?"right":"left"]=l>a.left+a.width/2?a.left+a.width+"px":a.left+"px",l=parseFloat(e.style[i.rightToLeft?"right":"left"])||e.offsetLeft,r=l+s-n.left,r=-1*(r-(r>=a.width/2?n.width:t)),e.style.width=s+r+"px")}i._refreshTask(e);const r=e._task;if("project"!==r.type||!r.dragProject)return;const o=r.tasks;if(!o||!Array.isArray(o))return;for(let e=0;e<o.length;e++){const t=i.$.timelineTasksContainer.children[i._tasks.indexOf(o[e])];t&&i._snapToNearest(t)}}}_setDragLimits(e){const t=this;if(t._dragDetails){const i=t._dragDetails.timelineTask;if(i&&e){const a=t.$.timeline.getAttribute("task-bar-hovered"),n=i._task;if(a){if(n.disableResize)return void delete t._dragDetails;const e=t._getTaskBarSizeLimits(i,a);t._dragDetails.min.width=e.min,t._dragDetails.max.width=e.max;const s=t._createDelimiter("min",a),l=t._createDelimiter("max",a);s&&i.appendChild(s),l&&i.appendChild(l)}else if(e.closest(".smart-task-connection-point"))t._dragDetails.timelineTask=void 0;else if(e.closest(".smart-timeline-task")===i){if(n.disableDrag||i.hasAttribute("connected")&&t.autoSchedule&&t.autoScheduleStrictMode)return void delete t._dragDetails.target;t._dragDetails._taskDuration=t._getWorkingTime(n.dateStart,n.dateEnd),i.classList.contains("milestone")&&(t._dragDetails.target=i.getElementsByClassName("smart-timeline-task-fill")[0]);const e=t._getTaskDragLimits(i),a=t.rightToLeft?t.$.timelineContent.offsetWidth-i.offsetLeft-i.offsetWidth:i.offsetLeft;if(void 0!==e.min&&(t._dragDetails.min.left=e.min,"project"===i._task.type&&e.min>a&&(t._dragDetails.min.left=a)),void 0!==e.max&&(t._dragDetails.max.left=e.max,"project"===i._task.type&&e.max<a&&(t._dragDetails.max.left=a)),"project"===n.type&&n.dragProject&&!t.synchronized){const e=t._getSubTaskLimits(i);void 0!==e.min&&(t._dragDetails.min.left=t._dragDetails.min.left?Math.max(t._dragDetails.min.left,e.min):e.min),void 0!==e.max&&(t._dragDetails.max.left=t._dragDetails.max.left?Math.min(t._dragDetails.max.left,e.max):e.max)}else"milestone"===n.type&&(t._dragDetails.target=i.getElementsByClassName("smart-timeline-task-fill")[0])}else t._dragDetails.timelineTask=void 0;t._dragDetails.relatedConnections={}}}}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,i=e._scrollView.hScrollBar;i.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),t.hasStyleObserver=!1,i.hasStyleObserver=!1,t.hasResizeObserver=!1,i.hasResizeObserver=!1,i.wait=!1,e._refresh()}_getWorkingTime(e,t){function i(e,t){let i,s,l=t.getTime()-e.getTime(),r=new Date(e),o=0;for(;0<l;){const e=a(l,3600000-(1e3*(60*r.getMinutes())+1e3*r.getSeconds()+r.getMilliseconds()));if(-1<n.nonworkingDays.indexOf(r.getDay())){s=new Date(r),s.setHours(0,0,0,0),s.setDate(r.getDate()+1),i=a(e,s.getTime()-r.getTime()),r=new Date(r.getTime()+i),l-=i;continue}if(-1<n.nonworkingHours.indexOf(r.getHours())){s=new Date(r);const t=s.getTime();s.setHours(r.getHours()+1,0,0,0),t===s.getTime()&&s.setHours(r.getHours()+2,0,0,0),i=a(e,s.getTime()-r.getTime()),r=new Date(r.getTime()+i),l-=i;continue}o+=e,l-=e,r=new Date(r.getTime()+e)}return o}var a=Math.min;if(!e||!t)return;const n=this;if(e.getFullYear()===t.getFullYear())return i(e,t);let s=new Date(e.getFullYear()+1,0,1,0,0,0,0),l=i(e,s);if(t.getFullYear()>s.getFullYear()){const e=Math.max(0,t.getFullYear()-s.getFullYear());for(let t,i=0;i<e;i++)t=n._getWorkingDaysBetweenDays(s),l+=1e3*(60*(60*(24*t-t*n.nonworkingHours.length))),s.setFullYear(s.getFullYear()+1)}return l+=i(s,t),l}_getWorkingDaysBetweenDays(e){const t=this,i=e.getFullYear(),a=(0==i%100?0==i%400:0==i%4)?366:365;let n=new Date(e),s=0;for(let i=0;i<a;i++)0>t.nonworkingDays.indexOf(n.getDay())&&s++,n.setDate(n.getDate()+1);return s}_setFocusable(){const e=this;return e.disabled||e.unfocusable?void(e.tabIndex=-1):void(e.tabIndex=0<e.tabIndex?e.tabIndex:0)}_setTaskBarLabel(e,t){const i=this,a=(i.shadowRoot||i).querySelectorAll(".smart-timeline-task")[i._tasks.indexOf(e)];if(a){const i=a.getElementsByClassName("smart-timeline-task-label")[0];i&&(i.innerHTML=t||e.label)}}_setTaskBarProgress(e){const t=this,i=(t.shadowRoot||t).querySelectorAll(".smart-timeline-task")[t._tasks.indexOf(e)];if(i){let a=e.progress;const n=i.querySelector(".smart-timeline-task-progress"),s=i.querySelector(".smart-timeline-task-progress-thumb");n&&(s.style[t.rightToLeft?"left":"right"]="",s.style[t.rightToLeft?"right":"left"]=n.style.width=(Math.min(100,Math.max(0,a))||0)+"%")}}_setTimelineTaskBar(e,t){const i=this,a=i._tasks.indexOf(e),n=i.$.timelineTasksContainer.children,s=n[a];let l,r;if(0!==n.length&&s){l=!t&&s._cellStart||i._getTimelineCellByDate(e.dateStart instanceof Date?e.dateStart:new Date(e.dateStart)),r=!t&&s._cellEnd||i._getTimelineCellByDate(e.dateEnd instanceof Date?e.dateEnd:new Date(e.dateEnd)),s._cellStart=l,s._cellEnd=r;const a=i._getTaskBarDetails(s);a&&(s.style.top=a.top+"px",s.style[i.rightToLeft?"left":"right"]="",s.style[i.rightToLeft?"right":"left"]=a.left+"px",s.style.width=a.width+"px"),e.project&&!i._isTaskExpanded(e)?s.classList.add("smart-visibility-hidden"):s.classList.remove("smart-visibility-hidden")}}_getTimelineCellByDate(e){const t=this,i=t._timelineCells;if(i&&0!==i.length)for(let a=0;a<i.length;a++){const n=i[a],s=n.date;switch(t.view){case"year":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth())return n;break;case"month":{const t=new Date(s);let i=new Date(s);if(i.setDate(i.getDate()+(6-i.getDay())+1),i.setMilliseconds(i.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=i.getTime())return n;break}case"week":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate())return n;break;case"day":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate()&&s.getHours()===e.getHours())return n;}}}_refreshViewDetailCell(e,t,i){const a=this,n=a._timelineCells,s=e.date;let l=0,r=0===i?0:void 0;for(void 0===t&&(t=0),t;t<n.length;t++){const e=n[t],i=a._getCellWidth(e,s);if(!i)if(e.date.getTime()>s.getTime())break;else continue;void 0===r&&(r=e.left+e.width-i),l+=i}return a._isLastWeekCellNotFull&&(delete a._isLastWeekCellNotFull,t--),e.width=l,e.left=r,t}_getCellWidth(e,t){const i=this,a=e.date,n=(e,t)=>e.getFullYear()===t.getFullYear(),s=(e,t)=>e.getMonth()===t.getMonth(),l=e.width;switch(i.view){case"month":{let e=new Date(a),r=new Date(e),o=0;for(r.setDate(r.getDate()+(6-e.getDay())+1),r.setMilliseconds(r.getMilliseconds()-1);e.getTime()<=r.getTime();)n(e,t)&&s(e,t)&&o++,e.setDate(e.getDate()+1);if(0==o)return;return i._isLastWeekCellNotFull=1!=o/7,l*o/7}case"year":if(n(a,t))return l;break;case"week":{const e=new Date(t),i=new Date(t);if(e.setDate(t.getDate()-t.getDay()),i.setDate(t.getDate()+(6-t.getDay())),a.getTime()>=e.getTime()&&a.getTime()<=i.getTime())return l;break}case"day":if(n(a,t)&&s(a,t)&&a.getDate()===t.getDate())return l;}}_getCellByOffsetLeft(e){const t=this,a=t._timelineCells;if(!e)return;let n;for(let t=0;t<a.length&&!(a[t].left>=e);t++)n=a[t];return n}_unselectAllTasks(e){const t=this,i=t.$.timelineTasksContainer,a=t.$.timelineCellsContainer;if(a.querySelector(".smart-timeline-task-cell[selected]")){const e=a.children;for(let i=0;i<e.length;i++)e[i].removeAttribute("selected")}if(i.querySelector(".smart-timeline-task[selected]")){const e=i.children;for(let i=0;i<e.length;i++)e[i].removeAttribute("selected"),e[i].setAttribute("aria-selected","false")}t._treeChangeEventFired||t.$.taskTree.clearSelection();const n=t.$.treeSplitter.getElementsByClassName("smart-task-label-container");for(let t=0;t<n.length;t++)n[t].removeAttribute("selected");if(!e){const e=t.selectedIndexes.slice(0);e.length&&(t.selectedIndexes=[],t.$.fireEvent("change",{value:[],oldValue:e}))}}_getTaskBarCellRange(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;let i=parseFloat(e.style.width)||e.offsetWidth;const a=t._timelineCells,n=t.$.timelineContent,s=parseFloat(e.style[t.rightToLeft?"right":"left"])||(t.rightToLeft?(parseFloat(n.style.width)||n.offsetWidth)-(e.offsetLeft+e.offsetWidth):e.offsetLeft);let l,r;!i&&e.classList.contains("milestone")&&(i=e.offsetHeight/2);for(let t=0;t<a.length;t++){const e=a[t],n=e.left,o=e.width,d=parseFloat((n+o).toFixed(2)),m=parseFloat((s+i).toFixed(2));if(!l&&s>=n&&s<=d&&(l=e),!r&&m>n&&m<=d&&(r=e),l&&r)break}return l||(l=e.classList.contains("milestone")&&r?r:a[0]),r||(r=a[a.length-1]),{cellStart:l,cellEnd:r}}_getDateFromCell(e,t,i){var a=Math.abs,n=Math.floor;if(!t)return new Date;const s=this,l=new Date(t.date);let r,o=0,d=0;switch(i||(i=s.view),i){case"year":{r=new Date(l.getFullYear(),l.getMonth()+1,0).getDate(),o=1;break}case"month":{o=l.getDate(),r=7;break}case"week":r=1,o=l.getDate();break;case"day":r=1/24,o=l.getDate(),d=l.getHours();}const m=parseFloat(((e-t.left)/t.width*r).toFixed(12)),c=Math.min(r,n(m)),g=24*(m%1),h=n(g),p=60*a(g-h),f=n(p),_=60*a(p-f),u=n(_),k=1e3*a(_-u),T=n(k);return new Date(l.getFullYear(),l.getMonth(),o+c,d+h,f,u,T)}_createTreeTasks(e,i){if(!e)return[];let a=[];for(let n=0;n<e.length;n++){const t={};t.label=e[n][i],e[n].tasks&&(t.items=this._createTreeTasks(e[n].tasks,i)),a.push(t)}return a}_getTasksJSON(){function e(e){let t={};for(let i in e){let a=e[i];"project"!=i&&(t[i]=a instanceof Date?a.toISOString():a)}return t}function i(a,n){if(a){let s=[];for(let l=0;l<a.length;l++){const t=a[l];let r;t.project&&t.project!==n||(r=e(t),r.tasks=i(t.tasks,t),s.push(r))}return s}}const t=this,a=t._tasks;return i(a)}_createTaskColumns(){const e=this,t=e._getTasksJSON(),a=e.taskColumns,n=e.$.treeSplitter.getElementsByClassName("smart-task-tree-header");if(a.length>n.length)for(;a.length>n.length;){const t=document.createElement("smart-splitter-item");t.innerHTML="<div class=\"smart-task-tree-header\"></div><div class=\"smart-task-tree-content\">",e.$.treeSplitter.appendChild(t)}else for(;n.length>a.length&&1!==n.length;)e.$.treeSplitter.removeChild(e.$.treeSplitter.lastElementChild);if(!a.length)return e.$.taskTree.dataSource=[],void(n[0].innerHTML="");const s=a.length,l=parseFloat(getComputedStyle(e).getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0);for(let r=0;r<s;r++){const i=a[r],s=n[r],o=s.closest("smart-splitter-item");s.innerHTML=e.localize(i.label)||i.label,o&&(i.size&&(e.shadowRoot?requestAnimationFrame(()=>o.size=i.size):o.size=i.size),o.min=i.min?i.min:l,o.max=i.max?i.max:o.max),e._createTaskColumnsData(o,i,t)}e.$.mainSplitter.isCompleted&&e.$.mainSplitter.refresh(),e._refresh()}_refreshColumnsHeaders(){const e=this,t=e.taskColumns,a=e.$.treeSplitter.getElementsByClassName("smart-task-tree-header");for(let n=0;n<a.length;n++)a[n].innerHTML=e.localize(t[n].label)||t[n].label}_createTaskColumnsData(e,t,i){const a=this;if(e){const n=t.value;if(a.$.taskTreeSplitterItem===e)return void(n?(a.$.taskTree.itemsMember="tasks",a.$.taskTree.displayMember=t.value,a.$.taskTree.dataSource=i.map(e=>(e[t.value]=a._formatColumnData(e,t),e))):a.$.taskTree.dataSource=[]);const s=e.getElementsByClassName("smart-task-tree-content")[0];s&&(s.innerHTML="",n&&s.appendChild(a._createTaskContainers(i,t)))}}_createTaskContainers(e,t){const a=this,n=document.createDocumentFragment();for(let s=0;s<e.length;s++){const i=e[s],l=document.createElement("div");l.innerHTML="<div class=\"smart-task-label-container\"></div>",l.firstElementChild.innerHTML=a._formatColumnData(e[s],t),i.tasks&&0<i.tasks.length&&(l.innerHTML+="<div class=\"smart-task-drop-down"+(i.expanded?"":" smart-visibility-hidden")+"\"></div>",l.lastElementChild.appendChild(a._createTaskContainers(i.tasks,t))),l.classList.add("smart-task-item"),l.id||l.setAttribute("id","taskItem"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),n.appendChild(l)}return n}_formatColumnData(e,t){const i=this,a=e[t.value];if("function"==typeof t.formatFunction)return t.formatFunction(-1<t.value.toLowerCase().indexOf("date")?new Date(a):a,i._tasks.indexOf(e));if(t.value){const e=(t.value+"").toLowerCase();if(-1<e.indexOf("date")){const e=Date.parse(a);if(!isNaN(e))return new Date(e).toLocaleDateString(i.locale,{year:"numeric",month:"2-digit",day:"numeric"})}else if(-1<e.indexOf("duration"))return parseFloat(a.toFixed(1))}return a===void 0?"":a.toString()}_validateTaskProperties(e,t){function i(e,t){return e[t]=s._dateValidator(void 0,e[t]),(!e[t]||isNaN(e[t].getTime()))&&(e[t]=void 0),e[t]}var a=Math.max,n=Math.min;const s=this;let l=s._convertDuration(parseInt(e.duration))||0,r=s._convertDuration(parseInt(e.minDuration))||0,o=s._convertDuration(parseInt(e.maxDuration))||0;if(r&&o&&(o=a(r,o)),l&&(r?l=a(r,l):o&&(l=n(l,o))),e.duration=s._convertDuration(l,!0),e.minDuration=s._convertDuration(r,!0),e.maxDuration=s._convertDuration(o,!0),e.minDateStart=i(e,"minDateStart"),e.maxDateStart=i(e,"maxDateStart"),e.minDateStart&&e.maxDateStart&&(e.maxDateStart=new Date(a(e.minDateStart.getTime(),e.maxDateStart.getTime()))),e.minDateEnd=i(e,"minDateEnd"),e.maxDateEnd=i(e,"maxDateEnd"),e.minDateEnd&&e.maxDateEnd&&(e.maxDateEnd=new Date(a(e.minDateEnd.getTime(),e.maxDateEnd.getTime()))),e.dateStart=i(e,"dateStart"),e.dateEnd=i(e,"dateEnd"),e.dateStart||(e.minDateStart?e.dateStart=e.minDateStart:e.maxDateStart&&(e.dateStart=e.maxDateStart)),e.dateEnd||(e.minDateEnd?e.dateEnd=e.minDateEnd:e.maxDateEnd&&(e.dateEnd=e.maxDateEnd)),e.minDateStart&&(e.dateStart=new Date(a(e.minDateStart.getTime(),e.dateStart.getTime()))),e.maxDateStart&&(e.dateStart=new Date(n(e.maxDateStart.getTime(),e.dateStart.getTime()))),e.minDateEnd&&(e.dateEnd=new Date(a(e.minDateEnd.getTime(),e.dateEnd.getTime()))),e.maxDateEnd&&(e.dateEnd=new Date(n(e.maxDateEnd.getTime(),e.dateEnd.getTime()))),e.dateStart&&(s.min&&(l=n(e.dateStart.getTime()-s.min.getTime(),l)),s.max&&(l=n(s.max.getTime()-e.dateStart.getTime(),l))),!e.dateStart&&l&&e.dateEnd&&(e.dateStart=new Date(e.dateEnd.getTime()-l)),"task"===e.type&&(!e.dateStart||isNaN(e.dateStart.getTime()))&&t&&(e.dateStart=new Date(t.dateStart)),r&&e.dateStart)if(0<s.nonworkingDays.length||0<s.nonworkingHours.length){const t=s._getTaskWorkingDateEnd(e,r);e.dateEnd=new Date(a(e.dateEnd?e.dateEnd.getTime():0,t.getTime()))}else e.dateEnd=new Date(a(e.dateEnd?e.dateEnd.getTime():0,e.dateStart.getTime()+l));if(l&&e.dateStart&&(e.dateEnd=0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getTaskWorkingDateEnd(e,l):new Date(e.dateStart.getTime()+l)),l||o){let t;t=0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getTaskWorkingDateEnd(e,a(l,o)):new Date(e.dateStart.getTime()+a(l,o)),e.dateEnd.getTime()>t.getTime()&&(e.dateEnd=t)}if("task"===e.type&&!e.dateEnd&&t&&(e.dateEnd=new Date(t.dateEnd)),e.dateStart=s._minMaxDateValidator(e.dateStart),e.dateEnd=s._minMaxDateValidator(e.dateEnd),"milestone"===e.type&&(e.dateStart=i(e,"dateStart"),e.dateEnd=i(e,"dateEnd"),e.dateStart=e.dateEnd=new Date(a(e.dateStart?e.dateStart.getTime():0,e.dateEnd?e.dateEnd.getTime():0))),t&&s._synchronizeProjectDates(t,e),e.dateStart||e.dateEnd||"project"!==e.type||e.synchronized){e.dateStart&&e.dateEnd&&e.dateStart.getTime()>e.dateEnd.getTime()&&(e.dateEnd=new Date(e.dateStart.getTime()+3600000*("day"===s.view?1:24))),e.dateStart&&e.dateEnd&&(e.duration=s._convertDuration(0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0));const t=e.connections;if(!(t instanceof Array))e.connections=[];else for(let e=0;e<t.length;e++){const i=t[e],a=i.target="string"==typeof i.target?i.target:parseInt(i.target),n=i.type=parseInt(i.type);if(!a||"number"==typeof a&&isNaN(a)||isNaN(n)){t.splice(t.indexOf(i),1);continue}i.lag=parseInt(i.lag)||0}return e.class=e.class?e.class+"":"",e.class=void 0!==e.class&&null!==e.class?e.class:"",e}}_synchronizeProjectDates(e,t){var i=Math.max,a=Math.min;const n=e.dateStart,s=e.dateEnd;e.synchronized&&(t.dateStart&&(e.dateStart=n?new Date(a(n.getTime(),t.dateStart.getTime())):t.dateStart),t.dateEnd&&(e.dateEnd=s?new Date(i(s.getTime(),t.dateEnd.getTime())):t.dateEnd),t.minDateStart&&(e.minDateStart=e.minDateStart?new Date(i(e.minDateStart.getTime(),t.minDateStart.getTime())):t.minDateStart),t.maxDateStart&&(e.maxDateStart=e.maxDateStart?new Date(a(e.maxDateStart.getTime(),t.maxDateStart.getTime())):t.maxDateStart),t.minDateEnd&&(e.minDateEnd=e.minDateEnd?new Date(i(e.minDateEnd.getTime(),t.minDateEnd.getTime())):t.minDateEnd),t.maxDateEnd&&(e.maxDateEnd=e.maxDateEnd?new Date(a(e.maxDateEnd.getTime(),t.maxDateEnd.getTime())):t.maxDateEnd),e.dateStart&&e.dateEnd&&(e.duration=this._convertDuration(e.dateEnd.getTime()-e.dateStart.getTime(),!0))),e.project&&this._synchronizeProjectDates(e.project,t)}_mouseWheelandler(e){const t=this;if(t.computedHorizontalScrollBarVisibility||t.computedVerticalScrollBarVisibility){const i=(t.shadowRoot||t).querySelector(".smart-task-popup-window");return i&&i.modal&&i.opened?void e.stopPropagation():void(!t.disabled&&t.computedVerticalScrollBarVisibility&&(e.stopPropagation(),e.preventDefault(),t.scrollTo(t.scrollTop+t._getScrollCoefficient(e,t.offsetHeight))))}}_horizontalScrollbarHandler(e){const t=this;e.stopPropagation(),t.$.timeline.scrollLeft=t._getScrollLeft(e.detail.value),t._recycle(e)}_verticalScrollbarHandler(e){const t=this;return e.stopPropagation(),t.$.timelineContent.scrollTop=e.detail.value,t._recycle(e),e.context.max===e.context.value?void t.$.fireEvent("scrollBottomReached"):void(e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"))}});