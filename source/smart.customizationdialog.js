
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-customization-dialog",class extends Smart.TabsWindow{static get properties(){return{dataSource:{value:null,type:"any",reflectToAttribute:!1},displayMember:{value:"",type:"string"},filtering:{value:!1,type:"boolean"},grouping:{value:!1,type:"boolean"},headerButtons:{value:["apply","close"],type:"array",reflectToAttribute:!1},messages:{value:{en:{sorting:"SORTING",grouping:"GROUPING",filtering:"FILTERING",columnChooser:"COLUMN CHOOSER",applyButton:"Apply",closeButton:"Close",columnsToSort:"Columns to Sort",columnsToGroup:"Columns to Group",placeholderSorting:"No sorting applied",placeholderGrouping:"No grouping applied",and:"And",notand:"Not And",or:"Or",notor:"Not Or","=":"Equals","<>":"Does not equal",">":"Greater than",">=":"Greater than or equal to","<":"Less than","<=":"Less than or equal to",startswith:"Starts with",endswith:"Ends with",contains:"Contains",notcontains:"Does not contain",isblank:"Is blank",isnotblank:"Is not blank"}},type:"object",extend:!0},modal:{value:!0,type:"boolean",reflectToAttribute:!1},pinned:{value:!0,type:"boolean",reflectToAttribute:!1},reorder:{value:!1,type:"boolean"},selectedTab:{value:0,type:"int"},sorting:{value:!1,type:"boolean"},value:{value:null,type:"object",reflectToAttribute:!1},valueMember:{value:"",type:"string"},visibility:{value:!1,type:"boolean"}}}static get listeners(){return{down:"_find\u0410ctiveListBox","document.scroll":"_handleScroll",resize:"_updateElementHeight","applyButton.click":"close","closeButton.click":"close","tabsElement.change":"_handleChange","tabsElement.dragStart":"_reorderStartHandler","tabsElement.dragEnd":"_reorderEndHandler","tabsElement.click":"_handleClickOnDynamicNodes","filteringDropDown.change":"_handleFilteringDropDownChange","sortingToggleElement.click":"_handleToggleElementClick","groupingToggleElement.click":"_handleToggleElementClick","allColumnsChooser.down":"_preventDragOnListItem","allColumnsChooser.up":"_preventDragOnListItem","selectedColumnsSorting.down":"_preventDragOnListItem","selectedColumnsSorting.up":"_preventDragOnListItem","selectedColumnsGrouping.down":"_preventDragOnListItem","selectedColumnsGrouping.up":"_preventDragOnListItem",transitionend:"_handleTransitionEnd"}}template(){return`<div id="container">
                    <div id="headerSection" class="smart-header-section">
                        <div id="header" class="smart-header">[[label]]</div>
                        <div id="buttonsContainer" class="smart-buttons-container">
                            <smart-button id="closeButton" class ="smart-close-button" theme="[[theme]]"></smart-button>
                            <smart-button id="applyButton" disabled class ="smart-apply-button" theme="[[theme]]"></smart-button>
                        </div>
                    </div>
                    <div id="contentSection" class="smart-content">
                       <smart-tabs id="tabsElement" selected-index="[[selectedTab]]" animation="[[animation]]" theme="[[theme]]">
                            <smart-tab-item>
                                <div id="placeholderSorting" class ="placeholder"></div>
                                <div id="selectedColumnsSortingContainer" class ="selected-columns sortable container">
                                    <smart-list-box id="selectedColumnsSorting" class ="smart-selected-columns-sorting" selection-mode="none" allow-drag allow-drop placeholder=""></smart-list-box>
                                </div>
                                <div id="allColumnsSortingContainer" class ="all-columns sortable container">
                                    <div class ="toggle-element" id="sortingToggleElement"></div>
                                    <div id="columnsToSort" class ="header-text"></div>
                                    <smart-list-box id="allColumnsSorting" class ="smart-all-columns-sorting"  placeholder="" selection-mode="checkBox"></smart-list-box>
                                </div>
                            </smart-tab-item>
                            <smart-tab-item>
                                <div id="placeholderGrouping" class="placeholder"></div>
                                <div  id="selectedColumnsGroupingContainer" class ="selected-columns sortable container">
                                    <smart-list-box id="selectedColumnsGrouping" class ="smart-selected-columns-grouping" selection-mode="none" allow-drag allow-drop placeholder=""></smart-list-box>
                                </div>
                                <div  id="allColumnsGroupingContainer" class ="all-columns sortable container">
                                    <div class ="toggle-element" id="groupingToggleElement"></div>
                                    <div id="columnsToGroup" class ="header-text"></div>
                                    <smart-list-box id="allColumnsGrouping" class ="smart-all-columns-grouping"  placeholder="" selection-mode="checkBox"></smart-list-box>
                                </div>
                            </smart-tab-item>
                            <smart-tab-item>
                                <smart-accordion id="allColumnsFiltering" placeholder="" expand-mode="multiple" tabindex="1"></smart-accordion>
                            </smart-tab-item>
                            <smart-tab-item>
                                <smart-list-box id="allColumnsChooser" class ="smart-all-columns-chooser" placeholder="" allow-drag allow-drop selection-mode="checkBox"></smart-list-box>
                            </smart-tab-item>
                        </smart-tabs>
                    </div>
                    <smart-drop-down-list id="filteringDropDown" drop-down-append-to="body" drop-down-width="auto" drop-down-height="auto" animation="[[animation]]" theme="[[theme]]" class ="smart-filtering-drop-down"></smart-drop-down-list>
                </div>`}static get requires(){return{"Smart.TabsWindow":"smart.window.js","Smart.Accordion":"smart.accordion.js","Smart.DropDownList":"smart.dropdownlist.js"}}propertyChangedHandler(a,b,c){const d=this;"valueMember"===a||"displayMember"===a||"dataSource"===a?(d._mapDataSource(d.dataSource,d.valueMember,d.displayMember),d._applyValue(d.value),d._handlePlaceholderAndContainer(),d.$.applyButton.disabled=!0):"value"===a?(d._applyValue(c),d._handlePlaceholderAndContainer()):"locale"===a||"messages"===a?d._applyMessages():"sorting"===a||"grouping"===a||"filtering"===a||"reorder"===a||"visibility"===a?d._toggleCustomizationOptions():"theme"===a||"animation"===a?d._applyBindings():void 0}ready(){const a=this;a.$.addClass("smart-hidden"),super.ready(),a._applyBindings(),a._mapDataSource(a.dataSource,a.valueMember,a.displayMember),a._applyValue(a.value),a._applyMessages(),a._toggleCustomizationOptions(),a._randomId=Math.floor(1e5*Math.random()),a._applyListboxTemplates(),a._handlePlaceholderAndContainer(),a.$.removeClass("smart-hidden")}open(){const a=this;super.open(),a._resizeListBoxContainers(),a._updateElementHeight(),"none"!==a.animation&&(a._resizeAtAnimationEnd=!0,[a.$.sortingToggleElement,a.$.groupingToggleElement].forEach(b=>a._toggleGroup(b))),a.$.applyButton.disabled=!0}_applyListboxTemplates(){const a=this,b=[{listbox:a.$.selectedColumnsSorting,prefix:"sortingTemplate",template:`<span class="smart-drag-area"></span>
                        <span class="smart-label">{{label}}</span>
                        <span class="smart-close-item-button"></span>
                        <smart-check-box class ="smart-sort-button"></smart-check-box>`},{listbox:a.$.selectedColumnsGrouping,prefix:"groupingTemplate",template:`<span class="smart-drag-area"></span>
                        <span class="smart-label">{{label}}</span>
                        <span class="smart-close-item-button"></span>`},{listbox:a.$.allColumnsChooser,prefix:"columnChooserTemplate",template:`<span class="smart-drag-area"></span>
                        <span class="smart-label">{{label}}</span>`}];b.forEach(a=>{const b=this,c=document.createElement("template"),d=a.prefix+b._randomId;c.innerHTML=a.template,c.id=d,b.appendChild(c),a.listbox.itemTemplate=d})}_applyBindings(){const a=this,b=["theme","animation"];["selectedColumnsSorting","allColumnsSorting","selectedColumnsGrouping","allColumnsGrouping","allColumnsFiltering","allColumnsChooser"].forEach(c=>b.forEach(b=>a.$[c][b]=a[b]))}_applyMessages(){const a=this;["sorting","grouping","filtering","columnChooser"].forEach((b,c)=>a.$.tabsElement.update(c,a.localize(b))),["closeButton","applyButton"].forEach(b=>a.$[b].title=a.localize(b)),["columnsToSort","columnsToGroup","placeholderSorting","placeholderGrouping"].forEach(b=>a.$[b].innerText=a.localize(b))}_applyValue(a){const b=this;if(a=b._validateValue(a),a.order&&0<a.order.length){const c=b._reorderDataSource(a.order);b.$.allColumnsSorting.dataSource=c,b.$.allColumnsGrouping.dataSource=c,b.$.allColumnsChooser.dataSource=c}b.$.selectedColumnsSorting.items.forEach(b=>{const c=b.getElementsByTagName("smart-check-box")[0],d=a.sorting.find(function(a){return a.field===b.value});b.hidden=!d,c.checked=!!(d&&"desc"===d.sortDirection)}),b.$.allColumnsSorting.selectedValues=[],a.sorting.forEach(a=>{a.field&&b.$.allColumnsSorting.select(a.field)}),a.grouping&&0<a.grouping.length?(b.$.selectedColumnsGrouping.items.forEach(b=>b.hidden=!(-1<a.grouping.indexOf(b.value))),b.$.allColumnsGrouping.selectedValues=[],a.grouping.forEach(a=>b.$.allColumnsGrouping.select(a)),b.$.selectedColumnsSorting.items.forEach(b=>{-1<a.grouping.indexOf(b.value)&&(b.hidden=!1,b.disabled=!0)}),b.$.allColumnsSorting.items.forEach(b=>b.disabled=!!(-1<a.grouping.indexOf(b.value)))):b.$.selectedColumnsGrouping.items.forEach(a=>a.hidden=!0),b.$.allColumnsChooser.selectedValues=a.hidden,b._toggleBothPlaceholders(),b._populateFilterSection()}_getValueFromState(a){const b=this,c=JSON.parse(JSON.stringify(b.value)),d={},e=[];for(let c in d.sorting=b.$.selectedColumnsSorting.items.reduce((a,b)=>{const c=b.getElementsByTagName("smart-check-box")[0];return b.hidden||a.push({field:b.value,sortDirection:c.checked?"desc":"asc"}),a},[]),d.grouping=b.$.selectedColumnsGrouping.items.reduce((a,b)=>(b.hidden||a.push(b.value),a),[]),d.order=b.$.allColumnsChooser.items.map(a=>a.value),d.hidden=b.$.allColumnsChooser.selectedValues,b._filteringDetails){const a=b._filteringDetails[c],d={field:c,criteria:a.accordionItem.data.criteria,pattern:a.input.value};e.push(d)}d.filtering=e,b.value=d,a||b.$.fireEvent("change",{value:b.value,oldValue:c,type:"customizationdialog"}),b.$.applyButton.disabled=!1}_handleChange(a){const b=this,c=a.detail,d=c?c.value:"",e=a.target.closest("smart-list-box"),f=a.target.closest("input"),g=a.target.closest("smart-accordion-item"),h=a.target===b.$.tabsElement;h?(b._resizeListBoxContainers(),b._updateElementHeight()):g&&f?(b.$.applyButton.disabled=!1,b._getValueFromState()):e&&b._handleListBoxSelectionChanges(e,d,c)}_handleClickOnDynamicNodes(a){const b=this,c=a.target.closest(".smart-close-item-button"),d=a.target.closest(".smart-filter-options-container-text");(c||d)&&(c?b._handleClickOnCloseButton(c):b._handleClickOnFilterOption(d))}_handleClickOnCloseButton(a){function b(a){const b=a.selectedValues.slice();b.splice(b.indexOf(e),1),a.selectedValues=b}const c=this,d=a.closest("smart-list-item"),e=d.value,f=d.closest("smart-list-box");d.hidden=!0,f===c.$.selectedColumnsSorting?(b(c.$.allColumnsSorting),c._toggleGroup(c.$.sortingToggleElement)):f===c.$.selectedColumnsGrouping&&(b(c.$.allColumnsGrouping),c._updateListBoxItem(c.$.selectedColumnsSorting,e,{disabled:!1,hidden:!0,selected:!1}),c._updateListBoxItem(c.$.allColumnsSorting,e,{disabled:!1,selected:!1}),c._toggleGroup(c.$.groupingToggleElement)),c._getValueFromState()}_handleClickOnFilterOption(a){const b=this,c=a.closest("smart-accordion-item");b._filterLabelContainer&&b._filterLabelContainer===a||(a.closest(".smart-filter-options-container").appendChild(b.$.filteringDropDown),b.$.filteringDropDown.dataSource=c.data.options,b._filterLabelContainer=a);const d=b.$.filteringDropDown.items.find(a=>a.value===c.data.criteria);d&&(b.$.filteringDropDown.select(d),b.$.filteringDropDown.ensureVisible(d)),setTimeout(function(){b.$.filteringDropDown.open(),b.$.filteringDropDown.focus()},0)}_handleFilteringDropDownChange(a){const b=this,c=a.detail;if(b._filterLabelContainer){const a=b._filterLabelContainer.closest("smart-accordion-item");b.$.filteringDropDown.closest("smart-accordion-item")!==a||(b._filterLabelContainer.innerText=c.label,a.data.criteria=c.value,b.$.applyButton.disabled=!1,b._getValueFromState())}}_handleListBoxSelectionChanges(a,b,c){const d=this;d._activeListBox===a&&(a===d.$.allColumnsSorting?(d._updateListBoxItem(d.$.selectedColumnsSorting,b,{hidden:!c.selected}),d._toggleGroup(d.$.sortingToggleElement)):a===d.$.allColumnsGrouping?(d._updateListBoxItem(d.$.selectedColumnsGrouping,b,{hidden:!c.selected}),d._updateListBoxItem(d.$.selectedColumnsSorting,b,{disabled:c.selected,hidden:!c.selected}),d._updateListBoxItem(d.$.allColumnsSorting,b,{disabled:c.selected,selected:c.selected}),d._toggleGroup(d.$.groupingToggleElement)):void 0,d._getValueFromState(),d._toggleRequired=!0)}_handleToggleElementClick(a){const b=this,c=a.target.closest(".toggle-element");c&&(c.classList.remove("smart-active"),c===b.$.sortingToggleElement?b._updateListHeight(b.$.selectedColumnsSorting):b._updateListHeight(b.$.selectedColumnsGrouping),b._updateElementHeight(),"none"!==b.animation&&(b._resizeAtAnimationEnd=!0))}_mapDataSource(a,b,c){const d=this,e=["selectedColumnsSorting","allColumnsSorting","selectedColumnsGrouping","allColumnsGrouping","allColumnsChooser"];b=b&&0<b.length?b:"value",c=c&&0<c.length?c:"label";for(let f=0;f<e.length;f++){const g=e[f],h=d.$[g];h.dataSource=a||[],h.valueMember=b,h.displayMember=c}}_populateFilterSection(){const a=this;if(a.dataSource&&0!==a.dataSource.length){const b=a._validateValue(a.value),c=0<b.order.length?a._reorderDataSource(b.order):a.dataSource,d=b.filtering,e=["=","<>",">",">=","<","<=","startswith","endswith","contains","notcontains","isblank","isnotblank"];a.$.allColumnsFiltering.$.container.innerHTML="",a._filteringDetails={};for(let b=0;b<c.length;b++){const f=document.createElement("smart-accordion-item"),g=document.createElement("input"),h=document.createElement("div"),i=document.createElement("span"),j=c[b],k=j.filteringOptions,l=(k||e).map(b=>({value:b,label:a.localize(b)}));let m=d.find(function(b){return b.field===j[a.valueMember]});f.data=void 0===m?{options:l,field:j,criteria:k?k[0]:"contains",pattern:""}:{options:l,field:m.field,criteria:m.criteria||k[0]||"contains",pattern:m.pattern||""},f.label=j[a.displayMember],a.$.allColumnsFiltering.appendChild(f),g.className="smart-filter-input",g.name=f.data.field,g.value=f.data.pattern,h.className="smart-filter-options-container",h.label=a.localize(f.data.criteria),i.className="smart-filter-options-container-text",i.innerText=a.localize(f.data.criteria||"contains"),h.appendChild(i),f.$.contentContainer.appendChild(h),f.$.contentContainer.appendChild(g),a._filteringDetails[j[a.valueMember]]={input:g,accordionItem:f,dropDownContainer:h}}}}_reorderDataSource(a){const b=this;if(a=a||[],0===a.length||!b.dataSource||0===b.dataSource.length)return b.dataSource;let c=[],d=b.dataSource.slice();return a.forEach(a=>{const e=d.find(c=>a===c[b.valueMember]);c.push(e),d.splice(d.indexOf(e),1)}),d.forEach(a=>c.push(a)),c}_reorderEndHandler(a){const b=this,c=a.target.closest("smart-list-box");if(c.$.removeClass("smart-is-in-reorder"),c===b.$.allColumnsChooser&&b._allColumnsReorder){const a=b.$.allColumnsChooser.items.map(a=>a.value),c=b._reorderDataSource(a),d=b.$.allColumnsSorting.selectedValues,e=b.$.allColumnsGrouping.selectedValues;b.$.allColumnsSorting.dataSource=c,b.$.allColumnsSorting.items.map(a=>{e&&e.includes(a.value)&&(a.disabled=!0)}),d.forEach(a=>b.$.allColumnsSorting.select(a)),b.$.allColumnsGrouping.dataSource=c,e.forEach(a=>b.$.allColumnsGrouping.select(a)),b._populateFilterSection(),b._allColumnsReorder=!1}b._getValueFromState()}_reorderStartHandler(a){const b=this,c=a.target.closest("smart-list-box");c&&(Smart.ListBox.DragDrop.Feedback&&Smart.ListBox.DragDrop.Feedback.classList.add("smart-customization-dialog"),c.allowDrop=!a.detail.target.closest(".smart-input"),b._getValueFromState(!0),c.$.addClass("smart-is-in-reorder"),c===b.$.allColumnsChooser&&(b._allColumnsReorder=!0))}_resizeListBoxContainers(){const a=this;a.$.sortingToggleElement.classList.remove("smart-active"),a.$.groupingToggleElement.classList.remove("smart-active"),a._updateListHeight(a.$.selectedColumnsSorting),a._updateListHeight(a.$.selectedColumnsGrouping)}_toggleBothPlaceholders(){const a=this,b=a.$.selectedColumnsSorting.items.find(a=>!a.hidden),c=a.$.selectedColumnsGrouping.items.find(a=>!a.hidden);b?a.$.placeholderSorting.classList.add("smart-hidden"):a.$.placeholderSorting.classList.remove("smart-hidden"),c?a.$.placeholderGrouping.classList.add("smart-hidden"):a.$.placeholderGrouping.classList.remove("smart-hidden")}_toggleCustomizationOptions(){const a=this,b=a.$.tabsElement._tabs;b[0].disabled=!a.sorting,b[1].disabled=!a.grouping,b[2].disabled=!a.filtering,a.reorder||a.visibility?(b[3].disabled=!1,a.$.allColumnsChooser.allowDrag=a.$.allColumnsChooser.allowDrop=a.reorder,a.$.allColumnsChooser.selectionMode=a.visibility?"checkBox":"none"):b[3].disabled=!0}_toggleGroup(a){const b=this,c=a.closest("smart-tab-item").getElementsByClassName("selected-columns")[0];a.classList.add("smart-active"),c.offsetHeight<c.scrollHeight?a.classList.add("smart-down"):a.classList.remove("smart-down"),b._toggleBothPlaceholders(),b.$.applyButton.disabled=!1}_updateElementHeight(){const a=this;if(a.style.height)return void(a.style.minHeight=a.style.height);const b=a.$.headerSection.getBoundingClientRect().height,c=a.$.tabsElement.$.tabsHeaderSection.getBoundingClientRect().height,d=a.$.tabsElement.selectedIndex;a.style.minHeight="0px",a.style.minHeight=a.$.tabsElement._tabs[d].scrollHeight+b+c+"px"}_updateListBoxItem(a,b,c){const d=a.items.find(a=>a.value===b);d&&c&&0!==c.length&&a.update(d.dataIndex,c)}_updateListHeight(a){const b=a.getBoundingClientRect().height;a.parentNode.style.height=b+"px"}_validateValue(a){let b=a||{};return["sorting","grouping","filtering","order","hidden"].forEach(a=>b[a]=b[a]||[]),b}_headerDblCickHandler(){}_handleScroll(){const a=this;a.opened&&a._toggleRequired&&("none"!==a.animation&&(a._resizeAtAnimationEnd=!0),a._handlePlaceholderAndContainer(),a._updateElementHeight(),a._toggleRequired=!1)}_preventDragOnListItem(a){const b=this,c=a.target.closest("smart-list-box");"down"===a.type&&-1<["smart-close-item-button","smart-sort-button","smart-input"].indexOf(a.originalEvent.target.className)?(c.allowDrag=c.allowDrop=!0,b._selectedListBox=c,Smart.ListBox.DragDrop.Feedback&&Smart.ListBox.DragDrop.Feedback.classList.add("smart-hidden")):b._selectedListBox&&!b._selectedListBox.allowDrag&&(b._selectedListBox.allowDrag=b._selectedListBox.allowDrop=!0)}_handleTransitionEnd(a){const b=this;(b._resizeAtAnimationEnd||"height"===a.propertyName)&&(b._resizeAtAnimationEnd=!1,b._resizeListBoxContainers(),b._updateElementHeight())}_handlePlaceholderAndContainer(){const a=this;a._toggleBothPlaceholders(),a._resizeListBoxContainers(),a._updateElementHeight()}_findÐctiveListBox(a){this._activeListBox=a&&a.originalEvent&&a.originalEvent.target.closest("smart-list-box")}});