
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-calendar",class extends Smart.BaseElement{static get properties(){return{animationSettings:{value:null,type:"object"},calendarMode:{value:"default",allowedValues:["default","classic"],type:"string"},dayNameFormat:{value:"firstTwoLetters",allowedValues:["narrow","firstTwoLetters","long","short"],type:"string"},dateFormatFunction:{value:null,type:"function"},disableAutoNavigation:{value:!1,type:"boolean"},displayMode:{value:"month",allowedValues:["month","year","decade"],type:"string"},displayModeView:{value:"table",allowedValues:["table","list"],type:"string"},dropDownHeight:{value:"200",type:"string"},dropDownWidth:{value:"initial",type:"string"},firstDayOfWeek:{value:0,type:"number",defaultValue:0,validator:"_firstDayOfWeekValidator"},footerTemplate:{value:null,type:"any"},headerTemplate:{value:null,type:"any"},hideDayNames:{value:!1,type:"boolean"},hideOtherMonthDays:{value:!1,type:"boolean"},hideTooltipArrow:{value:!1,type:"boolean"},importantDates:{value:[],type:"array",defaultValue:[]},importantDatesTemplate:{value:null,type:"any"},max:{value:new Date(2100,1,1),type:"any",defaultValue:new Date(2100,1,1)},min:{value:new Date(1900,1,1),type:"any",defaultValue:new Date(1900,1,1)},months:{value:1,type:"number",defaultValue:1,validator:"_monthsValidator"},monthNameFormat:{value:"long",allowedValues:["narrow","firstTwoLetters","long","short","2-digit","numeric"],type:"string"},name:{value:"",type:"string"},restrictedDates:{value:[],type:"array",defaultValue:[]},scrollButtonsNavigationMode:{value:"landscape",allowedValues:["portrait","landscape"],type:"string"},scrollButtonsPosition:{value:"both",allowedValues:["near","far","both"],type:"string"},selectedDates:{value:[],type:"array"},selectionMode:{value:"default",allowedValues:["none","default","one","many","zeroOrMany","oneOrMany","zeroOrOne","week","range"],type:"string"},spinButtonsDelay:{value:80,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},titleTemplate:{value:null,type:"any"},tooltip:{value:!1,type:"boolean"},tooltipArrow:{value:!0,type:"boolean"},tooltipArrowDirection:{allowedValues:["bottom","top","left","right","none"],value:"bottom",type:"string"},tooltipDelay:{value:100,type:"number"},tooltipOffset:{value:[],type:"array"},tooltipPosition:{value:"auto",allowedValues:["auto","bottom","top","left","right","absolute"],type:"string"},tooltipTemplate:{value:null,type:"any"},view:{value:"portrait",allowedValues:["landscape","portrait"],type:"string"},viewSections:{value:["header"],type:"array"},weekNumbers:{value:!1,type:"boolean"},weeks:{value:6,type:"number",defaultValue:6,validator:"_weeksValidator"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"}}}static get listeners(){return{"container.down":"_downHandler","document.up":"_documentUpHandler","container.move":"_moveHandler","container.wheel":"_containerWheelHandler","body.focus":"_bodyFocusStateHandler","body.blur":"_bodyBlurStateHandler","header.click":"_headerClickHandler","header.change":"_headerChangeHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler","listViewContainer.keydown":"_listViewContainerKeyDownHandler","listViewContainer.change":"_listViewContainerChangeEventHandler","listViewContainer.itemClick":"_listViewContainerItemClickHandler",mouseenter:"_mouseEventsHandler",mouseleave:"_mouseEventsHandler","container.mouseover":"_mouseEventsHandler","container.mouseout":"_mouseEventsHandler"}}static get methods(){return{select:"select(date=new Date(): date|string): void",clearSelection:"clearSelection(): void",today:"today(): date",navigate:"navigate(step: date|string|int): bool"}}static get styleUrls(){return["smart.calendar.css"]}template(){return`<div id="container" role="presentation">
                    <div id="title" class="smart-calendar-title" role="heading" aria-level="1">
                        <div id="yearContainer" class="smart-calendar-year-container" role="button"></div>
                        <div id="dateContainer" class="smart-calendar-date-container smart-calendar-selected" role="button"></div>
                    </div>
                    <div id="calendarContainer" class="smart-calendar-container">
                        <div id="header" class="smart-calendar-header">
                            <smart-repeat-button prev-month class="smart-calendar-button" id="previousMonthButton" animation="[[animation]]" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]" right-to-left="[[rightToLeft]]" aria-label="Previous month">
                                <span aria-hidden="true"></span>
                            </smart-repeat-button>
                            <div id="dateElement" class="smart-calendar-date-element" role="presentation">
                                <div id="defaultHeaderDate" role="button"></div>
                                <div id="classicHeaderDate">
                                    <smart-drop-down-list class="smart-calendar-month-element" id="monthElement"
                                        drop-down-position="bottom"
                                        selection-mode="one"
                                        disabled="[[disabled]]"
                                        right-to-left="[[rightToLeft]]"
                                        readonly="[[readonly]]"
                                        drop-down-width="[[dropDownWidth]]"
                                        drop-down-height="[[dropDownHeight]]"
                                        theme="[[theme]]">
                                    </smart-drop-down-list>
                                    <input class="smart-calendar-year-element" id="yearElement" disabled="[[disabled]]" readonly="[[readonly]]" aria-label="Year" />
                                    <span class="smart-calendar-year-elements">
                                        <smart-repeat-button next-year class="smart-calendar-button" id="nextYearButton" animation="[[animation]]" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]" right-to-left="[[rightToLeft]]" aria-label="Next year">
                                            <span aria-hidden="true"></span>
                                        </smart-repeat-button>
                                        <smart-repeat-button prev-year class="smart-calendar-button" id="previousYearButton" animation="[[animation]]" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]" right-to-left="[[rightToLeft]]" aria-label="Previous year">
                                            <span aria-hidden="true"></span>
                                        </smart-repeat-button>
                                    </span>
                                </div>
                            </div>
                            <smart-repeat-button next-month class="smart-calendar-button" id="nextMonthButton" animation="[[animation]]" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]" right-to-left="[[rightToLeft]]" aria-label="Next month">
                                <span aria-hidden="true"></span>
                            </smart-repeat-button>
                        </div>
                        <div id="body" class="smart-content smart-calendar-body" role="presentation">
                            <div id="monthsContainer" class="smart-calendar-months-container" role="presentation">
                              <div id="month" class="smart-calendar-month" role="grid">
                                   <div id="monthName" class="smart-calendar-month-name"></div>
                                   <div id="weekTitles" class="smart-calendar-week-titles" role="row">
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                       <div class="smart-calendar-week-title" role="columnheader"></div>
                                   </div>
                                   <div id="weeks" class="smart-calendar-weeks" role="rowgroup">
                                        <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                        </div>
                                        <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                       </div>
                                       <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                       </div>
                                       <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                       </div>
                                       <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                       </div>
                                       <div class="smart-calendar-week" role="row">
                                           <div class="smart-calendar-week-number" role="rowheader"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"></div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                           <div class="smart-calendar-cell" role="gridcell"> </div>
                                       </div>
                                   </div>
                                </div>
                            </div>
                            <div id="dateViewContainer" class="smart-calendar-date-view-container smart-hidden">
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                                    <div class="smart-calendar-cell" role="button"></div>
                            </div>
                            <div id="monthsSeparator" class="smart-calendar-month-separator"></div>
                            <div id="nextMonthsContainer" class="smart-calendar-next-months-container" aria-hidden="true"></div>
                            <smart-list-box id="listViewContainer" class="smart-calendar-list-view smart-hidden"
                                right-to-left="[[rightToLeft]]"
                                item-height="30"
                                unfocusable
                                selection-mode="one"
                                animation="simple">
                            </smart-list-box>
                            <div id="animationPanel" class="smart-calendar-animation-panel smart-hidden"></div>
                        </div>
                        <div id="footer" class="smart-calendar-footer smart-hidden">
                            <div id="selectedDatesRange"></div>
                        </div>
                        <smart-tooltip id="tooltip" open-mode="manual" right-to-left="[[rightToLeft]]" arrow="[[tooltipArrow]]"
                                   tooltip-template="[[tooltipTemplate]]"
                                   arrow-direction="[[tooltipArrowDirection]]"
                                   offset="[[tooltipOffset]]"
                                   position="[[tooltipPosition]]"
                                   delay="[[tooltipDelay]]"
                                   disabled="[[disabled]]">
                         </smart-tooltip>
                        <input id="hiddenInput" type="hidden" name="[[name]]">
                    </div>
                </div>`}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const n=this;switch(e){case"animationSettings":n._applyAnimationSettings();break;case"disabled":case"unfocusable":n._setFocusable();break;case"calendarMode":n.displayMode="month",n._refreshCalendarMode(),n._setDisplayModeContent();break;case"dayNameFormat":n._refreshDayOfWeekTitles(n.$.month);break;case"dateFormatFunction":{let e=n.$.monthsContainer.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML=a?a(e[t]._date):n._monthsNames[e[t]._date.getMonth()]+" "+e[t]._date.toLocaleDateString(n.locale,{year:n.yearFormat});n._refreshHeaderTitle();break}case"displayMode":if("classic"===n.calendarMode&&"month"!==a){n[e]="month";break}n._setDisplayMode(t,a);break;case"displayModeView":n._applyAnimationSettings(!0),"month"!==n.displayMode&&n._setDisplayModeContent();break;case"firstDayOfWeek":n._handleMonths(),n._refreshDayOfWeekTitles();break;case"hideTooltipArrow":n.$.tooltip.arrow=!a;break;case"titleTemplate":case"headerTemplate":case"footerTemplate":n._handleLayoutTemplate(n.$[e.split(/[T]/)[0]],a),"titleTemplate"===e?n._refreshTitle():"headerTemplate"===e?n._refreshHeaderTitle():n._refreshFooter();break;case"importantDates":n.importantDates=n._getValidDates(a),n._refreshImportantDates();break;case"importantDatesTemplate":n._handleImportantDateTemplate(),n._refreshImportantDates();break;case"locale":n._refreshMonthNames(),n._refreshDayOfWeekTitles(),n._refreshHeaderTitle(),n._refreshTitle(),n._refreshFooter(),n.displayMode&&"month"!==n.displayMode&&n._setDisplayModeContent();break;case"max":case"min":n._validateMinMax(e,a,t),n._validateSelectedDates(),n._noFocusingRequired=!1,n._refreshHeaderElements();break;case"months":n._handleMonths();break;case"monthNameFormat":n._refreshCalendarMode(),n._refreshHeaderTitle();break;case"restrictedDates":n._setRestrictedDates(n.restrictedDates=n._getValidDates(a));break;case"rightToLeft":n._refreshDayOfWeekTitles(),n._handleMonths();break;case"scrollButtonsNavigationMode":n._setScrollButtonsNavigationMode();break;case"selectedDates":if(n._clearSelection(!0),n._validateSelectedDates(n._getValidDates(a)),n._applySelectionMode(!0),n._viewDates){let e=n.selectedDates[n.selectedDates.length-1];n._isDateInView(e)?n.selectedDates.map(e=>n._selectDate(e,!0,!0)):n._handleMonths(e)}n._refreshFooter(),n._setWeeksVisibility(n.$.monthsContainer),n.$.hiddenInput.value=n.selectedDates.toString(),n.$.fireEvent("change",{value:n.selectedDates}),n._refreshTitle(),"month"!==n.displayMode&&n._setDisplayModeContent();break;case"selectionMode":n._applySelectionMode(!1,t),n._refreshTitle();break;case"view":n._refreshTitle();break;case"viewSections":-1<a.indexOf("title")?n.$title.removeClass("smart-hidden"):n.$title.addClass("smart-hidden"),n._refreshTitle(),-1<a.indexOf("header")?n.$header.removeClass("smart-hidden"):n.$header.addClass("smart-hidden"),n._refreshHeaderTitle(),-1<a.indexOf("footer")?n.$footer.removeClass("smart-hidden"):n.$footer.addClass("smart-hidden"),n._refreshFooter(),n._setFocusable();break;case"weeks":n._setWeeksVisibility(n.$.monthsContainer);break;case"yearFormat":if(n._refreshCalendarMode(),n._refreshFooter(),1<n.months&&"month"===n.displayMode){let e=n._animationStarted?n.$.nextMonthsContainer.children:n.$.monthsContainer.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML=n.dateFormatFunction?n.dateFormatFunction(e[t]._date):n._monthsNames[e[t]._date.getMonth()]+" "+e[t]._date.toLocaleDateString(n.locale,{year:a})}n._refreshTitle(),n._refreshHeaderTitle();}}ready(){super.ready();const e=this;e._keysPressed={},e._applyAnimationSettings(),e.importantDates=e._getValidDates(e.importantDates),e.restrictedDates=e._getValidDates(e.restrictedDates)}render(){const e=this;e.setAttribute("role","dialog"),e._refreshMonthNames(),e._validateMinMax(),e._validateSelectedDates(e._getValidDates(e.selectedDates)),e._handleLayoutTemplate(e.$.title,e.titleTemplate),e._handleLayoutTemplate(e.$.header,e.headerTemplate),e._handleLayoutTemplate(e.$.footer,e.footerTemplate),e._handleImportantDateTemplate(),e._setFocusable(),e._refreshDayOfWeekTitles(),e._applySelectionMode(!0),e._handleMonths(0===e.selectedDates.length?new Date(new Date().setHours(0,0,0,0)):e.selectedDates[e.selectedDates.length-1]),e._updateViewSectionsVisibility(),e._setScrollButtonsNavigationMode(),e._refreshCalendarMode(),e._setDisplayMode(),e._refreshTitle(),e._refreshFooter(),e._refreshImportantDates(),e.$.monthElement&&e.$.monthElement._setDropDownSize(),e._changeEventFired=0,e.$.hiddenInput.value=e.selectedDates.toString(),e.shadowRoot&&e.appendChild(e.$.hiddenInput),super.render()}_updateViewSectionsVisibility(){const e=this;-1<e.viewSections.indexOf("title")?e.$title.removeClass("smart-hidden"):e.$title.addClass("smart-hidden"),-1<e.viewSections.indexOf("header")?e.$header.removeClass("smart-hidden"):e.$header.addClass("smart-hidden"),-1<e.viewSections.indexOf("footer")?e.$footer.removeClass("smart-hidden"):e.$footer.addClass("smart-hidden")}clearSelection(){this._clearSelection()}_setFocusable(){function e(e,t){return t?e&&e instanceof t?("function"==typeof e._setFocusable&&e.isCompleted?e.unfocusable=-1>=a:e.setAttribute("tabindex",a),e):void 0:void 0}const t=this;let a=0<t.tabIndex?t.tabIndex:0;(t.disabled||t.unfocusable)&&(a=-1),t.$.previousMonthButton=e(t.$.previousMonthButton,Smart.Button),t.$.nextMonthButton=e(t.$.nextMonthButton,Smart.Button),t.$.nextYearButton=e(t.$.nextYearButton,Smart.Button),t.$.previousYearButton=e(t.$.previousYearButton,Smart.Button),t.$.monthElement=e(t.$.monthElement,Smart.DropDownList),t.$.yearElement=e(t.$.yearElement,HTMLInputElement),-1<t.viewSections.indexOf("title")&&(t.$.dateContainer.setAttribute("tabindex",a),t.$.yearContainer.setAttribute("tabindex",a)),t.$.body.setAttribute("tabindex",a),"default"===t.calendarMode?t.$.dateElement.setAttribute("tabindex",a):t.$.dateElement.removeAttribute("tabindex"),t.tabIndex=t.readonly&&!t.disabled?0<t.tabIndex?t.tabIndex:0:a}static get requires(){return{"Smart.DropDownList":"smart.dropdownlist.js","Smart.ListBox":"smart.listbox.js","Smart.RepeatButton":"smart.button.js","Smart.Tooltip":"smart.tooltip.js"}}navigate(e){const t=this;let a,n,l;if(e){if("number"==typeof e){if(e=parseInt(e),isNaN(e)||0===e)return!1;if(6!==t.weeks&&0!==t.weeks&&"month"===t.displayMode){t._focusedCell||t._focusCell();let l,i;const s=[].slice.call(t._focusedCell.closest(".smart-calendar-weeks").children).filter(e=>!e.classList.contains("smart-hidden"));0>e?(i=s[0].querySelectorAll(".smart-calendar-cell"),l=t.rightToLeft?i[i.length-1]:i[0]):(i=s[s.length-1].querySelectorAll(".smart-calendar-cell"),l=t.rightToLeft?i[0]:i[i.length-1]),n=new Date(l.value),n.setDate(n.getDate()+e),a=n}else a=t._getNextDate(e)}else{if(a=e=t._getValidDate(e),l=!0,isNaN(a.getTime()))return!1;const i=t._viewDates[0];if(i&&a.getMonth()===i.getMonth()&&a.getFullYear()===i.getFullYear())return!1;6!==t.weeks&&0!==t.weeks&&"month"===t.displayMode&&(n=a)}return!!a&&("month"===t.displayMode?(t.hasAnimation?(t._animateNavigation(a,e),t.$nextMonthsContainer.hasClass("smart-date-view-container")&&t.$nextMonthsContainer.removeClass("smart-date-view-container")):(t._handleMonths(a),t._refreshHeaderElements(),t._refreshHeaderTitle()),n&&(t._focusCell(t._getCellByDate(n,t._animationStarted?t.$.nextMonthsContainer:void 0),!0),t._updateWeeksVisibility(e)),!0):(!l&&t.hasAnimation?(t.$nextMonthsContainer.addClass("smart-calendar-date-view-container"),"list"===t.displayModeView?t._setDisplayModeContent(a):(!t._navigationDate||t._navigationDate.getTime()!==a.getTime())&&t._animateNavigation(a,e)):t._setDisplayModeContent(a),!0))}}select(e){const t=this;"undefined"!=typeof t._viewDates[0]&&"none"!==t.selectionMode&&e&&(e=t._getValidDate(e),!(e instanceof Date)||"one"===t.selectionMode&&-1<t.selectedDates.map(Number).indexOf(e.getTime())||e.getTime()<t.min.getTime()||e.getTime()>t.max.getTime()||(("one"===t.selectionMode||"default"===t.selectionMode||"zeroOrOne"===t.selectionMode)&&t._clearSelection(!0),t._selectDate(e),1===t.selectedDates.length&&!t._isDateInView(t.selectedDates[0])&&t._handleMonths(t.selectedDates[0])))}today(){const e=this;let t=new Date;return t.setHours(0,0,0,0),t.getTime()<e.min.getTime()||t.getTime()>e.max.getTime()?t=new Date(e.max):e.selectedDates=[t],e._handleMonths(t),t}_animateNavigation(e,t,a){function n(){let e=0<t?s.$.body[s._animationSettings.scrollSize]>=r:0===s.$.body[s._animationSettings.scrollSize],a=s._scrollStep/2;return e?void s._animateNavigationCompleted():void(0<t&&s.$.body[s._animationSettings.scrollSize]>r*s._animationSettings.easeThreshold?(a=l(s.$.body[s._animationSettings.scrollSize]/s._animationSettings.stepEaseSize,i(a-(r-s.$.body[s._animationSettings.scrollSize])*s._animationSettings.step)),s._scrollStep=s._scrollStep*s._animationSettings.step+a):0>t&&s.$.body[s._animationSettings.scrollSize]<r*s._animationSettings.easeThreshold&&(a=l(s.$.body[s._animationSettings.scrollMax]/s._animationSettings.stepEaseSize,i(a-s.$.body[s._animationSettings.scrollSize]*s._animationSettings.step)),s._scrollStep=s._scrollStep*s._animationSettings.step+a),s.$.body[s._animationSettings.scrollSize]+=0<t?s._scrollStep:-s._scrollStep,s._animationId=requestAnimationFrame(n))}var l=Math.max,i=Math.abs;const s=this;s._navigationDate=e,s._animationSettings||s._applyAnimationSettings(),s.$animationPanel.addClass("smart-hidden"),s.$.dateViewContainer.style.transform="",s.$.dateViewContainer.style.opacity="",s.$.monthsContainer.style.transform="",s.$.monthsContainer.style.opacity="";const o="month"===s.displayMode?s.$.monthsContainer:s.$.dateViewContainer,r=s.$.body[s._animationSettings.scrollMax]-s.$.body[s._animationSettings.size];if(s._scrollStep=s.$.body[s._animationSettings.size]*s._animationSettings.startSpeed,s._animationStarted){const e=s._getMonthCells(s.$.monthsContainer,s.rightToLeft);e.map(e=>{s._setCellState(e,"restricted",!1),s._setCellState(e,"selected",!1),s._setCellState(e,"otherMonth",!1),s._setCellState(e,"focus",!1),s._setCellState(e,"important",!1),s._setCellState(e,"today",!1),s._setCellState(e,"disabled",!1),s._setCellState(e,"hover",!1)})}s._animationStarted=!0,"month"===s.displayMode?s._handleMonths(e,s.$.nextMonthsContainer):(s._setCellState(s._focusedCell,"focus",!1),s._setDisplayModeContent(e,s.$.nextMonthsContainer)),s.rightToLeft&&(t*=-1),a||(0<t?(o.style.order=1,s.$.nextMonthsContainer.style.order=3,(!s._animationStarted||s._animationStarted&&s.$.body[s._animationSettings.scrollSize]>2*(s.$.body[s._animationSettings.scrollMax]*s._animationSettings.resetThreshold))&&(s.$.body[s._animationSettings.scrollSize]=0)):(o.style.order=3,s.$.nextMonthsContainer.style.order=1,(!s._animationStarted||s._animationStarted&&s.$.body[s._animationSettings.scrollSize]<s.$.body[s._animationSettings.scrollMax]*s._animationSettings.resetThreshold)&&(s.$.body[s._animationSettings.scrollSize]=s.$.body[s._animationSettings.scrollMax]))),cancelAnimationFrame(s._animationId),s._animationId=requestAnimationFrame(n)}_animateNavigationCompleted(){const e=this;let t,a,n,l="month"===e.displayMode?e.$.monthsContainer:e.$.dateViewContainer;if(cancelAnimationFrame(e._animationId),"month"!==e.displayMode){let i=[].slice.call(l.children).indexOf(e._focusedCell);l.innerHTML=e.$.nextMonthsContainer.innerHTML;let s,o=l.children[i];a=l.children,n=e.$.nextMonthsContainer.children;for(let t=0;t<a.length;t++)a[t].value=n[t].value,a[t].restricted=n[t].restricted,a[t].important=n[t].important,a[t].otherMonth=n[t].otherMonth,a[t].value.getTime()<=e.max.getTime()&&(s=a[t]);t=o&&o.value.getTime()>=e.max.getTime()?s.value:e._focusedCell?e._focusedCell.value:void 0}else{let t=l.children,s=e.$.nextMonthsContainer.children;for(let l=0;l<t.length&&!!s[l]._date;l++){t[l]._date=s[l]._date,t[l].innerHTML=s[l].innerHTML,a=e._getMonthCells(t[l]),n=e._getMonthCells(s[l]);for(let e=0;e<a.length;e++)a[e].value=n[e].value,a[e].restricted=n[e].restricted,a[e].important=n[e].important,a[e].otherMonth=n[e].otherMonth,a[e].removeAttribute("focus")}0<e._selectedCells.length&&(e._selectedCells=e._selectedCells.map(t=>t=e._getCellByDate(t.value)).filter(e=>"undefined"!=typeof e))}e._focusCell(e._getCellByDate(t)),l.style.order=1,e.$.nextMonthsContainer.style.order=3,e.$.body[e._animationSettings.scrollSize]=0,e._animationStarted=!1,delete e._navigationDate}_applyAnimationSettings(e){const t=this;if(!t.hasAnimation)return void delete t._animationSettings;t._animationSettings=t.animationSettings?t.animationSettings:t._animationSettings?t._animationSettings:{},"portrait"===t.scrollButtonsNavigationMode?(t._animationSettings.scrollMax="scrollHeight",t._animationSettings.size="offsetHeight",t._animationSettings.scrollSize="scrollTop"):(t._animationSettings.scrollMax="scrollWidth",t._animationSettings.size="offsetWidth",t._animationSettings.scrollSize="scrollLeft");e||(t._animationSettings.startSpeed=t._animationSettings.startSpeed?t._animationSettings.startSpeed:.2,t._animationSettings.easeThreshold=t._animationSettings.easeThreshold?t._animationSettings.easeThreshold:.5,t._animationSettings.step=t._animationSettings.step?t._animationSettings.step:.25,t._animationSettings.stepEaseSize=t._animationSettings.stepEaseSize?t._animationSettings.stepEaseSize:200,t._animationSettings.resetThreshold=t._animationSettings.resetThreshold?t._animationSettings.resetThreshold:.2)}_applySelectionMode(e,t){function a(e,t){const a=i.$.monthsContainer.children;for(let n=0;n<a.length;n++)i._getMonthCells(a[n]).map(a=>{i._setCellState(a,e,t)})}var n=Math.min,l=Math.max;const i=this;let s=[],o=!!e,r=i.selectionMode;switch(("many"!==r||"range"!==r)&&a("hover",!1),i._newRangeSelectionStarted=0<i.selectedDates.length&&"range"===r,-1===["default","many","zeroOrMany","oneOrMany","week","range"].indexOf(r)?Array.from(i.getElementsByClassName("smart-calendar-month")).forEach(e=>e.removeAttribute("aria-multiselectable")):Array.from(i.getElementsByClassName("smart-calendar-month")).forEach(e=>e.setAttribute("aria-multiselectable",!0)),("none"===r||"none"===t)&&a("selected",!1),r){case"none":return void i._clearSelection(o);case"range":return void(1<i.selectedDates.length&&i._selectMultipleDates(i.selectedDates[0],i.selectedDates[i.selectedDates.length-1]));case"many":case"default":case"oneOrMany":if(0===i.selectedDates.length){s.push(new Date(n(l(i.min.getTime(),new Date().setHours(0,0,0,0)),i.max.getTime())));break}return;case"one":if(1===i.selectedDates.length)return;1<i.selectedDates.length?(s.push(i.selectedDates[i.selectedDates.length-1]),i._clearSelection(o)):s.push(new Date(n(l(i.min.getTime(),new Date().setHours(0,0,0,0)),i.max.getTime())));break;case"zeroOrOne":if(1<i.selectedDates.length){s.push(i.selectedDates[i.selectedDates.length-1]),i._clearSelection(o);break}return;case"zeroOrMany":return;case"week":if(1<=i.selectedDates.length){let e=i.selectedDates[i.selectedDates.length-1];for(let t=0;7>t;t++)s.push(new Date(e)),e.setDate(e.getDate()+1);i._clearSelection(o)}}if(i.selectedDates=[],e)return void(i.selectedDates=s);const m=s.length;for(let a=0;a<m;a++)i._selectDate(s[a],a<m-1)}_clearSelection(e){const t=this,a=t.selectionMode;if(t._selectedCells&&t._selectedCells.map(e=>{t._setCellState(e,"selected",!1)}),t.selectedDates=[],t._selectedCells=[],"many"===a||"range"===a){const e=t.$.monthsContainer.children;for(let a=0;a<e.length;a++)t._getMonthCells(e[a]).map(e=>{t._setCellState(e,"hover",!1)})}t._refreshFooter(),t.$.hiddenInput.value=t.selectedDates.toString(),e||t.$.fireEvent("change",{value:[]}),t._refreshTitle()}_bodyBlurStateHandler(e){const t=this;t._bodyStateHandler(e),delete t._newRangeSelectionStarted}_bodyFocusStateHandler(e){const t=this;t._bodyStateHandler(e)}_bodyStateHandler(e){const t=this;if(t._focusedCell){if("blur"===e.type||"focus"===e.type&&t._noFocusingRequired)return t._noFocusingRequired=!1,void t._setCellState(t._focusedCell,"focus",!1);if("month"!==t.displayMode)return void("focus"!==e.type||t.$.dateViewContainer.querySelector("smart-calendar-cell[focus]")||t._setCellState(t._focusedCell||t.$.dateViewContainer.querySelector(".smart-calendar-cell"),"focus",!0))}"focus"===e.type&&t._focusCell()}_containerWheelHandler(e){const t=this;if(t.disabled||t.readonly)return;let a,n;n=document.activeElement,t.shadowRoot?n=t.shadowRoot.activeElement:t.isInShadowDOM&&(n=t.getRootNode().activeElement),t.$.yearElement===n&&(a=12),(n&&t.shadowRoot||n.closest("smart-calendar")===t)&&(a=e.target===t.$.yearElement?12:1);a&&(e.preventDefault(),a=12==a?a:a*t.months,0<e.deltaY?t.navigate(-a):t.navigate(a))}_downHandler(e){const t=this;let a=e.originalEvent.target;if(t._dragStartDetails=void 0,!(t.disabled||t.readonly)){if(t.hasRippleAnimation&&(a.value instanceof Date||a.parentElement&&a.parentElement.classList.contains("smart-calendar-title")||a.parentElement===t.$.dateElement)&&Smart.Utilities.Animation.Ripple.animate(a,e.pageX,e.pageY),a=e.originalEvent.target.closest(".smart-calendar-header"),e.originalEvent.target.closest(".smart-calendar-year-container")&&"decade"!==t.displayMode)return"classic"===t.calendarMode?void 0:void t._showDateView("year");if(e.originalEvent.target.closest(".smart-calendar-date-container")&&"month"!==t.displayMode)return"classic"===t.calendarMode?void 0:void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedCell,"month");if(t._animationStarted&&t._animateNavigationCompleted(),Smart.Utilities.Core.isMobile&&!(a&&a===t.$.header))return void(t._dragStartDetails={x:e.pageX,y:e.pageY,startTime:Date.now(),target:e.originalEvent.target});if(a=e.originalEvent.target,a.closest(".smart-calendar-week")||a.parentElement===t.$.dateViewContainer){for(;a&&!(a.value instanceof Date);)a=a.parentElement;return void(a&&("month"===t.displayMode?t._weeksDownHandler(e,a):t._displayModeHandler(a)))}if(!a.closest(".smart-calendar-month-element")){if(e.originalEvent.stopPropagation(),"list"===t.displayModeView&&"month"!==t.displayMode)return a=(t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target).closest("smart-list-item"),void(a&&t._displayModeHandler(a));const n=document.scrollingElement||document.documentElement,l=n.scrollLeft,i=n.scrollTop;t.focus(),window.scrollTo(l,i)}}}_displayModeHandler(e,t){const a=this;if(a._animationStarted&&a._animateNavigationCompleted(),e instanceof HTMLElement&&e.parentElement.classList.contains("smart-calendar-week")&&e.otherMonth){if("decade"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()>a.max.getFullYear()))return;if("year"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()===a.min.getFullYear()&&e.value.getMonth()<a.min.getMonth()||e.value.getFullYear()>a.max.getFullYear()||e.value.getFullYear()===a.max.getFullYear()&&e.value.getMonth()>a.max.getMonth()))return}if(t=t?t:a.displayMode,"year"===t?t="month":"decade"===t?t="year":void 0,a.displayMode!==t){const n=a.$.fireEvent("displayModeChanging",{oldDisplayMode:a.displayMode,newDisplayMode:t}).defaultPrevented;n||(a.displayMode=t,a.$nextMonthsContainer.removeClass("smart-calendar-date-view-container"),e.parentElement===a.$.dateViewContainer&&!e.disabled&&!e.restricted&&a._focusCell(e),a.hasAnimation?(e instanceof Smart.ListItem||e.ownerListBox===a.$.listViewContainer?e.offsetHeight?a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(0<e.dataItem.top?e.offsetTop-e.offsetHeight/2:e.offsetTop+e.offsetHeight/2)+"px":a.$.animationPanel.style.transformOrigin=a.$.listViewContainer.offsetLeft+a.$.listViewContainer.offsetWidth/2+"px "+(a.$.listViewContainer.offsetTop+a.$.listViewContainer.offsetHeight/2)+"px":(a.$.dateViewContainer.style.order=1,a.$.nextMonthsContainer.style.order=3,e=a._focusedCell,a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.offsetTop+e.offsetHeight/2)+"px"),a._animateView(1,e)):a._setDisplayModeContent(e.value instanceof Date?e.value:new Date(e.value)))}}_animateView(e,t){function a(){return(0<e&&3.5<=d||0>e&&0>=d)&&(r=!0),r?(cancelAnimationFrame(l._animationId),l.$animationPanel.addClass("smart-hidden"),l.$.animationPanel.style.transform="",l.$.animationPanel.style.opacity="",i.style.order=1,l.$.nextMonthsContainer.style.order=3,l.$.body[l._animationSettings.scrollSize]=0,s.style.transform="",s.style.opacity="",void("month"===l.displayMode?l.$.body.focus():"list"===l.displayModeView&&l.focus())):void(l.$.animationPanel.style.opacity=m,s.style.opacity=1-m,m-=.05,0<e?(l.$.animationPanel.style.transform="scale("+d+")",s.style.transform="scale("+Math.min((d-1)/2,1)+")",d+=.125):(l.$.animationPanel.style.transform="scale("+n(d,0)+")",s.style.transform="scale("+n(1+d,1)+")",d-=.06),l._animationId=requestAnimationFrame(a))}var n=Math.max;const l=this;let i,s,o=t instanceof Date?t:new Date(t.value),r=!1,d=1,m=1;if("list"===l.displayModeView?(i=t instanceof Smart.ListItem||t.ownerListBox===l.$.listViewContainer?l.$.listViewContainer:"month"===l.displayMode?l.$.listViewContainer:l.$.monthsContainer,s="month"===l.displayMode?l.$.monthsContainer:l.$.listViewContainer):!(t.value instanceof Date)&&(t=l._focusedCell?l._focusedCell:0<l._selectedCells.length?l._selectedCells[l._selectedCells.length-1]:l._getCellByDate(new Date)),i||(i=t.parentElement===l.$.dateViewContainer?l.$.dateViewContainer:l.$.monthsContainer),s||(s="month"===l.displayMode?l.$.monthsContainer:l.$.dateViewContainer),s.style.transformOrigin=l.$.animationPanel.style.transformOrigin,i instanceof Smart.ListBox)for(l.$.animationPanel.innerHTML="",l.$.animationPanel.appendChild(i.cloneNode(!1));i.$.itemsInnerContainer.firstElementChild;)l.$.animationPanel.children[0].appendChild(i.$.itemsInnerContainer.firstElementChild);else l.$.animationPanel.innerHTML=i.innerHTML;if(l._setDisplayModeContent(o),i.style.order=1,l.$.nextMonthsContainer.style.order=3,l.$.body[l._animationSettings.scrollSize]=0,l.$.animationPanel.style.width=l.$.body.offsetWidth+"px",l.$.animationPanel.style.height=l.$.body.offsetHeight+"px",l.$.animationPanel.style.transform="scale(1)",l.$.animationPanel.style.opacity=1,l.$animationPanel.removeClass("smart-hidden"),s.style.opacity="0",s.style.transform="scale(3.5)",i.$.hasClass("smart-calendar-date-view-container")?l.$animationPanel.addClass("smart-calendar-date-view-container"):l.$animationPanel.removeClass("smart-calendar-date-view-container"),i instanceof Smart.ListBox){const e=l.$.animationPanel.children[0];e.whenReady(function(){e._refreshLayout(),e.ensureVisible(e.selectedValues[0])})}cancelAnimationFrame(l._animationId),l._animationId=requestAnimationFrame(a)}_documentUpHandler(e){var t=Math.abs;const a=this;if(!Smart.Utilities.Core.isMobile||!a._dragStartDetails)return;delete a._previousIteration;const n=Date.now();let l=e.originalEvent.target,i={};(a.isInShadowDOM||a.shadowRoot&&l===a)&&(l=e.originalEvent.composedPath()[0]),"portrait"===a.scrollButtonsNavigationMode?(i.coordinate="y",i.direction="pageY"):(i.coordinate="x",i.direction="pageX");const s=a._dragStartDetails.step*(a.rightToLeft?-1:1);if(10>=t(a._dragStartDetails[i.coordinate]-e[i.direction])){if(l="list"===a.displayModeView&&"month"!==a.displayMode?l.closest("smart-list-item"):l,!l)return void(a._dragStartDetails=void 0);if("month"!==a.displayMode)return a._displayModeHandler(l),"portrait"===a.scrollButtonsNavigationMode?a.$.body.scrollTop=0:a.$.body.scrollLeft=0,void(a._dragStartDetails=void 0);if(a._weeksDownHandler(e,l),!a.disableAutoNavigation&&l.otherMonth)return}else{const l=t((e[i.direction]-a._dragStartDetails[i.coordinate])/(n-a._dragStartDetails.startTime));if(1<l){const e=parseInt(l);for(let t=0;t<e;t++)a.navigate(s);return void(a._dragStartDetails=void 0)}}if(!a.hasAnimation)return void(a._dragStartDetails=void 0);let o=("month"===a.displayMode?a.$.monthsContainer[a._animationSettings.scrollMax]:a.$.dateViewContainer[a._animationSettings.scrollMax])+a.$.monthsSeparator[a._animationSettings.size];return 0<a._dragStartDetails.step&&a.$.body[a._animationSettings.scrollSize]>o*a._animationSettings.easeThreshold||0>a._dragStartDetails.step&&a.$.body[a._animationSettings.scrollSize]<o*a._animationSettings.easeThreshold?(a._animateNavigation(a._dragStartDetails.navigationDate,s,!0),6!==a.weeks&&0!==a.weeks&&"month"===a.displayMode&&a._updateWeeksVisibility(s,a._getCellByDate(a._dragStartDetails.navigationDate,a.$.nextMonthsContainer)),void(a._dragStartDetails=void 0)):void(a._cancelAnimation(void 0,s||1),a._dragStartDetails=void 0)}_cancelAnimation(){function e(){if(!n||3.5<=n){cancelAnimationFrame(t._animationId),t.$animationPanel.addClass("smart-hidden"),t.$.animationPanel.style.transform="",t.$.animationPanel.style.opacity="";const e="month"===t.displayMode?t.$.monthsContainer:t.$.listViewContainer;return e.style.transform="",e.style.opacity="","month"===t.displayMode?t.$.body.focus():"list"===t.displayModeView&&t.focus(),void(t._animationStarted=!1)}t.$.animationPanel.style.opacity=l-=.25,t.$.animationPanel.style.transform="scale("+(n+=.5)+")",t._animationId=requestAnimationFrame(e)}const t=this,a="month"===t.displayMode?t.$.monthsContainer:t.$.dateViewContainer;let n=t.$.animationPanel.style.transform,l=t.$.animationPanel.style.opacity;n&&(n=parseFloat(n.substring(n.indexOf("(")+1||0,n.indexOf(")")))),a.style.order=1,t.$.nextMonthsContainer.style.order=3,t.$.body[t._animationSettings.scrollSize]=0,t._animationId=requestAnimationFrame(e)}_focusCell(e,t){const a=this;if(a._focusedCell&&a._setCellState(a._focusedCell,"focus",!1),!(a.disabled||a.readonly)){if(e)return"month"===a.displayMode?e.disabled||e.restricted?void 0:(t||a._setCellState(e,"focus",!0),void(a._focusedCell=e)):(a._setCellState(e,"focus",!0),void(a._focusedCell=e));if("month"===a.displayMode||0!==a.$.monthsContainer.offsetHeight){const e=a._selectedCells[a._selectedCells.length-1];if(e&&e.offsetHeight)a._setCellState(e,"focus",!0),a._focusedCell=e;else{const e=a.$.monthsContainer.children;if(!e[0]._date||a.min.getTime<e[0]._date.getTime())return;const t=a._getMonthCells(e[0],a.rightToLeft);for(let e=0;e<t.length;e++){const n=t[e];if(!n.otherMonth){if(n.disabled||n.restricted||!n.offsetHeight)continue;a._focusedCell=n;break}}}a._focusedCell&&a._setCellState(a._focusedCell,"focus",!0)}}}_getDays(e,t){const a=t.length;let n=[];if(0<a)for(let l=0;l<a;l++)t[l].getFullYear()===e.getFullYear()&&t[l].getMonth()===e.getMonth()&&n.push(t[l].getDate());return n}_getCellByDate(e,t){const a=this;if(!(e instanceof Date))return;if(t||(t=a.$.monthsContainer),"month"!==a.displayMode){if("list"===a.displayModeView)return;let t=arguments[1]?a.$.nextMonthsContainer.children:a.$.dateViewContainer.children;for(let n=0;n<t.length;n++)if("year"===a.displayMode){if(t[n].value.getMonth()===e.getMonth())return t[n];continue}else if(t[n].value.getFullYear()===e.getFullYear())return t[n];return}let n,l,s=t.children;for(let a=0;a<s.length;a++)if(e.getFullYear()===s[a]._date.getFullYear()&&e.getMonth()===s[a]._date.getMonth()){n=s[a];break}if(n){l=a._getMonthCells(n);for(let t=0;t<l.length;t++)if((!l[t].otherMonth||l[t].hover)&&l[t].value.getMonth()===e.getMonth()&&l[t].value.getDate()===e.getDate())return l[t]}}_getMonthCells(e,t){const a=e.getElementsByClassName("smart-calendar-week");let n=[];if(t)for(let e,t=0;t<a.length;t++){e=a[t].children;for(let t=e.length-1;0<t;t--)e[t].classList.contains("smart-calendar-cell")&&n.push(e[t])}else for(let e,t=0;t<a.length;t++){e=a[t].children;for(let t=1;t<e.length;t++)e[t].classList.contains("smart-calendar-cell")&&n.push(e[t])}return n}_getWeekNumber(e){var t=Math.round;const a=this;let n,l=new Date(e.getFullYear(),0,1),i=t((e.getTime()-l.getTime()-6e4*(e.getTimezoneOffset()-l.getTimezoneOffset()))/864e5)+1,s=l.getDay()-a.firstDayOfWeek;return s=0<=s?s:s+7,4>s?(n=Math.floor((i+s-1)/7)+1,52<n&&(l=new Date(e.getFullYear()+1,0,1),s=l.getDay()-a.firstDayOfWeek,s=0<=s?s:s+7,n=4>s?1:53)):n=t((i+s-1)/7),n}_handleDateSelection(e){const t=this;if(!("undefined"==typeof e||e.disabled||e.restricted))switch(t.selectionMode){case"none":t._focusCell(e);break;case"one":case"default":if(t._keysPressed.Control)return 1<t.selectedDates.length||1===t.selectedDates.length&&!e.selected?void t._selectDate(e.value):void t._focusCell(e);if(t._keysPressed.Shift)return void t._selectMultipleDates(new Date(t.selectedDates[0]),e);t._clearSelection(!0),t._selectDate(e.value,!!(-1<t._selectedCells.indexOf(e.value)));break;case"many":{if(0===t.selectedDates.length)return void t._selectDate(e.value);const a=t.selectedDates[t.selectedDates.length-1];let n=new Date(t.selectedDates[0]);if(e.value.getTime()===n.getTime()||e.value.getTime()===a.getTime())return t._clearSelection(),void t._focusCell(e);0<t.selectedDates.length&&t._selectMultipleDates(n,e);break}case"range":{if(!(1<t.selectedDates.length)||t._keysPressed.Control||t._newRangeSelectionStarted||t._clearSelection(!0),0===t.selectedDates.length||t._keysPressed.Control&&1<t.selectedDates.length&&!t._newRangeSelectionStarted)return e.value&&t.selectedDates.find(t=>t.getTime()===e.value.getTime())?void 0:(t._newRangeSelectionStarted=!0,void t._selectDate(e.value));const a=t.selectedDates[t.selectedDates.length-1];let n=t._keysPressed.Control||t._newRangeSelectionStarted?a:new Date(t.selectedDates[0]);0<t.selectedDates.length&&t._selectMultipleDates(n,e),delete t._newRangeSelectionStarted;break}case"zeroOrMany":t._selectDate(e.value);break;case"oneOrMany":if(1===t.selectedDates.length&&e.selected)return void t._focusCell(e);t._selectDate(e.value);break;case"zeroOrOne":if(1===t.selectedDates.length&&e.selected)return void t._selectDate(e.value);t._clearSelection(!0),t._selectDate(e.value);break;case"week":{if(e.selected&&(e.value.getTime()===t.selectedDates[0].getTime()||e.value.getTime()===t.selectedDates[t.selectedDates.length-1].getTime()))return t._clearSelection(),void t._focusCell(e);t._clearSelection(!0);let a=new Date(e.value);t._selectDate(a);for(let e=1;7>e;e++)a.setDate(a.getDate()+1),t._selectDate(a);t._isDateInView(a)||t.navigate(1);break}}}_handleImportantDateTemplate(){const e=this;if(e._importantDatesTemplate=e._validateTemplate("importantDatesTemplate",e.importantDatesTemplate),!e._importantDatesTemplate||!e._importantDatesTemplate.content)return;let t=e._importantDatesTemplate.content;const a=t.childNodes.length,n=/{{\w+}}/g;let l;e._bindingDetails=[];for(let s=0;s<a;s++)if(l=n.exec(t.childNodes[s].innerHTML),l)return void e._bindingDetails.push({childNodeIndex:s,bindingString:l[0]})}_handleLayoutTemplate(e,t){const a=this,n=a._validateTemplate(e.$.hasClass("smart-header")?"headerTemplate":e.$.hasClass("smart-calendar-footer")?"footerTemplate":"titleTemplate",t);if(!n||!n.content)return void("function"==typeof t&&t(e,{}));a._layoutTemplates||(a._layoutTemplates=[]);let l=document.importNode(n.content,!0);e.innerHTML="";const s=l.childNodes.length,o=/{{\w+}}/g;let r,d=[];for(let a=0;a<s;a++)r=o.exec(l.childNodes[a].innerHTML),r&&d.push({childNodeIndex:a,bindingString:r[0]});return a._layoutTemplates=a._layoutTemplates.filter(t=>t.selector!==e),a._layoutTemplates.push({selector:e,template:n,bindings:d}),a.shadowRoot?(e.innerHTML="<slot></slot>",void a.appendChild(l)):void e.appendChild(l)}_handleCalendarCellHover(e,t){const a=this;if(!a._animationStarted){if("month"===a.displayMode)if("mouseover"===e.type&&("many"===a.selectionMode||"range"===a.selectionMode&&a._newRangeSelectionStarted)&&0<a.selectedDates.length){const e=a.$.monthsContainer.children;for(let t=0;t<e.length;t++)a._getMonthCells(e[t]).map(e=>{a._setCellState(e,"hover",!1)});let n=new Date("range"===a.selectionMode?a.selectedDates[a.selectedDates.length-1]:a.selectedDates[0]),l=new Date(t.value),i=t;const s=n.getTime()>l.getTime()?-1:1,o=function(){i=a._getCellByDate(n),!i||i.selected||i.restricted||a._setCellState(i,"hover",!0)};if(n.getTime()!==l.getTime()){for(n.setDate(n.getDate()+s);n.getTime()!==l.getTime();)o(),n.setDate(n.getDate()+s);o()}}else a._setCellState(t,"hover",!1);"mouseover"!==e.type||t.otherMonth?a._setCellState(t,"hover",!1):a._setCellState(t,"hover",!0)}}_handleMonths(e,t){function a(e){let t,a=e.children.length,n=document.createDocumentFragment();for(a;a<l.months;a++)t=l.$.month.cloneNode(!1),t.innerHTML=l.$.month.innerHTML,n.appendChild(t);return n}function n(t){let a=t.children;for(let n=0;n<a.length;n++)l._setMonth(e,a[n]),e.setMonth(e.getMonth()+1);l._setWeeksVisibility(t),l._refreshHeaderElements(),l._refreshHeaderTitle(),l.tooltip&&l.$.tooltip.close(),l.$.body===document.activeElement&&l._focusCell()}const l=this;let i;if(e||(e=l._viewDates&&0<l._viewDates.length?l._viewDates[0]:new Date),e=new Date(Math.min(Math.max(l.min.getTime(),e.getTime()),l.max.getTime())),t||(t=l.$.monthsContainer),l._selectedCells=[],l.hasAnimation){for(i=l.$.nextMonthsContainer.children,0<i.length&&i[0].value instanceof Date&&(l.$.nextMonthsContainer.innerHTML="");l.$.nextMonthsContainer.childElementCount<l.months;)l.$.nextMonthsContainer.appendChild(a(l.$.nextMonthsContainer));for(;l.$.nextMonthsContainer.childElementCount>l.months;)l.$.nextMonthsContainer.removeChild(i[l.$.nextMonthsContainer.childElementCount-1]);if(arguments[1]===l.$.nextMonthsContainer)return void n(l.$.nextMonthsContainer)}if(i=l.$.monthsContainer.children,i.length>l.months){for(;l.$.monthsContainer.childElementCount>l.months;)l.$.monthsContainer.removeChild(i[l.$.monthsContainer.childElementCount-1]),l._viewDates.pop();return void n(l.$.monthsContainer)}return l.$.monthsContainer.children.length===l.months?void n(l.$.monthsContainer):void(l._viewDates=[],l.$.monthsContainer.appendChild(a(l.$.monthsContainer)),n(l.$.monthsContainer))}_headerChangeHandler(e){const t=this;if(e.stopPropagation(),!(t.disabled||t.readonly)){if(e.target.ownerElement===t.$.monthElement&&0!==t._changeEventFired)return void t._changeEventFired--;const a=t.displayMode;e.target===t.$.yearElement&&(t._viewDates[0].setFullYear(Math.min(Math.max(t.min.getFullYear(),isNaN(parseInt(t.$.yearElement.value))?0:parseInt(t.$.yearElement.value)),t.max.getFullYear())),t._handleMonths(t._viewDates[0])),t.$.monthElement&&(e.target===t.$.monthElement||e.target.ownerElement===t.$.monthElement)&&(t._handleMonths(new Date(t.$.monthsContainer.children[0]._date.getFullYear(),t.$.monthElement.selectedIndexes[0],1)),"month"!==a&&t._setDisplayMode(t.displayMode,t.displayMode="month"))}}_headerClickHandler(e){const t=this;if(!(t.disabled||t.readonly)){let a=e.target.closest("smart-repeat-button");if(!(a&&a.disabled)){switch(a){case t.$.previousMonthButton:return t._isInteractiveNavigation=!0,void t.navigate(-1*t.months*(t.rightToLeft?-1:1));case t.$.nextMonthButton:return t._isInteractiveNavigation=!0,void t.navigate(1*t.months*(t.rightToLeft?-1:1));case t.$.previousYearButton:return void t.navigate(-12);case t.$.nextYearButton:return void t.navigate(12);}"classic"===t.calendarMode||e.target.closest(".smart-calendar-date-element")&&(t._animationStarted&&t._animateNavigationCompleted(),t._isInteractiveNavigation=!0,t._showDateView())}}}_selectMultipleDates(e,t){const a=this;if(t instanceof HTMLElement&&(t=t.value),a._newRangeSelectionStarted?a._selectDate(e,!0):a._clearSelection(!0),"range"!==a.selectionMode||t.getTime()!==e.getTime()){if(e.getTime()<t.getTime())for(;e.getTime()<=t.getTime();)a.selectedDates.find(t=>t.getTime()===e.getTime())||a._selectDate(e,!0),e.setDate(e.getDate()+1);else if(e.getTime()>t.getTime())for(;e.getTime()>=t.getTime();)a.selectedDates.find(t=>t.getTime()===e.getTime())||a._selectDate(e,!0),e.setDate(e.getDate()-1);else a._selectDate(t,!0);a.$.hiddenInput.value=a.selectedDates.toString(),a._refreshFooter(),a.$.fireEvent("change",{value:a.selectedDates}),a._refreshTitle()}}_setDisplayMode(e,t,a){const n=this;if(n.$nextMonthsContainer.removeClass("smart-calendar-date-view-container"),0===arguments.length||!n.hasAnimation)return"classic"===n.calendarMode?void(n.displayMode="month"):("month"!==n.displayMode&&(n.$monthsContainer.addClass("smart-hidden"),n.$dateViewContainer.hasClass("smart-hidden")&&n.$dateViewContainer.removeClass("smart-hidden")),!n.isCompleted&&"month"===n.displayMode)?void 0:void n._setDisplayModeContent();if(n._animationStarted&&(n.displayMode=e,n._animateNavigationCompleted(),n.displayMode=t),"month"===e&&"year"===t||"year"===e&&"decade"===t)n.displayMode=e,n._showDateView(a?void 0:n.displayMode);else if("month"===e&&"decade"===t)n._showDateView(n.displayMode="year");else{let e;"list"===n.displayModeView?(e=(n.$.listViewContainer.shadowRoot?n.$.listViewContainer.shadowRoot:n.$.listViewContainer).querySelector("smart-list-item[selected]"),n.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(0<e.dataItem.top?e.offsetTop-e.offsetHeight/2:e.offsetTop+e.offsetHeight/2)+"px"):(n.$.dateViewContainer.style.order=1,n.$.nextMonthsContainer.style.order=3,e=n._focusedCell,n.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.offsetTop+e.offsetHeight/2)+"px"),n._animateView(1,e)}}_setDisplayModeContent(e,t){const a=this;let n=e&&"Invalid Date"!==e.toString()?e:0<a.selectedDates.length?a.selectedDates[a.selectedDates.length-1]:new Date;n.setTime(Math.min(Math.max(n.getTime(),a.min.getTime()),a.max.getTime())),n.setHours(0,0,0,0);const l=a._prepareView(n);if(!l)return;let i;t?(a.$.nextMonthsContainer.innerHTML=a.$.dateViewContainer.innerHTML,i=a.$.nextMonthsContainer):i=a.$.dateViewContainer;const s=i.children;let o;for(let r=0;r<s.length;r++){const e=s[r];e.innerHTML=l.viewContent[r],e.value=l.dates[r],"year"===a.displayMode?(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()===a.min.getFullYear()&&e.value.getMonth()<a.min.getMonth()||e.value.getFullYear()>a.max.getFullYear()||e.value.getFullYear()===a.max.getFullYear()&&e.value.getMonth()>a.max.getMonth()?a._setCellState(e,"otherMonth",!0):a._setCellState(e,"otherMonth",!1),n.getFullYear()===e.value.getFullYear()&&n.getMonth()===e.value.getMonth()&&(o=e)):"decade"===a.displayMode&&(0==r||r==s.length-1||e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()>a.max.getFullYear()?a._setCellState(e,"otherMonth",!0):a._setCellState(e,"otherMonth",!1),n.getFullYear()===e.value.getFullYear()&&(o=e)),a._setCellState(e,"hover",!1),a._setCellState(e,"focus",!1)}if(o.otherMonth)for(let e=0;e<s.length;e++)if(!s[e].otherMonth){o=s[e];break}return a._mobileScrolling?void 0:(a._focusedCell&&a._setCellState(a._focusedCell,"focus",!1),a._focusedCell=o,a._focusCell(a._focusedCell),a._refreshHeaderTitle(),a._refreshHeaderElements(),a.$.fireEvent("displayModeChange"),a._isInteractiveNavigation?void(a._isInteractiveNavigation=void 0):void(a._setCellState(o,"focus",!0),setTimeout(function(){a.$.body.focus(),a._focusCell(a._focusedCell)},0)))}_prepareView(e){function t(e,t,a){let n=new Date(e,t+1,0),l=n.getDate();return a>l?n.setDate(l):n.setDate(a),n}const a=this;let n,l,s=[],o=[];if("month"===a.displayMode)return a.$nextMonthsContainer.hasClass("smart-date-view-container")&&a.$nextMonthsContainer.removeClass("smart-date-view-container"),a.$listViewContainer.addClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a._isDateInView(e)||a._handleMonths(e),a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$body.hasClass("smart-calendar-list-view")&&a.$body.removeClass("smart-calendar-list-view"),a.$dateContainer.addClass("smart-calendar-selected"),a.$yearContainer.removeClass("smart-calendar-selected"),a.$dateViewContainer.addClass("smart-hidden"),a.$monthsContainer.removeClass("smart-hidden"),a._refreshHeaderTitle(),a.$.body.setAttribute("tabindex",0<a.tabIndex?a.tabIndex:0),a._refreshHeaderElements(),a.$.body.focus(),a._focusCell(a._getCellByDate(e)),void a.$.fireEvent("displayModeChange");if("list"===a.displayModeView)return a._setDisplayModeListContent(e),void a.$.fireEvent("displayModeChange");if(a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a.$listViewContainer.addClass("smart-hidden"),a.$.body.setAttribute("tabindex",0<a.tabIndex?a.tabIndex:0),"year"===a.displayMode){let n=new Date;for(let l=0;12>l;l++)n=t(n.getFullYear(),l,n.getDate()),s.push(n.toLocaleDateString(a.locale,{month:"short"})),o.push(t(e.getFullYear(),l,e.getDate()))}else{n=e?e.getFullYear():a._viewDates[0].getFullYear(),l=n%10,0!==l&&(n-=l),n-=1;for(let t=0;12>t;t++)s.push(n+""),o.push(new Date(n,e.getMonth(),e.getDate())),++n}return{viewContent:s,dates:o}}_setDisplayModeListContent(e){function t(e,t,a){let n=new Date(e,t+1,0),l=n.getDate();return a>l?n.setDate(l):n.setDate(a),n}const a=this;let n=[];if(a.$dateViewContainer.addClass("smart-visibility-hidden"),a.$listViewContainer.hasClass("smart-hidden")&&(a.$body.addClass("smart-calendar-list-view"),a.$listViewContainer.removeClass("smart-hidden"),a.$.listViewContainer._setFocusable(),a.$.body.removeAttribute("tabindex")),"year"===a.displayMode){let l=new Date;for(let s=0;12>s;s++)l=t(l.getFullYear(),s,l.getDate()),n.push({label:l.toLocaleDateString(a.locale,{month:"short"}),value:t(e.getFullYear(),s,e.getDate()).toDateString()});a.$yearContainer.removeClass("smart-calendar-selected"),a.$dateContainer.addClass("smart-calendar-selected")}else{let t=a.min.getFullYear(),l=a.max.getFullYear();l=Math.min(a.max.getFullYear(),e.getFullYear()+10),t=Math.max(a.min.getFullYear(),l-10);for(let a=t;a<l;a++)n.push({label:a.toString(),value:new Date(a,e.getMonth(),e.getDate()).toDateString()});a.$yearContainer.addClass("smart-calendar-selected"),a.$dateContainer.removeClass("smart-calendar-selected")}a.$.listViewContainer.dataSource=n,a.$.listViewContainer.selectedValues=[e.toDateString()],a.$.listViewContainer.ensureVisible(a.$.listViewContainer.selectedValues[0]),a._refreshHeaderTitle(),a._refreshHeaderElements(),a.focus()}_isDateInView(e){const t=this;if(!e)return!1;for(let a=0;a<t._viewDates.length;a++)if(e.getFullYear()===t._viewDates[a].getFullYear()&&e.getMonth()===t._viewDates[a].getMonth()){let a=t._getCellByDate(e,t._animationStarted?t.$.nextMonthsContainer:void 0);return a?!(a.otherMonth||!a.offsetHeight||a.classList.contains("smart-visibility-hidden")):void 0}return!1}_keyDownHandler(e){const t=this;if(!(t.disabled||t.readonly)){const a=(t.shadowRoot||t.getRootNode()).activeElement||document.activeElement;switch(a){case t.$.yearElement:"Escape"===e.key&&t._refreshHeaderElements();break;case t.$.dateElement:if("default"===t.calendarMode&&" "===e.key||"Enter"===e.key)return e.preventDefault(),t._isInteractiveNavigation=!0,void t._showDateView();t._focusedCell||t._focusCell(),-1<e.key.indexOf("Arrow")&&t.$.dateElement===a&&t.$.body.focus(),t._navigateDays(e);break;case t.$.body:" "===e.key&&e.preventDefault(),t._navigateDays(e);break;case t.$.yearContainer:if((" "===e.key||"Enter"===e.key)&&"decade"!==t.displayMode&&(e.preventDefault(),t._isInteractiveNavigation=!0,t._showDateView("year")),-1<e.key.indexOf("Arrow")){if(e.preventDefault(),t._focusedCell||t._focusCell(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;case t.$.dateContainer:if((" "===e.key||"Enter"===e.key)&&"month"!==t.displayMode&&(e.preventDefault(),t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedCell,"month")),-1<e.key.indexOf("Arrow")){if(t._focusedCell||t._focusCell(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;default:if("month"!==t.displayMode&&"list"===t.displayModeView)return(["Arrow","End","Home","Page"].indexOf(e.key)&&e.preventDefault()," "===e.key||"Enter"===e.key||e.ctrlKey&&("ArrowUp"===e.key||"ArrowDown"===e.key))?void t._navigateDays(e):void t.$.listViewContainer._handleKeyStrokes(e.key);-1<e.key.indexOf("Arrow")&&(!t._focusedCell&&t._focusCell(),t._navigateDays(e));}}}_listViewContainerItemClickHandler(e){const t=this;Smart.Utilities.Core.isMobile&&("list"!==t.displayModeView||"month"===t.displayMode||t._displayModeHandler(e.target.items[e.detail.index]))}_listViewContainerChangeEventHandler(e){e.stopPropagation()}_listViewContainerKeyDownHandler(e){const t=this;"list"!==t.displayModeView||(" "===e.key||"Enter"===e.key)&&t._navigateDays(e)}_showDateView(e){const t=this;if(e=e?e:t.displayMode,"month"===e?e="year":"year"===e?e="decade":void 0,t.displayMode===e)return;const a=t.$.fireEvent("displayModeChanging",{oldDisplayMode:t.displayMode,newDisplayMode:e}).defaultPrevented;if(a)return;t.displayMode=e;let n;return"list"===t.displayModeView&&"month"!==t.displayMode&&0<t.$.listViewContainer.items.length?(n=t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]),t.$.animationPanel.style.transformOrigin=n.offsetHeight?n.offsetLeft+n.offsetWidth/2+"px "+(0<n.dataItem.top?n.offsetTop-n.offsetHeight/2:n.offsetTop+n.offsetHeight/2)+"px":t.$.listViewContainer.offsetLeft+t.$.listViewContainer.offsetWidth/2+"px "+(0<n.dataItem.top?n.offsetTop-n.offsetHeight/2:t.$.listViewContainer.offsetTop+t.$.listViewContainer.offsetHeight/2)+"px"):(!t._focusedCell&&t._focusCell(),n=t._focusedCell,t.$.animationPanel.style.transformOrigin=n.offsetLeft+n.offsetWidth/2+"px "+(n.offsetTop+n.offsetHeight/2)+"px"),t.$monthsContainer.addClass("smart-hidden"),t.$dateViewContainer.hasClass("smart-hidden")&&t.$dateViewContainer.removeClass("smart-hidden"),"decade"===t.displayMode&&(t.$yearContainer.addClass("smart-calendar-selected"),t.$dateContainer.removeClass("smart-calendar-selected")),t.hasAnimation?void t._animateView(-1,n):void t._setDisplayModeContent(t._focusedCell?t._focusedCell.value:t._viewDates[0])}_keyUpHandler(e){const t=this;t.disabled||t.readonly||("default"===t.selectionMode||"range"===t.selectionMode)&&("Shift"===e.key||"Control"===e.key)&&(t._keysPressed[e.key]=!1)}_mouseEventsHandler(e){const t=this;if(t.disabled||t.readonly)return;if("mouseenter"===e.type)return void t.$.setAttributeValue("hover",!0);if("mouseleave"===e.type)return t.$.setAttributeValue("hover",!1),void(t.tooltip&&t.$.tooltip.close());const a=t.shadowRoot||t.isInShadowDOM?e.composedPath()[0]:e.target;if(!a.closest(".smart-calendar-week"))return void(t.tooltip&&t.$.tooltip.close());let n,l=a;for(;l&&!(l.value instanceof Date);)l=l.parentElement,n=!0;if(l&&(Smart.Utilities.Core.isMobile||t._handleCalendarCellHover(e,l),t.tooltip)){if(l.hasAttribute("important")&&"mouseover"===e.type)return t.$.tooltip.open(),t.tooltipTemplate?t.$.tooltip.value=l.value+"":t.$.tooltip.innerHTML=0===t.$.tooltip.innerHTML.trim().length?"Important day!":t.$.tooltip.innerHTML,t.$.tooltip.selector=l,void(t.$.tooltip.selector!==l&&t.$.tooltip.close());if(n||t.$.tooltip.selector===l)return;t.$.tooltip.close()}}_moveHandler(e){var t=Math.round;const a=this;if(!Smart.Utilities.Core.isMobile||!a._dragStartDetails||"list"===a.displayModeView&&"month"!==a.displayMode)return;e.originalEvent.preventDefault(),e.preventDefault(),e.stopPropagation();const n={x:t(e.pageX),y:t(e.pageY)};let l="portrait"===a.scrollButtonsNavigationMode?n.y>a._dragStartDetails.y?-1*a.months:1*a.months:n.x<a._dragStartDetails.x?1*a.months:-1*a.months;let s;if(a._previousIteration&&l===a._previousIteration.step)s=a._previousIteration.date;else if(6!==a.weeks&&0!==a.weeks&&"month"===a.displayMode){let e;a._focusedCell||a._focusCell();let t;const n=[].slice.call(a._focusedCell.closest(".smart-calendar-weeks").children).filter(e=>!e.classList.contains("smart-hidden"));if(!n.length)s=a._getNextDate(l*(a.rightToLeft?-1:1));else{let i;!a.rightToLeft&&0>l||a.rightToLeft&&0<l?(i=n[0].querySelectorAll(".smart-calendar-cell"),t=a.rightToLeft?i[i.length-1]:i[0]):(i=n[n.length-1].querySelectorAll(".smart-calendar-cell"),t=a.rightToLeft?i[0]:i[i.length-1]),e=new Date(t.value),e.setDate(e.getDate()+l*(a.rightToLeft?-1:1)),s=e}}else s=a._getNextDate(l*(a.rightToLeft?-1:1));if(!s)return;if(a._dragStartDetails.step=l,a._dragStartDetails.navigationDate=new Date(s),!a.hasAnimation)return;a._previousIteration={step:l,date:s},a._mobileScrolling=!0;let i;if("month"!==a.displayMode)a.$nextMonthsContainer.addClass("smart-calendar-date-view-container"),i=a.$.dateViewContainer,a.$.nextMonthsContainer.children[0].value instanceof Date&&a.$.nextMonthsContainer.children[1].value.getFullYear()===s.getFullYear()||a._setDisplayModeContent(s,a.$.nextMonthsContainer);else if(a.$nextMonthsContainer.hasClass("smart-calendar-date-view-container")&&a.$nextMonthsContainer.removeClass("smart-calendar-date-view-container"),i=a.$.monthsContainer,!a.$.nextMonthsContainer.children[0]._date||a.$.nextMonthsContainer.children[0]._date.getTime()!==s.getTime()){let e=a.$.nextMonthsContainer.children;for(let t=0;t<e.length;t++)s.setMonth(a._dragStartDetails.navigationDate.getMonth()+t*(a.rightToLeft?-1:1)),a._setMonth(new Date(s),e[t],!0)}6!==a.weeks&&0!==a.weeks&&"month"===a.displayMode&&a._updateWeeksVisibility(l*(a.rightToLeft?-1:1),a._getCellByDate(s,a.$.nextMonthsContainer)),delete a._mobileScrolling,0>l?(i.style.order=3,a.$.nextMonthsContainer.style.order=1,a.$.body[a._animationSettings.scrollSize]=a.$.body[a._animationSettings.scrollMax]):(i.style.order=1,a.$.nextMonthsContainer.style.order=3,a.$.body[a._animationSettings.scrollSize]=0);const o="portrait"===a.scrollButtonsNavigationMode?"y":"x";5<Math.abs(a._dragStartDetails[o]-n[o])&&(a.$.body[a._animationSettings.scrollSize]+=2*-(n[o]-a._dragStartDetails[o]))}_getNextDate(e){const t=this;let a;if("month"!==t.displayMode){let n;const l=t._focusedCell&&t._focusedCell.value.getFullYear();if("list"===t.displayModeView)a=new Date(t.$.listViewContainer.items[0].value);else{let e=t._animationStarted?t.$.nextMonthsContainer:t.$.dateViewContainer;a=new Date("year"===t.displayMode?e.children[0].value:e.children[1].value)}if(n="year"===t.displayMode?1:0===e?1:10,a.setFullYear(a.getFullYear()+(0<e?n:-n)),a.getTime()<t.min.getTime()&&(a=t.min),a.getTime()>t.max.getTime()&&(a=t.max),"year"===t.displayMode){if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear()||l===a.getFullYear())return;}else if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear()||l===a.getFullYear())return}else{let n=t._viewDates[0];if(a=new Date(n),a.setDate(1),a.setMonth(a.getMonth()+e),a.setTime(Math.min(Math.max(a.getTime(),t.min.getTime()),t.max.getTime())),n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear())return}return a}_navigateDays(e){const t=this;let a="ArrowUp"===e.key||"ArrowDown"===e.key?7:1,n="ArrowUp"===e.key||"ArrowLeft"===e.key||"PageUp"===e.key?-1:1;switch(e.key){case"ArrowUp":case"ArrowLeft":case"ArrowDown":case"ArrowRight":if(!t._handleArrowKeys(e,a,n))return;break;case" ":case"Enter":if("month"!==t.displayMode)return void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedCell);break;case"Control":case"Shift":return"default"===t.selectionMode&&(t._keysPressed[e.key]=!0),void("range"===t.selectionMode&&(t._keysPressed[e.key]="Control"===e.key));case"Home":case"End":{e.preventDefault();let a,n=function(t){if("Home"===e.key){for(let e=0;e<t.length;e++)if(!t[e].otherMonth&&(!t[e].disabled||!t[e].restricted)&&t[e].offsetHeight)return t[e];}else for(let e=t.length-1;0<=e;e--)if(!t[e].otherMonth&&(!t[e].disabled||!t[e].restricted)&&t[e].offsetHeight)return t[e]};if(a="month"===t.displayMode?n(t._getMonthCells(t._focusedCell.closest(".smart-calendar-month"),t.rightToLeft)):n(t.$.dateViewContainer.children),!a)return;if(t._focusCell(a),"month"!==t.displayMode)return;break}case"PageUp":case"PageDown":{if(!t._handlePageUpDownKeys(e,n))return;break}default:return;}t._focusedCell&&t._handleDateSelection(t._focusedCell)}_handleArrowKeys(e,t,a){const n=this;let l;if("month"!==n.displayMode||n._animationStarted||n.$.body.focus(),n._focusedCell||n._focusCell(n._getCellByDate(new Date)),!e.altKey){if(e.ctrlKey){if("ArrowDown"===e.key||"ArrowUp"===e.key){if("classic"===n.calendarMode)return;let t;switch(n.displayMode){case"month":t="ArrowDown"===e.key?"month":"year";break;case"year":t="ArrowDown"===e.key?"month":"decade";break;case"decade":t="ArrowDown"===e.key?"year":"decade";}if(t!==n.displayMode){const e=n.displayMode;n.displayMode=t,n._setDisplayMode(e,t,"month"===e),n._keysPressed&&delete n._keysPressed.Control}}return}if(e.preventDefault(),n.rightToLeft&&("ArrowLeft"===e.key||"ArrowRight"===e.key)&&(a*=-1),"month"!==n.displayMode){let i=n._animationStarted?n.$.nextMonthsContainer.children:n.$.dateViewContainer.children;if(t="ArrowUp"===e.key||"ArrowDown"===e.key?4:1,"year"===n.displayMode){const e=n._focusedCell.value.getMonth()+a*t;let i=new Date(n._focusedCell.value.getFullYear(),e+1,0);n._focusedCell.value.getDate()<=i.getDate()&&(i=n._focusedCell.value),l=new Date(n._focusedCell.value.getFullYear(),e,i.getDate())}else l=new Date(n._focusedCell.value.getFullYear()+a*t,n._focusedCell.value.getMonth(),n._focusedCell.value.getDate());if("year"===n.displayMode){if(l.getFullYear()<n.min.getFullYear()||l.getFullYear()===n.min.getFullYear()&&l.getMonth()<n.min.getMonth()||l.getFullYear()>n.max.getFullYear()||l.getFullYear()===n.max.getFullYear()&&l.getMonth()>n.max.getMonth())return;l.getTime()>i[i.length-1].value.getTime()?n.navigate(1):l.getTime()<i[0].value.getTime()&&n.navigate(-1)}else{if(l.getFullYear()<n.min.getFullYear()||l.getFullYear()>n.max.getFullYear())return;if(l.getFullYear()<i[1].value.getFullYear()||l.getFullYear()>i[10].value.getFullYear()){let t=n._focusedCell;n.navigate(a),("ArrowUp"===e.key||"ArrowDown"===e.key)&&(t===i[3]||t===i[4]||t===i[7]||t===i[8]?l.setFullYear(l.getFullYear()+2*a):l.setFullYear(l.getFullYear()-2*a))}}return void n._focusCell(n._getCellByDate(l,n._animationStarted?n.$.nextMonthsContainer:void 0))}const i=n.restrictedDates.map(Number);for(l=new Date(n._focusedCell.value.getFullYear(),n._focusedCell.value.getMonth(),n._focusedCell.value.getDate()+a*t,0,0,0,0);-1<i.indexOf(l.getTime());)l.setDate(l.getDate()+a);if(!(l.getTime()<n.min.getTime()||l.getTime()>n.max.getTime())){n._isDateInView(l)||n.navigate(a*n.months);let e=n._getCellByDate(l,n._animationStarted?n.$.nextMonthsContainer:void 0);return n._focusCell(e),n._updateWeeksVisibility(a),!(-1<["zeroOrMany","oneOrMany","none","many","week","range"].indexOf(n.selectionMode))||void 0}}}_handlePageUpDownKeys(e,t){const a=this;e.preventDefault();let n;if("month"!==a.displayMode){if(n=a._focusedCell,!a.navigate(t))return;for(;n&&n.classList.contains("smart-visibility-hidden");)n=null===n.previousElementSibling?n.nextElementSibling:n.previousElementSibling;return a._focusCell(n),void(a.hasAnimation&&"decade"===a.displayMode&&a._focusedCell.value.setFullYear(a._focusedCell.value.getFullYear()+10*t))}n=new Date(a._focusedCell.value.getFullYear(),a._focusedCell.value.getMonth()+t,1,0,0,0,0);let l=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();return a._focusedCell.value.getDate()>l?n.setDate(l):n.setDate(a._focusedCell.value.getDate()),a._isDateInView(n)||a.navigate(n),a._animationStarted?a._focusCell(a._getCellByDate(n,a.$.nextMonthsContainer)):a._focusCell(a._getCellByDate(n)),!0}_selectDate(e,t,a){const n=this;if("undefined"==typeof n._viewDates||"none"===n.selectionMode)return;let l=n.selectedDates.slice(0),i=n._getCellByDate(e,n._animationStarted?n.$.nextMonthsContainer:void 0);i&&n._selectCell(i);let s;e=new Date(e),e.setHours(0,0,0,0),s=l.map(Number).indexOf(e.getTime());-1<n.restrictedDates.map(Number).indexOf(e.getTime())||e.getTime()<n.min.getTime()||e.getTime()>n.max.getTime()||(-1<s?l.splice(s,1):l.push(e),!a&&(n.selectedDates=l),n._refreshFooter(),n.$.hiddenInput.value=n.selectedDates.toString(),!t&&n.$.fireEvent("change",{value:[e]}),n._refreshTitle())}_selectCell(e){const t=this;if(!(!e||-1<t.restrictedDates.map(Number).indexOf(e.value.getTime())||t.disableAutoNavigation&&!1===e.otherMonth||e.value.getTime()<t.min.getTime()||e.value.getTime()>t.max.getTime())){const a=t._selectedCells.indexOf(e);-1<a?(t._setCellState(e,"selected",!1),t._selectedCells.splice(a,1)):(t._setCellState(e,"selected",!0),t._selectedCells.push(e)),t._focusCell(e)}}_refreshDayOfWeekTitles(){function e(e){let a;return"firstTwoLetters"===t.dayNameFormat?(a=new Intl.DateTimeFormat(t.locale,{weekday:"long"}).format(e),a=8206===a.charCodeAt(0)?a.substring(1,3):a.substring(0,2)):a=new Intl.DateTimeFormat(t.locale,{weekday:t.dayNameFormat}).format(e),a}const t=this;let a,n=[],l=new Date;for(let t=1;8>t;t++)l.setDate(t),a={number:l.getDay(),name:e(l)},n.push(a);n.sort((e,t)=>e.number>t.number?1:-1);const i=t.$.monthsContainer.children;let s,o;for(let e=0;e<i.length;e++)if(s=i[e].getElementsByClassName("smart-calendar-week-titles")[0].children,o=6<t.firstDayOfWeek?0:t.firstDayOfWeek,t.rightToLeft)for(let e=s.length-1;1<=e;e--)s[e].textContent=n[o++].name,o=6<o?0:o;else for(let e=1;e<s.length;e++)s[e].textContent=n[o++].name,o=6<o?0:o;if(t.hasAnimation){const e=t.$.monthsContainer.getElementsByClassName("smart-calendar-week-titles")[0].innerHTML,a=t.$.nextMonthsContainer.getElementsByClassName("smart-calendar-week-titles");for(let t=0;t<a.length;t++)a[t].innerHTML=e}}_refreshCalendarMode(){const e=this;if(!e.headerTemplate)if(e._refreshMonthNames(),"default"===e.calendarMode){e.$classicHeaderDate.addClass("smart-hidden"),e.$defaultHeaderDate.removeClass("smart-hidden");const t=e._viewDates.slice(0).sort((e,t)=>e.getTime()-t.getTime()),a=t[0],n=t[t.length-1];a.setDate(2);let l=a.toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat});1<e.months&&(n.setDate(2),l+=" - "+n.toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat})),e.$.defaultHeaderDate.innerHTML=l,e.unfocusable||e.$.dateElement.setAttribute("tabindex",0<e.tabIndex?e.tabIndex:0)}else e.$defaultHeaderDate.addClass("smart-hidden"),e.$classicHeaderDate.removeClass("smart-hidden"),e.$.dateElement.removeAttribute("tabindex")}_refreshFooter(){function e(){if(0===t.selectedDates.length)return"";if(1===t.selectedDates.length)return t.selectedDates[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"});else{let e=t.selectedDates.slice(0).sort((e,t)=>e.getTime()-t.getTime());return e[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})+" - "+e[e.length-1].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})}}const t=this;if(!(0>t.viewSections.indexOf("footer")||0===t.$.footer.offsetHeight)){if(t.footerTemplate){if("function"==typeof t.footerTemplate)return;let a=t._layoutTemplates.filter(e=>e.selector===t.$.footer)[0],n=document.importNode(a.template.content,!0);if(0<a.bindings.length){let t=n.childNodes[a.bindings[0].childNodeIndex];a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=t.innerHTML.replace(a.bindings[0].bindingString,e())}return}t.$.selectedDatesRange.innerHTML=e()}}_refreshImportantDates(){const e=this;if("month"===e.displayMode){e._clearImportantDates();for(let t=0;t<e.importantDates.length;t++)e._setImportantDate(e.importantDates[t])}}_clearImportantDates(){const e=this,t=e.$.monthsContainer.children;for(let a=0;a<t.length;a++)e._getMonthCells(t[a]).map(t=>{e._setCellState(t,"important",!1)})}_setImportantDate(e,t){const a=this,n=a._getCellByDate(e);t||(t=n),t&&(a._setCellState(t,"important",!0),a._applyImportantDateTemplate(t))}_applyImportantDateTemplate(e){const t=this;if(!t._importantDatesTemplate)return"function"==typeof t.importantDatesTemplate?void t.importantDatesTemplate(e,{value:e.value}):void(e.innerHTML=e.value.getDate()+"");let a=document.importNode(t._importantDatesTemplate.content,!0);if(t._bindingDetails&&0<t._bindingDetails.length){let n=a.childNodes[t._bindingDetails[0].childNodeIndex];n.innerHTML=n.innerHTML.replace(t._bindingDetails[0].bindingString,e.value.getDate())}e.innerHTML="";for(let t=0;t<a.childNodes.length;t++)a.childNodes[t].outerHTML&&(e.innerHTML+=a.childNodes[t].outerHTML)}_setMonth(e,t,a){const n=this,l=n._getDays(e,n.selectedDates),i=n._getDays(e,n.importantDates),s=n._getDays(e,n.restrictedDates);e.setDate(1),t||(t=n.$.month),t._date=new Date(e),a||((!n._viewDates||n._viewDates.length>=n.months)&&(n._viewDates=[]),n._viewDates.push(new Date(e))),e=new Date(e);let o=(e.getDay()-n.firstDayOfWeek+7)%7;e.setDate(0);let r=e.getDate();if(e.setDate(32),e.setDate(1),e.setDate(32),n._selectedCells)for(let e=0;e<n._selectedCells.length;e++)n._selectedCells[e].closest(".smart-calendar-month")===t&&n._setCellState(n._selectedCells[e],"selected",!1);n._setMonthContent(e,t,{previusMonthDays:r,firstDayOfWeek:o,selectedDates:l,importantDates:i,restrictedDates:s})}_setMonthContent(e,t,a){const n=this,l=32-e.getDate(),i=n._getMonthCells(t,n.rightToLeft),s=t._date.getMonth(),o=t._date.getFullYear(),r=new Date;let m,h=1,c=1;r.setHours(0,0,0,0),i.map(e=>{n._setCellState(e,"restricted",!1),n._setCellState(e,"selected",!1),n._setCellState(e,"otherMonth",!1),n._setCellState(e,"focus",!1),n._setCellState(e,"important",!1),n._setCellState(e,"today",!1),n._setCellState(e,"disabled",!1),n._setCellState(e,"hover",!1)});for(let g=0;g<i.length;g++){const e=i[g];g===a.firstDayOfWeek&&c<=l?(e.className="smart-calendar-cell",e.value=new Date(o,s,c),e.innerHTML=e.value.getDate().toString(),-1<a.restrictedDates.indexOf(c)||e.value.getTime()<n.min.getTime()||e.value.getTime()>n.max.getTime()?n._setCellState(e,"restricted",!0):-1<a.selectedDates.indexOf(c)&&(n._setCellState(e,"selected",!0),0>n._selectedCells.indexOf(e)&&n._selectedCells.push(e)),-1<a.importantDates.indexOf(c)&&(n._setImportantDate(e.value,e),a.importantDates.splice(a.importantDates.indexOf(c),1)),e.value.getTime()===r.getTime()&&n._setCellState(e,"today",!0),a.firstDayOfWeek++,c++):(1==c?(e.value=new Date(o,s-1,++a.previusMonthDays-a.firstDayOfWeek),m=!!(e.value.getTime()<n.min.getTime()||t.previousElementSibling)):(e.value=new Date(o,s+1,h++),m=!!(e.value.getTime()>n.max.getTime()||t.nextElementSibling)),e.innerHTML=e.value.getDate().toString(),m?e.classList.add("smart-visibility-hidden"):(n._setCellState(e,"otherMonth",!0),e.classList.remove("smart-visibility-hidden")))}1<n.months&&(t.firstElementChild.innerHTML=n.dateFormatFunction?n.dateFormatFunction(t._date):n._monthsNames[s]+" "+t._date.toLocaleDateString(n.locale,{year:n.yearFormat})),n._setMonthWeekNumbers(t)}_refreshMonthNames(){function e(e){let a=new Intl.DateTimeFormat(t.locale,{month:t.monthNameFormat}).format(e);return"firstTwoLetters"===t.monthNameFormat&&(a=8206===a.charCodeAt(0)?a.substring(0,2):a.substring(1,3)),a}const t=this;let a,n=new Date;n.setDate(1),t._monthsNames=[];for(let l=0;12>l;l++)n.setMonth(l),a=e(n),t._monthsNames.push(a);if("classic"===t.calendarMode&&t.$.monthElement){let e=t.$.monthsContainer.children;if(t.$.monthElement.dataSource&&(t._changeEventFired=1),t.shadowRoot?t._setMonthElementPropertyInShadowDOM("dataSource",t._monthsNames):t.$.monthElement.dataSource=t._monthsNames,t._viewDates){for(let a=0;a<e.length;a++)e[a].firstElementChild.textContent=t._monthsNames[e[a]._date.getMonth()]+" "+e[a]._date.getFullYear();t._changeEventFired=1,t.shadowRoot?t._setMonthElementPropertyInShadowDOM("selectedIndexes",t._viewDates.map(e=>e.getMonth())):t.$.monthElement.selectedIndexes=t._viewDates.map(e=>e.getMonth())}}}_setMonthWeekNumbers(e){const t=this,a=function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!0};let n=e.getElementsByClassName("smart-calendar-week");n=[].slice.call(n);for(let l=0;l<n.length;l++){if(!a(n[l])){n[l].children[0].innerHTML="";continue}const i=n[l].children[1],s=i.otherMonth?i.value.getTime()>e._date.getTime()?1:-1:0;n[l].children[0].innerHTML=t._getWeekNumber(new Date(e._date.getFullYear(),e._date.getMonth()+s,i.value.getDate()))}}_setRestrictedDates(e){const t=this,a=t.$.monthsContainer.children;for(let n=0;n<a.length;n++)t._getMonthCells(a[n]).map(e=>{t._setCellState(e,"restricted",!1)});if(t._viewDates){const a=function(e){for(let a=0;a<t._viewDates.length;a++)if(t._viewDates[a].getFullYear()===e.getFullYear()&&t._viewDates[a].getMonth()===e.getMonth())return!0};for(let n=0;n<e.length;n++)if(a(e[n])){const a=t._getCellByDate(e[n]);t._setCellState(a,"restricted",!0)}}}_setScrollButtonsNavigationMode(){const e=this;"landscape"===e.scrollButtonsNavigationMode?(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.className="smart-arrow-left smart-arrow"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.className="smart-arrow-right smart-arrow")):(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.className="smart-arrow-down smart-arrow"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.className="smart-arrow-up smart-arrow")),e._applyAnimationSettings(!0)}_refreshTitle(){const e=this;let t=0<e.selectedDates.length?e.selectedDates[e.selectedDates.length-1]:new Date;if(e.titleTemplate){if("function"==typeof e.titleTemplate)return;let a=e._layoutTemplates.filter(t=>t.selector===e.$.title)[0],n=document.importNode(a.template.content,!0);if(0<a.bindings.length){let l=n.childNodes[a.bindings[0].childNodeIndex];return t=t.toLocaleDateString(e.locale,{year:e.yearFormat,weekday:"short",month:"short",day:"numeric"}),void(a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=l.innerHTML.replace(a.bindings[0].bindingString,t))}}e.$.title.children[0].innerHTML=t.toLocaleDateString(e.locale,{year:e.yearFormat}),e.$.title.children[1].innerHTML="landscape"===e.view?t.toLocaleDateString(e.locale,{weekday:"short"})+",</br>"+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"}):t.toLocaleDateString(e.locale,{weekday:"short"})+", "+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"})}_setWeeksVisibility(e){function t(e){return function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0}(e)||l>=a.weeks?void e.classList.add("smart-hidden"):void(l<a.weeks&&(e.classList.remove("smart-hidden"),l++))}const a=this,n=e.children;let l;for(let i=0;i<n.length;i++){const e=n[i];let s=e.getElementsByClassName("smart-calendar-week");s=[].slice.call(s);let o=a._selectedCells.filter(e=>e.closest(".smart-calendar-month")===n[i]);if(6===a.weeks){s.map(e=>e.classList.remove("smart-hidden"));continue}if(l=0,0<o.length){let e=o[o.length-1],a=s.indexOf(e.parentElement);for(let e=a;e<s.length;e++)t(s[e]);for(let e=a-1;0<=e;e--)t(s[e])}else for(let e=0;e<s.length;e++)t(s[e])}}_refreshHeaderElements(){const e=this,t=document.activeElement.closest("smart-calendar")===e,a=e._animationStarted?e.$.nextMonthsContainer:e.$.dateViewContainer;let n,l,i=e._viewDates[e._viewDates.length-1],s=e._viewDates.map(e=>e.getFullYear());if("month"===e.displayMode||"list"!==e.displayModeView){if(e.$.previousMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?l="year"===e.displayMode?a.children[0].value.getFullYear()-1:a.children[1].value.getFullYear()-1:0>e._viewDates[0].getMonth()-1?(n=11,l=e._viewDates[0].getFullYear()-1):(n=e._viewDates[0].getMonth()-1,l=e._viewDates[0].getFullYear()),e.$.previousMonthButton.disabled=!!(l<e.min.getFullYear()||l===e.min.getFullYear()&&n<e.min.getMonth()),e.$.previousMonthButton.disabled&&t&&e.$.body.focus()),e.$.nextMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?l="year"===e.displayMode?a.children[0].value.getFullYear()+1:a.children[1].value.getFullYear()+11:11<i.getMonth()+1?(n=0,l=i.getFullYear()+1):(n=i.getMonth()+1,l=i.getFullYear()),e.$.nextMonthButton.disabled=!!(l>e.max.getFullYear()||l===e.max.getFullYear()&&n>e.max.getMonth()),e.$.nextMonthButton.disabled&&t&&e.$.body.focus()),"classic"===e.calendarMode&&e.$.monthElement){const t=e.$.monthElement.items;if(t.map(e=>e.disabled=!1),-1<s.indexOf(e.min.getFullYear()))for(let a=0;a<e.min.getMonth();a++)t[a].disabled=!0;if(-1<s.indexOf(e.max.getFullYear()))for(let a=e.max.getMonth()+1;a<t.length;a++)t[a].disabled=!0;e._changeEventFired=e.$.monthElement.selectedIndexes.length,e.shadowRoot?e._setMonthElementPropertyInShadowDOM("selectedIndexes",[e._viewDates[0].getMonth()]):e.$.monthElement.selectedIndexes=[e._viewDates[0].getMonth()],e._changeEventFired=0}e.$.previousYearButton&&!e.disabled&&(l=e._viewDates[0].getFullYear()-1,e.$.previousYearButton.disabled=!!(l<e.min.getFullYear()),e.$.previousYearButton.disabled&&t&&e.$.body.focus()),e.$.nextYearButton&&!e.disabled&&(l=i.getFullYear()+1,e.$.nextYearButton.disabled=!!(l>e.max.getFullYear()),e.$.nextYearButton.disabled&&t&&e.$.body.focus()),e.$.yearElement&&(e.$.yearElement.value=s[0],e.$.yearElement.disabled=!!(i.getFullYear()+1>e.max.getFullYear()&&e._viewDates[0].getFullYear()-1<e.min.getFullYear()))}}_setMonthElementPropertyInShadowDOM(e,t){const a=this,n=a.$.monthElement,l=a.$.monthElement.$?a.$.monthElement.$.listBox:void 0,i=n.context;let s;n.context=document,l&&(s=l.context,l.context=document),a.$.monthElement[e]=t,n.context=i,l&&(l.context=s)}_refreshHeaderTitle(){function e(){if("month"!==t.displayMode){if("list"===t.displayModeView&&t.$.listViewContainer.selectedValues[0]){let e=t.$.listViewContainer.items;a="year"===t.displayMode?new Date(t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]).value).getFullYear():new Date(e[0].value).getFullYear()+" - "+new Date(e[e.length-1].value).getFullYear()}else if(t.$.dateViewContainer.children[0].value){let e=t._animationStarted?t.$.nextMonthsContainer.children:t.$.dateViewContainer.children;a="year"===t.displayMode?e[0].value.getFullYear():e[1].value.getFullYear()+" - "+e[e.length-2].value.getFullYear()}if(a)return a}const e=t._viewDates.slice(0).sort((e,t)=>e.getTime()-t.getTime()),n=e[0],l=e[e.length-1];return n.setDate(2),a=n.toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat}),1<t.months&&(l.setDate(2),a+=" - "+l.toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat})),a}const t=this;let a;if("default"===t.calendarMode&&(t.$.defaultHeaderDate.innerHTML=e()),"function"!=typeof t.headerTemplate&&t._layoutTemplates){let a=t._layoutTemplates.filter(e=>e.selector===t.$.header)[0];if(a){let n=document.importNode(a.template.content,!0);if(0<a.bindings.length){const l=n.childNodes[a.bindings[0].childNodeIndex];(t.shadowRoot?t:a.selector).childNodes[a.bindings[0].childNodeIndex].innerHTML=l.innerHTML.replace(a.bindings[0].bindingString,t.dateFormatFunction?t.dateFormatFunction(t._viewDates):e())}}}}_updateWeeksVisibility(e,t){function a(){for(let e=o;e<s.length;e++)if(s[e].classList.contains("smart-hidden")&&!r(s[e])&&(s[e].classList.remove("smart-hidden"),d++,d===l.weeks))return!0}function n(){for(let e=o;0<=e;--e)if(s[e].classList.contains("smart-hidden")&&!r(s[e])&&(s[e].classList.remove("smart-hidden"),d++,d===l.weeks))return!0}const l=this;let i=(t||l._focusedCell).parentElement;if(!t&&!i.classList.contains("smart-hidden"))return;const s=[].slice.call(i.parentElement.children),o=s.indexOf(i),r=function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0};let d=0;if(s.map(e=>e.classList.add("smart-hidden")),0<e){if(a())return;n()}else{if(n())return;a()}}_getValidDates(e){function t(e){if(e instanceof Date)return e;if(Smart.Utilities.DateTime&&e instanceof Smart.Utilities.DateTime)return e.toDate();if("string"==typeof e){if("new Date()"===e.trim()||"new Smart.Utilities.DateTime()"===e.trim())return new Date;let t=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;const a=()=>{if(e=e.replace(/[,-.\/]/g,",").split(","),2<e.length)e=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]));else return new Date;return e};return t.test(e)?(e=t.exec(e)[0].replace(/[,-.\/]/g,",").split(","),e?new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2])):a()):a()}}let a=[];if(void 0===e)return null;if(Array.isArray(e))for(let n=0;n<e.length;n++)a.push(t(e[n]));else a.push(t(e));return a=a.filter(e=>e&&"Invalid Date"!==e.toDateString()),a.map(e=>e.setHours(0,0,0,0)),a}_getValidDate(e){const t=this,a=t._getValidDates(e);return 0<a.length?a[0]:null}_validateSelectedDates(e){const t=this;let a=[];e||(e=t.selectedDates);let n=e.slice(0),l=function(e){for(let a=0;a<t.restrictedDates.length;a++)if(t.restrictedDates[a].getTime()===e.getTime())return!0};t.selectedDates=n.filter(function(e){return!!(e.getTime()>=t.min.getTime()&&e.getTime()<=t.max.getTime()&&!l(e))||void a.push(e)}),t._viewDates&&(a.map(e=>t._selectDate(e)),t._focusCell())}_validateMinMax(e,t,a){const n=this;switch(e){case"min":t=n._getValidDate(n[e]),n.min=t?t:a?a:n.properties.min.defaultValue;break;case"max":t=n._getValidDate(n[e]),n.max=t?t:a?a:n.properties.max.defaultValue;break;default:t=n._getValidDate(n.min),n.min=t?t:a?a:n.properties.min.defaultValue,t=n._getValidDate(n.max),n.max=t?t:a?a:n.properties.max.defaultValue;}n.min=n.min.getTime()>n.max.getTime()?n.max:n.min,n.min.setHours(0,0,0,0),n.max.setHours(0,0,0,0);let l,s=n.$.monthsContainer.children;if(n._viewDates){if(n._viewDates[0].getTime()>n.max.getTime()||n._viewDates[0].getTime()<n.min.getTime())return void n._handleMonths();for(let e=0;e<s.length;e++){l=n._getMonthCells(s[e]);for(let t=0;t<l.length;t++){const a=l[t];if(a.value.getTime()>=n.min.getTime()&&a.value.getTime()<=n.max.getTime())n._setCellState(a,"restricted",!1),a.value.getMonth()===s[e]._date.getMonth()?a.classList.remove("smart-visibility-hidden"):!n.hideOtherMonthDays&&(n._setCellState(a,"otherMonth",!0),a.classList.remove("smart-visibility-hidden")),"month"!==n.displayMode&&n._setCellState(a,"otherMonth",!1);else{if(!a.otherMonth)n._setCellState(a,"restricted",!0);else if(a.classList.contains("smart-visibility-hidden")){n._setCellState(a,"restricted",!1);continue}"month"!==n.displayMode&&(a.classList.remove("smart-visibility-hidden"),n._setCellState(a,"otherMonth",!0))}}}}}_setCellState(e,t,a){e[t]=a;const n=Smart.Utilities.Core.toDash(t);a?(e.setAttribute(n,""),"selected"===t?e.setAttribute("aria-selected",!0):"today"===t?e.setAttribute("aria-current","date"):"restricted"===t?e.removeAttribute("aria-selected"):"disabled"==t&&(e.removeAttribute("aria-selected"),e.setAttribute("aria-disabled",!0))):(e.removeAttribute(n),"selected"===t?"none"===this.selectionMode||e.restricted||e.disabled?e.removeAttribute("aria-selected"):e.setAttribute("aria-selected",!1):"today"===t?e.removeAttribute("aria-current"):"restricted"!==t||e.disabled?"disabled"===t&&(e.removeAttribute("aria-disabled"),!e.restricted&&e.setAttribute("aria-selected",!1)):e.setAttribute("aria-selected",!1))}_validateTemplate(e,t){if(null!==t&&t&&"function"!=typeof t){const a=this;return"content"in document.createElement("template")?("string"==typeof t&&(t=document.getElementById(t)),null!==t&&"content"in t?t:void a.error(a.localize("invalidTemplate",{elementType:a.nodeName.toLowerCase(),property:e}))):void a.error(a.localize("htmlTemplateNotSuported",{elementType:a.nodeName.toLowerCase()}))}}_weeksDownHandler(e,t){const a=this,n=t.value;let l;return(t.otherMonth&&(l=t.value.getTime()>t.closest(".smart-calendar-month")._date.getTime()?1:-1),n&&a.hasRippleAnimation&&Smart.Utilities.Animation.Ripple.animate(t,e.pageX,e.pageY),l)?a._isDateInView(n)?void 0:void(a.disableAutoNavigation||a.navigate(l*a.months)):void(t=a._getCellByDate(n),t&&(t.disabled||t.restricted)||a._handleDateSelection(t))}_firstDayOfWeekValidator(e,t){return Math.min(Math.max(0,isNaN(t)?6:t),6)}_weeksValidator(e,t){return Math.min(Math.max(1,isNaN(t)?6:t),6)}_monthsValidator(e,t){return Math.min(Math.max(1,isNaN(t)?1:t),12)}});