
/* Smart HTML Elements v5.1.0 (2019-Dec) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart.Utilities.Assign("Grid.Menu",class{_openColumnChooserMenu(a){const b=this;if(a||(a=b._commandColumn),!a||b.menu&&b.menu.column===a&&a.element.hasAttribute("aria-controls"))return void b.closeMenu();b.menu||(b.menu=document.createElement("div"),b.menu.classList.add("smart-grid-column-menu"),b.menu.id=b.id+"_"+b.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),b.appearance.allowColumnMenuAnimation?b.menu.classList.add("smart-animate"):b.menu.classList.remove("smart-animate"),b._createColumnChooserMenuItems(a),b.menu.style.height=b.columnMenu.height?b.columnMenu.height+"px":"auto",b.menu.column&&b.menu.column!==a&&(b.menu.column.setProperty("menu",null),b.menu.column=null),document.body.appendChild(b.menu),a.setProperty("menu",b.menu);const c=a.element.getBoundingClientRect();b.menu.column=a;let d=c.right-a.element.actionButton.getBoundingClientRect().width+window.pageXOffset,e=c.bottom+window.pageYOffset;d+b.menu.offsetWidth>window.innerWidth&&(d=c.right+window.pageXOffset-b.menu.offsetWidth,d+b.menu.offsetWidth>window.innerWidth&&(d=window.innerWidth-b.menu.offsetWidth)),b.menu.style.left=d+"px",b.menu.style.top=e+"px",b.menu.classList.remove("smart-hidden"),b.menu.classList.add("open")}_openMenu(a){const b=this;if(!a||b.menu&&b.menu.column===a&&a.element.hasAttribute("aria-controls")||!1===b.columnMenu.enabled)return void b.closeMenu();b.menu||(b.menu=document.createElement("div"),b.menu.classList.add("smart-grid-column-menu"),b.menu.id=b.id+"_"+b.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),b.appearance.allowColumnMenuAnimation?b.menu.classList.add("smart-animate"):b.menu.classList.remove("smart-animate"),b._createMenuItems(a),b._createFilterPanel(a),b._filterMenuItemsVisibility(a),b.menu.style.height=b.columnMenu.height?b.columnMenu.height+"px":"auto",b.menu.column&&b.menu.column!==a&&(b.menu.column.setProperty("menu",null),b.menu.column=null),document.body.appendChild(b.menu),a.setProperty("menu",b.menu);const c=a.element.getBoundingClientRect();b.menu.column=a;let d=c.right-a.element.actionButton.getBoundingClientRect().width+window.pageXOffset,e=c.bottom+window.pageYOffset;d+b.menu.offsetWidth>window.innerWidth&&(d=c.right+window.pageXOffset-b.menu.offsetWidth,d+b.menu.offsetWidth>window.innerWidth&&(d=window.innerWidth-b.menu.offsetWidth)),b.menu.style.left=d+"px",b.menu.style.top=e+"px",b.hasColumnMenu(a)?b.menu.classList.remove("smart-hidden"):b.closeMenu(),b.menu.classList.add("open")}_menuItemClick(a){const b=this,c=a.detail,d=c.value;if(d&&d.properties){const a=d.properties.command;"function"==typeof a?a.apply(b,[d.column]):b[a]&&b[a].apply(b,[d.column]),d.column.autoCloseMenu&&b.closeMenu()}}removeGroupByCommand(a){const b=this;b.removeGroup(a.dataField)}groupByCommand(a){const b=this;b.dataSource&&b.addGroup(a.dataField)}sortAscCommand(a){const b=this;b.sortBy(a.dataField,"asc")}sortDescCommand(a){const b=this;b.sortBy(a.dataField,"desc")}removeSortCommand(a){const b=this;b.sortBy(a.dataField,null)}_removeMenu(){const a=this,b=a.menu.querySelector("smart-menu");b&&a.menu.removeChild(b)}_createColumnChooserMenuItems(){const a=this;a._removeMenu();const b=document.createElement("smart-menu"),c=document.createDocumentFragment();b.mode="vertical",b.dropDownAppendTo="body",b.checkboxes=!0,b.checkable=!0,b.classList.add("smart-grid-column-chooser-menu");for(let b=0;b<a.columns.length;b++){const d=a.columns[b],e=document.createElement("smart-menu-item"),f=d.showIcon?d.icon:d.visible?"smart-icon-eye":"smart-icon-eye-off";(e.checked=d.visible,!!d.allowHide)&&(d.command=function(a){a.visible=!a.visible},e.label=a.localize(d.label)||d.label||d.dataField,e.value={column:d,properties:d},f&&(e.label="<span class=\"smart-grid-icon "+f+"\"></span>"+e.label),c.appendChild(e))}b.appendChild(c),a.menu.appendChild(b),a.menu.itemCheckChange=a._menuItemClick.bind(a),a.menu.addEventListener("itemCheckChange",a.menu.itemCheckChange),a.menu.addEventListener("keydown",a._keyDownHandler.bind(a))}_createMenuItems(a){const b=this;b._removeMenu();const c=document.createElement("smart-menu"),d=document.createDocumentFragment(),e=a.menuItems||b.columnMenu.dataSource;for(let f in c.mode="vertical",c.dropDownAppendTo="body",e){const c=e[f],g=document.createElement("smart-menu-item");let h=c.icon;g.label=b.localize(f),g.value={column:a,properties:c};const i=b=>{if(b){if("string"===a.dataType)return"A \u2192 Z";if("number"===a.dataType||"date"===a.dataType||"time"===a.dataType)return"1 \u2192 9";if("bool"===a.dataType||"boolean"===a.dataType)return"0 \u2192 1"}else{if("string"===a.dataType)return"Z \u2192 A";if("number"===a.dataType||"date"===a.dataType||"time"===a.dataType)return"9 \u2192 1";if("bool"===a.dataType||"boolean"===a.dataType)return"1 \u2192 0"}};"columnMenuItemSortAsc"==f?(g.label=b.localize(f,{mode:i(!0)}),"string"!==a.dataType&&c.iconAlt&&(h=c.iconAlt)):"columnMenuItemSortDesc"==f&&(g.label=b.localize(f,{mode:i(!1)}),"string"!==a.dataType&&c.iconAlt&&(h=c.iconAlt)),h&&(g.label="<span class=\"smart-grid-icon "+h+"\"></span>"+g.label),d.appendChild(g)}c.appendChild(d),b._filterContainer?b.menu.insertBefore(c,b._filterContainer):b.menu.appendChild(c),b.menu.itemClick=b._menuItemClick.bind(b),b.menu.addEventListener("itemClick",b.menu.itemClick),b.menu.addEventListener("keydown",b._keyDownHandler.bind(b))}_getFilterType(a){const b=a.dataType.endsWith("?")?a.dataType.substring(0,a.dataType.length-1):a.dataType;let c="string";return"number"===b||"int"===b||"float"===b||"int64"===b?c="numeric":"bool"===b||"boolean"===b?c="bool":"date"===b||"time"===b||"datetime"===b?c="date":"any"===b?c="any":void 0,c}_createFilterPanel(a){const b=this;if(Smart.FilterPanel)if(b.filtering.enabled&&b.filtering.filterMenu.visible&&a.allowFilter){const c=b._getFilterType(a);if(b._filterPanel&&b._filterPanel.parentNode.removeChild(b._filterPanel),b._filterPanel=b._filterPanels[c],b._filterPanel.dataField=a.dataField,!b._filterContainer){const a=document.createElement("div");a.classList.add("smart-filter-container"),b._filterContainer=a,requestAnimationFrame(function(){b.menu.appendChild(a)}),b._applyFilterHandler=function(){b.addFilter(b._filterPanel.dataField,b._filterPanel.getFilter());const a=b.columnByDataField[b._filterPanel.dataField];a._filterState=b._filterPanel.getState()},b._clearFilterHandler=function(){requestAnimationFrame(()=>{b.removeFilter(b._filterPanel.dataField);const a=b.columnByDataField[b._filterPanel.dataField];a._filterState=null})}}if(b._filterContainer.appendChild(b._filterPanel),b._filterPanel.classList.remove("smart-hidden"),b._filterPanel.removeEventListener("filter",b._applyFilterHandler),b._filterPanel.removeEventListener("clear",b._clearFilterHandler),b._filterPanel.addEventListener("filter",b._applyFilterHandler),b._filterPanel.addEventListener("clear",b._clearFilterHandler),"none"!==a.filterMenuMode&&b.filtering.filterMenu.visible&&Smart.FilterPanel?b._filterContainer.classList.remove("smart-hidden"):b._filterContainer.classList.add("smart-hidden"),b._filterPanel.reset(),a._filterState)b._filterPanel.loadState(a._filterState);else if(a.filter){const c=a.filter,d=b._getFilterType(a);let e=c.getFilters();for(;0<e.length&&"FilterGroup"===e[0].type;)e=e[0].value;const f=c.getConditions(d),g=0<e.length?f.indexOf(e[0].condition):-1,h=1<e.length?f.indexOf(e[1].condition):-1,i=0<e.length?e[0].value:"",j=1<e.length?e[1].value:"",k=1<e.length?["and","or"].indexOf(e[1].logicalOperator):0;a._filterState={firstFilterComparison:g,firstFilterValue:i,logicalOperator:k,secondFilterComparison:h,secondFilterValue:j},b._filterPanel.loadState(a._filterState)}}else b._filterPanel&&(b._filterPanel.parentNode.removeChild(b._filterPanel),a._filterState=null)}hasColumnMenu(a){const b=this;if(!1===b.columnMenu.enabled)return!1;const c=a.menuItems||b.columnMenu.dataSource;let d=0,e=0;for(let f in c){const g=c[f];e++,!1===g.visible?d++:"auto"===g.visible&&(("columnMenuItemFilter"==f||"columnMenuItemRemoveFilter"==f)&&(b.filtering.filterMenu.visible||b.filtering.filterBuilder.visible)&&d++,("columnMenuItemGroupBy"==f||"columnMenuItemRemoveGroupBy"==f)&&(!a.allowGroup||!b.grouping.enabled)&&d++,"columnMenuItemFilter"==f&&!a.allowFilter&&d++,"columnMenuItemRemoveFilter"==f&&!a.allowFilter&&d++,"columnMenuItemGroupBy"==f&&!a.allowGroup&&d++,("columnMenuItemSortAsc"==f||"columnMenuItemSortDesc"==f||"columnMenuItemRemoveSort"==f)&&(!a.allowSort||!b.sorting.enabled)&&d++)}const f=b.filtering.enabled&&b.filtering.filterMenu.visible&&"none"!==a.filterMenuMode;return!!(f&&Smart.FilterPanel||Smart.Menu&&!(d>=e))}_filterMenuItemsVisibility(a){const b=this,c=(b.menu.parentElement&&(b.enableShadowDOM||b.isInShadowDOM)?b.menu.firstElementChild.shadowRoot:b.menu).querySelectorAll("smart-menu-item"),d=a.menuItems||b.columnMenu.dataSource;let e=0;for(let f in d){const g=c[e++],h=d[f];if(g.disabled=!h.enabled,g.classList.remove("smart-hidden"),"columnMenuItemRemoveSort"==f&&(a.sortOrder?g.disabled=!1:g.disabled=!0),"columnMenuItemSortAsc"==f&&"asc"===a.sortOrder?g.disabled=!0:"columnMenuItemSortDesc"==f&&"desc"===a.sortOrder&&(g.disabled=!0),!0===h.visible)g.classList.remove("smart-hidden");else if(!1===h.visible)g.classList.add("smart-hidden");else if("auto"===h.visible){if(("columnMenuItemFilter"==f||"columnMenuItemRemoveFilter"==f)&&(!1===b.filtering.enabled?g.classList.add("smart-hidden"):b.filtering.filterMenu.visible||b.filtering.filterBuilder.visible?g.classList.add("smart-hidden"):b.filtering.filterBuilder.visible&&g.classList.remove("smart-hidden")),"columnMenuItemGroupBy"==f){b.grouping.enabled&&a.allowGroup?g.classList.remove("smart-hidden"):g.classList.add("smart-hidden");const c=b.dataSource.groupBy.indexOf(a.dataField);g.disabled=!!(0<=c)}if("columnMenuItemRemoveGroupBy"==f){b.grouping.enabled&&a.allowGroup?g.classList.remove("smart-hidden"):g.classList.add("smart-hidden");const c=b.dataSource.groupBy.indexOf(a.dataField);g.disabled=!!(0>c)}"columnMenuItemFilter"!=f||a.allowFilter||g.classList.add("smart-hidden"),"columnMenuItemRemoveFilter"!=f||a.allowFilter||g.classList.add("smart-hidden"),("columnMenuItemSortAsc"==f||"columnMenuItemSortDesc"==f||"columnMenuItemRemoveSort"==f)&&(a.allowSort&&b.sorting.enabled?g.classList.remove("smart-hidden"):g.classList.add("smart-hidden"))}}}openMenu(a){const b=this,c=b.columnByDataField[a];c&&b._openMenu(c)}hasMenu(){const a=this;return!!(a.menu&&a.menu.column&&a.menu.parentNode)}closeMenu(){const a=this;a.menu&&a.menu.column&&(a.menu.column&&(a.menu.column.setProperty("menu",null),a.menu.column=null),a.menu.parentNode&&(a.menu.classList.remove("open"),!a.appearance.allowColumnMenuAnimation&&a.menu.parentNode.removeChild(a.menu)),a.menu.removeEventListener("keydown",a._keyDownHandler.bind(a)),a.menu.removeEventListener("itemClick",a.menu.itemClick),a.menu.removeEventListener("itemCheckChange",a.menu.itemCheckChange),a.focus())}});