
/* Smart HTML Elements v4.0.0 (2019-Aug) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-tree-item",class extends Smart.MenuItem{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready()}propertyChangedHandler(e,t,l){const r=this,o=r.menu;if("level"===e)return void(r.level=t);if("disabled"!==e&&"separator"!==e&&o){const n=o.context;switch(o.context=o,e){case"label":{const e=o.sorted&&o.autoSort;r.firstElementChild.firstElementChild.firstElementChild.innerHTML=l,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":r.selected=t,l?o.select(r):o.unselect(r);break;case"shortcut":{let e=r.firstElementChild.children[1];e||(e=document.createElement("div"),e.className="smart-tree-item-shortcut",r.firstElementChild.appendChild(e)),e.innerHTML=l;break}case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=n}}}),Smart("smart-tree-items-group",class extends Smart.MenuItemsGroup{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready()}propertyChangedHandler(e,t,l){const r=this,o=r.menu;if("level"===e)return void(r.level=t);if("disabled"!==e&&"separator"!==e&&o){const n=o.context;switch(o.context=o,e){case"expanded":{r.expanded=t,l?o.expandItem(r):o.collapseItem(r);break}case"label":{const e=o.sorted&&o.autoSort;r.firstElementChild.firstElementChild.firstElementChild.innerHTML=l,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":r.selected=t,l?o.select(r):o.unselect(r);break;case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=n}}}),Smart("smart-tree",class extends Smart.Menu{static get properties(){return{allowDrag:{value:!1,type:"boolean"},allowDrop:{value:!1,type:"boolean"},autoHideToggleElement:{value:!1,type:"boolean"},autoLoadState:{value:!1,type:"boolean"},autoSaveState:{value:!1,type:"boolean"},autoSort:{value:!0,type:"boolean"},displayLoadingIndicator:{value:!1,type:"boolean"},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},editable:{value:!1,type:"boolean"},filterable:{value:!1,type:"boolean"},filterInputPlaceholder:{value:"",type:"string"},filterMode:{value:"containsIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},hasThreeStates:{value:!1,type:"boolean"},loadingIndicatorPlaceholder:{value:"Loading...",type:"string"},loadingIndicatorPosition:{value:"center",allowedValues:["bottom","center","top"],type:"string"},messages:{value:{en:{noId:"smart-tree: Saving and loading the element's state are not available if the element has no id."}},type:"object",extend:!0},scrollMode:{value:"scrollbar",allowedValues:["scrollbar","scrollButtons"],type:"string"},selectedIndexes:{value:[],type:"array"},selectionDisplayMode:{value:"row",allowedValues:["row","label"],type:"string"},selectionMode:{value:"one",allowedValues:["none","oneOrManyExtended","zeroOrMany","oneOrMany","zeroOrOne","one","checkBox","radioButton"],type:"string"},showLines:{value:!1,type:"boolean"},showRootLines:{value:!1,type:"boolean"},sort:{value:null,type:"function?"},sortDirection:{value:"asc",allowedValues:["asc","desc"],type:"string"},sorted:{value:!1,type:"boolean"},toggleElementPosition:{value:"near",allowedValues:["near","far"],type:"string"},toggleMode:{value:"dblclick",allowedValues:["click","dblclick","arrow"],type:"string"}}}static get listeners(){return{blur:"_blurHandler",focus:"_focusHandler",keydown:"_keydownHandler",mouseenter:"_mouseenterHandler",mouseleave:"_mouseleaveHandler",resize:"_checkOverflow",styleChanged:"_styleChangedHandler",transitionend:"_overriddenMenuHandler","container.click":"_overriddenMenuHandler","container.mouseout":"_overriddenMenuHandler","container.mouseover":"_overriddenMenuHandler","editInput.blur":"_editInputBlurHandler","filterInput.keydown":"_filterInputKeydownHandler","filterInput.keyup":"_filterInputKeyupHandler","mainContainer.click":"_overriddenMenuHandler","mainContainer.mouseleave":"_overriddenMenuHandler","mainContainer.mouseout":"_overriddenMenuHandler","mainContainer.mouseover":"_overriddenMenuHandler","mainContainer.swipeleft":"_mainContainerSwipeHandler","mainContainer.swiperight":"_mainContainerSwipeHandler","scrollButtonFar.click":"_scrollButtonFarClickHandler","scrollButtonNear.click":"_scrollButtonNearClickHandler","scrollViewer.down":"_scrollViewerDownHandler","scrollViewer.kineticScroll":"_scrollViewerWheelHandler","mainContainer.wheel":"_scrollViewerWheelHandler","document.move":"_moveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.ScrollBar":"smart.scrollbar.js"}}static get styleUrls(){return["smart.scrollbar.css","smart.scrollviewer.css","smart.tree.css"]}template(){return`<div id="container">
                    <div class="smart-tree-filter-input-container">
                        <input id="filterInput" class="smart-filter-input" disabled="[[disabled]]" placeholder="[[filterInputPlaceholder]]" type="text" />
                    </div>
                    <smart-repeat-button id="scrollButtonNear" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-near smart-hidden" animation="[[animation]]" unfocusable>
                        <div id="arrowNear" class="smart-arrow smart-arrow-up"></div>
                    </smart-repeat-button>
                    <smart-scroll-viewer id="scrollViewer" animation="[[animation]]" horizontal-scroll-bar-visibility="hidden" right-to-left="[[right-to-left]]">
                        <div id="mainContainer" class="smart-tree-main-container">
                            <content></content>
                        </div>
                        <input type="text" id="editInput" class="smart-tree-edit-input smart-hidden" />
                    </smart-scroll-viewer>
                    <smart-repeat-button id="scrollButtonFar" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-far smart-hidden" animation="[[animation]]" unfocusable>
                        <div id="arrowFar" class="smart-arrow smart-arrow-down"></div>
                    </smart-repeat-button>
                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden">
                        <span id="loadingIndicator" class="smart-loader"></span>
                        <span id="loadingIndicatorPlaceHolder" class="smart-loader-label smart-hidden">[[loadingIndicatorPlaceholder]]</span>
                    </div>
                </div>`}addAfter(e,t){const l=this;t=l.getItem(t);void 0===t||l.addTo(e,t.parentItem,t,!0)}addBefore(e,t){const l=this;t=l.getItem(t);void 0===t||l.addTo(e,t.parentItem,t)}addTo(e,t){const l=this;if(!(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup))return;let r,o;if(void 0===t)t=l.$.mainContainer,r=1,o=t;else{if(t=l.getItem(t),!1==t instanceof Smart.TreeItemsGroup)return;r=t.level+1,o=t.itemContainer}l._createItemHTMLStructure(e,r,t,o.childElementCount,0);const n=l.sorted&&l.autoSort,a=l._state.filter,s=l.selectedIndexes.slice(0);n&&l._unsortItems(l.$.mainContainer),e instanceof Smart.TreeItemsGroup&&l._processHTML(e,r+1,!1);let i=arguments[2];i&&arguments[3]&&(i=i.nextElementSibling),i?(o.insertBefore(e,i),l._menuItems={},l._refreshItemPaths(l.$.mainContainer,!0,void 0,l.sorted&&!l.autoSort)):o.appendChild(e),n&&l._applyGrouping(l.$.mainContainer),a&&l._applyFilter(a),l._checkOverflow(),l._expandItemsByDefault(),l.selectedIndexes=[],l._applySelection(!0,s)}clearSelection(){const e=this,t=e.selectedIndexes.slice(0);e.selectedIndexes=[],e._applySelection(!1,t)}collapseAll(e){const t=this,l=t.animation,r=!1===e&&t.hasAnimation;r&&(t.animation="none"),t._collapseAll(!0),r&&(t.animation=l)}ensureVisible(e){const t=this;if(e=t.getItem(e),void 0===e||e.hidden)return;let l=!1;1<e.level&&!t._isBranchExpanded(e)&&(super.expandItem(e.parentItem,void 0,!1),l=t.hasAnimation,l&&(t._ensureVisibleOnTransitionend=e)),l||t._ensureVisible(e)}expandAll(e){const t=this,l=t.animation,r=!1===e&&t.hasAnimation;let o=1,n=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\"1\"]");for(r&&(t.animation="none");0<n.length;){for(let e=0;e<n.length;e++){const l=n[e];l.expanded||t._menuItemsGroupSelectionHandler(l,{target:l,type:"expand"})}o++,n=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\""+o+"\"]")}r&&(t.animation=l)}expandItem(e,t){const l=this;if(e=l.getItem(e),!(void 0===e||!1==e instanceof Smart.TreeItemsGroup||l._isContainerOpened(e.container.level,e.container))){const r=!1===t&&l.hasAnimation,o=l.animation;r&&(l.animation="none"),l._discardKeyboardHover(),l._menuItemsGroupSelectionHandler(e,{target:e,type:"expand"},arguments[2]),r&&(l.animation=o)}}filter(e){const t=this;t.filterable&&(t._applyFilter(e),t.$.filterInput.value=e)}getState(){return JSON.parse(JSON.stringify(this._state))}insert(e,t){function l(e){const t=e[r.itemsMember]||[],o="smart-tree-items-group"===e.tagName||0<t.length?"smart-tree-items-group":"smart-tree-item",n=document.createElement(o);if(e.disabled&&(n.disabled=!0),e[r.displayMember]&&(n.label=e[r.displayMember]),e.separator&&(n.separator=!0),e[r.valueMember]&&(n.value=e[r.valueMember]),"smart-tree-items-group"==o){e.expanded&&(n.expanded=!0);for(let e=0;e<t.length;e++)n.appendChild(l(t[e]))}else e.shortcut&&(n.shortcut=e.shortcut);return n}const r=this;let o;if(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup){if(r.contains(e))return;o=e}else if("object"==typeof e&&e.constructor===Object)o=l(e);else return;if(void 0===t)return void r.addTo(o);if("number"==typeof t)t=t.toString();else if(t instanceof Smart.TreeItem||t instanceof Smart.TreeItemsGroup){if(!r.contains(t))return;t=t.path}else if("string"!=typeof t)return;const n=t.split(".");let a,s;1===n.length?(s=r._menuItems[n[0]],s?r.addBefore(o,s):r.addTo(o)):(s=r._menuItems[t],a=r._menuItems[n.slice(0,n.length-1).join(".")],s?r.addBefore(o,s):a&&a instanceof Smart.TreeItemsGroup&&r.addTo(o,a))}loadState(e){const t=this,l=t.selectedIndexes.slice(0),r=[];if(!e){if(!t.id)return void t.warn(t.localize("noId"));e=window.localStorage.getItem("smartTree"+t.id)}"string"==typeof e&&(e=JSON.parse(e)),e.filter&&!t.filterable&&(e.filter="");let o=e.filter!==t._state.filter,n=e.sorted!==t.sorted;n?(t.sorted=e.sorted,t._updateState("sorted",t.sorted),e.sorted?t._applyGrouping(t.$.mainContainer):t._unsortItems(t.$.mainContainer),(e.filter||o)&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter)):o&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter),t._menuItemsGroupsToExpand=[];for(let l=0;l<e.expanded.length;l++){const r=t.getItem(e.expanded[l]);r&&t._menuItemsGroupsToExpand.push(r)}t._expandItemsByDefault(!0);for(let l=0;l<e.selected.length;l++){const o=t.getItem(e.selected[l]);o&&r.push(o.path)}t.selectedIndexes=r,t._applySelection(!1,l)}moveDown(e){const t=this;e=t.getItem(e);const l=e.nextElementSibling;void 0===e||!l||t.sorted||(t._moveTreeItem(e,l,2,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}moveUp(e){const t=this;e=t.getItem(e);const l=e.previousElementSibling;void 0===e||!l||t.sorted||(t._moveTreeItem(e,l,0,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}refresh(){this._checkOverflow()}removeItem(e){const t=this;if(e=t.getItem(e),void 0!==e){if(e instanceof Smart.TreeItemsGroup){const l=e.container;t._isContainerOpened(l.level,l)&&t._closeSubContainersTreeMode(l.level,l)}const l=t.sorted&&t.autoSort;l&&t._unsortItems(t.$.mainContainer),e.parentElement.removeChild(e),t._menuItems={},t._refreshItemPaths(t.$.mainContainer,!0,void 0,t.sorted&&!t.autoSort),l&&t._applyGrouping(t.$.mainContainer);const r=t._state.filter,o=t.selectedIndexes.slice(0);r&&t._applyFilter(r),t._checkOverflow(),t.selectedIndexes=[],t._applySelection(!0,o)}}saveState(){const e=this;return e.id?window.localStorage.setItem("smartTree"+e.id,JSON.stringify(e._state)):e.warn(e.localize("noId")),JSON.parse(JSON.stringify(e._state))}select(e){const t=this;e=t.getItem(e);void 0===e||e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}unselect(e){const t=this;e=t.getItem(e);void 0===e||!e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}updateItem(e,t){const l=this;if(e=l.getItem(e),void 0!==e&&void 0!==t){const l=e instanceof Smart.TreeItem;for(let r in t)if(t.hasOwnProperty(r)){if(l){if(-1===["disabled","label","level","selected","separator","shortcut","value"].indexOf(r))continue;}else if(-1===["disabled","expanded","label","level","selected","separator","value"].indexOf(r))continue;e[r]=t[r]}}}propertyChangedHandler(e,t,l){const r=this;switch(e){case"allowDrag":case"allowDrop":case"autoLoadState":case"autoSort":case"editable":case"filterInputPlaceholder":case"loadingIndicatorPlaceholder":case"selectionDisplayMode":case"showLines":case"showRootLines":case"toggleElementPosition":case"toggleMode":break;case"autoHideToggleElement":l?r.$mainContainer.addClass("hidden-arrows"):r.$mainContainer.removeClass("hidden-arrows");break;case"autoSaveState":if(!l)return;if(!r.id)return r.warn(r.localize("noId")),void(r.autoSaveState=!1);window.localStorage.setItem("smartTree"+r.id,JSON.stringify(r._state));break;case"dataSource":{const e=r.selectedIndexes.slice(0);r.selectedIndexes=[],r._menuItems={},r._processDataSource(),r._checkOverflow(),r._expandItemsByDefault(),r._applySelection(!0,e);const t=r._state.filter;t&&r._applyFilter(t);break}case"disabled":r._setFocusable(),r.$.scrollButtonNear.disabled=l,r.$.scrollButtonFar.disabled=l,l||r._updateScrollButtonVisibility();break;case"displayLoadingIndicator":l?(r._discardKeyboardHover(!0),r.$loadingIndicatorContainer.removeClass("smart-hidden")):r.$loadingIndicatorContainer.addClass("smart-hidden");break;case"filterable":!1===l&&(r._applyFilter(""),r.$.filterInput.value=""),r._checkOverflow();break;case"filterMode":r.filterable&&r._state.filter&&r._applyFilter(r._state.filter);break;case"hasThreeStates":if("checkBox"!==r.selectionMode)return;if(l)r._applySelection(!1);else{const e=(r.enableShadowDOM?r.shadowRoot:r).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}break;case"loadingIndicatorPosition":"center"===l?r.$loadingIndicatorPlaceHolder.addClass("smart-hidden"):r.$loadingIndicatorPlaceHolder.removeClass("smart-hidden");break;case"overflow":if("scrollbar"===r.scrollMode)return void(r.$.scrollViewer.verticalScrollBarVisibility="scroll"===l?"visible":"auto");r.$.scrollViewer.scrollTop=0,"hidden"===l?(r.$scrollViewer.removeClass("scroll-buttons-shown"),r.$scrollButtonNear.addClass("smart-hidden"),r.$scrollButtonFar.addClass("smart-hidden")):(r.$.scrollButtonNear.disabled=r.disabled,r.$.scrollButtonFar.disabled=r.disabled,"auto"===l?(r.$scrollButtonNear.addClass("smart-hidden"),r.$scrollButtonFar.addClass("smart-hidden"),r._checkOverflow()):(r.$scrollViewer.addClass("scroll-buttons-shown"),r.$scrollViewer.removeClass("one-button-shown"),r.$scrollButtonNear.removeClass("smart-hidden"),r.$scrollButtonFar.removeClass("smart-hidden"),r._updateScrollButtonVisibility())),r.$.scrollViewer.refresh();break;case"rightToLeft":{let e,t;for(let o in l?(e="paddingLeft",t="paddingRight"):(e="paddingRight",t="paddingLeft"),r._menuItems)if(r._menuItems.hasOwnProperty(o)){const l=r._menuItems[o],n=l.firstElementChild;n.style[e]="",r._setIndentation(n,l.level,t)}break}case"scrollMode":if("hidden"===r.overflow)return;if(r.$.scrollViewer.scrollTop=0,"scrollButtons"===l)return"scroll"===r.overflow&&(r.$scrollViewer.addClass("scroll-buttons-shown"),r.$scrollButtonNear.removeClass("smart-hidden"),r.$scrollButtonFar.removeClass("smart-hidden")),r.$.scrollViewer.verticalScrollBarVisibility="auto",void r._checkOverflow();r.$scrollViewer.removeClass("scroll-buttons-shown"),r.$scrollViewer.removeClass("one-button-shown"),r.$scrollButtonNear.addClass("smart-hidden"),r.$scrollButtonFar.addClass("smart-hidden"),r.$.scrollViewer.verticalScrollBarVisibility="auto"===r.overflow?"auto":"visible";break;case"selectedIndexes":r._applySelection(!1,t);break;case"selectionMode":if(void 0===r._menuItems[0])return;if("one"===t&&"none"!==l&&"checkBox"!==l&&"radioButton"!==l||-1!==t.indexOf("oneOrMany")&&-1!==l.indexOf("oneOrMany")||"none"===t&&(-1!==l.indexOf("zero")||"checkBox"===l)||"zeroOrMany"===l&&"checkBox"!==t||"radioButton"===t&&-1!==l.indexOf("Many")||!r.hasThreeStates&&("checkBox"===l||"checkBox"===t&&"zeroOrMany"===l))return void(r._lastSelectedItem="one"===l||"oneOrManyExtended"===l?r._menuItems[r.selectedIndexes[r.selectedIndexes.length-1]]:void 0);if(r.hasThreeStates&&"checkBox"===t){const e=(r.enableShadowDOM?r.shadowRoot:r).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}r._applySelection(!1);break;case"sort":{if(!r.sorted)return;r._refreshSorting();break}case"sortDirection":r.sorted&&!r.sort&&(r._unsortItems(r.$.mainContainer),r._applyGrouping(r.$.mainContainer));break;case"sorted":{if(!l&&!r.autoSort)return r._refreshItemPathsAndSelection(),void r._updateState("sorted",!1);l?r._applyGrouping(r.$.mainContainer):r._unsortItems(r.$.mainContainer);const e=r._state.filter;e&&r._applyFilter(e),r._updateState("sorted",l),r._checkOverflow();break}case"unfocusable":r._setFocusable();}}_addDragFeedback(){const e=this,t=document.createElement("div");return t.className="smart-tree-item-feedback",t.setAttribute("parent-tree-id",e.id),e.theme&&t.classList.add(e.theme),e.dragFeedbackFormatFunction?t.innerHTML=e.dragFeedbackFormatFunction(e._dragDetails.Items):1===e._dragDetails.Items.length?t.innerHTML=e._dragDetails.Item.label:(t.classList.add("multiple"),t.innerHTML="&#xf0c5;"),document.body.appendChild(t),t}_applyFilter(e){function t(e,t){e?(t.hidden&&t.$.removeClass("smart-hidden"),t.hidden=!1):(!t.hidden&&t.$.addClass("smart-hidden"),t.hidden=!0)}function l(o,n){let a,s=!1,d=0;n=Array.from(n);for(let c=0;c<n.length;c++){const o=n[c];o instanceof Smart.TreeItem?t(r._findItem(o,e),o):l(o,o.itemContainer.children),o.hidden||(d++,a=o),s=s||!o.hidden}if(o!==r.$.mainContainer){const l=r._findItem(o,e);t(s||l,o),s&&null===l?o.$.addClass("filtered-child"):o.$.removeClass("filtered-child"),!s&&0<n.length?(o.hiddenChildren=!0,o.$.addClass("hidden-children"),r.collapseItem(o,void 0,!1)):(o.hiddenChildren=!1,o.$.removeClass("hidden-children"))}""!==e&&0<d&&a.$.addClass("last-filtered-child")}const r=this;if(""!==e||r.hasAttribute("filter-applied")){const t=Array.from(r.getElementsByClassName("last-filtered-child"));for(let e=0;e<t.length;e++)t[e].$.removeClass("last-filtered-child");l(r.$.mainContainer,r.$.mainContainer.children),""===e?r.removeAttribute("filter-applied"):r.setAttribute("filter-applied",""),r._updateState("filter",e),r._checkOverflow()}}_applyHierarchicalSelection(e,t){const l=this,r=e!==l.$.mainContainer,o=r?e.itemContainer.children:e.children;let n=0,a=0;for(let s=0;s<o.length;s++){const i=o[s];e.selected&&i.set("selected",!0),i instanceof Smart.TreeItemsGroup?l._applyHierarchicalSelection(i,t):i.selected&&t.push(i.path),r&&(i.selected?n++:i.hasAttribute("indeterminate")&&a++)}r&&(l._setThreeStateCheckbox(e,n,a),e.selected&&t.push(e.path))}_applyRadioButtonSelection(e,t,l){const r=this,o=e===r.$.mainContainer?e.children:e.itemContainer.children,n=[];let a;for(let a=0;a<o.length;a++){const e=o[a];e instanceof Smart.TreeItemsGroup&&r._applyRadioButtonSelection(e,t,l),e.set("selected",!1),-1!==t.indexOf(e.path)&&n.push(e)}a=0===n.length?o[0]:n[n.length-1],a.set("selected",!0),l.push(a.path)}_applySelection(e,t){const l=this;let r=l.selectedIndexes.slice(0);if(void 0===t&&(t=r.slice(0)),void 0===l._menuItems[0])return l.selectedIndexes=[],l._lastSelectedItem=void 0,void(l.isCompleted&&JSON.stringify(t)!==JSON.stringify([])&&l.$.fireEvent("change",{selectedIndexes:l.selectedIndexes,oldSelectedIndexes:t}));const o=l.selectionMode,n=Array.from((l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("smart-tree-item[selected], smart-tree-items-group[selected]"));for(let o=r.length-1;0<=o;o--){const e=l._menuItems[r[o]];void 0===e&&r.splice(o,1)}if(e)for(let e=0;e<n.length;e++)-1===r.indexOf(n[e].path)&&r.push(n[e].path);else{for(let e=0;e<n.length;e++)n[e].set("selected",!1);n.length=0}switch(l._sortPathCollection(r),o){case"none":r.length=0;for(let e=0;e<n.length;e++)n[e].set("selected",!1);break;case"one":case"zeroOrOne":"zeroOrOne"!==o&&0===r.length&&r.push("0");for(let e=0;e<r.length;e++){const t=l._menuItems[r[e]];if(e==r.length-1){t.set("selected",!0),r=[r[e]];break}-1!==n.indexOf(t)&&t.set("selected",!1)}break;case"oneOrMany":case"oneOrManyExtended":0===r.length&&r.push("0");for(let e=0;e<r.length;e++)l._menuItems[r[e]].set("selected",!0);break;case"zeroOrMany":case"checkBox":for(let e=0;e<r.length;e++)l._menuItems[r[e]].set("selected",!0);if("checkBox"===o&&l.hasThreeStates){const e=[];l._applyHierarchicalSelection(l.$.mainContainer,e),l._sortPathCollection(e),r=e}break;case"radioButton":{const e=[];l._applyRadioButtonSelection(l.$.mainContainer,r,e),l._sortPathCollection(e),r=e;break}}l.selectedIndexes=r,l._updateState("selected"),l._lastSelectedItem="one"===o||"oneOrManyExtended"===o?l._menuItems[r[r.length-1]]:void 0,l.isCompleted&&!1!==arguments[2]&&JSON.stringify(t)!==JSON.stringify(r)&&l.$.fireEvent("change",{selectedIndexes:l.selectedIndexes,oldSelectedIndexes:t})}_autoLoadState(e){const t=this,l=[];for(let l=0;l<t._menuItemsGroupsToExpand.length;l++)t._menuItemsGroupsToExpand[l].set("expanded",!1);t._menuItemsGroupsToExpand=[];for(let l=0;l<e.expanded.length;l++){const r=t.getItem(e.expanded[l]);r&&t._menuItemsGroupsToExpand.push(r)}t.filterable&&e.filter&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter);for(let r=0;r<e.selected.length;r++){const o=t.getItem(e.selected[r]);o&&l.push(o.path)}t.selectedIndexes=l}_blurHandler(){this._discardKeyboardHover(!0)}_canItemBeHovered(e){const t=e.level;return!1===e.disabled&&!0!==e.templateApplied&&!0!==e.hidden&&(1===t||1<t&&this._isContainerOpened(t,e.parentElement.container)&&0<e.getBoundingClientRect().height)}_canItemBeSelected(e){return!1===e.disabled&&!0!==e.templateApplied}_checkOverflow(){var e=Math.round;const t=this,l=t.$.scrollViewer,r=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===r)return void l.refresh();const o=l.scrollTop;"auto"===r&&(l.$.removeClass("scroll-buttons-shown"),l.$.removeClass("one-button-shown"),t.$scrollButtonNear.addClass("smart-hidden"),t.$scrollButtonFar.addClass("smart-hidden"));const n=e(l.$.scrollViewerContentContainer.offsetHeight)>e(l.$.scrollViewerContainer.offsetHeight),a=0<e(l.scrollTop),s=e(l.$.scrollViewerContainer.offsetHeight+l.scrollTop)<e(l.$.scrollViewerContentContainer.offsetHeight);n?"auto"===r?(l.$.addClass("scroll-buttons-shown"),a&&t.$scrollButtonNear.removeClass("smart-hidden"),s&&t.$scrollButtonFar.removeClass("smart-hidden"),!1==(a&&s)&&l.$.addClass("one-button-shown"),!t.disabled&&(t.$.scrollButtonNear.disabled=!1,t.$.scrollButtonFar.disabled=!1),l.scrollTop=o):(t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.disabled?(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0):(t.$.scrollButtonNear.disabled=!a,t.$.scrollButtonFar.disabled=!s)):"scroll"===r&&(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0),l.refresh()}_createElement(){const e=this,t=window.getComputedStyle(e.$.scrollViewer);e.$.scrollViewer.onVerticalChange=e._verticalScrollbarHandler,Object.defineProperty(e,"dataSource",{get:function(){return e.context===e?e.properties.dataSource.value:e._getDataSource()},set(t){e.updateProperty(e,e._properties.dataSource,t)}}),!e.id&&(e.autoLoadState||e.autoSaveState)&&(e.warn(e.localize("noId")),e.autoLoadState=!1,e.autoSaveState=!1),e.mode="tree",e._element="tree",e._isMobile=Smart.Utilities.Core.isMobile,e._edgeMacFF=!1,e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?4:Smart.Utilities.Core.Browser.Edge?8:2,e._scrollViewerPadding=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)||0,e._state={expanded:[],filter:""},e._dblclickObject={numberOfClicks:0},e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),e.disabled&&(e.$.scrollButtonNear.disabled=!0,e.$.scrollButtonFar.disabled=!0),"scrollbar"===e.scrollMode&&"scroll"===e.overflow&&(e.$.scrollViewer.verticalScrollBarVisibility="visible"),null===e.dataSource&&e.$.mainContainer.firstElementChild instanceof HTMLUListElement&&e._processUList();const l=e.getElementsByTagName("smart-tree-item"),r=function(){let t;e.autoLoadState&&(t=window.localStorage.getItem("smartTree"+e.id),t&&(t=JSON.parse(t),e.sorted=t.sorted)),e._setFocusable(),e._menuItems={},null===e.dataSource?e._processHTML(e.$.mainContainer,1):e._processDataSource(),"scrollButtons"===e.scrollMode&&"scroll"===e.overflow&&(e.$scrollViewer.addClass("scroll-buttons-shown"),e.$scrollButtonNear.removeClass("smart-hidden"),e.$scrollButtonFar.removeClass("smart-hidden"),e._updateScrollButtonVisibility()),e._checkOverflow(),t&&e._autoLoadState(t),e._expandItemsByDefault(),e._applySelection(!0),e._updateState("sorted",e.sorted),e.displayLoadingIndicator&&e.$loadingIndicatorContainer.removeClass("smart-hidden"),"center"!==e.loadingIndicatorPosition&&e.$loadingIndicatorPlaceHolder.removeClass("smart-hidden"),e.__onCompleted&&(e._onCompleted=e.__onCompleted,e.__onCompleted=null,e._onCompleted())};0===l.length?r():(e._onCompleted&&(e.__onCompleted=e._onCompleted,e._onCompleted=null),e._ensureItemsReady(l,r))}_dblclickHandler(e,t,l){const r=this;"dblclick"!==r.toggleMode||e instanceof Smart.TreeItem||t||r._menuItemsGroupSelectionHandler(e,l)}_discardKeyboardHover(e,t){const l=this;t||!l._hoveredViaKeyboard||!e&&l._hoveredViaKeyboard instanceof Smart.MenuItemsGroup&&l._isContainerOpened(l._hoveredViaKeyboard.level+1,l._hoveredViaKeyboard.container)||(l._hoveredViaKeyboard.removeAttribute("focus"),l._hoveredViaKeyboard=void 0)}_documentUpHandler(e){const t=this,l=t._downItem,r=t.enableShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(delete t._downItem,t._editedItem&&!t._editInputDown&&(!t._isMobile&&r!==t.$.editInput||t._isMobile&&document.elementFromPoint(e.clientX,e.clientY)!==t.$.editInput))return void t._endEditing();if(delete t._editInputDown,l){const o=r.closest("smart-tree-item")||r.closest("smart-tree-items-group");!o||!o.selected||o!==l||t._dragDetails&&t._dragDetails.FeedbackShown||o instanceof Smart.TreeItemsGroup&&(r.closest(".smart-tree-items-group-arrow")||r===o.container||r===o.container.firstElementChild)||t._handleSelection(o,e)}const o=t._dragDetails;if(!o)return;const n=Smart.Tree.hoveredTree,a=Smart.Tree.hoveredItem;if(delete t._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!o.FeedbackShown)return;const s=n||document.elementFromPoint(e.clientX,e.clientY);let d;document.body.classList.remove("smart-dragging"),document.body.removeChild(o.Feedback),n&&clearInterval(n._dragInterval);const i=o.Item,c=o.Items,m=o.ValidItems;if(!s)return;if(!a||i.contains(a))return void t.$.fireEvent("dragEnd",{item:i,items:c,target:s,data:o,previousContainer:t,container:n||s,originalEvent:e});if(!(n&&n.allowDrop&&!n.disabled))return;const p=[n];let u;if(a.classList.remove("drop-target"),a.classList.contains("top")?(a.classList.remove("top"),u="top",d=0):a.classList.contains("bottom")?(a.classList.remove("bottom"),u="bottom",d=2):(u="inside",d=1),o.DropDetails={item:a,position:u},n!==t)p.push(t);else if(o.ValidateOnDrop)for(let e=0;e<m.length;e++)if(m[e].contains(a))return;const h=t.$.fireEvent("dragEnd",{item:i,items:c,target:a,data:o,previousContainer:t,container:n,originalEvent:e});if(!h.defaultPrevented){n.sorted&&n.autoSort&&n._unsortItems(n.$.mainContainer);for(let e=0;e<m.length;e++)t._moveTreeItem(m[e],a,d,p);n.sorted&&n.autoSort&&n._applyGrouping(n.$.mainContainer),n!==t&&n._state.filter&&n._applyFilter(n._state.filter)}}_editInputBlurHandler(){this._endEditing()}_endEditing(e){const t=this,l=t._editedItem;if(l&&(delete t._editedItem,t.$editInput.addClass("smart-hidden"),t.focus(),!e)){const e=t.$.editInput.value,r=t.sorted&&t.autoSort,o=t._state.filter;e===l.label||(l.set("label",e),l.firstElementChild.firstElementChild.firstElementChild.innerHTML=e,r&&(t._unsortItems(t.$.mainContainer),t._applyGrouping(t.$.mainContainer)),o&&t._applyFilter(o))}}_ensureVisible(e){const t=this;t._ensureVisibleTreeMode(e,e.getBoundingClientRect(),t.$.scrollViewer,t.$.scrollViewer.getBoundingClientRect(),t._scrollViewerPadding),t._ensureVisibleCallback&&t._ensureVisibleCallback(e)}_filterInputKeydownHandler(e){if("PageDown"!==e.key)return void("PageUp"===e.key&&(e.preventDefault(),e.stopPropagation()));const t=this;let l;if(e.preventDefault(),e.stopPropagation(),0<t.selectedIndexes.length){const e=t.selectedIndexes.slice(0);l=t._lastSelectedItem||t._menuItems[t.selectedIndexes[t.selectedIndexes.length-1]],"checkBox"!==t.selectionMode&&"radioButton"!==t.selectionMode&&(t.selectedIndexes=[l.path],t._applySelection(!1,e)),t.focus()}else l=t._getFirstEnabledChild(t.$.mainContainer),t.focus(),l&&t._hoverViaKeyboard(l);t._ensureVisible(l)}_focusHandler(){const e=this;0<e.selectedIndexes.length&&!e._hoveredViaKeyboard&&(e._lastSelectedItem?e._hoverViaKeyboard(e._lastSelectedItem,!1,void 0,!1):e._hoverViaKeyboard(e._menuItems[e.selectedIndexes[e.selectedIndexes.length-1]],!1,void 0,!1))}_getDataSource(){function e(t,l){for(let r=0;r<t.length;r++){const o=t[r],n={label:o.label};o.disabled&&(n.disabled=!0),o.selected&&(n.selected=!0),o.separator&&(n.separator=!0),null!==o.value&&(n.value=o.value),o instanceof Smart.TreeItem?o.shortcut&&(n.shortcut=o.shortcut):(o.expanded&&(n.expanded=!0),n.items=[],e(o.itemContainer.children,n.items)),l.push(n)}}const t=this,l=[];return e(t.$.mainContainer.children,l),l}_handleHierarchicalSelection(e,t){function l(e,t){const r=e.itemContainer.children;for(let o=0;o<r.length;o++){const e=r[o];e.set("selected",t),e.removeAttribute("indeterminate"),e instanceof Smart.TreeItemsGroup&&l(e,t)}}const r=this;let o=e;for(e.selected?e.set("selected",!1):(e.set("selected",!0),e.removeAttribute("indeterminate"));o.parentItem;){const e=o.parentItem,t=e.itemContainer.children;let l=0,n=0;for(let e=0;e<t.length;e++)t[e].selected?l++:t[e].hasAttribute("indeterminate")&&n++;r._setThreeStateCheckbox(e,l,n),o=e}e instanceof Smart.TreeItemsGroup&&l(e,e.selected),t.length=0;const n=Array.from((r.enableShadowDOM?r.shadowRoot:r).querySelectorAll("[selected]"));for(let l=0;l<n.length;l++)t.push(n[l].path);r._sortPathCollection(t)}_handleSelection(e,t){const l=this,r=l.selectionMode;if("none"===r||"programmatic"!==t.type&&!l._canItemBeSelected(e))return;const o=e.selected;if(o&&"down"===t.type)return;const n=l.selectedIndexes.slice(0);let a=n.slice(0);switch(r){case"one":if(o)return;l._menuItems[a[0]].set("selected",!1),l.selectedIndexes=[e.path],e.set("selected",!0),l._lastSelectedItem=e;break;case"zeroOrOne":o?(l.selectedIndexes=[],e.set("selected",!1)):(void 0!==a[0]&&l._menuItems[a[0]].set("selected",!1),l.selectedIndexes=[e.path],e.set("selected",!0));break;case"oneOrMany":case"zeroOrMany":if(o){if(1===a.length&&"zeroOrMany"!==r)return;a.splice(a.indexOf(e.path),1),e.set("selected",!1)}else a.push(e.path),l._sortPathCollection(a),e.set("selected",!0);l.selectedIndexes=a;break;case"oneOrManyExtended":{const r=t.ctrlKey,o=t.shiftKey;if(!r&&!o||o&&e===l._lastSelectedItem){for(let e=0;e<a.length;e++)l._menuItems[a[e]].set("selected",!1);a=[e.path],e.set("selected",!0),l._lastSelectedItem=e}else if(r)e.selected&&1<a.length?(a.splice(a.indexOf(e.path),1),e.set("selected",!1)):!e.selected&&(a.push(e.path),l._sortPathCollection(a),e.set("selected",!0),l._lastSelectedItem=e);else if(o){for(let e=0;e<a.length;e++)l._menuItems[a[e]].set("selected",!1);a=l._selectItemRange(l._lastSelectedItem,e)}l.selectedIndexes=a;break}case"checkBox":l.hasThreeStates?l._handleHierarchicalSelection(e,a):o?(a.splice(a.indexOf(e.path),1),e.set("selected",!1)):(a.push(e.path),l._sortPathCollection(a),e.set("selected",!0)),l.selectedIndexes=a;break;case"radioButton":{if(e.selected)return;let t;for(let l=0;l<e.parentElement.children.length;l++){const r=e.parentElement.children[l];if(r.selected){t=r;break}}const r=a.indexOf(t.path);t.set("selected",!1),e.set("selected",!0),a.splice(r,1),a.push(e.path),l._sortPathCollection(a),l.selectedIndexes=a;break}}if(l._discardKeyboardHover(!0),l._hoverViaKeyboard(e,!1,void 0,!l._treeAnimationInProgress),l._updateState("selected"),JSON.stringify(n)!==JSON.stringify(l.selectedIndexes)){if(l.ownerElement&&!l.ownerElement.isCompleted)return;l.$.fireEvent("change",{item:e,selectedIndexes:l.selectedIndexes,oldSelectedIndexes:n})}}_hoverViaKeyboard(e,t,l,r){if(e){const o=this;e.setAttribute("focus",""),o._hoveredViaKeyboard=e,!1!==r&&o._ensureVisible(e),t&&o._handleSelection(e,l),o._hoverViaKeyboardCallback&&o._hoverViaKeyboardCallback(e)}}_keydownHandler(e){function t(t){for(let l=t;l<a.length;l++){const t=a[l];if(o._canItemBeHovered(t)){if(i){if(i===t)break;i.removeAttribute("focus")}o._hoverViaKeyboard(t,s,e);break}}}function l(t){for(let l=t;0<=l;l--){const t=a[l];if(o._canItemBeHovered(t)){if(i){if(i===t)break;i.removeAttribute("focus")}o._hoverViaKeyboard(t,s,e);break}}}function r(){1<i.level&&(i.removeAttribute("focus"),o._hoverViaKeyboard(i.parentItem,s,e))}const o=this,n=e.key;if(o._editedItem)return void("Enter"===n?o._endEditing():"Escape"===n&&o._endEditing(!0));if(document.activeElement!==o||-1===["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","F2","Home","PageDown","PageUp"," "].indexOf(n)||o.disabled||o.displayLoadingIndicator)return;e.preventDefault();const a=Array.from(o.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),s="one"===o.selectionMode||"oneOrManyExtended"===o.selectionMode&&!e.ctrlKey,i=o.$.mainContainer.querySelector("[focus]");let d;switch(n){case"ArrowDown":d=i?a.indexOf(i)+1:0,t(d);break;case"ArrowLeft":if(!i)return;if(i instanceof Smart.TreeItem)r();else{if(o._isContainerOpened(i.level+1,i.container))return void o._closeSubContainersTreeMode(i.level+1,i.container,!0,!0);r()}break;case"ArrowRight":if(!i||i instanceof Smart.TreeItem)return;o._isContainerOpened(i.level+1,i.container)?(i.removeAttribute("focus"),o._hoverViaKeyboard(o._getFirstEnabledChild(i.itemContainer),s,e)):o._menuItemsGroupSelectionHandler(i,{target:i,type:"keydown"});break;case"ArrowUp":d=i?a.indexOf(i)-1:a.length-1,l(d);break;case"End":l(a.length-1);break;case"Enter":i&&i instanceof Smart.TreeItemsGroup&&o._menuItemsGroupSelectionHandler(i,{target:i,type:"keydown"});break;case"F2":o.editable&&o._startEditing(i);break;case"Home":t(0);break;case"PageDown":o._pageDownHandler(a,i,s,e);break;case"PageUp":o._pageUpHandler(a,i,s,e);break;case" ":i&&o._handleSelection(i,e);}}_mainContainerSwipeHandler(e){Smart.Tree.treeItemDragged&&e.stopPropagation()}_menuItemsGroupSelectionHandler(e,t,l){const r=this,o=r.toggleMode,n=!!t.originalEvent&&t.originalEvent.target.classList.contains("smart-tree-items-group-arrow"),a=e.container;if(!(r._waitAnimation&&r._treeAnimationInProgress===a)&&("down"!==t.type||n||"dblclick"===o&&1!==r._dblclickObject.numberOfClicks||r._handleSelection(e,t),!("down"===t.type&&!n&&("dblclick"===o&&2!==r._dblclickObject.numberOfClicks||"click"===o&&1<r._dblclickObject.numberOfClicks||"arrow"===o)||e.hiddenChildren))){const o=a.level;let n=r.hasAnimation;if("keydown"===t.type&&r._discardKeyboardHover(),r._treeAnimationInProgress&&(a.removeEventListener("transitionend",r._transitionendHandlerExpand),a.removeEventListener("transitionend",r._transitionendHandlerCollapse)),r._isContainerOpened(o,a))r._closeSubContainersTreeMode(o,a,!0,!1!==l);else{const s=r.$.fireEvent("expanding",{item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children});if(s.defaultPrevented)return;if(n&&("expand"!==t.type&&(r._ensureVisibleOnTransitionend=e),r._expandSection(a)),a.$.removeClass("smart-visibility-hidden"),"keydown"===t.type&&(e.setAttribute("focus",""),r._hoveredViaKeyboard=e),e.$.addClass("smart-tree-items-group-opened"),e.$.addClass("smart-tree-items-group-expanded"),r._addOpenedContainer(o,a),void 0===t.type&&r._hoverViaKeyboard(r._getFirstEnabledChild(e.itemContainer)),!1!==l){const t={item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children};r.toggleCallback?(t.type="expand",r.toggleCallback(t)):r.$.fireEvent("expand",t)}}n||(r._checkOverflow(),"expand"!==t.type&&r._ensureVisible(e))}}_mouseenterHandler(){const e=this;e.autoHideToggleElement&&e.$mainContainer.removeClass("hidden-arrows"),Smart.Tree.treeItemDragged&&e.allowDrop&&!e.disabled&&(Smart.Tree.hoveredTree=e)}_mouseleaveHandler(){const e=this;if(e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),Smart.Tree.treeItemDragged){Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree);const e=Smart.Tree.hoveredItem;e&&(e.classList.remove("drop-target"),e.classList.remove("top"),e.classList.remove("bottom"),delete Smart.Tree.hoveredItem)}}_moveHandler(e){var t=Math.abs;const l=this,r=l._dragDetails;if(!r)return;if(!r.FeedbackShown)if(5<t(r.StartPosition.left-e.pageX)||5<t(r.StartPosition.top-e.pageY)){const e=l.$.fireEvent("dragStart",{item:r.Item,items:r.Items,data:r,container:l,previousContainer:l,originalEvent:r.OriginalEvent});if(e.defaultPrevented)return delete l._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,void(l.$.scrollViewer._scrollView.disableSwipeScroll=!1);document.body.classList.add("smart-dragging"),r.Feedback=l._addDragFeedback(),r.FeedbackShown=!0}else return;const o=l.dragOffset;let n,a,s;if(l.$.fireEvent("dragging",{item:r.Item,items:r.Items,data:r,originalEvent:e}),r.Feedback.style.left=e.pageX+o[0]+"px",r.Feedback.style.top=e.pageY+o[1]+"px",l._isMobile){const t=Smart.Tree.hoveredItem;t&&(t.classList.remove("drop-target"),t.classList.remove("top"),t.classList.remove("bottom"),delete Smart.Tree.hoveredItem);const l=document.elementFromPoint(e.clientX,e.clientY);Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree),l&&(n=l.closest("smart-tree"),n&&n.allowDrop&&(Smart.Tree.hoveredTree=n,a=l.closest("smart-tree-item")||l.closest("smart-tree-items-group"),a?s=a:a=l))}if(n=Smart.Tree.hoveredTree,!n)return;const i=n.filterable?n.$.filterInput.offsetHeight+10:0;if(clearInterval(n._dragInterval),n._dragInterval=setInterval(function(){const t=n.getBoundingClientRect();0<n.$.scrollViewer.scrollHeight&&t.left<=e.clientX&&t.left+t.width>=e.clientX?e.clientY>=t.top+i&&e.clientY<=t.top+20+i?(n.$.scrollViewer.scrollTop-=l._autoScrollCoefficient,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility()):e.clientY>=t.top+t.height-20&&e.clientY<=t.top+t.height?(n.$.scrollViewer.scrollTop+=l._autoScrollCoefficient,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility()):clearInterval(n._dragInterval):clearInterval(n._dragInterval)},1),l._isMobile||(a=e.originalEvent.target,a&&a.enableShadowDOM&&(a=e.originalEvent.composedPath()[0]),a&&a.closest&&(s=a.closest("smart-tree-item")||a.closest("smart-tree-items-group"))),s){if(Smart.Tree.hoveredItem&&s!==Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),Smart.Tree.hoveredItem=s,r.Item.contains(s))return;const t=s.getBoundingClientRect();s instanceof Smart.TreeItem?e.clientY-t.top<=t.height/2?(s.classList.remove("bottom"),s.classList.add("top")):(s.classList.remove("top"),s.classList.add("bottom")):10>=e.clientY-t.top?(s.classList.remove("bottom"),s.classList.add("top")):!s.expanded&&10>=t.bottom-e.clientY?(s.classList.remove("top"),s.classList.add("bottom")):(s.classList.remove("top"),s.classList.remove("bottom")),s.classList.add("drop-target")}else if(Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),a!==n.$.scrollViewer.$.scrollViewerContainer)delete Smart.Tree.hoveredItem;else if(n._menuItems[0]){let e=n.$.mainContainer.lastElementChild,t=n.$.mainContainer.childElementCount-1;for(;e.hidden&&(t--,e=n.$.mainContainer.children[t],!!e););e?(Smart.Tree.hoveredItem=e,Smart.Tree.hoveredItem.classList.add("bottom")):Smart.Tree.hoveredItem=n.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}else Smart.Tree.hoveredItem=n.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}_moveSubItems(e,t,l){const r=this;for(let o=0;o<e.length;o++){const n=e[o];n.menu=t,n.set("level",n.parentItem.level+1),n.firstElementChild.style.paddingLeft="",n.firstElementChild.style.paddingRight="",r._setIndentation(n.firstElementChild,n.level,l),n.hidden=!1,n.$.removeClass("smart-hidden"),n.$.removeClass("filtered-child"),n.$.removeClass("last-filtered-child"),n instanceof Smart.TreeItemsGroup&&(n.$.removeClass("hidden-children"),n.container.level=n.level+1,r._moveSubItems(n.itemContainer.children,t,l),t!==r&&n.expanded&&(t._menuItemsGroupsToExpand.push(n),r._updateState("expanded",n.id,!1)))}}_moveTreeItem(e,t,l,r){const o=this,n=e.level;if(0===l){if(t.previousElementSibling===e)return;t.parentElement.insertBefore(e,t),e.set("level",t.level)}else if(2===l){if(t.nextElementSibling===e)return;t.parentElement.insertBefore(e,t.nextElementSibling||null),e.set("level",t.level)}else if(t===r[0].$.container)r[0].$.mainContainer.appendChild(e),e.set("level",1);else{if(t.itemContainer.lastElementChild===e)return;t.itemContainer.appendChild(e),e.set("level",t.level+1)}const a=r[0].rightToLeft?"paddingRight":"paddingLeft";if(e.menu=r[0],e.parentItem=e.parentElement.menuItemsGroup,e.firstElementChild.style.paddingLeft="",e.firstElementChild.style.paddingRight="",o._setIndentation(e.firstElementChild,e.level,a),e.hidden=!1,e.$.removeClass("smart-hidden"),e.$.removeClass("filtered-child"),e.$.removeClass("last-filtered-child"),e instanceof Smart.TreeItemsGroup&&(e.$.removeClass("hidden-children"),e.container.level=e.level+1,o._moveSubItems(e.itemContainer.children,r[0],a),e.expanded)){const t=o._openedContainers[n+1].indexOf(e.container);-1!==t&&o._openedContainers[n+1].splice(t,1),r[0]._menuItemsGroupsToExpand.push(e),2===r.length&&o._updateState("expanded",e.id,!1)}for(let o=0;o<r.length;o++){const e=r[o],t=e.context,l=e.selectedIndexes.slice(0);e.context=e,e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0,void 0,e.sorted&&!e.autoSort),e.selectedIndexes=[],e._applySelection(!0,l,!1),e._checkOverflow(),e.context=t}r[0]._expandItemsByDefault()}_overriddenMenuHandler(){}_pageDownHandler(e,t,l,r){function o(){for(let t=e.length-1;0<=t;t--){const l=e[t];if(n._canItemBeHovered(l)&&n._getOffsetTop(l)+l.firstElementChild.offsetHeight<=a.scrollTop+a.$.container.offsetHeight)return l}}const n=this,a=n.$.scrollViewer;if(!t)return;let s=o();s&&(t===s?a.scrollTop+a.$.container.offsetHeight!==a.$.scrollViewerContentContainer.offsetHeight&&(n.$.scrollViewer.scrollTop+=a.$.container.offsetHeight,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility(),s=o(),t.removeAttribute("focus"),n._hoverViaKeyboard(s,l,r)):(t.removeAttribute("focus"),n._hoverViaKeyboard(s,l,r)))}_pageUpHandler(e,t,l,r){function o(){for(let t=0;t<e.length;t++){const l=e[t];if(n._canItemBeHovered(l)&&n._getOffsetTop(l)>=a.scrollTop)return l}}const n=this,a=n.$.scrollViewer;if(!t)return;let s=o();s&&(t===s?0===a.scrollTop?n.filterable&&n.$.filterInput.focus():(n.$.scrollViewer.scrollTop-=a.$.container.offsetHeight,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility(),s=o(),t.removeAttribute("focus"),n._hoverViaKeyboard(s,l,r)):(t.removeAttribute("focus"),n._hoverViaKeyboard(s,l,r)))}_refreshItemPathsAndSelection(){const e=this,t=e.selectedIndexes.slice(0);e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0),e.selectedIndexes=[],e._applySelection(!0,t)}_refreshSorting(){const e=this;e._unsortItems(e.$.mainContainer),e._applyGrouping(e.$.mainContainer);const t=e._state.filter;t&&e._applyFilter(t),e._checkOverflow()}_scroll(e){const t=this;t.$.scrollViewer.scrollTop+=10*e,t._updateScrollButtonVisibility(),t.focus()}_scrollButtonFarClickHandler(){const e=this;e.$.scrollButtonFar.disabled||e._scroll(1)}_scrollButtonNearClickHandler(){const e=this;e.$.scrollButtonNear.disabled||e._scroll(-1)}_scrollViewerDownHandler(e){function t(){const t=r.closest("smart-tree-item")||r.closest("smart-tree-items-group");if(!(t&&l._canItemBeSelected(t)))return;const o=r.closest(".smart-tree-items-group-arrow");let n;if(t instanceof Smart.TreeItem)n="_handleSelection";else{if(r===t.container||r===t.container.firstElementChild)return;n="_menuItemsGroupSelectionHandler"}if(clearTimeout(l._dblclickTimeout),t!==l._dblclickObject.target&&(l._dblclickObject.numberOfClicks=0),l._dblclickObject.target=t,l._dblclickObject.numberOfClicks++,l._dblclickTimeout=setTimeout(function(){l._dblclickObject.numberOfClicks=0},300),2===l._dblclickObject.numberOfClicks)if(!l.editable)l._dblclickHandler(t,o,e),l._dblclickObject.numberOfClicks=0;else return void l._startEditing(t);t.selected&&(l._downItem=t),l[n](t,e),l._discardKeyboardHover(!0),l._hoverViaKeyboard(t,!1,void 0,!1),o||l._startDragging(t,e)}const l=this;if(e.target!==l.$.scrollViewer||l.disabled||l.displayLoadingIndicator||!l._isMobile&&1!==e.which)return;const r=e.originalEvent.target;if(r===l.$.editInput)return void(l._editInputDown=!0);if(l._isMobile){const e=l.$.scrollViewer.scrollTop;setTimeout(function(){if(l.$.scrollViewer.scrollTop!==e)return;else{const e=l.context;l.context=l,t(),l.context=e}},250)}else t()}_scrollViewerWheelHandler(){const e=this;"scrollButtons"===e.scrollMode&&"hidden"!==e.overflow&&e._updateScrollButtonVisibility()}_selectItemRange(e,t){const l=this,r=Array.from(l.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),o=r.indexOf(e),n=r.indexOf(t),a=[];for(let s=Math.min(o,n);s<=Math.max(o,n);s++){const e=r[s];l._canItemBeHovered(e)&&(a.push(e.path),e.set("selected",!0))}return a}_setFocusable(){super._setFocusable();const e=this;return e.disabled||e.unfocusable?void(e.$.filterInput.tabIndex=-1):void e.$.filterInput.removeAttribute("tabindex")}_setIndentation(e,t,l){e.style[l]=20*t-10+"px"}_setThreeStateCheckbox(e,t,l){t===e.itemContainer.childElementCount?(e.removeAttribute("indeterminate"),e.set("selected",!0)):0===t&&0===l?(e.removeAttribute("indeterminate"),e.set("selected",!1)):(e.setAttribute("indeterminate",""),e.set("selected",!1))}_sortItems(e){const t=this;if(!t.sorted)return;let l;e instanceof Smart.TreeItemsGroup?l=e.container.firstElementChild:e===t.$.mainContainer&&(l=e);let r=Array.from(l.children);if(t.sort){const l=t.sort(r,e);Array.isArray(l)&&(r=l)}else"asc"===t.sortDirection?r.sort(function(e,t){return e.label.localeCompare(t.label)}):r.sort(function(e,t){return t.label.localeCompare(e.label)});for(let t=r.length-1;0<=t;t--)l.insertBefore(r[t],l.firstElementChild)}_sortPathCollection(e){e.sort(function(e,t){const l=e.split("."),r=t.split("."),o=Math.max(l.length,r.length);for(let n=0;n<o;n++){const e=parseFloat(l[n]),t=parseFloat(r[n]);if(isNaN(e))return-1;if(isNaN(t))return 1;if(e<t)return-1;if(e>t)return 1}})}_startDragging(e,t){const l=this,r=l.selectionMode;if(!l.allowDrag||l._editedItem||"none"===r)return;const o=[],n=[];let a;if(-1!==["one","zeroOrOne","checkBox","radioButton"].indexOf(r))a=!1,o.push(e),n.push(e);else{a=!0;for(let e=0;e<l.selectedIndexes.length;e++)o.push(l._menuItems[l.selectedIndexes[e]]),n.push(o[e]);for(let e=0;e<o.length;e++){const t=o[e];if(-1!==n.indexOf(t))for(let e=n.length-1;0<=e;e--){const l=n[e];if(l===t)break;t.contains(l)&&n.splice(e,1)}}}l._dragDetails={StartPosition:{left:t.pageX,top:t.pageY},Items:o,ValidItems:n,Item:e,FeedbackShown:!1,ValidateOnDrop:a,OriginalEvent:t,StartTime:new Date,Dragging:!0},Smart.Tree.treeItemDragged=!0,l.$.scrollViewer._scrollView.disableSwipeScroll=!0,l.allowDrop&&(Smart.Tree.hoveredTree=l,Smart.Tree.hoveredItem=e)}_startEditing(e){const t=this,l=t.$.editInput;let r,o;if(!t._canItemBeSelected(e))return;const n=e.firstElementChild,a=n.firstElementChild;t.rightToLeft?(r=function(){return n.offsetWidth-a.offsetLeft-a.offsetWidth},o="paddingRight"):(r=function(){return a.offsetLeft+parseFloat(window.getComputedStyle(n).borderLeftWidth)},o="paddingLeft"),e instanceof Smart.TreeItemsGroup?(l.style[o]=r()+(t.showLines?parseFloat(window.getComputedStyle(a.firstElementChild).paddingLeft):0)-1+"px",l.style.height=n.offsetHeight+"px"):(l.style[o]=e.offsetWidth+parseInt(n.style[o],10)-n.offsetWidth+parseFloat(window.getComputedStyle(a.firstElementChild).paddingLeft)-2+"px",l.style.height=e.offsetHeight+"px"),l.style.top=t._getOffsetTop(e)+"px",t.$editInput.removeClass("smart-hidden"),l.value=e.label,t._editedItem=e,setTimeout(function(){l.focus()},0)}_styleChangedHandler(e){e.detail.styleProperties&&e.detail.styleProperties["font-size"]&&this._checkOverflow()}_updateScrollButtonVisibility(){var e=Math.round;const t=this,l=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===l)return;let r=!0,o=!0;if(0===e(t.$.scrollViewer.scrollTop)&&(r=!1),e(t.$.scrollViewer.$.scrollViewerContainer.offsetHeight+t.$.scrollViewer.scrollTop)>=e(t.$.scrollViewer.$.scrollViewerContentContainer.offsetHeight)&&(o=!1),"auto"===l){if(r&&o)return t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.$scrollViewer.removeClass("one-button-shown"),void t.$.scrollViewer.refresh();r?t.$scrollButtonNear.removeClass("smart-hidden"):t.$scrollButtonNear.addClass("smart-hidden"),o?t.$scrollButtonFar.removeClass("smart-hidden"):t.$scrollButtonFar.addClass("smart-hidden"),t.$scrollViewer.addClass("one-button-shown"),t.$.scrollViewer.refresh()}else"scroll"!==l||t.disabled||(t.$.scrollButtonNear.disabled=!r,t.$.scrollButtonFar.disabled=!o)}_updateState(e,t,l){const r=this;switch(e){case"expanded":{const e=r._state.expanded.indexOf(t);if(l&&-1===e)r._state.expanded.push(t);else if(!l&&-1!==e)r._state.expanded.splice(e,1);else return;break}case"filter":r._state.filter=t===void 0?r.$.filterInput.value:t;break;case"selected":r._state.selected=[];for(let e=0;e<r.selectedIndexes.length;e++){const t=r._menuItems[r.selectedIndexes[e]];r._state.selected.push(t.id)}break;case"sorted":r._state.sorted=t;}r.autoSaveState&&window.localStorage.setItem("smartTree"+r.id,JSON.stringify(r._state))}_verticalScrollbarHandler(){const e=this,t=e.$.verticalScrollBar,l=t.value;return e.disabled?void 0:t.max===l?void(e._bottomReached||(e.$.fireEvent("scrollBottomReached"),delete e._topReached,e._bottomReached=!0)):t.min===l?void(e._topReached||(e.$.fireEvent("scrollTopReached"),delete e._bottomReached,e._topReached=!0)):void(delete e._topReached,delete e._bottomReached)}});