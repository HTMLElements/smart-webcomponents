
/* Smart UI v12.0.0 (2022-01-16) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-editor",class extends Smart.ContentElement{static get properties(){return{autoLoad:{value:!1,type:"boolean"},autoSave:{value:!1,type:"boolean"},autoSaveInterval:{value:1e3,type:"number"},charCountFormatFunction:{value:null,type:"function?"},contentFiltering:{value:{attributes:{value:[],type:"array"},attributeFilterMode:{allowedValues:["blackList","whiteList"],value:"blackList",type:"string"},tags:{value:[],type:"array"},tagFilterMode:{allowedValues:["blackList","whiteList"],value:"blackList",type:"string"},styleAttributes:{value:[],type:"array"},styleAttributeFilterMode:{allowedValues:["blackList","whiteList"],value:"blackList",type:"string"}},type:"object"},contextMenu:{allowedValues:["default","browser","none"],value:"default",type:"string"},contextMenuDataSource:{value:null,type:"any",reflectToAttribute:!1},dataExport:{value:{style:{value:null,type:"object"},fileName:{value:"smartEditor",type:"string?"},pageOrientation:{value:"portrait",type:"string"}},type:"object"},disableEditing:{value:!1,type:"boolean"},disableSearchBar:{value:!1,type:"boolean"},editMode:{allowedValues:["html","markdown"],value:"html",type:"string"},enableHtmlEncode:{value:!1,type:"boolean"},enableTabKey:{value:!1,type:"boolean"},findAndReplaceTimeout:{value:50,type:"number"},hideToolbar:{value:!1,type:"boolean"},hideInlineToolbar:{value:!1,type:"boolean"},imageFormat:{allowedValues:["blob","base64"],value:"base64",type:"string"},innerHTML:{type:"string",validator:"_sanitize",reflectToAttribute:!1},inlineToolbarOffset:{value:[0,-5],type:"array"},iframeSettings:{value:{attributes:{value:null,type:"object?"},enabled:{value:!1,type:"boolean"},resources:{value:null,type:"object?"}},type:"object"},maxCharCount:{value:null,type:"number?"},messages:{extend:!0,value:{en:{invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",permissionsRequired:"{{elementType}}: Permissions are required for the following action {{actionName}}.",timeout:"{{elementType}}: The import request has timed out.",importError:"{{elementType}}: The import request errored with the following status: {{status}}.",exportError:"{{elementType}}: The Export request errored with the following status: {{status}}.",ok:"Ok",cancel:"Cancel",alignLeft:"Align Left",alignCenter:"Align Center",alignRight:"Align Right",alignJustify:"Align Justify",segoeUi:"Segoe UI",arial:"Arial",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesNewRoman:"Times New Roman",verdana:"Verdana",p:"Paragraph",pre:"Code",code:"Code",blockquote:"Quotation",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",orderedlist:"Ordered List",unorderedlist:"Unordered List",subscript:"Subscript",superscript:"Superscript",alignment:"Alignments",fontname:"Font Name",fontsize:"Font Size",formats:"Formats",backgroundcolor:"Background Color",fontcolor:"Font Color",redo:"Redo",undo:"Undo",indent:"Indent",outdent:"Outdent",createlink:"Hyperlink",hyperlink:"Hyperlink",editlink:"Hyperlink",removelink:"Remove link",openlink:"Open link",image:"Image",video:"Video",table:"Table",lowercase:"Lower Case",uppercase:"Upper Case",print:" Print",cut:" Cut",copy:" Copy",paste:" Paste",clearformat:"Clear Format",fullscreen:"Full Screen",restore:"Restore Screen",sourcecode:"Source Code",preview:"Preview",splitmode:"Split Editor",address:"Web Address",text:"Display Text",addressPlaceholder:"http://example.com",textPlaceholder:"Enter Text",targetPlaceholder:"Select Target",titlePlaceholder:"Enter a Title",urlPlaceholder:"http://example.com/image.png",srcPlaceholder:"https://www.youtube.com/embed/video_link",thumbnail:"Or provide a URL as a video thumbnail",thumbnailPlaceholder:"https://www.link-to-thumbnail.jpg",videoUrl:"Video URL",videoUrlPlaceholder:"https://www.youtube.com/video_link",captionPlaceholder:"Caption",altPlaceholder:"Alternative Text",widthPlaceholder:"auto",heightPlaceholder:"auto",target:"Open Link in",linkBlankDescr:"New Window",linkSelfDescr:"Same Window",linkParentDescr:"Parent Frame",linkTopDescr:"Full Body of the Window",linkCustomDescr:"Custom Frame Name",title:"Title",url:"Or provide the URL to an image",src:"Or provide the URL to an embed video",width:"Width",height:"Height",alt:"Alternative Text",caption:"Caption",display:"Display",displayPlaceholder:"Display",displayBlock:"Block",displayInline:"Inline",draggable:"Enable Dragging",resizable:"Enable Resizing",browse:"Browse",connectionError:"{{elementType}}: File Upload requires connection to the server.",wrongItemIndex:"{{elementType}}: There is no file with such an index in the list of uploaded files.",tooLongFileName:"{{elementType}}: File name is too long.",totalFiles:"Total files: ",cancelFile:"Cancel File",dashedborders:"Dashed Borders",altrows:"Alternate Rows",insertRowBefore:"Insert Row Before",insertRowAfter:"Insert Row After",deleteRow:"Delete Row",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteColumn:"Delete Column",alignTop:"Align Top",alignMiddle:"Align Middle",alignBottom:"Align Bottom",delete:"Delete",tablerows:"Table Rows",tablecolumns:"Table Columns",tablevalign:"Table Cell Vertical Align",tablestyle:"Table Style",tableheader:"Table Header",buttonLabel:"Custom Table",pasteLabel:"Choose the paste format action:",cols:"Columns",rows:"Rows",alphabet:"abcdefghijklmnopqrstuvwxyz",header:"Header",column:"Column",plainText:"Plain Text",keepFormat:"Keep Format",cleanFormat:"Clean Format",roleDescription:"Text Editor",iframeTitle:"Editor Content is Encloused in it's own DOM inside an iFrame",toolbarButtonAriaLabel:"Toolbar Toggle Button",primaryToolbarAriaLabel:"Primary Toolbar",secondaryToolbarAriaLabel:"Secondary Toolbar",inputAriaLabel:"Enter Text",homeTab:"Home",viewTab:"View",insertTab:"Insert",layoutTab:"Layout",undoGroup:"Undo",clipboardGroup:"Clipboard",fontGroup:"Font",paragraphGroup:"Paragraph",editingGroup:"Editing",tableGroup:"Tables",imageGroup:"Images",videoGroup:"Videos",linkGroup:"Links",viewsGroup:"Views",deleteGroup:"Delete",findandreplace:"Find and Replace",requiredMessage:"The content of the Editor cannot be empty",tableProperties:"Table Properties",imageProperties:"Image Properties",videoProperties:"Video Properties",linkProperties:"Link Properties",selectAll:"Select All",deleteTable:"Delete Table",deleteImage:"Delete Image",deleteVideo:"Delete Video",createLink:"Create Link",deleteLink:"Delete Link",copyImage:"Copy",cutImage:"Cut",copyVideo:"Copy",cutVideo:"Cut",find:"Find",findPlaceholder:"",replace:"Replace",replaceWith:"Replace With",replaceAll:"Replace All",replacePlaceholder:"",results:"Results",resultsPlaceholder:"No match",matchCase:"Match Case",searchPlaceholder:"Search..."}}},name:{value:null,type:"string?"},pasteFormat:{allowedValues:["prompt","plainText","keepFormat","cleanFormat"],value:"keepFormat",type:"string"},placeholder:{value:"",type:"string"},removeStylesOnClearFormat:{value:!1,type:"boolean"},required:{value:!1,type:"boolean"},sanitized:{value:!1,type:"boolean"},showCharCount:{value:!1,type:"boolean"},splitModeRefreshTimeout:{value:100,type:"number"},toolbarItems:{value:["bold","italic","underline","|","formats","alignment","orderedList","unorderedList","|","hyperlink","image","video","|","sourceCode","undo","redo"],reflectToAttribute:!1,type:"array"},toolbarMode:{allowedValues:["menu","singleLineRibbon"],value:"menu",type:"string"},toolbarRibbonConfig:{value:[{name:"homeTab",groups:[{name:"undoGroup",items:["undo","redo"]},{name:"clipboardGroup",items:["cut","copy","paste"]},{name:"fontGroup",items:["fontName","fontSize","backgroundColor","fontColor","clearFormat","formats","bold","italic","underline","strikethrough","superscript","subscript"]},{name:"paragraphGroup",items:["orderedList","unorderedList","indent","outdent","alignment"]},{name:"editingGroup",items:["findAndReplace"]}]},{name:"insertTab",groups:[{name:"tableGroup",items:["table"]},{name:"imageGroup",items:["image"]},{name:"videoGroup",items:["video"]},{name:"linkGroup",items:["createLink","removeLink"]}]},{name:"viewTab",groups:[{name:"viewsGroup",items:["fullScreen","sourceCode","splitMode"]}]},{name:"layoutTab",hidden:!0,groups:[{name:"deleteGroup",items:["delete"]},{name:"tableGroup",items:["table","tableHeader","tableRows","tableColumns","tableVAlign","tableStyle",""]},{name:"imageGroup",items:["image","caption"]},{name:"videoGroup",items:["video","caption"]}]}],type:"array"},toolbarViewMode:{allowedValues:["toggle","multiRow","scroll"],value:"toggle",type:"string"},toolbarSticky:{value:!1,type:"boolean"},value:{value:"",type:"string",validator:"_sanitize",reflectToAttribute:!1},windowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"}}}static get listeners(){return{"document.down":"_documentDownHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","document.selectstart":"_selectStartHandler","document.selectionchange":"_selectionChangeHandler","container.dragend":"_dragEndHandler","container.drop":"_dropHandler","container.change":"_changeHandler","container.beforeinput":"_beforeInputHandler","container.input":"_afterInputHandler","contentContainer.contextmenu":"_contextMenuHandler","contentContainer.keydown":"_editableElementKeyDownHandler","contentContainer.keyup":"_updateOnInputChange","contentContainer.paste":"_updateOnInputChange","input.focus":"_editableElementFocusHandler","input.blur":"_editableElementBlurHandler","input.change":"_inputChangeEvent","editableElement.focus":"_editableElementFocusHandler","editableElement.blur":"_editableElementBlurHandler","editableElement.wheel":"_editableElementWheelHandler","editableElement.move":"_editableElementMoveHandler",touchmove:"_touchmoveHandler",resize:"_resizeHandler"}}static get requires(){return{"Smart.Button":"smart.button.js","Smart.Window":"smart.window.js","Smart.Tooltip":"smart.tooltip.js"}}static get styleUrls(){return["smart.editor.css"]}template(){return'<div id="container" role="presentation">\n                    <div id="toolbar" class="smart-editor-toolbar" role="presentation">\n                        <div id="toolbarItemsPrimary" class="smart-editor-toolbar-items-primary" role="toolbar"></div>\n                        <div id="toolbarToggleButton" class="smart-editor-toolbar-toggle-button" role="button"></div>\n                        <div id="toolbarItemsSecondary" class="smart-editor-toolbar-items-secondary" role="toolbar"></div>\n                    </div>\n                    <div id="contentContainer" class="smart-editor-content-container" role="presentation">\n                        <div class="smart-editor-editable" contenteditable="true" id="editableElement" aria-placeholder="[[placeholder]]"\n                        inner-h-t-m-l="[[innerHTML]]" spellcheck="false" role="textbox" aria-multiline="true"><content></content></div>\n                        <textarea name="[[name]]" id="input" class="smart-hidden" placeholder="[[placeholder]]" aria-placeholder="[[placeholder]]"\n                        spellcheck="false" autocapitalize="none" autocomplete="off"></textarea>\n                    </div>\n                </div>'}propertyChangedHandler(e,t,o){const n=this;switch(e){case"contentFiltering":case"contentFiltering_attributes":case"contentFiltering_attributeFilterMode":case"contentFiltering_tags":case"contentFiltering_tagFilterMode":case"contentFiltering_styleAttributes":case"contentFiltering_styleAttributeFilterMode":n._handleContentFiltering();break;case"disabled":case"disableEditing":n.$.input.readonly=o,n.$.editableElement.setAttribute("contenteditable",!o),"disabled"===e&&n._setFocusable();break;case"disableSearchBar":n._closeSearchToolbar();break;case"enableHtmlEncode":{const e=n.$.input;e.classList.contains("smart-hidden")||(e.value=n._getInputValue());break}case"hideToolbar":o&&n._updateToolbarItems(void 0,n.$.toolbar);break;case"innerHTML":case"value":n._handleInputContent(e,o),n.$.fireEvent("change",{oldValue:n._value||t,value:n._value=n._getCurrentValue()});break;case"editMode":n._handleEditMode(o);break;case"hideInlineToolbar":{const e=n.$.inlineToolbar;e&&e.visible&&e.classList.contains("smart-editor-inline-toolbar")&&e.close();break}case"toolbarViewMode":n._toggleToolbar("toggle"===o);break;case"toolbarMode":case"toolbarRibbonConfig":n._handleToolbarMode();break;case"locale":delete n._toolbarItemsObj,delete n._inlineToolbarItemsObj,n._refreshToolbarItems(n._getToolbarItems()),n._closeToolbar(),n._closeWindow();break;case"iframeSettings":n._handleInputElement();break;case"maxCharCount":n._handleMaxCharCount(),n._setCharCount();break;case"name":o&&"markdown"!==n.editMode&&(n.$.input.value=n._getInputValue(n.$.editableElement.innerHTML.trim()));break;case"placeholder":n._handlePlaceholder();break;case"pasteFormat":n._closeWindow();break;case"readonly":n.$.input.readonly=o,n.$.editableElement.setAttribute("contenteditable","markdown"!==n.editMode&&!o),n._closePopups(),n._setResizeFrame(),n._closeWindow();break;case"showCharCount":n._setCharCount();break;case"rightToLeft":case"animation":case"theme":n._updateIframeBody();break;case"toolbarItems":n._handleToolbarItems();break;default:super.propertyChangedHandler(e,t,o)}}_handleToolbarItems(){const e=this,t=e.$.toolbarItemsPrimary,o=e.$.toolbarItemsSecondary;if(t.innerHTML=o.innerHTML="",delete e._toolbarItemsObj,delete e._inlineToolbarItemsObj,e._refreshToolbarItems(e._getToolbarItems()),"toggle"===e.toolbarViewMode){const n=e.$.toolbarToggleButton;t.scrollHeight!==t.offsetHeight||o.children.length?n.classList.remove("smart-visibility-hidden"):n.classList.add("smart-visibility-hidden")}}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._isFireFox=Smart.Utilities.Core.Browser.Firefox,e._isSafari=Smart.Utilities.Core.Browser.Safari,e._isMacOS=(window.navigator.platform||"").indexOf("Mac")>-1,e._handleMaxCharCount(),e._handleInputContent(),e._setToolbarVisibility(),e._handleToolbarMode(),e._handleInputElement(),e._handleEditMode(),e._predefPropertyGetter(),e._setCharCount(),e._setFocusable(),e._setAriaSettings(),super.render()}detached(){const e=this;super.detached(),delete e._dragDetails,delete e._resizeFrameObj,delete e._toolbarItemClick,e._endInlineToolbarClick(),e._closeWindow(),e._closeToolbarItemDropDown(e.$.inputPopup),e._closeToolbarItemDropDown(e.$.colorInputPopup),e._closeContextMenu(),e._closeToolbar(),e._handleTableSelection()}focus(){const e=this,t="markdown"===e.editMode?e.$.input:e.$.editableElement;t&&t.focus()}blur(){const e=this,t="markdown"===e.editMode?e.$.input:e.$.editableElement;t&&t.blur()}clearState(){const e=this;e.id?window.localStorage.removeItem("smartEditor"+e.id):e.warn(e.localize("noId"))}collapseToolbar(){this._toggleToolbar(!0)}disableToolbarItem(e){this._setToolbarItemAttr(e,"disabled",!0)}enableToolbarItem(e){this._setToolbarItemAttr(e,"disabled",!1)}expandToolbar(){this._toggleToolbar()}executeCommand(e,t){return this.$.editableElement.getRootNode().execCommand(e,!1,t)}exportData(e,t){this._handleDataExport(e,t)}importData(e,t){"string"==typeof e&&(e={url:e}),t||(t={}),this._ajax(e,t)}fullScreenMode(e){const t=this;t.$.fireEvent("actionStart",{name:"fullScreenMode"}).defaultPrevented||(t._handleFullScreenMode(t._toggleItem("fullscreen",e)),t.$.fireEvent("actionEnd",{name:"fullScreenMode"}))}getCharCount(){const e=this;if("html"===e.editMode){const t=e.$.editableElement,o=t.textContent.length,n=t.innerText.length;return n&&o?n:0}return e.$.input.value.length}getSelectionRange(){return this._selectionRange}clearContent(){const e=this;e._setResizeFrame(),e.$.editableElement.innerHTML=e.$.input.value=""}getHTML(){const e=this;if("markdown"===e.editMode){const t=e.$.input;return window.marked?window.marked(t.value):t.value}return e.$.editableElement.innerHTML}getText(){const e=this;return"markdown"===e.editMode?e.$.input.value:e.$.editableElement.textContent}loadState(e){const t=this;t.id?(e||(e=window.localStorage.getItem("smartEditor"+t.id)),"string"==typeof e&&(t.set("value",e),t.$.editableElement.innerHTML=t.$.input.value=e)):t.warn(t.localize("noId"))}showMessage(e,t){const o=this;if(!e||!o.isRendered)return;if(!Smart.Toast)return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"showMessage",files:"smart.toast.js"}));o._setToast();const n=o.$.toast;if(n){let a;if("object"==typeof t)for(let e in t)"iconType"===e?a=t[e]:n[e]=t[e];if(!o.$.container.contains(n)){const e=o.$toast;o._toastVisibilityHandler||(o._toastVisibilityHandler=e=>{const t=e.type;"close"===e.type&&e.detail.instance===o._requiredMessage&&delete o._requiredMessage,e.stopPropagation(),o.$.fireEvent("message"+t.slice(0,1).toUpperCase()+t.slice(1),e.detail)},e.listen("open",o._toastVisibilityHandler),e.listen("close",o._toastVisibilityHandler)),o.$.container.appendChild(n)}return n.open(e+"",a)}}hideMessage(e){const t=this.$.toast;t&&(void 0===e?t.closeAll():t.closeItem(e))}hideLastMessage(){const e=this.$.toast;e&&e.closeLast()}selectAll(){this._selectAll()}selectRange(e,t){const o=this,n=o.$.editableElement.getRootNode();if(!n)return;e=parseInt(e),t=parseInt(t),e=Math.min(e,t),t=Math.max(e,t);const a=o.$.input,i=o.$.editableElement,r="markdown"===o.editMode||o.$.editableElement.classList.contains("smart-hidden")?a:i,l=o.$.iframe,[s,d]=l?[l.contentWindow,l.contentDocument]:[window,document],c=s.getSelection();let m=n.activeElement;if((!m||m!==a&&m!==i||m.classList.contains("smart-hidden"))&&(r.focus(),m=r),c.removeAllRanges(),delete o._selectionRange,!isNaN(e)&&!isNaN(t)&&e!==t){if(m===a)a.setSelectionRange(e,t),o._selectionRange={selectionStart:e,selectionEnd:t};else{const n=o._getNodes(i,e,t).nodes;for(let e=0,t=n.length;e<t;e+=1){const{node:t,index:a,startIndex:i}=n[e],r=d.createRange();t.nodeType===Node.TEXT_NODE?(r.setStart(t,Math.max(0,i)),r.setEnd(t,Math.min(a,t.nodeValue.length))):r.selectNodeContents(t),c.addRange(r),o._selectionRange=r}}o._updateToolbarItems()}}saveState(){const e=this;e.id?window.localStorage.setItem("smartEditor"+e.id,e.$.editableElement.innerHTML):e.warn(e.localize("noId"))}splitMode(e){const t=this;t.$.fireEvent("actionStart",{name:"splitMode"}).defaultPrevented||(t._handleSplitMode(t._toggleItem("splitmode",e)),t.$.fireEvent("actionEnd",{name:"splitMode"}))}previewMode(e){const t=this;t.$.contentContainer.hasAttribute("split-mode")||t.$.fireEvent("actionStart",{name:"sourcecode"}).defaultPrevented||(t._handleSourceCodeMode(t._toggleItem("sourcecode",e)),t.$.fireEvent("actionEnd",{name:"sourcecode"}))}print(){this._handlePrint()}updateToolbarItem(e,t){const o=this,n=o.toolbarItems;let a;if("string"==typeof e?a=n.find((t=>t.name===e)):"number"==typeof e&&(a=n[e]),a){o._closePopups(),o._closeWindow(),delete o._toolbarItemsObj[a.name],delete o._inlineToolbarItemsObj[a.name];for(let e in t)a[e]=t[e];return o._refreshToolbarItems(o._getToolbarItems()),!0}}_toggleItem(e,t){const o=this._toolbarItemsObj;if(!o)return;const n=o[e],a=this.$.toolbar.querySelector(`.smart-editor-toolbar-item[item-name="${e}"]`);return n&&a?((t=n.value=void 0===t?!n.value:!!t)?(a.setAttribute("checked",""),a.setAttribute("aria-pressed",!0)):(a.removeAttribute("checked"),a.setAttribute("aria-pressed",!1)),a):void 0}_ajax(e,t={}){const o=this;let n="GET",a=e.url,i=null,r=!0;if(e.type&&(n=e.type),e.data)if("GET"===n){a+="?";for(let t in e.data)Object.prototype.hasOwnProperty.call(e.data,t)&&(a+=encodeURI(t+"="+e.data[t]+"&"));"&"===a.charAt(a.length-1)&&(a=a.slice(0,a.length-1))}else"POST"===n&&(i=JSON.stringify(e.data));t&&!1===t.async&&(r=!1),void 0!==window.fetch&&r?o._ajaxFetch(e,t,n,a,i):o._ajaxXMLHttpRequest(e,t,n,a,i,r)}_ajaxFetch(e,t,o,n,a){const i=this,r={method:o};let l,s,d;t&&t.contentType&&(r.headers=new Headers({"Content-Type":t.contentType})),null!==a&&(r.body=a),e.timeout&&(s=setTimeout((function(){d=!0}),e.timeout)),t.beforeSend&&!1===t.beforeSend(r,t)||fetch(n,r).then((function(e){if(d)throw l=408,i.error(i.localize("timeout",{elementType:i.nodeName.toLowerCase()}));if(s&&clearTimeout(s),l=e.status,!e.ok)throw i.error(i.localize("importError",{elementType:i.nodeName.toLowerCase(),status:e.statusText}));return e.text()})).then((e=>i._ajaxComplete(t,e,l))).catch((function(e){t&&t.loadError&&t.loadError(l,e)}))}_ajaxXMLHttpRequest(e,t,o,n,a,i){const r=new XMLHttpRequest,l=this;r.open(o,n,i),r.ontimeout=function(){t&&t.loadError&&t.loadError(408,"timeout")},r.onload=function(){if(4===r.readyState){const o=r.status;let n=r.response;o>=200&&o<=299?("json"===e.dataType&&(n=JSON.parse(n)),l._ajaxComplete(t,n,o)):t&&t.loadError&&t.loadError(o,n)}},r.onerror=function(){t&&t.loadError&&t.loadError(r.status,r.response)},t&&t.contentType&&r.setRequestHeader("Content-Type",t.contentType),i&&e.timeout&&(r.timeout=e.timeout),t.beforeSend&&!1===t.beforeSend(r,t)||r.send(a)}_ajaxComplete(e,t){if(e){if(e.beforeLoadComplete){const o=e.beforeLoadComplete(t);o&&(t=o)}this._handleInputContent("value",t)}}_afterInputHandler(e){const t=this,o=t._beforeInputObj,n=t.$.editableElement,a=!n.innerHTML;let i,r;if(o&&o.type&&(i=o.type,r=o.rangeDetails),delete t._beforeInputObj,a&&(t._setResizeFrame(),t._closeToolbar()),"insertParagraph"===i||a){let e=t._getSelectionRange().startContainer;if(e.nodeType===Node.TEXT_NODE&&(e=e.parentElement),e&&e.classList&&(e.closest(".smart-editor-image-caption")||e.closest(".smart-editor-editable table")))return;const o=t.$.iframe,[i,r]=o?[o.contentWindow,o.contentDocument]:[window,document];("div"===i.getSelection().anchorNode.nodeName.toLowerCase()||e===n&&a)&&r.execCommand("insertHTML",!1,"<p><br></p>")}else if(i&&r&&i.indexOf("delete")>-1){const e=t._resizeFrameObj;e&&e.target&&!n.contains(e.target)&&t._setResizeFrame()}n.textContent.length&&n.innerText.length?n.removeAttribute("show-placeholder"):n.setAttribute("show-placeholder",""),t.name&&e.target===t.$.editableElement&&"markdown"!==t.editMode&&(t.$.input.value=t._getInputValue(t.$.editableElement.innerHTML.trim())),t._setCharCount()}_beforeInputHandler(e){const t=this,o=t.$.iframe,n=t.$.contentContainer,a=t.$.editableElement,i=(o?o.contentWindow:window).getSelection().getRangeAt(0),r=e.inputType,l=i.startContainer;let s;if(r&&(s=r.indexOf("delete")>-1,t._beforeInputObj={type:r,rangeDetails:{startOffset:i.startOffset,endOffset:i.endOffset,startContainer:i.startContainer,endContainer:i.endContainer}}),s&&a.contains(l))if(l===i.endContainer&&i.startOffset===i.endOffset){const e=t._resizeFrameObj;let o=l;if(e&&e.target&&e.target.contains(l))return;if(o.nodeType!==Node.TEXT_NODE&&o.innerHTML.length){if(o===a)return;o.remove()}else{let e=o.parentElement,t=o.previousElementSibling;for(;!t&&e;)t=e.previousElementSibling,e=e.parentElement;a!==t&&a.contains(t)&&!t.innerHTML.length&&t.remove()}}else i.deleteContents(),e.preventDefault();if(!n.classList.contains("char-count-maxed")||s){if("insertParagraph"===r){const e=t._getSelectionRange().startContainer;e.nodeType===Node.TEXT_NODE&&e.parentElement===a&&a.getRootNode().execCommand("formatBlock",!1,"p")}}else e.preventDefault()}_changeHandler(e){const t=this,o=e.target,n=e.detail,a=o.closest(".smart-editor-toolbar-item");if(e.stopPropagation(),t._toolbarItemsObj||t._inlineToolbarItemsObj)return a&&o===t.$.inputPopup||o===t.$.colorInputPopup?(t._ignoreSelectionChange=!0,t._updateToolbarItem(a,n),void delete t._ignoreSelectionChange):void 0}_contextMenuHandler(e){const t=this,o=t.contextMenu;"browser"!==o?(e.preventDefault(),"none"!==o?t._openContextMenu(e):t._closeContextMenu()):t._closeContextMenu()}_closeContextMenu(){const e=this.$.inlineToolbar,t=this.$.fireEvent("dropDownToolbarClosing",{target:e}).defaultPrevented;e&&e.visible&&e.classList.contains("smart-editor-context-menu")&&!t&&e.close()}_openContextMenu(e){const t=this,o=e.target;let n=t.$.inlineToolbar;if(n||(n=t._createToolbar()),t.$.fireEvent("contextMenuOpening",{target:n}).defaultPrevented)return;t._setupToolbar(o,"context"),n.parentElement||t.getShadowRootOrBody().appendChild(n),n.clear(),t._setContextMenuContent(o);const a=t.getBoundingClientRect();n.style.left=Math.min(e.pageX+1,a.right+window.pageXOffset-n.offsetWidth)+"px",n.style.top=Math.min(e.pageY+1,a.bottom+window.pageYOffset-n.offsetHeight)+"px",n.open()}_setContextMenuContent(e){const t=this;if(!e)return;let o=t._contextList,n=t._getContextMenuTargetType(e),a=t._getContextMenuDataSource(e,n);o||(t._contextList=o=document.createElement("div"),o.classList.add("smart-editor-context-menu-item-container"));const i=document.createDocumentFragment(),r=a.length;let l=o.children;for(;l.length>r;)l[0].remove();l=Array.from(l);for(let o=0;o<r;o++){const r=a[o];let s,d,c=l[o];if("object"==typeof r?(s=r.label,d=r.value):s=d=r+"",c||(c=document.createElement("div"),c.classList.add("smart-editor-context-menu-item"),c.setAttribute("role","option")),c.removeAttribute("disabled"),"deleteLink"!==r||"image"!==n||e.closest(".smart-editor-editable a")){if("cut"===r||"copy"===r){const e=t._getSelectionRange();(void 0!==e.selectionStart?e.selectionStart:e.startOffset)===(void 0!==e.selectionEnd?e.selectionEnd:e.endOffset)&&c.setAttribute("disabled","")}}else c.setAttribute("disabled","");c.parentElement||i.appendChild(c),c.innerHTML=t.localize(s)||s,c.setAttribute("value",d)}o.appendChild(i),t.$.inlineToolbar.appendChild(o)}_getContextMenuTargetType(e){let t;return t=e.closest(".smart-editor-editable table")?"table":e.closest(".smart-editor-editable img")?"image":e.closest(".smart-editor-video-container")?"video":e.closest(".smart-editor-editable a")?"link":"text",t}_getContextMenuDataSource(e,t){if(!t)return[];const o=this.contextMenuDataSource;let n;switch(t){case"table":n=["tableProperties","insertRowAfter","insertRowBefore","insertColumnLeft","insertColumnRight","deleteRow","deleteColumn","deleteTable","selectAll"];break;case"image":n=["imageProperties","copyImage","cutImage","createLink","deleteLink","deleteImage","caption"];break;case"video":n=["videoProperties","copyVideo","cutVideo","deleteVideo","caption"];break;case"link":n=["linkProperties","deleteLink","selectAll"];break;default:n=["copy","cut","paste","selectAll"]}return o&&(n="function"==typeof o?o(e,t,n):Array.isArray(o)?o:[]),n}_updateToolbarItem(e,t){const o=this,n=o.editMode,a=e.getAttribute("item-name"),i=o.$.toolbarItemsPrimary,r=o.$.toolbarItemsSecondary,l=o.$.inlineToolbar,s="markdown"===n?o.$.input:o.$.editableElement,d=(e,n,a)=>{n&&(n.label=t["alignment"===n.name?"value":"label"],n.value=t.value,e&&o._setItemValue(e,n),a&&o._updateToolbarTarget(n))};if(l&&l.contains(e)?(d(e,o._inlineToolbarItemsObj[a],!0),o._toolbarItemsObj&&o._toolbarItemsObj[a]&&d(o.$.toolbar.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),o._toolbarItemsObj[a])):(i.contains(e)||r.contains(e))&&o._toolbarItemsObj&&(d(e,o._toolbarItemsObj[a],!0),l&&l.visible&&o._inlineToolbarItemsObj&&d(l.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),o._inlineToolbarItemsObj[a])),s.getRootNode().activeElement!==s){const e=o._selectionRange,t=s.scrollTop;e&&("markdown"===n?o._setSelectionRange(s,e.selectionStart,e.selectionEnd):o._setSelectionRange(e.startContainer,e.startOffset,e.endOffset)),s.focus({preventScroll:!0}),o._isSafari&&t&&(s.scrollTop=t)}}_updateToolbarTarget(e){const t=this,o=t._resizeFrameObj;if(!e)return;const n=t.$.inlineToolbar;let a;o&&o.target?a=o.target:n&&n.visible&&(a=n.selector,a=a.closest?a.closest(".smart-editor-editable img")||a.closest(".smart-editor-editable table"):void 0);const i=a?a.nodeName.toLowerCase():"";if(a&&"img"===i)return"alignment"===e.name&&(a.closest(".smart-editor-image-container")||a).setAttribute("alignment",e.value),t._setResizeFrame(a),void(n&&n.visible&&n.reposition());if(a&&"table"===i)return void t._handleTableToolbarAction(e,a);const r=t._getSelectionRange();if(r&&(r.startContainer||void 0!==r.selectionStart)){const o=e.name;if(t.$.fireEvent("actionStart",{name:o}).defaultPrevented)return;switch(o){case"backgroundcolor":t._handleBackgroundColor(e);break;case"fontcolor":t._handleFontColor(e);break;case"alignment":t._handleTextAlignment(e);break;case"fontsize":t._handleFontSize(e);break;case"fontname":t._handleFontName(e);break;case"formats":t._handleFormats(e);break;case"paste":t._handlePaste(e);break;default:{const t=r.startContainer.closest?r.startContainer:r.startContainer.parentElement;return void(t&&t.closest&&t.setAttribute(e.name,e.value))}}o&&t.$.fireEvent("actionEnd",{name:o})}}_setSelectionRange(e,t,o){const n=this,a=n.$.iframe,i=n.editMode;let r;if(n.disabled)return;if("markdown"===i||n.$.editableElement.classList.contains("smart-hidden")){r=n.$.input,n._selectionRange={selectionStart:void 0!==t?t:r.selectionStart,selectionEnd:void 0!==o?o:r.selectionEnd};const e=n._selectionRange;return void(n._selectionChangeFired||r.setSelectionRange(e.selectionStart,e.selectionEnd))}const l=(a?a.contentWindow:window).getSelection();let s;if(r=n.$.editableElement,e){if(s=document.createRange(),"number"==typeof t&&"number"==typeof o)try{s.setStart(e,parseInt(t)),s.setEnd(e,parseInt(o))}catch(t){s.selectNodeContents(e)}else"img"===e.nodeName.toLowerCase()||e.classList.contains("smart-editor-video-container")?(s.setStartBefore(e),s.setEndAfter(e),s.selectNode(e)):s.selectNodeContents(e);l.removeAllRanges(),l.addRange(s)}else l.rangeCount&&(s=l.getRangeAt(0));try{s&&s.startContainer&&r.contains(s.startContainer)&&(n._selectionRange=s)}catch(e){}n._selectionRange||(s=document.createRange(),s.selectNodeContents(r),s.collapse(!0),n._selectionRange=s)}_getSelectionRange(){const e=this,t=e.editMode;let o=e._selectionRange;return o&&("markdown"===t&&void 0===o.selectionStart||"html"===t&&void 0===o.startContainer)&&(delete e._selectionRange,o=void 0),o||e._setSelectionRange(),e._selectionRange}_setCharCount(){const e=this,t=e.$.contentContainer;if(!e.showCharCount)return void t.removeAttribute("char-count");const o=e.maxCharCount;let n,a;if("html"===e.editMode){const t=e.$.editableElement,o=t.textContent.length,n=t.innerText.length;a=n&&o?n:0}else a=e.$.input.value.length;if(n=e.charCountFormatFunction?e.charCountFormatFunction(a,o)+"":o?`${a} / ${o}`:a+"",t.setAttribute("char-count",n),null===o)return void t.classList.remove("char-count-low","char-count-medium");const i=parseFloat((a/o).toFixed(2));t.classList[i>=.7&&i<=.9?"add":"remove"]("char-count-warning"),t.classList[i>=.9?"add":"remove"]("char-count-error"),t.classList[a>=o?"add":"remove"]("char-count-maxed")}_documentDownHandler(e){const t=this,o=t.$.iframe,n=t.$.inlineToolbar,a=t.$.window,i=e.originalEvent||e,r=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target;if(n&&n.contains(r)){const e=r.closest(".smart-editor-toolbar-item");return t._handleToolbarItemDown(e,r),void i.preventDefault()}if(t.$.container.contains(r)||o&&o.contentDocument.body.contains(r))return void t._handleDownInside(i,r);const l=r.closest(".smart-input-drop-down-menu");let s;if(l&&(s=l.ownerElement),a&&a.opened&&!a.contains(s||r)&&a.close(),t._handleTableSelection(),s&&(t.$.toolbarItemsPrimary.contains(s)||t.$.toolbarItemsSecondary.contains(s)||n&&n.contains(s)))return t._toolbarItemClick={},void i.preventDefault();t._setResizeFrame(),t._closePopups()}_handleDownInside(e,t){const o=this,n=e.originalEvent||e,a=t.closest(".smart-editor-toolbar-item"),i=o.$.inlineToolbar,r=t.classList.contains("smart-editor-video-container")?t:null,l=o.$.window;let s=o._editorVideoItemClick;if(s&&(r&&s.dragElement&&s.dragElement.remove(),delete o._editorVideoItemClick,s=void 0),t===o.$.toolbarToggleButton)o._toolbarItemClick={},e.preventDefault();else{if(a)return o._handleToolbarItemDown(a,t),void e.preventDefault();if(t.closest(".smart-editor-toolbar-tab"))e.preventDefault();else if(r)s||(s=o._editorVideoItemClick={target:t,originalSelectionRange:o._selectionRange}),e.preventDefault(),!1!==r.getAttribute("draggable")&&r.querySelector("video")?(s.dragElement=o._createWhiteSpaceChar(t,r),o._setSelectionRange(t)):s.dragElement&&(s.dragElement.remove(),delete s.dragElement);else if(t.closest(".smart-editor-search-bar"))o._searchBarDown={target:t},t.closest(".smart-search-input")||e.preventDefault();else{const e={x:n.pageX+window.pageXOffset,y:n.pageY+window.pageYOffset};l&&l.opened&&l.close();const a=o._getInlineToolbarTarget(t,e);if(a){const t=o.$.contentContainer;t.contains(t.getRootNode().activeElement)||o._focusEditableElement(),o._handleInlineToolbarItemDown(a,e)}else!i||i.contains(t)&&i.classList.contains("smart-editor-drop-down-toolbar")||(o._closeToolbar(),o._handleTableSelection())}}o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup)}_handleToolbarItemDown(e,t){const o=this,n=o.$.inlineToolbar,a=o.$.window;if(!e)return;const i=e.getAttribute("item-type"),r=e.getAttribute("item-name");switch(!a||!a.opened||a._target&&a._target.item.name===r||a.close(),o._toolbarItemClick={toolbarItem:e},o._resizeFrameObj&&o._resizeFrameObj.target?o._toolbarItemClick.target=o._resizeFrameObj.target:o._setResizeFrame(),o._setSelectionRange(),i){case"button":["hyperlink","createlink","image","video"].includes(r)?o._toolbarItemClick.callback=o._toggleWindow:"table"===r&&(o._toolbarItemClick.callback=n&&n.contains(e)?o._toggleWindow:o._toggleDropDownToolbar);break;case"toggle":e.toggleAttribute("checked"),e.hasAttribute("checked")?e.setAttribute("aria-pressed",!0):e.setAttribute("aria-pressed",!1),o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup);break;case"drop-down":o._toolbarItemClick.callback=o._toggleItemDropDown;break;case"color-input":t.closest(".smart-editor-item-drop-down-button")&&(o._toolbarItemClick.callback=o._toggleItemDropDown)}}_handleInlineToolbarItemDown(e,t){const o=this,n=e.closest(".smart-editor-editable table"),a=o.$.editableElement;if(o._inlineToolbarClickObj&&o._inlineToolbarClickObj.target&&(o._inlineToolbarClickObj.target.removeAttribute("drag-id"),o._inlineToolbarClickObj.dragElement&&o._inlineToolbarClickObj.dragElement.removeAttribute("drag-id")),o._inlineToolbarClickObj={},e)if("img"===e.nodeName.toLowerCase())e.setAttribute("drag-id",Math.random().toString(36).substr(2,5));else if(e.classList.contains("smart-editor-video-container")){const t=e.querySelector("video, iframe");t&&(t.setAttribute("drag-id",Math.random().toString(36).substr(2,5)),o._inlineToolbarClickObj.dragElement=t)}if(n&&a.hasAttribute("table-cell-resize")){const i=a.getAttribute("table-cell-resize");o._inlineToolbarClickObj.resizeDetails={x:t.x,y:t.y,position:i,target:"vertical"===i?e.closest("tr"):e,table:n},e=void 0}o._handleTableSelection(e),o._inlineToolbarClickObj.target=e,o._inlineToolbarClickObj.dragTarget=e}_getInlineToolbarTarget(e,t){const o=this;let n,a=e.closest(".smart-editor-editable img")||e.closest(".smart-editor-editable a")||e.closest(".smart-editor-video-container");return a||(n=e.closest(".smart-editor-editable table"),n&&(a=e.closest(".smart-editor-editable td")||e.closest(".smart-editor-editable th"))),e.closest(".smart-editor-resize-frame")&&o._resizeFrameObj?(o._resizeFrameObj.resizeDetails={x:t.x,y:t.y,position:e.getAttribute("position")},a=o._resizeFrameObj.target):a&&(a&&"img"===a.nodeName.toLowerCase()||n||a.classList.contains("smart-editor-video-container"))||o._setResizeFrame(),a}_documentMoveHandler(e){const t=this,o=t._resizeFrameObj,n=t._inlineToolbarClickObj,a=e.originalEvent||e;o&&o.resizeDetails?t._handleFrameResize(a):n&&n.resizeDetails&&t._handleTableCellResize(a)}_touchmoveHandler(e){const t=this,o=t._resizeFrameObj;t._isMobile&&o&&o.target&&(o.resizeDetails?(e.preventDefault(),e.stopPropagation()):(t._closeToolbar(),t._setResizeFrame()))}_dragStartHandler(e){const t=this,o=t._resizeFrameObj,n=t._inlineToolbarClickObj;if(o&&o.resizeDetails||n&&n.resizeDetails)return e.preventDefault(),void delete t._dragDetails;if(!t.$.contentContainer.contains(e.target))return;if(!n||!n.target)return void e.preventDefault();const a=t._inlineToolbarClickObj.target;if(a&&(["img","table"].indexOf(a.nodeName.toLowerCase())>-1||a.classList.contains("smart-editor-video-container"))){if("false"===a.getAttribute("draggable"))return void e.preventDefault();const o=e.target,n=o.parentElement,i=o.closest(".smart-editor-image-container");t._closeToolbar(),t._setResizeFrame(),t._dragDetails={target:o,scrollTop:t.$.editableElement.scrollTop,container:i,anchor:n&&"a"===n.nodeName.toLowerCase()?n:void 0,caption:i?i.querySelector(".smart-editor-image-caption"):void 0}}}_dropHandler(){const e=this;e._isFireFox&&e._dragEndHandler()}_dragEndHandler(){const e=this,t=e.$.inlineToolbar,o=e._dragDetails;if(o){const n=o.target,a=o.container,i=e.$.editableElement,r=i.querySelector(`[drag-id="${n.getAttribute("drag-id")}"]`);if(r){const n=o.anchor;if(r.removeAttribute("drag-id"),a&&!a.contains(r)&&r.parentElement){const e=o.caption;let t=r.parentElement;if(t.classList.contains("smart-editor-video-container")){const e=t;t=t.parentElement,e.remove(),t.appendChild(r)}a.remove(),a.innerHTML="",t.insertBefore(a,r),a.appendChild(r),e&&a.appendChild(e)}n&&r.parentElement!==n&&(n.innerHTML="",r.parentElement.insertBefore(n,r),n.appendChild(r)),void 0!==o.scrollTop&&(i.scrollTop=o.scrollTop),requestAnimationFrame((()=>e._setResizeFrame(r)));const l=e._resizeFrameObj;if(e._editorVideoItemClick){const t=i.querySelectorAll('.smart-editor-video-white-space, div[pseudo="-webkit-media-controls"]');for(let e=0,o=t.length;e<o;e+=1)t[e].remove();delete e._editorVideoItemClick}(!t||t&&!t.visible)&&l&&l.target&&e._openInlineToolbar(l.target)}return void delete e._dragDetails}e._setSelectionRange();const n=e._getSelectionRange();n&&n.startOffset!==n.endOffset&&(e._handleInlineToolbar(n.startContainer),e._focusEditableElement())}_documentUpHandler(e){const t=this,o=t._resizeFrameObj,n=t.$.inlineToolbar,a=e.originalEvent||e,i=t.shadowRoot||t.isInShadowDOM?a.composedPath()[0]:a.target;if(o&&(o.resizeDetails&&o.target&&(o.target.removeAttribute("dragged"),t.$.fireEvent("resizeEnd",{target:o.target})),delete o.resizeDetails),t._dragDetails)return t._endInlineToolbarClick(),void delete t._toolbarItemClick;const r=t.$.iframe;if(t.$.container.contains(i)||n&&n.contains(i)||r&&r.contentDocument.body.contains(i)){const e=i.closest(".smart-editor-toolbar-item");e?t._handleToolbarUp(e):t._handleContentUp(a,i)}t._endInlineToolbarClick(),delete t._searchBarDown,delete t._dragDetails,delete t._toolbarItemClick}_handleToolbarUp(e){const t=this,o=t._toolbarItemClick,n=e.getAttribute("item-type");if(o&&o.toolbarItem===e){const e=o.toolbarItem;"custom"!==n&&(t._handleToolbarItemClick(event,e),t._focusEditableElement())}}_handleContentUp(e,t){const o=this,n=o._inlineToolbarClickObj,a=o.$.toolbarToggleButton,i=o._editorVideoItemClick,r=void 0!==e.button&&2===e.button;if(r||t!==a&&!a.contains(t))if(t.classList.contains("smart-editor-toolbar-tab"))o.$.toolbar.hasAttribute("expanded")?t.hasAttribute("checked")||o._selectToolbarTab(t):(o._selectToolbarTab(t),o._toggleSecondaryToolbar(t.hasAttribute("checked")));else if(i&&t.classList.contains("smart-editor-video-container")&&t===i.target)o._setResizeFrame(t),o._focusEditableElement();else if(n){const e=n.target;e&&(e===t||e.contains(t))&&(r?o._setResizeFrame(e):o._handleInlineToolbar(e),o._focusEditableElement())}else if(!r&&(o.$.editableElement.contains(t)||"markdown"===o.editMode&&t===o.$.input)){const e=o.$.iframe,t=e?e.contentWindow:window;requestAnimationFrame((()=>{e&&o._setSelectionRange();const n=o._getSelectionRange();if(n instanceof t.Range){let e=n.startContainer;n.startOffset!==n.endOffset&&(o._handleInlineToolbar(e),o._focusEditableElement())}}))}else!r&&t.closest(".smart-editor-search-bar")&&o._handleSearchButtonClick(t.closest(".smart-search-button"));else o._toggleToolbar(o.$.toolbar.hasAttribute("expanded"))}_toggleSecondaryToolbar(e){const t=this,o=t.$.toolbar,n=t.$.toolbarItemsPrimary,a=t.$.toolbarItemsSecondary,i=()=>{o.hasAttribute("expanded")?(a.classList.remove("smart-drop-down"),o.contains(a)||o.appendChild(a),a.style.top=""):(a.classList.add("smart-drop-down"),o.contains(a)&&o.parentElement.insertBefore(a,o.nextElementSibling),a.style.top=n.offsetTop+n.offsetHeight+"px")};if(!e&&(a.classList.add("smart-visibility-hidden"),t.hasAnimation))return a.addEventListener("transitionend",i,{once:!0}),void a.addEventListener("transitioncancel",i,{once:!0});i(),e&&(t._setToolbarGroupHeight(),a.classList.remove("smart-visibility-hidden"))}_setToolbarGroupHeight(){const e=this.$.toolbarItemsSecondary,t=e.children;if(e.style.height="","menu"===this.toolbarMode)return;let o;for(let e=0,n=t.length;e<n;e+=1){const n=t[e].offsetHeight;(void 0===o||o<n)&&(o=n)}void 0!==o&&(e.style.height=o+"px")}_endInlineToolbarClick(){const e=this,t=e._inlineToolbarClickObj;if(t){const o=t.resizeDetails;if(!e._dragDetails&&t.target&&(t.target.removeAttribute("drag-id"),t.dragElement&&t.dragElement.removeAttribute("drag-id")),o&&o.target){if("horizontal"===o.position){const e=o.cells,t=o.table.offsetWidth;e&&e.forEach((e=>{e.style.width&&(e.style.width=100*parseFloat((e.offsetWidth/t).toFixed(2))+"%")}))}e.$.editableElement.removeAttribute("table-cell-resize"),o.target.removeAttribute("resizing"),o.isInlineToolbarOpened&&e._handleInlineToolbar(o.target)}delete e._inlineToolbarClickObj}}_updateToolbarItems(e,t){const o=this;if(o._dragDetails||o.readonly||o.disabled)return;if("markdown"===o.editMode)return void o._updateToolbarItemsMarkdown(e);const n=o._getSelectionRange(),a=o.$.inlineToolbar;let i,r;if(!n)return;if(t||(t=o.$.toolbar),a&&t!==a&&!o.hideInlineToolbar&&a.visible&&(o._updateToolbarItems(e,a),i=!0),t!==o.$.toolbar||o.hideToolbar?i||o.hideInlineToolbar||(r=o._inlineToolbarItemsObj):r=o._toolbarItemsObj,!r)return;const l=o.$.editableElement;let s,d=n.startOffset>n.endOffset?n.endContainer:n.startContainer;if(d&&(d.closest||(d=d.parentElement),d&&d.closest)){e||(e=["alignment","bold","italic","strikethrough","underline","fontsize","fontname","formats","fontcolor","backgroundcolor","orderedlist","unorderedlist","subscript","superscript"]);for(let n=0,a=e.length;n<a;n+=1){const a=e[n],i=r[a];if(i){let e;if("alignment"===a)e=d.style.textAlign;else if("bold"===a)e=!!o._getNodeFromList(d,["b","strong","h1","h2","h3","h4","h5","h6"]);else if("italic"===a)e=!!o._getNodeFromList(d,["i"]);else if("underline"===a)e=!!o._getNodeFromList(d,["u"]);else if("strikethrough"===a)e=!!o._getNodeFromList(d,["strike"]);else if("fontsize"===a){const t=d.closest(".smart-editor-editable font");t&&(e=t.style.fontSize),e||(s||(s=window.getComputedStyle(d)),e=s.fontSize),e=parseInt(e),isNaN(e)&&(e="")}else if("fontname"===a){const t=d.closest(".smart-editor-editable font");t&&t.hasAttribute("face")?e=t.getAttribute("face"):(s||(s=window.getComputedStyle(d)),e=s.fontFamily.split(",")[0])}else if("formats"===a&&d!==l){const t=i.dataSource;if(e="",t){const n=t.map((e=>e.value));e=o._getNodeFromList(d,n)||""}}else if("fontcolor"===a){const t=d.closest(".smart-editor-editable font");t?e=t.color:(s||(s=window.getComputedStyle(d)),e=s.color)}else"backgroundcolor"===a?(e=o._getNodeBackgroundColor(d),e||(s||(s=window.getComputedStyle(d)),e=s.backgroundColor)):"orderedlist"===a||"unorderedlist"===a?e=!!d.closest(`.smart-editor-editable ${"orderedlist"===a?"ol":"ul"} li`):"subscript"===a?e=!!d.closest(".smart-editor-editable sub"):"superscript"===a&&(e=!!d.closest(".smart-editor-editable sup"));if(!e&&i.dataSource){const t=i.dataSource[0];t&&(e=t.value||t)}null!==e&&(i.value=e,o._setItemValue(t.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),i))}}}}_updateToolbarItemsMarkdown(e){const t=this,o=t._getSelectionRange();if(!o||void 0===o.selectionStart)return;const n=o.selectionStart;e||(e=["bold","italic","strikethrough","underline","formats","orderedlist","unorderedlist","subscript","superscript"]);for(let o=0,a=e.length;o<a;o+=1){const a=e[o],i=t._toolbarItemsObj[a];if(i){let e;if("bold"===a)e=!!t._getMarkdownItem(n,"**"),e||(e=!!t._getMarkdownItem(n,"__"));else if("italic"===a)e=!!t._getMarkdownItem(n,"*"),e||(e=!!t._getMarkdownItem(n,"_"));else if("strikethrough"===a)e=!!t._getMarkdownItem(n,"~~");else if("underline"===a)e=!!t._getMarkdownItem(n,"<ins>","</ins>");else if("formats"===a){const o=i.dataSource;if(e="",o){const a=o.map((e=>e.value));e:for(let o=0,i=a.length;o<i;o+=1)if(e=t._getMarkdownFormat(n,a[o]),e&&void 0!==e.formatName){e=e.formatName;break e}}}else"orderedlist"===a||"unorderedlist"===a?e=!!t._getMarkdownFormat(n,a):"subscript"===a?e=!!t._getMarkdownItem(n,"<sub>","</sub>"):"superscript"===a&&(e=!!t._getMarkdownItem(n,"<sup>","</sup>"));if(!e&&i.dataSource){const t=i.dataSource[0];t&&(e=t.value||t)}null!==e&&(i.value=e,t._setItemValue(t.$.toolbar.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),i))}}}_getMarkdownItem(e,t,o=t){const n=this.$.input.value,a=n.lastIndexOf(t,Math.max(0,e-1)),i=n.indexOf(o,a>-1?a+t.length:e);if(!(a<0||a>e||i<0||i<e||n.slice(a,e).indexOf("\n")>-1||n.slice(e,i).indexOf("\n")>-1))return" "!==n[a+1]&&n[a-1]!==t&&n[a+1]!==t&&" "!==n[i-1]&&n[i-1]!==t&&n[i+1]!==t?{startIndex:a,endIndex:i+o.length}:void 0}_getMarkdownFormat(e,t){const o=this.$.input.value,n=o.lastIndexOf("\n",Math.max(0,e-1))+1,a=o.slice(n,e);let i;switch(t){case"h1":i="# ";break;case"h2":i="## ";break;case"h3":i="### ";break;case"h4":i="#### ";break;case"h5":i="##### ";break;case"h6":i="###### ";break;case"code":case"pre":i="```";break;case"blockquote":i="> ";break;case"orderedlist":{const e=/^\s*([0-9]+\.{1}\s+)/gs.exec(a);return e?{formatName:t,occuranceIndex:n+e.input.indexOf(e[1])}:void 0}case"unorderedlist":{const e=/^\s*([-+*]{1}\s+)/gs.exec(a);return e?{formatName:t,occuranceIndex:n+e.input.indexOf(e[1])}:void 0}default:i=t+""}const r=a.indexOf(i);if(r>=0&&r<=3&&a.slice(r,i.length)===i)return{formatName:t,occuranceIndex:n+r,markdown:i}}_getNodeFromList(e,t){const o=this.$.editableElement;if(e&&t)for(;e&&e!==o;){const o=e.nodeName.toLocaleLowerCase();if(t.indexOf(o)>-1)return o;e=e.parentElement}}_getNodeBackgroundColor(e){const t=this.$.editableElement;for(;e&&e!==t;){const t=e.style.backgroundColor;if(t)return t;e=e.parentElement}}_editableElementBlurHandler(e){const t=this,o=t.$.editableElement,n=t.$.contentContainer;if(!t._toolbarItemClick&&!n.contains(n.getRootNode().activeElement)){const a=t._value,i=()=>{n.removeAttribute("required"),t._requiredMessage&&(t.hideMessage(t._requiredMessage),delete t._requiredMessage)},r=t._getCurrentValue();if(t.required){const e=t.$.editableElement;"markdown"===t.editMode&&!t.$.input.value||"markdown"!==t.editMode&&!e.textContent&&!e.querySelectorAll("img, table").length?(n.hasAttribute("required")||n.setAttribute("required",""),t._requiredMessage||(t._requiredMessage=t.showMessage(t.localize("requiredMessage"),{autoClose:!1,iconType:"error"}))):i()}else i();a!==r&&(t.$.fireEvent("change",{oldValue:a,value:r}),t.name&&e.target===o&&"markdown"!==t.editMode&&(t.$.input.value=t._getInputValue(o.innerHTML.trim()))),t.removeAttribute("focus"),t.removeAttribute("aria-activedescendant")}}_editableElementFocusHandler(e){const t=this,o=t.editMode,n="markdown"===o?t.$.input:t.$.editableElement;let a=t._autoSaveObj;t.setAttribute("focus",""),e.target.id&&t.setAttribute("aria-activedescendant",e.target.id),t._value=t._getCurrentValue(),t.autoSave?(a||(a=t._autoSaveObj={}),clearInterval(a.interval),a.interval=setInterval((()=>{n.getRootNode().activeElement!==n&&clearInterval(a.interval),window.localStorage.setItem("smartEditor"+t.id,"markdown"===o?n.value:n.innerHTML)}),t.autoSaveInterval)):a&&(clearInterval(a.interval),delete t._autoSaveObj)}_inputChangeEvent(e){e.stopPropagation()}_updateOnInputChange(e){const t=this,o=t.$.editableElement,n=e.target,a=t.$.input,i=n.classList.contains("smart-search-input"),r=()=>{const e=l===a?a.value:t.$.editableElement.innerHTML;void 0!==s&&e!==s&&t.$.fireEvent("changing",{value:e,oldValue:t._changingValue})};if("paste"===e.type&&o.contains(n)){const o=e.clipboardData;if(o&&o.types.length){const n=o.types.indexOf("text/html")>-1?"text/html":"text/plain",[a,i]=["\x3c!--StartFragment--\x3e","\x3c!--EndFragment--\x3e"];let r=o.getData(n);e.preventDefault(),r.indexOf(a)>-1&&r.indexOf(i)>-1&&(r=r.slice(r.indexOf(a),r.indexOf(i))),t._handlePasteAction(r,{advanced:!0,value:t.pasteFormat},n)}}const l=o.getRootNode().activeElement,s=t._changingValue;if(!t.$.contentContainer.hasAttribute("split-mode")){if(clearTimeout(t._refreshTimeout),delete t._refreshTimeout,i){const o=t.findAndReplaceTimeout,n=e.key;if(clearTimeout(t._findAndReplaceTimeout),!n||"enter"===n.toLowerCase())return;return void(o?t._findAndReplaceTimeout=setTimeout((()=>t._applySearching(e.target.value)),o):t._applySearching(e.target.value))}const o=t._resizeFrameObj?t._resizeFrameObj.target:void 0;return o&&!o.parentElement&&(t._setResizeFrame(),t._closeToolbar()),void r()}r(),clearTimeout(t._refreshTimeout);let d=t.$.input.value;t._refreshTimeout=setTimeout((()=>{clearTimeout(t._refreshTimeout),"markdown"===t.editMode?t.$.editableElement.innerHTML=window.marked?window.marked(d):d:l===a?t.$.editableElement.innerHTML=t._getInputValue(d,!0):t.$.input.value=t._getInputValue(t.$.editableElement.innerHTML.trim())}),t.splitModeRefreshTimeout)}_editableElementWheelHandler(){const e=this.$.inlineToolbar;this._setResizeFrame(),e&&e.visible&&e.close()}_editableElementKeyDownHandler(e){const t=this,o=t.$.editableElement,n=t.$.input,a=e.target.getRootNode().activeElement,i=e.key.toLowerCase(),r=t._isMacOS&&e.metaKey||e.ctrlKey;if(!t.disabled&&!t.readonly){switch(i){case"a":if(!r){t._changingValue=a===o?o.innerHTML:n.value;break}if(a.classList.contains("smart-editor-image-caption"))return e.preventDefault(),t._setSelectionRange(a),void t._handleInlineToolbar(t._getSelectionRange().startContainer);if(t._tableCell)return e.preventDefault(),t._setSelectionRange(t._tableCell),void t._handleInlineToolbar(t._getSelectionRange().startContainer);break;case"backspace":case"delete":{const i=t._resizeFrameObj?t._resizeFrameObj.target:void 0;i&&("img"===i.nodeName.toLowerCase()||i.classList.contains("smart-editor-video-container"))&&(e.preventDefault(),t._deleteResizeFrameTarget(i)),t._changingValue=a===o?o.innerHTML:n.value;break}case"enter":if(!t.disableSearchBar){const o=t._searchToolbar;o&&!o.classList.contains("smart-visibility-hidden")&&(e.preventDefault(),t._highlightSearchResult(!e.shiftKey))}break;case"escape":a===o?t._closeToolbar():a.classList.contains("smart-search-input")&&t._closeSearchToolbar();break;case"tab":t.enableTabKey&&(e.preventDefault(),t._handleTabInsert());break;default:t._handleToolbarShortcuts(e,a)}t._closeToolbar()}}_handleToolbarShortcuts(e,t){const o=this,n=o.$.editableElement,a=o.$.input,i=e.key,r=o._isMacOS&&e.metaKey||e.ctrlKey;if(!r)return void(o._changingValue=t===n?n.innerHTML:a.value);const l=o._resizeFrameObj;let s;switch(l&&l.target&&(s=l.target),i.toLocaleLowerCase()){case"b":e.preventDefault(),o._handleTextDecorations("bold");break;case"c":r&&s&&o._handleImageCopy(s);break;case"x":r&&s&&o._handleImageCut(s);break;case"k":e.preventDefault(),o._openWindow({name:"hyperlink"});break;case"i":e.shiftKey?(e.preventDefault(),o._openWindow({name:"image"},s)):(e.preventDefault(),o._handleTextDecorations("italic"));break;case"e":e.shiftKey?(e.preventDefault(),o._openWindow({name:"table"},s)):(e.preventDefault(),o._updateToolbarTarget({name:"alignment",value:"center"}));break;case"u":e.shiftKey?(e.preventDefault(),o._handleTextCase("uppercase")):(e.preventDefault(),o._handleTextDecorations("underline"));break;case"s":e.shiftKey&&(e.preventDefault(),o._handleTextDecorations("strikethrough"));break;case"l":e.shiftKey?(e.preventDefault(),o._handleTextCase("lowercase")):(e.preventDefault(),o._updateToolbarTarget({name:"alignment",value:"left"}));break;case"+":e.shiftKey&&(e.preventDefault(),o._handleSubSuperScript("superscript"));break;case"=":e.shiftKey?(e.preventDefault(),o._handleSubSuperScript("superscript")):(e.preventDefault(),o._handleSubSuperScript("subscript"));break;case"]":e.preventDefault(),o._handleIndentation("indent");break;case"[":e.preventDefault(),o._handleIndentation("outdent");break;case"h":if(e.shiftKey){const t=o._toolbarItemsObj.sourcecode;t&&(t.value=void 0===t.value||!t.value),e.preventDefault(),o._handleSourceCodeMode()}break;case"f":if(e.shiftKey){const t=o._toolbarItemsObj.fullscreen;t&&(t.value=void 0===t.value||!t.value),e.preventDefault(),o._handleFullScreenMode()}else!r||o.disableSearchBar||"html"!==o.editMode||n.classList.contains("smart-hidden")||(e.preventDefault(),o._openSearchBar());break;case"j":e.preventDefault(),o._updateToolbarTarget({name:"alignment",value:"justify"});break;case"r":e.shiftKey?(e.preventDefault(),o._handleClearFormat()):(e.preventDefault(),o._updateToolbarTarget({name:"alignment",value:"right"}));break;case"o":e.shiftKey?(e.preventDefault(),o._handleList("orderedlist")):e.altKey&&(e.preventDefault(),o._handleList("unorderedlist"))}}_editableElementMoveHandler(e){const t=this,o=t.$.editableElement,n=e.originalEvent||e,a=n.clientX,i=n.clientY,r=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(e.stopPropagation(),!r||!r.closest||t._isMobile||"false"===o.getAttribute("contenteditable"))return void o.removeAttribute("table-cell-resize");const l=t._inlineToolbarClickObj;if(l&&l.resizeDetails||t._dragDetails)return;const s=r.tagName.toLowerCase();if(!r.closest(".smart-editor-editable table")||"td"!==s&&"th"!==s)return void o.removeAttribute("table-cell-resize");const d=r.getBoundingClientRect();i<d.bottom+5&&i>d.bottom-5?o.setAttribute("table-cell-resize","vertical"):a<d.right+5&&a>d.right-5&&r.nextElementSibling?o.setAttribute("table-cell-resize","horizontal"):o.removeAttribute("table-cell-resize")}_focusEditableElement(){const e=this,t=e.$.iframe,o=e.editMode;let n=e.$.editableElement;if(("markdown"===o||n.classList.contains("smart-hidden"))&&(n=e.$.input),t&&t.focus({preventScroll:!0}),n.getRootNode().activeElement!==n){const a=e._getSelectionRange(),i=n.scrollTop,r=t?t.contentWindow:window;if(n.focus({preventScroll:!0}),e._isSafari&&i&&(n.scrollTop=i),"markdown"===o||n.classList.contains("smart-hidden"))return void(void 0!==a.selectionStart&&e._setSelectionRange(a.selectionStart,a.selectionEnd));if(a instanceof r.Range){const e=(t?t.contentWindow:window).getSelection();e.removeAllRanges(),e.addRange(a)}}}_getTextFromCarret(){const e=this._getSelectionRange(),t=e.startContainer,o=t.textContent;let n,a;if(!e.toString()&&o.length>0&&o.indexOf(" ")>-1){const t=o.slice(0,e.startOffset).lastIndexOf(" ")+1;let i=o.slice(e.endOffset).indexOf(" ");i<0&&(i=o.length-1),n=t>-1?t:e.startOffset,a=Math.max(e.endOffset,e.endOffset+i)}else n=0,a=t.length;return{selectionStartIndex:n,selectionEndIndex:a}}_handleSearchButtonClick(e){const t=this;if(!e)return;const o=e.classList;o.contains("smart-search-button")&&(o.contains("prev")?t._highlightSearchResult():o.contains("next")?t._highlightSearchResult(!0):o.contains("close")&&t._closeSearchToolbar())}_highlightSearchResult(e){const t=this,o=t.$.contentContainer,n=t.$.editableElement.querySelectorAll(".find-and-replace-match"),a=o.querySelector(".smart-search-input-container"),i=n.length;for(let o=0,r=i;o<r;o+=1){const r=n[o];if(r.classList.contains("selected")){const l=e?Math.min(i-1,o+1):Math.max(0,o-1),s=n[l];return s&&(s.classList.add("selected"),a.setAttribute("selected",l+1),t._scrollToMarker(s)),void(s!==r&&r.classList.remove("selected"))}}}_handleToolbarItemClick(e,t){const o=this;if(!t)return;const n=o.$.inlineToolbar,a=o._toolbarItemClick,i=t.getAttribute("item-type"),r=t.getAttribute("item-name");let l,s;if(e&&(l=e.originalEvent||e,s=o.shadowRoot||o.isInShadowDOM?l.composedPath()[0]:l.target),"custom"!==i&&l&&(o.hasRippleAnimation&&"delimiter"!==i&&Smart.Utilities.Animation.Ripple.animate(s,l.pageX,l.pageY),a&&a.callback))return a.callback.call(o,t,a.target),void o.$.fireEvent("toobarItemClick",{value:r,originalEvent:l});o.$.fireEvent("actionStart",{name:r}).defaultPrevented||(o._handleToolbarItemAction(t),o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup),n&&n.close(),l&&o.$.fireEvent("toobarItemClick",{value:r,originalEvent:l}),r&&o.$.fireEvent("actionEnd",{name:r}))}_handleToolbarItemAction(e){const t=this,o=t._toolbarItemClick;if(!e)return;const n=e.getAttribute("item-type"),a=e.getAttribute("item-name");if("custom"!==n)switch(a){case"bold":case"italic":case"underline":case"strikethrough":t._handleTextDecorations(a);break;case"clearformat":t._handleClearFormat();break;case"redo":case"undo":t._handleUndoRedo(a);break;case"lowercase":case"uppercase":t._handleTextCase(a);break;case"backgroundcolor":t._handleBackgroundColor(e.getAttribute("item-value"));break;case"fontcolor":t._handleFontColor(e.getAttribute("item-value"));break;case"findandreplace":case"editlink":t._openWindow(e);break;case"openlink":{const o=t.$.inlineToolbar;if(o&&o.contains(e)){const e=o.selector;let t;e.nodeName!==Node.TEXT_NODE&&(t=e.closest(".smart-editor-editable a")),t&&window.open(t.href,t.target)}break}case"caption":{if(!o)break;const e=o.target;if(e&&"img"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-image-container");let n;o&&o.querySelector(".smart-editor-image-caption")||(n=t.localize("captionPlaceholder")),t._handleImgCaption(e,{caption:n,focusCaption:!0})}else if(e.classList.contains("smart-editor-video-container")){const o=e.querySelectorAll(".smart-editor-video-container > video, .smart-editor-video-container > iframe");let n;e.querySelector(".smart-editor-image-caption")||(n=t.localize("captionPlaceholder")),t._handleVideoCaption(o[0]||o[1],{caption:n,focusCaption:!0})}break}case"cut":case"copy":case"paste":t._handleClipboardAction(a);break;case"delete":t._resizeFrameObj&&t._resizeFrameObj.target?t._deleteResizeFrameTarget(o.target):t._handleTextDelete();break;case"removelink":o&&t._handleLinkRemove(o.target);break;case"tableheader":case"tablerows":case"tablecolumns":case"tablevalign":case"tablestyle":t._handleTableToolbarAction(e);break;case"sourcecode":t._handleSourceCodeMode(e);break;case"splitmode":t._handleSplitMode(e);break;case"fullscreen":t._handleFullScreenMode(e);break;case"orderedlist":case"unorderedlist":t._handleList(a);break;case"indent":case"outdent":t._handleIndentation(a);break;case"subscript":case"superscript":t._handleSubSuperScript(a);break;case"print":t._handlePrint();break;default:t._inlineToolbarItemsObj?t._updateEditorViaWindow(t._inlineToolbarItemsObj[a]):t._toolbarItemsObj&&t._updateEditorViaWindow(t._toolbarItemsObj[a])}}_handleCommonToolbarAction(e,t){const o=this;if("html"===o.editMode){const n=o._getSelectionRange(),a=o.$.iframe,[i,r]=a?[a.contentDocument,a.contentWindow]:[document,window];let l,s=n.startContainer;if(!s)return;const d=e=>"string"==typeof e?("removeFormat"===e&&o.removeStylesOnClearFormat&&o._removeNodeStyles(n.commonAncestorContainer),i.execCommand(e)):"object"==typeof e?i.execCommand(e.name,!1,e.value):void 0;if(n.startOffset===n.endOffset&&s.nodeType===Node.TEXT_NODE){const{selectionStartIndex:e,selectionEndIndex:t}=o._getTextFromCarret();l=n.startOffset-e,o._setSelectionRange(s,e,t)}d(e)&&void 0!==l&&o._setSelectionRange(r.getSelection().focusNode,l,l),t&&o._updateToolbarItems(t)}}_handleClearFormat(){this._handleCommonToolbarAction("removeFormat")}_handleFontName(e){this._handleCommonToolbarAction(e)}_handleFontSize(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange();let n,a=o.startContainer;if(a){if(o.startOffset===o.endOffset){if(a.nodeType!==Node.TEXT_NODE){const n=document.createElement("font");return o.insertNode(n),t._setSelectionRange(n),void(n.style.fontSize=e.value+"px")}{const{selectionStartIndex:e,selectionEndIndex:i}=t._getTextFromCarret();n=o.startOffset-e,t._setSelectionRange(a,e,i)}}if((t.$.editableElement.getRootNode()||document).execCommand("fontSize",!1,3)){const a=t.$.iframe,i=a?a.contentWindow:window;if(o.commonAncestorContainer.closest){const t=o.commonAncestorContainer.querySelectorAll("font[size]");for(let o=0,n=t.length;o<n;o+=1){const n=t[o];n.removeAttribute("size"),n.style.fontSize=e.value+"px"}}else{const t=i.getSelection().focusNode;if(!t)return;const o=t.closest?t.closest(".smart-editor-editable font"):t.parentElement;"font"===o.nodeName.toLowerCase()&&(o.removeAttribute("size"),o.style.fontSize=e.value+"px")}void 0!==n&&t._setSelectionRange(i.getSelection().focusNode,n,n)}}}_handleFormats(e){const t=this;if("markdown"!==t.editMode)t._getSelectionRange().startContainer&&t.$.editableElement.getRootNode().execCommand("formatBlock",!1,e.value);else{let o;switch(e.value){case"h1":o="#";break;case"h2":o="##";break;case"h3":o="###";break;case"h4":o="####";break;case"h5":o="#####";break;case"h6":o="######";break;case"code":case"pre":o="```\n\n```";break;case"blockquote":o=">";break;case"p":o="";break;default:o=e.value}const n=e.dataSource,a=t.$.input.selectionStart;if(n){const e=n.map((e=>e.value));for(let o=0,n=e.length;o<n;o+=1){const n=t._getMarkdownFormat(a,e[o]);if(n&&void 0!==n.formatName){t._removeMarkDown(n.markdown,n.occuranceIndex,!0);break}}}0===o.indexOf("#")||0===o.indexOf(">")?(o+=" ",t._insertMarkDown(o,t.$.input.selectionStart+o.length,!0)):t._insertMarkDown(o,t.$.input.selectionStart+o.length/2)}}_handleSubSuperScript(e){const t=this;"markdown"!==t.editMode?t._handleCommonToolbarAction(e,["subscript","superscript"]):t._handleMarkdownItem(e)}_handleMarkdownItem(e){const t=this,o=t.$.input,n=t._getSelectionRange(),a=n.selectionStart,i=n.selectionEnd;let r,l,s,d=o.value;switch(e){case"bold":l="**",s="**";break;case"italic":l="*",s="*";break;case"underline":l="<ins>",s="</ins>";break;case"strikethrough":l="~~",s="~~";break;case"subscript":l="<sub>",s="</sub>";break;case"superscript":l="<sup>",s="</sup>"}if(void 0!==a&&a!==i){const e=l.length,n=s.length;if(r=d.slice(a,i),d.slice(a-e,a)===l&&d.slice(i,i+n)===s)return o.value=d.slice(0,a-e)+r+d.slice(i+n),t._refreshMarkdownPreview(),void t._setSelectionRange(o,a-e,i-e)}l&&s&&t._insertMarkDown(l+s,o.selectionStart+l.length)}_handleTextDecorations(e){const t=this;if("markdown"===t.editMode)return void t._handleMarkdownItem(e);const o=t._getSelectionRange();let n,a=o.startContainer;if(a){if(o.startOffset===o.endOffset&&a.nodeType===Node.TEXT_NODE){const{selectionStartIndex:e,selectionEndIndex:i}=t._getTextFromCarret();n=o.startOffset-e,t._setSelectionRange(a,e,i)}if((t.$.editableElement.getRootNode()||document).execCommand(e))if(void 0!==n){const e=t.$.iframe,o=e?e.contentWindow:window,a=o.getSelection().focusNode;a.textContent=a.textContent.trim(),t._setSelectionRange(o.getSelection().focusNode,n,n)}else t._setSelectionRange();t._updateToolbarItems([e])}}_handlePasteAction(e,t,o){if(!e)return;const n=this;if(t&&!t.name&&"prompt"===n.pasteFormat){const a={name:"paste",text:e,textType:o};return t&&(a.value=t.value,a.advanced=t.advanced),void n._openWindow(a)}n._handleTextPaste(e,t,o)}_handleTextPaste(e,t,o){const n=this,a=n.$.input;if(n.$.contentContainer.classList.contains("char-count-maxed"))return;if("markdown"===n.editMode)return n._insertMarkDown(e),void n._setCharCount();e=e.replace(/<!--StartFragment-->|<!--EndFragment-->/gi,"");let i,r,l=n.pasteFormat;if(t&&t.advanced&&(l=t.value),!o||"plainText"===l){const t=document.createElement("div");t.innerHTML=e,e=t.innerText}const s=e.toLocaleLowerCase();if(i=document.createElement("span"),i.innerHTML=e,s.indexOf("<video")>-1||s.indexOf("<iframe")>-1||s.indexOf("smart-editor-image-caption")>-1){const e=i.querySelectorAll("video, iframe"),t=i.querySelector(".smart-editor-image-caption"),o=e.length>0;let n=document.createDocumentFragment();for(let t=0,o=e.length;t<o;t+=1)n.appendChild(e[t]);if(t&&(t.removeAttribute("style"),n.appendChild(t)),o||t){const e=document.createElement("span");i.classList.add("smart-editor-image-container"),o&&i.classList.add("smart-editor-video-container"),i.setAttribute("contenteditable",!1),n.childElementCount&&(i.innerHTML="",i.appendChild(n)),e.appendChild(i),i=e}}if("cleanFormat"===l&&n._removeNodeStyles(i),o&&"text/plain"!==o||(i=document.createTextNode(i.innerHTML),r=Node.TEXT_NODE),a.getRootNode().activeElement===a){const e=a.value;return a.value=e.slice(0,a.selectionStart)+(r===Node.TEXT_NODE?i.textContent:i.innerHTML)+e.slice(a.selectionEnd),void n._setCharCount()}const d=n._getSelectionRange(),c=n.$.iframe,[m,u]=c?[c.contentWindow,c.contentDocument]:[window,document];if(!(d instanceof m.Range))return u.execCommand("paste"),void n._handleContentFiltering();if(d.deleteContents(),i.childNodes.length)for(;i.lastChild;)d.insertNode(i.lastChild);else d.insertNode(i);d.collapse(),n._handleContentFiltering()}_removeNodeStyles(e){if(e&&e.nodeType!==Node.TEXT_NODE){const t=e.querySelectorAll("style, [style]");for(let e=0,o=t.length;e<o;e+=1){const o=t[e];"style"===o.nodeName.toLowerCase()?o.remove():t[e].removeAttribute("style")}e.removeAttribute("style")}}_handlePaste(e){const t=this,o=navigator.clipboard,n=o.read?"read":"readText",a=()=>{o[n]&&o[n]().then((o=>{if(Array.isArray(o)&&o.length){const n=o[0],a=n.types.indexOf("text/html")>-1?"text/html":"text/plain";n.getType(a).then((o=>{o.text().then((o=>t._handlePasteAction(o,e,a)))}))}else"string"==typeof o&&t._handlePasteAction(o,e)}))};if(navigator.permissions&&navigator.permissions.query&&!t._isFireFox)try{navigator.permissions.query({name:"clipboard-read"}).then((e=>{("granted"===e.state||"prompt"===e.state&&o[n])&&a()}))}catch(e){t.error(t.localize("permissionsRequired",{elementType:t.nodeName.toLowerCase(),actionName:"paste"}))}else if(o[n])return void a();t.$.editableElement.getRootNode().execCommand("paste")}_handlePasteViaWindow(e){const t=this,o=t._getItemOptionsViaWindow(e);if(!e||"paste"!==e.name)return;let n=t.pasteFormat;for(let e in o)if(o[e]){n=e;break}e.value=n,t._handleTextPaste(e.text,e,e.textType)}_handleClipboardAction(e){const t=this,o=t.editMode,n=t.$.input;if("paste"===e)return void t._handlePaste();const a=t._getSelectionRange();if(("copy"===e||"cut"===e)&&(document.execCommand("copy"),"cut"===e))if("markdown"===o){const e=n.value,o=n.selectionStart;n.value=e.slice(0,o)+e.slice(n.selectionEnd),t._setSelectionRange(n,o,o),t._refreshMarkdownPreview()}else a.deleteContents()}_handleLinkRemove(e){const t=this;let o;if(e&&"img"===e.nodeName.toLowerCase())o=e.closest(".smart-editor-editable a"),o&&(o.parentElement.insertBefore(e,o),o.remove());else{const e=t.$.iframe;let o,n;e?(o=e.contentDocument,n=e.contentWindow):(o=document,n=window);const a=n.getSelection(),i=t._getSelectionRange();a.removeAllRanges(),a.addRange(i);const r=a.anchorNode?a.anchorNode.parentElement:void 0;if(!r||"a"!==r.nodeName.toLowerCase())return;i.selectNode(a.anchorNode),o.execCommand("unlink",!1,!1)}}_handleBackgroundColor(e){const t=this;if("markdown"===t.editMode)return;const o=t.$.iframe,n="string"==typeof e?e:e.value,[a,i]=o?[o.contentDocument,o.contentWindow]:[document,window],r=t.$.inlineToolbar,l=t._getSelectionRange(),s=r&&r.visible?r.selector:l.commonAncestorContainer;let d;if(s&&["th","td"].indexOf(s.nodeName.toLowerCase())>-1){if(l.startOffset===l.endOffset)return void(s.style.backgroundColor=n);d=s.style.backgroundColor}const c=l.startOffset,m=l.endOffset,u=l.startContainer;let b;if(u&&u.nodeType===Node.TEXT_NODE&&l.startOffset===l.endOffset){const{selectionStartIndex:e,selectionEndIndex:o}=t._getTextFromCarret();b=l.startOffset-e,t._setSelectionRange(u,e,o)}else u.closest&&c!==m&&t._setSelectionRange(u,c,m);const p=a.execCommand("hiliteColor",!1,n&&"transparent"!==n?n:"transparent");s&&d?s.style.backgroundColor=d:p&&void 0!==b&&t._setSelectionRange(i.getSelection().focusNode,b,b)}_handleFontColor(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange(),n="string"==typeof e?e:e.value,a=o.startContainer,i=t.$.iframe,r=n?"foreColor":"removeFormat",[l,s]=i?[i.contentDocument,i.contentWindow]:[document,window];let d;if(a&&a.nodeType===Node.TEXT_NODE&&o.startOffset===o.endOffset){const e=a.parentElement;if("font"===e.nodeName.toLocaleLowerCase())return void(e.color=n);const{selectionStartIndex:i,selectionEndIndex:r}=t._getTextFromCarret();d=o.startOffset-i,t._setSelectionRange(a,i,r)}l.execCommand(r,!1,n)&&void 0!==d&&t._setSelectionRange(s.getSelection().focusNode,d,d)}_handlePrint(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const o=window.open("","","width=800,height=500"),n=o.document.open(),a='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>'+t+"</title></head><body>"+e._handleDataExport("html")+"</body></html>";try{n.write(a),n.close(),setTimeout((function(){o.print(),o.close()}),100)}catch(e){}e.dataExport.fileName=t}_handleDataExport(e,t){const o=this;if(!Smart.Utilities.DataExporter)return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"smart.export.js"}));try{new JSZip}catch(e){return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"jszip.min.js"}))}if("pdf"===e&&!window.pdfMake)return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"pdfMake.min.js"}));if("pdf"===e)return void o._exportToPDF(o.dataExport.fileName,e);let n;if("markdown"===o.editMode){const t=o.$.input;n="md"!==e&&window.marked?window.marked(t.value):t.value}else n=o.$.editableElement["pdf"===e?"textContent":"innerHTML"];const a=new Smart.Utilities.DataExporter({exportHeader:!1,pageOrientation:o.dataExport.pageOrientation,style:o.dataExport.style}),i=[{value:n}];return o._setExportStyles(a,e),a.exportData(i,e,o.dataExport.fileName,t)}_exportToPDF(e,t){const o=this,n=o.$.editableElement,a=window.getComputedStyle(o),i=o.dataExport.style,r={pageOrientation:o.pageOrientation||"portrait",info:{title:"smartEditor",creator:"Smart",producer:"Smart"}};if(i&&(r.styles=i),r.defaultStyle={fontSize:parseFloat(a.fontSize)},"markdown"===o.editMode){const e=o.$.input,a=document.createElement("div");let i;"md"!==t?n.classList.contains("smart-hidden")?(a.innerHTML=window.marked?window.marked(e.value):e.value,i=o._processHTMLAsPDFObject(a,[])):i=o._processHTMLAsPDFObject(n,[]):(a.innerHTML=e.value,i=o._processHTMLAsPDFObject(a,[])),r.content=i}else r.content=o._processHTMLAsPDFObject(o.$.editableElement,[]);try{pdfMake.createPdf(r).download(e)}catch(e){console.error(o.localize("exportError",{elementType:o.nodeName.toLowerCase(),status:e.toString()}))}}_processHTMLAsPDFObject(e,t,o){const n=this,a={},i=["left","center","right"],r=e.childNodes,l=["td","th"].indexOf(e.nodeName.toLowerCase())>-1;for(let o=0,s=r.length;o<s;o+=1){const s=r[o],d=s.nodeName.toLowerCase(),c=s.nodeType===Node.TEXT_NODE;let m;if("table"===d){const e=s.querySelectorAll("thead tr"),t=s.querySelectorAll("thead tr:last-of-type td, thead tr:last-of-type th"),o=s.querySelectorAll("tbody tr:last-of-type td, tbody tr:last-of-type th"),a=t.length?t:o,i=s.querySelectorAll("body tr");let r=e.length;if(!r)for(let e=0,t=i.length;e<t&&Array.from(i[e].children).every((e=>"th"===e.nodeName.toLowerCase()));e+=1)r++;m={table:{headerRows:r,widths:(()=>{const e=Math.round(100/a.length)+"%";let t=[];for(let o=0,n=a.length;o<n;o+=1)t.push(e);return t})(),body:(()=>{let e=[];for(let t=0,o=i.length;t<o;t+=1){const o=i[t],r=o.children;let l=[];for(let e=0,t=o.childElementCount;e<t;e+=1){const t=n._processHTMLAsPDFObject(r[e],[],!0);if(o.childElementCount<a.length){let e;for(e=Array.isArray(t)&&1===t.length?t[0]:{text:t},e.colSpan=Math.round(a.length/o.childElementCount),l.push(e);l.length<a.length;)l.push({text:""})}else l.push(1===t.length?t[0]:t)}e.push(l)}return e})()}}}else if("ul"===d)m={ul:n._processHTMLAsPDFObject(s,[])};else if("ol"===d)m={ol:n._processHTMLAsPDFObject(s,[])};else if("img"===d){const e=document.createElement("canvas"),t=e.getContext("2d");let o;e.width=s.naturalWidth||s.width,e.height=s.naturalHeight||s.height,t.drawImage(s,0,0);try{o=e.toDataURL("image/png")}catch(e){console.error(n.localize("exportError",{elementType:n.nodeName.toLowerCase(),status:e.toString()}));continue}if(o.indexOf("image/png")<0){console.error(n.localize("exportError",{elementType:n.nodeName.toLowerCase(),status:"Invalid image"}));continue}m={image:o,width:s.width,height:s.height}}else"a"===d?(m={},s.childElementCount?s.querySelector("img")&&(m=n._processHTMLAsPDFObject(s,[],!0)[0]||{}):m.text=s.textContent,m.link=s.href):s.childElementCount?t=t.concat(n._processHTMLAsPDFObject(s,[],!0)):m={text:s.textContent.trim()?s.textContent:"\n"};if(m){const o=window.getComputedStyle(c?e:s);if(!c||l){const e=o.backgroundColor,t=parseFloat(o.fontSize);isNaN(t)||(m.fontSize=t),m.alignment=a.alignment=i.indexOf(o.textAlign)>-1?o.textAlign:i[0],"rgba(0, 0, 0, 0)"!==e&&"transparent"!==e&&(m.fillColor=a.fillColor=n._RGBAtoHex(e)),parseInt(o.fontWeight)>500&&(m.bold=!0),"italic"===o.fontStyle&&(m.italics=!0)}m.inlineElement=c||o.display.indexOf("inline")>-1,m.color=a.color=n._RGBAtoHex(o.color),t.push(m)}}return 1===t.length?t:o||l?(a[t.every((e=>e.inlineElement&&!e.image))?"text":"stack"]=t,[a]):t}_RGBAtoHex(e){const t=/rgb[a]?\(\s*(\d+),\s*(\d+),\s*(\d+),?\s*(\d*.\d+|\d+)?\)/gi.exec(e.replace(/\s/g,""));if(null===t)return e;const o=parseFloat(t[1]).toString(16).toUpperCase(),n=parseFloat(t[2]).toString(16).toUpperCase(),a=parseFloat(t[3]).toString(16).toUpperCase();return"#"+"0".repeat(2-o.length)+o+"0".repeat(2-n.length)+n+"0".repeat(2-a.length)+a}_setExportStyles(e,t){const o=this;if(e.style)return;const n=window.getComputedStyle(o),a=n.getPropertyValue("--smart-border-width")||"1px",i=n.getPropertyValue("--smart-border")||"black",r=n.getPropertyValue("--smart-editor-table-column-width")||"initial",l=n.getPropertyValue("--smart-editor-table-cell-min-height")||"20px",s=n.getPropertyValue("--smart-editor-table-cell-min-width")||l,d=n.getPropertyValue("--smart-surface")||"#333",c=n.getPropertyValue("--smart-alternation-index0-background")||d;e.style={border:"initial",width:"100%",height:o.$.editableElement.scrollHeight+"px",removeDefault:!0,custom:`\n            ${"html"===t&&o.rightToLeft?"body { direction: rtl; }":""}\n\n          .column table {\n            width: 100%;\n            border-collapse: collapse;\n            empty-cells: show;\n            border-spacing: 0;\n            table-layout: fixed;\n          }\n          \n          .column td, .column th {\n            border: ${a} solid ${i};\n            width: ${r};\n            min-height: ${l};\n            min-width: ${s};\n            padding: 2px 5px;\n            vertical-align: middle;\n          }\n          \n          .column table img {\n            max-width: 100%;\n          }\n          \n          .column table table {\n            width: 100%;\n          }\n          \n          .column table th {\n            background: ${d};\n          }\n\n          .column th:empty::before,\n          .column td:empty::before {\n            content: 'A';\n            visibility: hidden;\n          }\n          \n          .column table[dashed-borders] th, .column table[dashed-borders] td {\n            border-style: dashed;\n          }\n          \n          .column table[alternation] tr:nth-child(2n) {\n            background-color: ${c};\n          }\n          \n          .column .smart-editor-image-container {\n            display: inline-block;\n          }\n          \n          .column .smart-editor-image-container[display="block"] {\n            display: block;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="left"] img {\n            margin-left: 0;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="left"] .smart-editor-image-caption {\n            text-align: left;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="right"] img {\n            margin-right: 0;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="right"] .smart-editor-image-caption {\n            text-align: right;\n          }\n          \n          .column .smart-editor-image-container:not([display="block"])[alignment="left"] {\n            float: left;\n          }\n          \n          .column .smart-editor-image-container:not([display="block"])[alignment="right"] {\n            float: right;\n          }\n          \n          .column .smart-editor-image-container .smart-editor-image-caption {\n            display: block;\n            text-align: center;\n            outline: none;\n          }`}}_handleSourceCodeMode(e){const t=this,o=t.editMode,n=t._toolbarItemsObj.sourcecode;let a;if(t.$.contentContainer.hasAttribute("split-mode"))return;e?a=e.hasAttribute("checked"):(a=n?n.value:!t.classList.contains("preview-mode"),e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="sourcecode"]')),t._closePopups(),t._closeWindow(),t._closeSearchToolbar(),t._setResizeFrame(),t._handleTableSelection();const i=t.$.editableElement,r=t.$.input;"markdown"===o?a&&i.classList.contains("smart-hidden")?(i.innerHTML=window.marked?window.marked(r.value):r.value,i.classList.remove("smart-hidden"),r.classList.add("smart-hidden"),i.focus({preventScroll:!0})):!a&&r.classList.contains("smart-hidden")&&(i.classList.add("smart-hidden"),r.classList.remove("smart-hidden"),r.focus({preventScroll:!0})):a&&r.classList.contains("smart-hidden")?(r.value=t._getInputValue(i.innerHTML),i.classList.add("smart-hidden"),r.classList.remove("smart-hidden"),r.focus({preventScroll:!0})):!a&&i.classList.contains("smart-hidden")&&(i.innerHTML=t._getInputValue(r.value,!0),r.classList.add("smart-hidden"),i.classList.remove("smart-hidden"),i.focus({preventScroll:!0}),t._handleContentFiltering()),a?t.classList.add("preview-mode"):t.classList.remove("preview-mode"),n&&(n.value=a),e&&n&&(a?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)),t._setTextSelection(),t._setToolbarItemAttr("sourcecode","disabled",n.disabled))}_setTextSelection(){const e=this,t=e.$.input,o=e.$.editableElement,n=e._selectionRange;if(!n)return;const a=n.commonAncestorContainer;if(a){if(t.classList.contains("smart-hidden"))return;const i=e._getParentCharDetails(n.startContainer,a),r=e._getParentCharDetails(n.endContainer,a),l=e._getSiblingsCharOffset(i.parentElement,r.parentElement),{charOffset:s}=e._getParentCharDetails(a,o),d=n.startOffset+i.charOffset+s,c=n.endOffset+r.charOffset+l+s;e._setSelectionRange(t,d,c)}else if(!o.classList.contains("smart-hidden")){const a=n.selectionStart,i=n.selectionEnd,r=t.value;if(void 0===a||void 0===i||a===i&&(r.length===a||0===a))return;if(0===a&&i===o.innerHTML.length)return void e._setSelectionRange(o);const l=e._getNodeByChartOffset(o.firstChild,a,i);if(!l)return;const{node:s,charOffset:d}=l;e._setSelectionRange(s,a-d,i-d)}}_getNodeByChartOffset(e,t,o){const n=this;let a=0;for(;e;){const i=e.outerHTML||e.textContent,r=i.length;if(a<=t&&a+r>=o){e.tagName&&(a+=e.outerHTML.slice(0,i.indexOf(e.innerHTML)).length);const r=n._getNodeByChartOffset(e.firstChild,t-a,o-a);return r?{node:r.node,charOffset:r.charOffset+a}:{node:e,charOffset:a}}e=e.nextSibling,a+=r}}_getParentCharDetails(e,t){let o=0;if(e===t)return{charOffset:o,parentElement:e.parentElement};let n=e,a=e.innerHTML||e.textContent,i=e.parentElement;for(;i&&i!==t&&t.contains(i);){const e=i.outerHTML;o+=e.indexOf(a),a=e,n=i,i=i.parentElement}return o+=(t.innerHTML||t.textContent).indexOf(a),{charOffset:o,parentElement:n}}_getPreSiblingOffset(e,t){let o=0,n=e.textContent,a=e.previousSibling;for(;a&&t.contains(a);){const e=a.outerHTML||a.textContent;n=e+n,o+=e.length,a=a.previousSibling}return o}_getSiblingsCharOffset(e,t){let o=0,n=e.nextSibling;if(e===t)return o;for(;n&&n!==t;)o+=(n.outerHTML||n.textContent).length,n=n.nextSibling;return o}_handleFullScreenMode(e){const t=this,o=t._toolbarItemsObj.fullscreen;let n;e?n=e.hasAttribute("checked"):(n=o?o.value:!t.classList.contains("full-screen-mode"),e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="fullscreen"]')),t._closePopups(),t._setResizeFrame(),t._handleTableSelection(),n?(t.classList.add("full-screen-mode"),t._lastToolbarExpandedState=t.$.toolbar.hasAttribute("expanded")):(t.classList.remove("full-screen-mode"),t._lastToolbarExpandedState&&t._toggleToolbar()),o&&(o.value=n),e&&o&&(n?(e.setAttribute("cheched",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)),o.disabled?(e.setAttribute("disabled",""),e.setAttribute("aria-disabled",!0)):(e.removeAttribute("disabled"),e.removeAttribute("aria-disabled")))}_handleSplitMode(e){const t=this,o=t.$.editableElement,n=t.$.input,a=t.$.contentContainer,i=t._toolbarItemsObj,r=i.splitmode,l=i.sourcecode,s=e?e.hasAttribute("checked"):!a.hasAttribute("split-mode"),d=t.editMode;t._closePopups(),s?("markdown"===d?o.innerHTML=window.marked?window.marked(n.value):n.value:n.value=o.innerHTML.trim(),a.setAttribute("split-mode",""),n.classList.remove("smart-hidden"),o.classList.remove("smart-hidden"),l&&t._setToolbarItemAttr("sourcecode","disabled",!0)):(a.removeAttribute("split-mode",""),"markdown"===d?o.classList.add("smart-hidden"):n.classList.add("smart-hidden"),l&&t._setToolbarItemAttr("sourcecode","disabled",!1)),r&&(r.value=s),e||(e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="splitmode"]')),e&&(s?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1))),t._resizeFrameObj&&t._setResizeFrame(t._resizeFrameObj.target),t.classList.contains("preview-mode")&&t._handleSourceCodeMode()}_handleUndoRedo(e){this.$.editableElement.getRootNode().execCommand(e)}_handleTextCase(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange(),n=o.startContainer;if(!n)return;const a=n.textContent;let i,r,l,s,d=o.startOffset;n.nodeType===Node.TEXT_NODE&&o.startOffset===o.endOffset?(({selectionStartIndex:l,selectionEndIndex:s}=t._getTextFromCarret()),r=a.slice(l,s)):([l,s]=[d,o.endOffset],r=a.slice(d,o.endOffset),i=o.endOffset),r="lowercase"===e?r.toLowerCase():r.toUpperCase(),n.textContent=a.slice(0,l)+r+a.slice(s),t._setSelectionRange(n,d,i||d)}_handleList(e){const t=this;if(!e)return;if("markdown"===t.editMode){const o="orderedlist"===e?"1. ":"- ",n=t.$.input.selectionStart,a=t._getMarkdownFormat(n,"orderedlist"),i=t._getMarkdownFormat(n,"unorderedlist");if(a&&(t._removeMarkDown(o,a.occuranceIndex,"orderedlist"!==e),"orderedlist"===e))return;if(i&&(t._removeMarkDown(o,i.occuranceIndex,"unorderedlist"!==e),"unorderedlist"===e))return;return void t._insertMarkDown(o,t.$.input.selectionStart+o.length,!0)}let o,n,a=t._getSelectionRange();if(a.startContainer===a.endContainer&&(o=a.startOffset,n=a.endOffset),t.$.editableElement.getRootNode().execCommand("insert"+e,!1)){const e=t.$.iframe;a=(e?e.contentWindow:window).getSelection(),void 0!==n&&void 0!==n&&t._setSelectionRange(a.focusNode,o,n),t._updateToolbarItems(["orderedlist","unorderedlist"])}}_handleIndentation(e){"markdown"!==this.editMode&&this.$.editableElement.getRootNode().execCommand(e,!1)}_handleTextDelete(){this.$.editableElement.getRootNode().execCommand("delete")}_handleTabInsert(){this.$.editableElement.getRootNode().execCommand("insertHTML",!1,"&#009")}_handleTableToolbarAction(e,t){const o=this,n=o._toolbarItemClick;if(!t&&n&&(t=n.target),!t||"table"!==t.nodeName.toLowerCase()||!e)return;const a=e.getAttribute?e.getAttribute("item-name"):e.name,i=o.$.inlineToolbar;let r=e;if(r.closest){const e=o.$.inlineToolbar;r=(e&&e.contains(r)?o._inlineToolbarItemsObj:o._toolbarItemsObj)[a]}if(!n&&o.$.fireEvent("actionStart",{name:a}).defaultPrevented)return;switch(a){case"backgroundcolor":o._handleBackgroundColor(r);break;case"fontcolor":o._handleFontColor(r);break;case"fontsize":o._handleFontSize(r);break;case"tableheader":o._handleTableHeader(t);break;case"tablerows":o._handleTableRows(t,r);break;case"tablecolumns":o._handleTableColumns(t,r);break;case"tablevalign":o._handleTableVAlignment(t,r);break;case"alignment":o._handleTextAlignment(r);break;case"tablestyle":o._handleTableStyle(t,r);break;default:o._handleToolbarItemAction(e)}!n&&a&&o.$.fireEvent("actionEnd",{name:a}),i&&i.visible&&(o.$.editableElement.contains(i.selector)?i.reposition():o._closeToolbar());const l=o._getSelectionRange().startContainer;let s;if(l.nodeType===Node.TEXT_NODE){const e=l.parentElement;s=e.closest("th")||e.closest("td")}else s=["th","td"].indexOf(l.nodeName.toLowerCase())>-1;o._setResizeFrame(s&&t.contains(l)?t:void 0)}_handleTableHeader(e,t){let o,n,a=e.querySelector("th"),i=e.querySelector("tbody tr"),r=e.querySelector("thead");if(i&&(n=Array.from(i.children)),t||!r&&!a){if(void 0===t||!0===t){let t=e.querySelectorAll("tbody tr:first-of-type td").length;r||(r=document.createElement("thead")),o=r.querySelector("tr"),o||(o=document.createElement("tr"));const a=Array.from(o.children);for(;a.length>t;)a.pop().remove();for(let e=a.length;e<t;e+=1){const t=document.createElement("th");n[e]&&(t.style.width=n[e].style.width,n[e].style.width=""),o.appendChild(t)}r.appendChild(o),e.insertBefore(r,e.querySelector("tbody")||e.querySelector("tr"))}}else r&&r.remove(),a&&(o=a.closest("tr"),o&&o.remove(),Array.from(o.children).forEach(((e,t)=>n[t].style.width=e.style.width)))}_handleTableRows(e,t){if(!e)return;const o=this,n=o.$.inlineToolbar.selector,a=n.nodeName.toLocaleLowerCase();let i;if(!(n&&["th","td"].indexOf(a)>-1))return;if(i=n.closest("tr"),!i)return;const r=t.value,l=i.closest("thead");switch(r){case"insertRowAfter":case"insertRowBefore":{const t=document.createElement("tr"),o=i.parentElement;if(!o)break;const n=e.querySelector("tr").childElementCount,l="th"===a?"th":"td";for(let e=0;e<n;e+=1)t.appendChild(document.createElement(l));o.insertBefore(t,r.indexOf("Before")>-1?i:i.nextElementSibling);break}case"deleteRow":o._closeToolbar(),i.remove(),l&&!l.children.length&&l.remove()}const s=e.querySelectorAll("tr").length;s?(e.setAttribute("aria-rowcount",s),o._resizeFrameObj&&o._setResizeFrame(o._resizeFrameObj.target)):e.remove()}_handleTableColumns(e,t){if(!e)return;const o=this,n=o.$.inlineToolbar.selector;if(!(n&&["th","td"].indexOf(n.nodeName.toLowerCase())>-1))return;const a=t.value,i=Array.from(e.querySelectorAll("tr"));if(!i.length)return o._closeToolbar(),void e.remove();const r=Array.from(n.parentElement.children).indexOf(n);switch(a){case"insertColumnLeft":case"insertColumnRight":{const e=a.indexOf("Left")>-1;for(let t=0,o=i.length;t<o;t+=1){const o=i[t],n=o.children[r];if(n){const t="th"===n.tagName.toLowerCase()?"th":"td";o.insertBefore(document.createElement(t),e?n:n.nextElementSibling)}}break}case"deleteColumn":o._closeToolbar();for(let e=0,t=i.length;e<t;e+=1){const t=i[e].children[r];t&&t.remove()}}const l=i[0].children.length;l?(e.setAttribute("aria-colcount",l),o._resizeFrameObj&&o._setResizeFrame(o._resizeFrameObj.target)):e.remove()}_handleTextAlignment(e){if("markdown"===this.editMode)return;const t="justify"===e.value?"full":e.value;this.$.editableElement.getRootNode().execCommand("justify"+t.charAt(0).toUpperCase()+t.slice(1),!1,null)}_handleTableVAlignment(e,t){const o=this.$.inlineToolbar;if(!o)return;const n=o.selector;n&&["th","td"].indexOf(n.nodeName.toLowerCase())>-1&&(n.style.verticalAlign=t.value)}_handleTableStyle(e,t){const o=this.$.inlineToolbar.selector;if(o&&["th","td"].indexOf(o.nodeName.toLowerCase())>-1)switch(t.value){case"altrows":e.toggleAttribute("alternation");break;case"dashedborders":e.toggleAttribute("dashed-borders")}}_handleInlineToolbar(e){const t=this,o=e.nodeName.toLowerCase();"a"===o?(t._openInlineToolbar(e),t._refreshToolbarTabs()):"img"===o||["td","th"].indexOf(o)>-1?(t._setResizeFrame(e),t._openInlineToolbar(e),t._refreshToolbarTabs()):e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length&&t._openInlineToolbar(e)}_handleTableCellResize(e){const t=this,o=t._inlineToolbarClickObj,n=o?o.resizeDetails:void 0;if(!n)return;const a=n.target,i=n.position,r=t.$.inlineToolbar;switch(n.started||t.$.fireEvent("resizeStart",{target:a}),a.setAttribute("resizing",""),n.started=!0,r&&r.visible&&(n.isInlineToolbarOpened=!0,t._closeToolbar()),i){case"horizontal":{const o=e.pageX+window.pageXOffset;if(t._setTableResizeDetails(n),!n.shrinkingCell)break;t._handleHorizontalTableCellResize(n,o);break}case"vertical":{const o=n.table;o.style.height&&(o.querySelectorAll("tr").forEach((e=>e.style.height=e.offsetHeight+"px")),o.style.height=""),t._resizeFrameObj&&t._resizeFrameObj.target&&t._setResizeFrame();const i=e.pageY+window.pageYOffset,r=n.y-i;let l=a.offsetHeight;l-=r,a.style.height=Math.max(1,l)+"px",l===a.offsetHeight&&(n.y=i+Math.abs(Math.min(0,l)));break}}}_setTableResizeDetails(e){const t=e.table,o=e.target;let n,a=e.expandingCell,i=e.shrinkingCell,r=e.isLastCell,l=e.areAllCellsResized;if(!a){const i=t.querySelector("tr"),r=Array.from(o.parentElement.children).indexOf(o);n=e.cells=Array.from(i.children),a=e.expandingCell=n[r]}e.shrinkingCell||(i=e.shrinkingCell=a.nextElementSibling,l=e.areAllCellsResized=!n.some((e=>e!==a&&e!==i&&!e.style.width)),r=e.isLastCell=l&&null===i.nextElementSibling,l&&!e.lastCell&&(e.lastCell=n[n.length-1]),r&&(i.style.width=""))}_handleHorizontalTableCellResize(e,t){const o=30,n=e.isLastCell;let a=e.expandingCell,i=e.shrinkingCell,r=a.offsetWidth,l=i.offsetWidth,s=e.x-t;const d=e.x-r+o,c=e.x+i.offsetWidth-o;if(n){const n=r+l-o;a.style.width=Math.min(Math.max(o,r-s),n)+"px",a.offsetWidth!==r&&(e.x=Math.min(c,Math.max(d,t)))}else{let n;s>0&&([a,i]=[i,a],[r,l]=[l,r],s*=-1),i.style.width=Math.max(o,l+s)+"px",n=i.offsetWidth-l,a.style.width=Math.max(o,a.offsetWidth-n)+"px",0!==n&&(e.x=Math.min(c,Math.max(d,t))),e.lastCell&&(e.lastCell.style.width="")}}_handleFrameResize(e){const t=this,o=t._resizeFrameObj;if(!o)return;t._closeToolbar();const n=o.resizableElement||o.target,a=o.resizeDetails,i=a.position,r=e.pageX+window.pageXOffset,l=e.pageY+window.pageYOffset,s=a.x-r,d=a.y-l;let c,m;c=n.offsetWidth,m=n.offsetHeight,a.started||(o.target.setAttribute("dragged",""),t.$.fireEvent("resizeStart",{target:n})),a.started=!0;const u=c,b=m,p=t.rightToLeft?-1:1;switch(i){case"top-left":n.style.width=Math.max(0,u+p*s)+"px",n.style.height=Math.max(0,b+d)+"px",c=n.offsetWidth,m=n.offsetHeight,u!==c&&(a.x-=p*(c-u)),b!==m&&(a.y-=m-b);break;case"bottom-left":n.style.width=Math.max(0,u+p*s)+"px",n.style.height=Math.max(0,b-d)+"px",c=n.offsetWidth,m=n.offsetHeight,u!==c&&(a.x-=p*(c-u)),b!==m&&(a.y+=m-b);break;case"bottom-right":n.style.width=Math.max(0,u-p*s)+"px",n.style.height=Math.max(0,b-d)+"px",c=n.offsetWidth,m=n.offsetHeight,u!==c&&(a.x+=p*(c-u)),b!==m&&(a.y+=m-b);break;case"top-right":n.style.width=Math.max(0,u+p*-s)+"px",n.style.height=Math.max(0,b+d)+"px",c=n.offsetWidth,m=n.offsetHeight,b!==m&&(a.y-=m-b),u!==c&&(a.x+=p*(c-u));break;case"top-center":n.style.height=Math.max(0,b+d)+"px",m=n.offsetHeight,b!==m&&(a.y-=m-b);break;case"bottom-center":n.style.height=Math.max(0,b-d)+"px",m=n.offsetHeight,b!==m&&(a.y+=m-b);break;case"left-center":n.style.width=Math.max(0,u+p*s)+"px",c=n.offsetWidth,u!==c&&(a.x-=p*(c-u));break;case"right-center":n.style.width=Math.max(0,u-p*s)+"px",c=n.offsetWidth,u!==c&&(a.x+=p*(c-u))}t._positionResizeHandles()}_deleteResizeFrameTarget(e){const t=this,o=t._getSelectionRange();if(e)if("img"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-editable .smart-editor-image-container"),n=(o||e).parentElement,a=n&&"a"===n.nodeName.toLowerCase()?n:void 0;t._setResizeFrame(),(a||o||e).remove(),URL.revokeObjectURL(e.src)}else if(e.classList.contains("smart-editor-video-container")){const o=e.querySelector(".smart-editor-video-container video, .smart-editor-video-container > iframe");t._setResizeFrame(),e.remove(),o&&URL.revokeObjectURL(o.src)}else if("table"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-editable table");o&&(t._setResizeFrame(),o.remove())}t._setCharCount(),t._setSelectionRange(o.startContainer,o.startOffset,o.endOffset),t._focusEditableElement()}_setResizeFrame(e,t){const o=this,n=o.$.editableElement;let a,i=e?e.nodeName.toLowerCase():"",r=o._resizeFrameObj;if("td"!==i&&"th"!==i||(e=e.closest(".smart-editor-editable table")),i=e?e.nodeName.toLowerCase():"",e&&e.parentElement&&("img"===i||"table"===i||e.classList.contains("smart-editor-video-container"))&&"false"!==n.getAttribute("contenteditable"))if(r?a=r.element:(r=o._resizeFrameObj={},a=r.element=document.createElement("span"),a.classList.add("smart-editor-resize-frame"),a.innerHTML='<span position="top-left"></span><span position="top-right"></span>\n                                     <span position="bottom-left"></span><span position="bottom-right"></span>\n                                     <span position="top-center"></span><span position="bottom-center"></span>\n                                     <span position="left-center"></span><span position="right-center"></span>'),r.target&&r.target.removeAttribute("show-resize-frame"),r.target=e,e.classList.contains("smart-editor-video-container")?r.resizableElement=e.querySelector("video, iframe"):delete r.resizableElement,o._refreshToolbarTabs(),"false"!==e.getAttribute("resizable")){if(e.setAttribute("show-resize-frame",""),o._positionResizeHandles(),a.parentElement||o.$.contentContainer.appendChild(a),!t&&"img"===i){const e=o.$.iframe;(e?e.contentWindow:window).getSelection().collapse(null),o._updateToolbarItems()}}else e.removeAttribute("show-resize-frame");else{if(r){if(r.element.remove(),r.target){const e=n.querySelectorAll("[show-resize-frame]");for(let t=0,o=e.length;t<o;t+=1)e[t].removeAttribute("show-resize-frame")}delete r.target}o._refreshToolbarTabs()}}_setToast(){const e=this;let t=e.$.toast;return t||(e.$.toast=t=document.createElement("smart-toast"),t.appendTo=e.$.container,t.showCloseButton=!0,t.itemClass="smart-editor-message",e.$toast=Smart.Utilities.Extend(t)),t.rightToLeft=e.rightToLeft,t.theme=e.theme,t.animation=e.animation,t}_positionResizeHandles(){const e=this,t=e._resizeFrameObj;if(!e._resizeFrameObj)return;const o=t.element,n=e.rightToLeft,a=n?"right":"left",i=(t.resizableElement||t.target).getBoundingClientRect(),r=o.children,l=r[0],s=r[1],d=r[2],c=r[3],m=r[4],u=r[5],b=r[6],p=r[7],h=e.$.editableElement,g=e.$.contentContainer.getBoundingClientRect(),f=i.top-g.top+h.offsetTop,_=i.width,v=i.height;let w;n?(w=g.right-i.right+(h.offsetLeft+h.offsetWidth-g.width),l.style.left=d.style.left=b.style.left=""):(w=i.left-g.left+h.offsetLeft,l.style.right=d.style.right=b.style.right=""),l.style.top=s.style.top=m.style.top=f+"px",l.style[a]=d.style[a]=b.style[a]=w+"px",d.style.top=c.style.top=u.style.top=f+v+"px",s.style[a]=c.style[a]=p.style[a]=_+w+"px",m.style[a]=u.style[a]=w+_/2+"px",b.style.top=p.style.top=f+v/2+"px"}_openInlineToolbar(e){const t=this,o=t.$.editableElement;let n=t.$.inlineToolbar;if(t._closeToolbarItemDropDown(t.$.inputPopup),t._closeToolbarItemDropDown(t.$.colorInputPopup),"false"===o.getAttribute("contenteditable")||t.hideInlineToolbar)return void(n&&n.visible&&n.close());if(n||(n=t._createToolbar()),t.$.fireEvent("inlineToolbarOpening",{target:n}).defaultPrevented)return;t._setupToolbar(e,"inline"),n.parentElement||t.getShadowRootOrBody().appendChild(n);const a=t._getInlineToolbarContent(e);n.clear(),a instanceof DocumentFragment&&(n.appendChild(a),n.open(),t._setAriaOwns(n)),t._updateToolbarItems(void 0,n)}_closeToolbar(){const e=this,t=e.$.inlineToolbar;if(t){const o=t.classList,n=o.contains("smart-editor-context-menu")?"contextMenu":o.contains("smart-editor-inline-toolbar")?"inlineToolbar":"dropDownToolbar";if(e.$.fireEvent(n+"Closing",{target:t}).defaultPrevented)return;t.close()}}_closePopups(){const e=this;e._closeToolbar(),e._closeToolbarItemDropDown(e.$.inputPopup),e._closeToolbarItemDropDown(e.$.colorInputPopup)}_createToolbar(){const e=this;let t=e.$.inlineToolbar;return t||(t=document.createElement("smart-tooltip"),e.$.inlineToolbar=t,e.$inlineToolbar=Smart.Utilities.Extend(t),t)}_setupToolbar(e,t){const o=this,n=o.$.iframe,a=o.$.inlineToolbar,i=o.$inlineToolbar;if(!a.visible){const e=e=>o._tooltipVisibilityHandler.call(o,e),t=e=>o._tooltipVisibilityHandler.call(o,e),n=e=>o._tooltipChangeHandler.call(o,e),a=e=>o._tooltipClickHandler.call(o,e),r=e=>o._tooltipTransitionEndHandler.call(o,e);i.unlisten("open"),i.unlisten("close"),i.unlisten("change"),i.unlisten("click"),i.unlisten("transitionend"),i.listen("open",e),i.listen("close",t),i.listen("change",n),i.listen("click",a),i.listen("transitionend",r)}if(a.locale=o.locale,a.rightToLeft=o.rightToLeft,a.theme=o.theme,a.animation=o.animation,a.openMode="manual","inline"===t)a.position="auto",a.iframeRect=n?n.getBoundingClientRect():null,a.arrow=!0,a.align="center",a.offset=o.inlineToolbarOffset,a.classList.add("smart-editor-toolbar","smart-editor-inline-toolbar"),a.classList.remove("smart-editor-drop-down-toolbar","smart-editor-context-menu"),a.setAttribute("role","tooltip"),a.setAttribute("aria-label","Inline Toolbar");else{if("context"!==t)return a.position="auto",a.iframeRect=null,a.arrow=!1,a.align=o.rightToLeft?"right":"left",a.offset=[0,-5],a.selector=e,a.classList.add("smart-editor-toolbar","smart-editor-drop-down-toolbar"),a.classList.remove("smart-editor-inline-toolbar","smart-editor-context-menu"),a.setAttribute("role","tooltip"),void a.setAttribute("aria-label","Drop Down Toolbar");a.position="absolute",a.arrow=!1,a.classList.add("smart-editor-context-menu"),a.classList.remove("smart-editor-toolbar","smart-editor-drop-down-toolbar","smart-editor-inline-toolbar"),a.setAttribute("role","listbox"),a.setAttribute("aria-label","Context Menu")}if(a.selector&&!a.selector.closest&&delete a.selector.getBoundingClientRect,e.closest)a.selector=e;else{const t=e.parentElement,n=o._getSelectionRange();t.getBoundingClientRect=()=>n.getBoundingClientRect(),a.selector=t}}_getInlineToolbarContent(e){const t=this,o=t.$.inlineToolbar;if(o.innerHTML&&o.selector.nodeName===e.nodeName)return;let n;const a=t._toolbarItemsObj,i=e.nodeName.toLowerCase(),r=(e=[])=>{let t;for(let o=0,n=e.length;o<n;o+=1){const n=a[e[o]];if(n){t=n;break}}return t};let l;switch(i){case"a":l=r(["hyperlink","createlink"]);break;case"#text":l=r(["cut","copy","paste"]);break;case"img":l=r(["image"]);break;case"td":case"th":l=r(["table"]);break;default:return}return n=l&&Array.isArray(l.inlineToolbarItems)?l.inlineToolbarItems:t._getDefaultInlineToolbarItems(e,i),n.length?t._getToolbarItems(o,n):void 0}_getDefaultInlineToolbarItems(e,t){let o;switch(t){case"a":o=["openlink","editlink","removelink"];break;case"#text":o=["cut","copy","paste"];break;case"img":o=["image","alignment","createlink","delete","caption"],e.closest(".smart-editor-editable a")&&o.splice(o.indexOf("createlink")+1,0,"openlink","removelink");break;case"td":case"th":o=["table","tableheader","tablerows","tablecolumns","backgroundcolor","delete","alignment","tablevalign","tablestyle"];break;default:return[]}return o}_getNodes(e,t=0,o,n=0){const a=this,i=e.childNodes;let r=[];for(let e=0,l=i.length;e<l;e+=1){const l=i[e];if(l.childElementCount){const e=a._getNodes(l,t,o,n);if(n=e.index,e.nodes.length&&(r=r.concat(e.nodes)),n>=o)break}else if(l.nodeType===Node.TEXT_NODE){const e=l.nodeValue;if(!e.trim())continue;const a=e.length;if(n+a>t&&r.push({node:l,index:o-n,startIndex:Math.max(0,t-n)}),(n+=a)>o)break}else if((n+=(l.textContent||l.innerText||l.innerHTML).length)>t&&r.push({node:l,index:n}),n>o)break}return{nodes:r,index:n}}_tooltipChangeHandler(e){const t=this,o=e.target,n=t.$.inlineToolbar;n&&n.classList.contains("smart-editor-drop-down-toolbar")&&n.visible&&n.contains(o)?o.classList.contains("smart-table-picker")&&(t._handleTableInsert({cells:e.detail.value}),n.close()):t._changeHandler(e)}_tooltipClickHandler(e){const t=this,o=e.target,n=t.$.inlineToolbar;if(n&&n.classList.contains("smart-editor-drop-down-toolbar")&&n.contains(e.target)&&o.closest(".smart-table-picker-button")){const e=t._getSelectionRange();let o;return e.startContainer&&["th","td"].indexOf(e.startContainer.nodeName.toLowerCase())>-1&&(o=e.startContainer.closest(".smart-editor-editable table")),void t._openWindow(n.selector,o)}if(n&&n.classList.contains("smart-editor-context-menu")){const n=o.closest(".smart-editor-context-menu-item");if(n)return void t._handleContextMenuItemClick(e,n)}}_tooltipVisibilityHandler(e){const t=this,o=t.$.inlineToolbar,n=e.type;if(e.target!==o)return;const a=t.$.inlineToolbar,i=t.$inlineToolbar;let r;r=o.classList.contains("smart-editor-toolbar")?(o.classList.contains("smart-editor-drop-down-toolbar")?"inline":"dropDown")+"Toolbar":"contextMenu",e.stopPropagation(),"close"===e.type?(a.selector&&!a.selector.closest&&delete a.selector.getBoundingClientRect,a.hasAnimation||(i.unlisten(e.type),i.unlisten("change"),i.unlisten("click"),a.remove(),t._focusEditableElement()),t._setAriaOwns(o)):"open"===e.type&&t._setAriaOwns(o),t.$.fireEvent(r+n.slice(0,1).toUpperCase()+n.slice(1),Object.assign({target:e.target},e.detail))}_tooltipTransitionEndHandler(e){const t=this;if(!(e.target instanceof Smart.Tooltip))return;const o=t.$.inlineToolbar,n=t.$inlineToolbar;o.visible||(n.unlisten("transitionend"),o.style.top=o.style.left=0,o.remove(),t._setAriaOwns(o))}_toggleItemDropDown(e){const t=this,o=e.getAttribute("item-type");let n;if("drop-down"===o?(t.$.inputPopup||(t.$.inputPopup=document.createElement("smart-input")),n=t.$.inputPopup):"color-input"===o&&(t.$.colorInputPopup||(t.$.colorInputPopup=document.createElement("smart-color-input")),n=t.$.colorInputPopup),n.noRipple=!0,t.$.inputPopup&&n===t.$.colorInputPopup&&t.$.inputPopup.parentElement?t._closeToolbarItemDropDown(t.$.inputPopup):t.$.colorInputPopup&&n===t.$.inputPopup&&t.$.colorInputPopup.parentElement&&t._closeToolbarItemDropDown(t.$.colorInputPopup),n)if(n.locale=t.locale,n.rightToLeft=t.rightToLeft,n.theme=t.theme,n.animation=t.animation,e.contains(n)&&n.opened)t._closeToolbarItemDropDown(n);else{const o=t.$.inlineToolbar;o&&!o.contains(e)&&t._closeToolbar(),n.remove(),t._openToolbarItemDropDown(e,n)}}_toggleDropDownToolbar(e){const t=this;if(!e)return;if("table"!==e.getAttribute("item-name"))return;const o=t.$.inlineToolbar;if(o&&o.visible&&o.classList.contains("smart-editor-drop-down-toolbar")){if(o.contains(e)){const o=t._getSelectionRange();let n;return o.startContainer&&["th","td"].indexOf(o.startContainer.nodeName.toLowerCase())>-1&&(n=o.startContainer.closest(".smart-editor-editable table")),void t._openWindow(e,n)}o.classList.contains("smart-editor-drop-down-toolbar")&&o.close()}else t._closeToolbarItemDropDown(t.$.inputPopup),t._closeToolbarItemDropDown(t.$.colorInputPopup),t._openDropDownToolbar(e)}_openDropDownToolbar(e){const t=this;let o=t.$.inlineToolbar;o||(o=t._createToolbar()),t.$.fireEvent("dropDownToolbarOpening",{target:o}).defaultPrevented||(t._setupToolbar(e,"dropDown"),o.parentElement||t.getShadowRootOrBody().appendChild(o),t._setDropDownToolbarContent(e),o.open(),t._setAriaControls(e,o))}_setDropDownToolbarContent(e){const t=this,o=t.$.inlineToolbar,n=e.getAttribute("item-name");let a=t._dropDownToolbarObj;a||(a=t._dropDownToolbarObj={});let i=a[n];i||(i=document.createElement("smart-table-picker"),a[n]=i),i.rightToLeft=t.rightToLeft,i.locale=t.locale,i.messages=t.messages,i.value=[],o.contains(i)||(o.clear(),o.appendChild(i))}_openSearchBar(){const e=this,t=e.$.editableElement,o=e.$.contentContainer;let n=e._searchToolbar;if(e.disableSearchBar||t.classList.contains("smart-hidden"))return void(n&&n.remove());n||(n=e._searchToolbar=document.createElement("div"),n.classList.add("smart-editor-search-bar"),n.innerHTML='<span class="smart-search-input-container">\n                                    <input class="smart-search-input"></input>\n                                </span>\n                                <smart-button class="smart-search-button prev"></smart-button>\n                                <smart-button class="smart-search-button next"></smart-button>\n                                <smart-button class="smart-search-button close"></smart-button>'),n.ontransitionend=null;const a=e.animation,i=e.theme,r=e.rightToLeft,l=n.children;let s;for(let t=0,o=l.length;t<o;t+=1){const o=l[t];if(o.classList.contains("smart-search-input-container")){const t=o.firstElementChild;t.placeholder=e.localize("searchPlaceholder"),s=t}o.animation=a,o.theme=i,o.rightToLeft=r}if(o.contains(n)||o.appendChild(n),n.classList.remove("smart-visibility-hidden"),s){const t=e.$.iframe,o=(t?t.contentWindow:window).getSelection().toString();s.value=o,s.focus({preventScroll:!0}),o&&e._applySearching(o)}delete e._lastSearchQuery}_closeSearchToolbar(){const e=this,t=e._searchToolbar;if(t&&!t.classList.contains("smart-visibility-hidden")){t.classList.add("smart-visibility-hidden"),t.ontransitionend=()=>{t.remove(),t.ontransitionend=null};const o=Array.from(e.$.editableElement.querySelectorAll(".find-and-replace-match"));for(let e=0,t=o.length;e<t;e+=1){const t=o[e];t.outerHTML=t.textContent}e._focusEditableElement()}}_toggleWindow(e,t){const o=this;if(!e)return;const n=e.getAttribute("item-name"),a=o.$.window;if(!a)return void o._openWindow(e,t);const i=a._target?a._target.item:void 0;!i||i.name!==n||i.name===n&&!a.opened?o._openWindow(e,t):a.close()}_openWindow(e,t){const o=this;if(!e||!o._toolbarItemsObj||o._window&&o._window.opened)return;let n;t&&t.classList.contains("smart-editor-video-container")&&(t=t.querySelector(".smart-editor-video-container > video, .smart-editor-video-container > iframe"));const a=o.$.editableElement;if(e.closest){if(!e.classList.contains("smart-editor-toolbar-item"))return;n=(e.closest(".smart-editor-inline-toolbar")?o._inlineToolbarItemsObj:o._toolbarItemsObj)[e.getAttribute("item-name")]}else"object"==typeof e&&"string"==typeof e.name&&(n=e);if(!n||"findandreplace"===n.name&&a.classList.contains("smart-hidden"))return;const i=o._createWindow(n);o.$.fireEvent("dialogOpening",{target:i,item:n}).defaultPrevented||(o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup),i._target={item:n,itemTarget:t,originalTarget:e},o._closeToolbar(),i.parentElement||o.getShadowRootOrBody().appendChild(i),i.isCompleted?o._setupWindow():i.whenReady((()=>o._setupWindow())))}_closeWindow(){const e=this,t=e.$.window;t&&t.opened&&(e.$.fireEvent("dialogClosing",{target:t,item:t._target.item}).defaultPrevented||t.close())}_setupWindow(){const e=this,t=e.$.window,o=t._target,n=o.item;function a(){e._positionWindow(),t.opened?(t.bringToFront(),t._handleActiveState(),t._onOpenCallback&&t._onOpenCallback()):t.open()}if(t.locale=e.locale,t.rightToLeft=e.rightToLeft,t.theme=e.theme,t.animation=e.animation,e.windowCustomizationFunction?e.windowCustomizationFunction(t,n):(e._setPopupWindowTemplate("header",n),e._setPopupWindowTemplate("footer",n),e._setPopupWindowTemplate("content",n)),!t.opened){const o=e.$window,n=t=>e._windowOpenHandler.call(e,t),a=t=>e._windowCloseHandler.call(e,t),i=t=>e._windowClickHandler.call(e,t),r=t=>e._windowChangeHandler.call(e,t),l=t=>e._windowKeyDownHandler.call(e,t),s=t=>e._windowKeyUpHandler.call(e,t),d=t=>e._windowTransitionendHandler.call(e,t),c=t=>e._fileUploadCompletedHandler.call(e,t),m=t=>e._fileUploadErrorHandler.call(e,t);o.unlisten("transitionend"),o.unlisten("open"),o.unlisten("close"),o.unlisten("click"),o.unlisten("change"),o.unlisten("keydown"),o.unlisten("keyup"),o.unlisten("uploadCompleted"),o.unlisten("uploadError"),t._onOpenCallback=()=>{((t.shadowRoot||t).querySelector(".smart-editor-window-editor:not(.smart-hidden) .smart-input.smart-element")||t).focus({preventScroll:!0})},t.hasAnimation&&o.listen("transitionend",d),o.listen("open",n),o.listen("close",a),o.listen("click",i),o.listen("change",r),o.listen("keydown",l),o.listen("keyup",s),o.listen("uploadCompleted",c),o.listen("uploadError",m)}t.shadowRoot?e._onShadowDomLoaded(t,"smart.window.css",a):a(),e._setAriaOwns(t),e._setAriaControls(o.originalTarget,t)}_setPopupWindowTemplate(e,t){const o=this,n=o.$.window;if(!n)return;if("content"===e)return void o._setWindowContent(t);n[e+"Template"]||(n[e+"Template"]=o._createWindowTemplate(e));const a=n._target.item;if("header"===e)n.label=o.localize(a.name)||"";else if("footer"===e){const e=(n.shadowRoot||n).querySelectorAll(".smart-editor-window-button"),a="findandreplace"===t.name;for(let t=0;t<e.length;t++){const n=e[t];n.innerHTML='<span class="smart-icon"></span>',n.theme=o.theme,n.rightToLeft=o.rightToLeft,n.animation=o.animation,n.classList.contains("ok")?a?(n.classList.add("replace"),n.innerHTML+=o.localize("replace"),n.setAttribute("aria-label","replace")):(n.classList.remove("replace"),n.innerHTML+=o.localize("ok"),n.setAttribute("aria-label","ok")):n.classList.contains("cancel")?(n.innerHTML+=o.localize("cancel"),n.setAttribute("aria-label","cancel")):a?(n.classList.contains("replace-all")&&(n.innerHTML+=o.localize("replaceAll"),n.setAttribute("aria-label","replaceAll")),n.classList.remove("smart-hidden")):n.classList.add("smart-hidden");const i=n.querySelector(".smart-ripple");i&&i.parentElement.removeChild(i)}}}_setWindowContent(e){const t=this,o=t.$.window,n=o._target.originalTarget,a=[].slice.call(o.getElementsByClassName("smart-editor-window-editor"));if((!o.innerHTML||a.length)&&n){switch(e.name){case"createlink":case"editlink":case"hyperlink":case"image":case"video":case"table":case"paste":case"findandreplace":t._createWindowEditors(e)}n.id&&o.setAttribute("aria-controls",n.id)}}_createWindowEditors(e){const t=this,o=t.$.window,n=e.name;let a,i=t._windowEditors,r=o.querySelector(".smart-editor-window-content-wrapper");r||(r=document.createElement("div"),r.classList.add("smart-editor-window-content-wrapper"),o.appendChild(r)),t._windowEditors||(i=t._windowEditors={}),i&&(a=i[n]),a||(a=document.createElement("div"),a.classList.add(`smart-editor-window-${n}`),a.innerHTML=t._getWindowEditorTemplate(n),i[n]=a),r.contains(a)||(r.innerHTML="",r.appendChild(a));const l=a.querySelectorAll(".smart-editor-window-editor[type]");for(let e=0;e<l.length;e++)t._setPopupWindowEditor(l[e])}_getWindowEditorTemplate(e){switch(e){case"createlink":case"editlink":case"hyperlink":return'\n                <div class="smart-editor-window-editor" type="address">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="text">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="title">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="target">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>';case"image":return'\n                <div class="smart-editor-window-editor" type="file">\n                    <smart-file-upload item-editor></smart-file-upload>\n                </div>\n                <div class="smart-editor-window-editor" type="url">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="width">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="height">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="alt">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="title">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="caption">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="display">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="alignment">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="draggable">\n                    <smart-check-box item-editor></smart-check-box>\n                </div>\n                <div class="smart-editor-window-editor" type="resizable">\n                    <smart-check-box item-editor></smart-check-box>\n                </div>';case"table":return'\n                    <div class="smart-editor-window-editor" type="cols">\n                        <label></label>\n                        <smart-number-input item-editor></smart-number-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="rows">\n                        <label></label>\n                        <smart-number-input item-editor></smart-number-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="width">\n                        <label></label>\n                        <smart-input item-editor></smart-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="height">\n                        <label></label>\n                        <smart-input item-editor></smart-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="tableheader">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="altrows">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="dashedborders">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="resizable">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>';case"paste":return'\n                    <div class="smart-editor-window-editor" type="keepFormat">\n                        <label></label>\n                        <smart-radio-button checked group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>\n                    <div class="smart-editor-window-editor" type="cleanFormat">\n                        <smart-radio-button group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>\n                    <div class="smart-editor-window-editor" type="plainText">\n                        <smart-radio-button group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>';case"findandreplace":return'\n                <div class="smart-editor-window-editor" type="find">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="replaceWith">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="results">\n                    <label></label>\n                    <smart-list-box virtualized item-editor></smart-list-box>\n                </div>\n                <div class="smart-editor-window-editor" type="matchCase">\n                    <smart-check-box item-editor></smart-check-box>\n                </div>';case"video":return'\n                        <div class="smart-editor-window-editor" type="file">\n                            <smart-file-upload item-editor></smart-file-upload>\n                        </div>\n                        <div class="smart-editor-window-editor" type="src">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="width">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="height">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="thumbnail">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="videoUrl">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="alt">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="title">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="caption">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="display">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="alignment">\n                            <label></label>\n                            <smart-input item-editor></smart-input>\n                        </div>\n                        <div class="smart-editor-window-editor" type="draggable">\n                            <smart-check-box item-editor></smart-check-box>\n                        </div>\n                        <div class="smart-editor-window-editor" type="resizable">\n                            <smart-check-box item-editor></smart-check-box>\n                        </div>';default:return""}}_setPopupWindowEditor(e){const t=this,o=e.getAttribute("type"),n=e.querySelector("label"),a=t.$.window._target,i=a.item,r="markdown"===t.editMode,l=i.editor;let s,d=e.querySelector("[item-editor]");if(n&&("paste"===i.name?(n.id=t.id+"pasteLabel",n.innerHTML=t.localize("pasteLabel")||""):(n.id=t.id+o+"Label",n.innerHTML=t.localize(o)||"")),!d)return;const c=t._toolbarItemClick;let m;switch(m=c?c.target:a.itemTarget,i.name){case"hyperlink":case"createlink":case"editlink":{const n=t._getSelectionRange();let a=n.startContainer;a&&"a"!==a.nodeName.toLowerCase()&&(a=a.parentElement),a&&"a"===a.nodeName.toLowerCase()?"address"===o?s=a.getAttribute("href"):"text"===o?s=a.textContent:"title"===o?s=a.title:"target"===o&&(s=a.target):s="text"===o?r?t.$.input.value.slice(n.selectionStart,n.selectionEnd):n.toString():l&&void 0!==l[o]?l[o]+"":"","target"===o&&r||m&&"img"===m.nodeName.toLowerCase()&&["title","text"].indexOf(o)>-1?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden");break}case"video":case"image":{const n=t._toolbarItemClick,d=n?n.target:a.itemTarget;if(d&&["img","video","iframe"].indexOf(d.nodeName.toLowerCase())>-1){const e=d.closest(".smart-editor-image-container");switch(o){case"file":d.file instanceof File&&(s=d.file);break;case"url":case"src":s=d.file instanceof File?"":d.getAttribute("src")||"";break;case"alt":s=d.alt;break;case"title":s=d.title;break;case"width":if(s=d.style.width||(e?e.style.width:""),!s){const e=d.getAttribute("width");e&&(s=e)}break;case"height":if(s=d.style.height||(e?e.style.height:""),!s){const e=d.getAttribute("height");e&&(s=e)}break;case"caption":if(e){const t=e.querySelector(".smart-editor-image-caption");t&&(s=t.textContent)}void 0===s&&(s="");break;case"alignment":s=(e||d).getAttribute("alignment")||"";break;case"display":s=(e||d).getAttribute("display")||"";break;case"draggable":case"resizable":{const t=("video"===i.name?e:d).getAttribute(o);s=null==t||"true"===t;break}}}else s=l?("draggable"===o||"resizable"===o)&&void 0===l[o]||(void 0!==l[o]?l[o]+"":""):"width"===o?480:"height"===o?270:"draggable"===o||"resizable"===o||"";r&&["file","url","videoUrl","alt","title","thumbnail"].indexOf(o)<0||!r&&"video"===i.name&&["alt","thumbnail","videoUrl"].indexOf(o)>-1?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden");break}case"table":{const t=a.itemTarget&&"table"===a.itemTarget.nodeName.toLowerCase()?a.itemTarget:void 0;switch(o){case"width":case"height":s=t?t.style[o]:l&&void 0!==l[o]?l[o]:"";break;case"cols":s=t?t.querySelector("tbody > tr").children.length+"":l&&void 0!==l[o]?l[o]:"1";break;case"rows":s=t?t.querySelectorAll("tbody > tr").length+"":l&&void 0!==l[o]?l[o]:"1";break;case"tableheader":s=!!r||(t?null!==t.querySelector("thead"):!(!l||void 0===l[o])&&l[o]);break;case"altrows":s=t?t.hasAttribute("alternation"):!(!l||void 0===l[o])&&l[o];break;case"dashedborders":s=t?t.hasAttribute("dashed-borders"):!(!l||void 0===l[o])&&l[o];break;case"resizable":s=t?!("false"===t.getAttribute("resizable")):!l||void 0===l[o]||l[o]}r&&["cols","rows","tableheader"].indexOf(o)<0?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden");break}case"paste":s=o===t.pasteFormat;break;case"findandreplace":s=l&&void 0!==l[o]?l[o]:""}t._setupEditorElement(d,o,s),t._setEditorCommonProperties(d)}_setupEditorElement(e,t,o){const n=this,a=n.$.window._target.item,i=a.editor,r="markdown"===n.editMode;if((e instanceof Smart.CheckBox||e instanceof Smart.RadioButton)&&(e.innerHTML=n.localize(t)||"",e.checked=!!o),e instanceof Smart.NumberInput)e.min=1,e.value=parseInt(o);else{if(e instanceof Smart.FileUpload)return"file"===t&&e.isCompleted&&(e.cancelAll(),o&&e.addFile(o)),e.uploadUrl="",e.removeUrl="",e.autoUpload=!1,i&&(i.uploadUrl&&(e.uploadUrl=i.uploadUrl,e.autoUpload=!0),i.removeUrl&&(e.removeUrl=i.removeUrl)),e.dropZone=e.parentElement,e.accept=a.allowedTypes||(r||"video"!==a.name?"image/*":"video/mp4,video/x-m4v,video/*"),void(e.hideFooter=!0);if(e instanceof Smart.ListBox)e.selectionMode="one",e.itemHeight=35;else{if("string"==typeof e.placeholder&&(e.placeholder=n.localize(t+"Placeholder")||""),e.dropDownClassList&&(e.dropDownClassList=["smart-editor-input"]),void 0!==e.dataSource){if("target"===t||"alignment"===t||"display"===t){e.dataSource.length||(e.dataSource=n._getDefaultDataSource(t)),"alignment"!==t||o||(o="center");const a=o?e.dataSource.find((e=>"object"==typeof e&&e.value===o)):void 0;a&&"object"==typeof a&&(o=a.label||o),e.readonly=!a&&!o||a&&""!==a.value}else e.dataSource=[];"string"==typeof e.dropDownButtonPosition&&(e.dropDownButtonPosition=e.dataSource.length?n.rightToLeft?"left":"right":"none")}e.value=void 0===o?"":o+""}}}_setEditorCommonProperties(e){const t=this;if(e){const o=e.messages,n=t.messages,a=t.locale;for(let e in o.en){const t=n[a][e];void 0!==t&&(o[a]||(o[a]={}),o[a][e]=t)}e.locale=t.locale,e.rightToLeft=t.rightToLeft,e.animation=t.animation,e.theme=t.theme}}_createWindow(){const e=this,t=e.$.window;if(t)return t;const o=document.createElement("smart-window");return o.classList.add("smart-editor-window"),o.id=e.id+"Window",o.setAttribute("smart-id","window"),e.$.window=o,e.$window=Smart.Utilities.Extend(o),o.rightToLeft=e.rightToLeft,o.theme=e.theme,o.animation=e.animation,o.disableSnap=!0,o.headerButtons=["close"],o}_createWindowTemplate(e){const t=this,o=t.animation,n=t.theme,a=t.rightToLeft;let i;return"footer"===e&&(i=document.createElement("template"),i.innerHTML=`<smart-button class="smart-editor-window-button primary replace replace-all smart-hidden"\n                    animation="${o}" theme="${n}" ${a?"right-to-left":""}>\n                </smart-button>\n                <smart-button class="smart-editor-window-button ok primary"\n                    animation="${o}" theme="${n}" ${a?"right-to-left":""}>\n                </smart-button>\n                <smart-button class="smart-editor-window-button cancel"\n                    animation="${o}" theme="${n}" ${a?"right-to-left":""}>\n                </smart-button>`),i}_positionWindow(){const e=this,t=e.getShadowRootOrBody(),o=e.$.window;if(!o||!t.contains(o))return;const n=e.getBoundingClientRect();o.opened||(o.style.left=o.style.top=""),o.style.left=Math.max(n.left+window.pageXOffset,n.left+window.pageXOffset+n.width/2-o.offsetWidth/2)+"px",o.style.top=Math.max(n.top+window.pageYOffset,n.top+window.pageYOffset+n.height/2-o.offsetHeight/2)+"px"}_windowChangeHandler(e){const t=this,o=e.detail,n=t.$.window._target.item;let a=(e.originalEvent||e).target;const i=a.closest(".smart-editor-window-editor");if(!a.hasAttribute("item-editor")||!n||!i)return;const r=i.getAttribute("type");if(n.name.indexOf("link")>0&&"target"===r&&a instanceof Smart.Input)a.readonly=!!o.value.length;else if(t._windowEditors&&n.name.indexOf("findandreplace")>-1)if("results"===r&&a instanceof Smart.ListBox)t._handleMarkerSelection(e.target);else if("matchCase"===r&&a instanceof Smart.CheckBox){const e=i.parentElement.querySelector('.smart-editor-window-editor[type="find"] [item-editor]');e&&t._findMatches(e.value)}}_windowClickHandler(e){const t=this;let o=(e.originalEvent||e).target;o.shadowRoot&&(o=(e.originalEvent||e).composedPath()[0]);const n=t.$.window,a=n._target,i=o.closest(".smart-editor-window-button");if(n&&i&&a){if("findandreplace"===a.item.name){const e=i.classList,o=i.classList.contains("replace-all");if(o||e.contains("ok"))return void t._replaceMatches(n._target.item,o)}else if(i.classList.contains("ok")&&!1===t._updateEditorViaWindow(a.item))return;n.close(),delete n._target}}_windowCloseHandler(e){const t=this,o=e.target;if(!o.classList.contains("smart-editor-window"))return;const n=t.$window;if(n){t.$.fireEvent("dialogClose",{target:e.target,item:e.target._target.item}),n.unlisten("close"),n.unlisten("click"),n.unlisten("change"),n.unlisten("keydown"),n.unlisten("uploadCompleted"),n.unlisten("uploadError"),t.hasAttribute("aria-owns")&&t.removeAttribute("aria-owns"),t.hasAnimation||(o.remove(),t._setAriaOwns(o));const a=o._target,i=a.itemTarget;if("findandreplace"===a.item.name&&t._findMatches(""),t._focusEditableElement(),i&&["img","th","td","table"].indexOf(i.nodeName.toLowerCase())>-1)return void t._setResizeFrame(i)}}_windowKeyDownHandler(e){const t=this,o=t.$.window;if("Enter"!==e.key||!o._target)return;const n=o._target.item,a=o.getRootNode().activeElement;if(n&&a.closest(".smart-editor-window-editor")){if(!1===t._updateEditorViaWindow(n))return;e.stopPropagation(),e.preventDefault(),o.close(),delete o._target}}_windowKeyUpHandler(e){const t=this,o=e.target;if(o.closest('.smart-editor-window-editor[type="find"]')){const e=o.closest("[item-editor]");if(e){const o=t.findAndReplaceTimeout;if(clearTimeout(t._findAndReplaceTimeout),"html"!==t.editMode)return;o?t._findAndReplaceTimeout=setTimeout((()=>t._findMatches(e.value)),o):t._findMatches(e.value)}}}_windowOpenHandler(e){const t=this,o=e.target;if(!o.classList.contains("smart-editor-window"))return;const n=t.$window;if(n){const a=o._target.item;if(t._setAriaOwns(o),t.$.fireEvent("dialogOpen",{target:e.target,item:a}),n.unlisten("open"),"findandreplace"===a.name){const e=o.querySelector('.smart-editor-window-editor[type="find"] [item-editor]');t._findMatches(e?e.value:"")}}}_windowTransitionendHandler(e){const t=this,o=e.target;o.classList.contains("smart-editor-window")&&(o.opened||"visibility"!==e.propertyName||(t.$window.unlisten("transitionend"),t.$.window.remove(),t._setAriaOwns(o)))}_updateEditorViaWindow(e){const t=this;if(!e||!t._windowEditors)return;const o=t.$.iframe,n=t.$.editableElement;let a,i;t.$.contentContainer.contains(n.getRootNode().activeElement)||t._focusEditableElement(),o?(a=o.contentWindow,i=a.getSelection()):(a=window,i=window.getSelection());const r=t._windowEditors[e.name],l=t._getSelectionRange();let s;if(r&&!t.$.fireEvent("actionStart",{name:e.name}).defaultPrevented){switch(l instanceof a.Range&&(i.removeAllRanges(),i.addRange(l)),e.name){case"editlink":case"createlink":case"hyperlink":s=t._handleLinksInsert(e);break;case"image":s=t._handleImageInsert(e);break;case"table":t._handleTableInsert(t._getItemOptionsViaWindow(e));break;case"paste":t._handlePasteViaWindow(e);break;case"video":s=t._handleVideoInsert(e)}return t.$.fireEvent("actionEnd",{name:e.name}),s?(s(),!1):void 0}}_focusFirstInputCallback(e,t){const o=this._windowEditors[e];if(o)return()=>{const e=o.querySelector(`.smart-editor-window-editor[type="${t}"] .smart-input[item-editor]`);e&&e.focus({preventScroll:!0})}}_fileUploadCompletedHandler(e){const t=this.$.window;let o;t&&t.opened&&t._target&&(o=t._target.item),e.stopPropagation(),this.$.fireEvent("imageUploadSuccess",Object.assign({target:e.target,toolbarItem:o},e.detail))}_fileUploadErrorHandler(e){const t=this.$.window;let o;t&&t.opened&&t._target&&(o=t._target.item),e.stopPropagation(),this.$.fireEvent("imageUploadFailed",Object.assign({target:e.target,toolbarItem:o},e.detail))}_replaceMatches(e,t){const o=this,n=o.$.editableElement;if(!e||!o._windowEditors||"html"!==o.editMode||n.classList.contains("smart-hidden"))return;const a=o._getItemOptionsViaWindow(e),i=o._windowEditors[e.name],r=i.querySelector('.smart-editor-window-editor[type="results"] smart-list-box[item-editor]'),l=i.querySelector('.smart-editor-window-editor[type="results"] label'),s=r.selectedIndexes;if(!a||!s||!s.length)return;const d=a.replaceWith,c=Array.from(n.querySelectorAll(".find-and-replace-match"));for(let e=0,o=c.length;e<o;e+=1){const o=c[e];(t||s.indexOf(e)>-1)&&(o.outerHTML=d)}t?r.dataSource=[]:s.forEach((e=>r.removeAt(e))),o._setFindAndReplaceLabel(l,r)}_findMatches(e){const t=this,o=t.$.editableElement,n=t._windowEditors,a=n?n.findandreplace:void 0,i=a.querySelector('.smart-editor-window-editor[type="results"] smart-list-box[item-editor]'),r=a.querySelector('.smart-editor-window-editor[type="results"] label'),l=a.querySelector('.smart-editor-window-editor[type="matchCase"] smart-check-box[item-editor]'),s=t.$.window.querySelectorAll(".smart-editor-window-button.replace");i&&"smart-list-box"===i.nodeName.toLowerCase()&&(i.dataSource=[]),t._findAndReplaceTimeout&&(clearTimeout(t._findAndReplaceTimeout),delete t._findAndReplaceTimeout);const d=Array.from(o.querySelectorAll(".find-and-replace-match"));for(let e=0,t=d.length;e<t;e+=1){const t=d[e];t.outerHTML=t.textContent}if("html"===t.editMode)if(e){i.dataSource=t._getFindMarkers(o,new RegExp(e,"gm"+(l.checked?"":"i")),[]),i.select("0"),t._setFindAndReplaceLabel(r,i);for(let e=0,t=s.length;e<t;e+=1)s[e].disabled=!1}else{t._setFindAndReplaceLabel(r);for(let e=0,t=s.length;e<t;e+=1)s[e].disabled=!0}}_clearSearchToolbar(){const e=this,t=e._searchToolbar;t&&!t.classList.contains("smart-visibility-hidden")&&(t.value="",delete e._lastSearchQuery)}_applySearching(e){const t=this,o=t.$.editableElement;if(t._lastSearchQuery===e||o.classList.contains("smart-hidden"))return;const n=t.$.contentContainer.querySelector(".smart-search-input-container");let a;t._findAndReplaceTimeout&&(clearTimeout(t._findAndReplaceTimeout),delete t._findAndReplaceTimeout);const i=Array.from(o.querySelectorAll(".find-and-replace-match"));for(let e=0,t=i.length;e<t;e+=1){const t=i[e];t.outerHTML=t.textContent}if("html"===t.editMode){if(e){a=t._getFindMarkers(o,new RegExp(e,"gmi"),[]).length;const n=o.querySelector(".find-and-replace-match");n&&(n.classList.add("selected"),t._scrollToMarker(n))}n&&(n.setAttribute("matches",a||0),n.setAttribute("selected",a?1:0)),t._lastSearchQuery=e}}_scrollToMarker(e){const t=this,o=t._searchToolbar,n=o&&!t._searchToolbar.classList.contains("smart-visibility-hidden")?o.offsetHeight:0,a=t.$.editableElement,i=a.getBoundingClientRect(),r=e.getBoundingClientRect(),l=a.scrollLeft,s=a.scrollTop,d=i.height,c=i.width,m=r.height,u=r.width,b=r.top-i.top+s,p=r.left-i.left+l;s+n>b||l>p?a.scrollTo(p-c,b-n-10):(s+d<b+m||l+c<p+u)&&a.scrollTo(p+u-c,b+m-d)}_setFindAndReplaceLabel(e,t){if(!e)return;const o=t?t.items.length:0;if(!t||!o)return e.removeAttribute("matches"),void e.removeAttribute("selected");if(e){const n=t.selectedIndexes[0];e.setAttribute("matches",o),e.setAttribute("selected",n?n+1:1)}}_getFindMarkers(e,t,o){const n=this,a=Array.from(e.childNodes);for(let e=0,i=a.length;e<i;e+=1){const i=a[e];if(i.childElementCount)n._getFindMarkers(i,t,o);else if(i.textContent){const e=document.createDocumentFragment(),n=i.textContent;let a,r=0;if(n.matchAll)a=Array.from(n.matchAll(t));else{let e;for(a=[];e=t.exec(n);)a.push(e)}if(a.forEach((t=>{const n=t.input,a=t.index,i=t[0],l=n.substring(r,a),s=o.length,d=document.createElement("span");l.length&&e.appendChild(document.createTextNode(l)),d.classList.add("find-and-replace-match"),d.setAttribute("match-id",s),d.textContent=i,e.appendChild(d);const c=n.substring(Math.max(0,a-10),a),m=n.substr(a+i.length,10);o.push({label:`${a>0?"...":""}${c}<b>${i}</b>${m}${a<n.length-1?"...":""}`,value:s}),r=a+i.length})),!e.childElementCount)continue;const l=i.textContent.substr(r);l&&e.appendChild(document.createTextNode(l)),i.nodeType===Node.TEXT_NODE?(i.parentElement.insertBefore(e,i),i.remove()):(i.innerHTML="",i.appendChild(e))}}return o}_handleMarkerSelection(e){const t=this,o=e.selectedValues[0],n=t.$.editableElement.querySelectorAll(`.find-and-replace-match.selected, .find-and-replace-match[match-id="${o}"]`);let a;for(let e=0,t=n.length;e<t;e+=1){const t=n[e];t.getAttribute("match-id")===o?(t.classList.add("selected"),a=t):t.classList.remove("selected")}a&&t._scrollToMarker(a);const i=t._windowEditors,r=i?i.findandreplace:void 0,l=r?r.querySelector('.smart-editor-window-editor[type="results"] label'):void 0;if(l){const t=e.selectedIndexes;l.setAttribute("selected",t.length?t[0]+1:0)}}_handleImageInsert(e){const t=this,o=t._getItemOptionsViaWindow(e),n=t.$.window;if(!n)return;let a,i,r,l,s,d=n._target.itemTarget;if(o.file.length?(l=o.file[0],a=URL.createObjectURL(l)):o.url&&(a=o.url+""),!a&&o)return t._focusFirstInputCallback(e.name,"url");if("markdown"===t.editMode)return i=o.title?` "${o.title}"`:"",void t._insertMarkDown(`![${o.alt}](${a}${i})`);const c=t.$.iframe,m=t.$.editableElement,u=c?c.contentDocument:document;if(!d||"img"!==d.nodeName.toLowerCase()){const e=t.id+"newImage"+Math.random().toString(36).substr(2,5);s=u.execCommand("insertHTML",!1,`<img id="${e}"></img>`),d=m.querySelector("#"+e)}if(d&&"img"===d.nodeName.toLowerCase()){const e="inline"===o.display.toLowerCase()?"inline":"block",n=o.width+"",i=o.height+"";if(t._handleImgCaption(d,o),s&&(d.id=""),URL.revokeObjectURL(d.src),d.src=a,l&&(d.file=l,"base64"===t.imageFormat)){const e=new FileReader;e.readAsDataURL(l),e.onload=()=>d.src=e.result}if(d.removeAttribute("width"),d.removeAttribute("height"),d.style.width=n&&"auto"!==n?parseFloat(n)+(n.indexOf("%")>-1?"%":"px"):"",d.style.height=i&&"auto"!==i?parseFloat(i)+(i.indexOf("%")>-1?"%":"px"):"",o.alt&&(d.alt=o.alt),o.title&&(d.title=o.title),o.alignment){const e=o.alignment.toLowerCase();r=e.indexOf("left")>-1?"left":e.indexOf("right")>-1?"right":"center"}d.setAttribute("resizable",o.resizable),d.setAttribute("draggable",o.draggable);const c=d.closest(".smart-editor-image-container");c?(c.setAttribute("alignment",r),c.setAttribute("display",e),d.removeAttribute("alignment"),d.removeAttribute("display")):(d.setAttribute("alignment",r),d.setAttribute("display",e))}}_handleVideoInsert(e){const t=this,o=t._getItemOptionsViaWindow(e),n=t.$.window;if(!n)return;let a,i,r,l,s=n._target.itemTarget;if(o.file.length?(r=o.file[0],a=URL.createObjectURL(r),s&&"video"!==s.nodeName.toLowerCase()&&(s.remove(),s=void 0)):(o.src||o.videoUrl)&&(a=(o.src||o.videoUrl)+"",s&&"iframe"!==s.nodeName.toLowerCase()&&(s.remove(),s=void 0)),s&&s.file&&(r=s.file),!a&&!r&&o)return t._focusFirstInputCallback(e.name,"src");if("markdown"===t.editMode)return i=o.title?` "${o.title}"`:"",void t._insertMarkDown(`[![${o.alt}](${a||o.thumbnail||""})](${o.videoUrl} ${i})`);const d=t.$.iframe,c=t.$.editableElement,m=d?d.contentDocument:document;if(!r||s&&"video"===s.nodeName.toLowerCase()){if(!(r||s&&"iframe"===s.nodeName.toLowerCase())){const e=t.id+"newVideo"+Math.random().toString(36).substr(2,5);l=m.execCommand("insertHTML",!1,`<iframe id="${e}" frameborder="0" allowfullscreen></iframe>`),s=c.querySelector("#"+e)}}else{const e=t.id+"newVideo"+Math.random().toString(36).substr(2,5);l=m.execCommand("insertHTML",!1,`<video id="${e}"></video>`),s=c.querySelector("#"+e)}if(s){if(l&&s.removeAttribute("id"),URL.revokeObjectURL(s.src),s.controls=!0,s.frameborder=0,s.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",t._handleVideoCaption(s,o),void 0!==o.width){const e=o.width+"";s.style.width=e?e+(e.indexOf("%")<0?"px":""):""}if(void 0!==o.height){const e=o.height+"";s.style.height=e?e+(e.indexOf("%")<0?"px":""):""}if(r){if(s.file===r)return;if(s.file=r,"base64"===t.imageFormat){const e=new FileReader;e.readAsDataURL(r),e.onload=()=>s.src=e.result}}else s.src!==a&&(s.src=a)}}_insertMarkDown(e,t,o){const n=this;if("markdown"!==n.editMode)return;const a=n.$.input,i=n._getSelectionRange(),r=i.selectionStart,l=i.selectionEnd;let s,d=a.value;if(void 0!==r&&r!==l&&(s=d.slice(r,l)),o){let t=d.lastIndexOf("\n",r-1)+1;for(;" "===d[t+1];)t++;a.value=d.slice(0,t)+e+d.slice(t)}else a.value=d.slice(0,a.selectionStart)+e+d.slice(a.selectionEnd);void 0!==r&&(void 0===t&&(t=r+e.length),s?o?n._setSelectionRange(a,r+e.length,l+e.length):(d=a.value,a.value=d.slice(0,t)+s+d.slice(t),n._setSelectionRange(a,t,t+s.length)):n._setSelectionRange(a,t,t)),n._refreshMarkdownPreview()}_removeMarkDown(e,t,o){const n=this,a=n.$.input,i=a.value,r=n._getSelectionRange(),l=r.selectionStart,s=r.selectionEnd,d=e.length;a.value=i.slice(0,t)+i.slice(t+d),n._setSelectionRange(a,l-d,s-d),o||n._refreshMarkdownPreview()}_handleLinksInsert(e){const t=this,o=t.$.window,n=t.editMode,a=t._getItemOptionsViaWindow(e);if(!a.address)return t._focusFirstInputCallback(e.name,"address");if("markdown"===n){let e;return e=a.title?`[${a.text}](${a.address}, "${a.title}")`:`[${a.text}](${a.address})`,void t._insertMarkDown(e)}const i=t.$.iframe,[r,l]=i?[i.contentDocument,i.contentWindow]:[document,window],s=l.getSelection();let d,c,m=s.anchorNode?s.anchorNode.parentElement:void 0,u=o&&o._target?o._target.itemTarget:void 0;u&&"img"===u.nodeName.toLowerCase()?(d=o._target.itemTarget,m=d.parentElement,m&&"a"===m.nodeName.toLowerCase()||(m=document.createElement("a"),d.parentElement.insertBefore(m,d),m.appendChild(d))):m=s.anchorNode?s.anchorNode.parentElement:void 0,a.address&&"a"!==m.nodeName.toLowerCase()&&(c=r.execCommand("createLink",!1,a.address),m=s.anchorNode.parentElement),"a"===m.nodeName.toLowerCase()&&(a.address?c||m.setAttribute("href",a.address):m.setAttribute("href",""),a.text?m.textContent=a.text:m.innerHTML||(m.textContent=a.address||""),m.title=a.title||"",m.target=a.target||"",d||s.selectAllChildren(m))}_refreshMarkdownPreview(){const e=this,t=e.$.input;if(e.$.contentContainer.hasAttribute("split-mode")){let o=t.value;e.$.editableElement.innerHTML=window.marked?window.marked(o):o}}_handleImgCaption(e,t){const o=this;if(!t)return;let n,a=e.closest(".smart-editor-image-container");const i=e.nodeName.toLowerCase(),r="video"===i||"iframe"===i&&e.src.indexOf("/embed")>-1;if(t.caption||r){if(a||(a=document.createElement("span"),a.classList.add("smart-editor-image-container"),a.setAttribute("draggable",!1),a.setAttribute("contenteditable",!1),e.hasAttribute("alignment")&&a.setAttribute("alignment",e.getAttribute("alignment")),e.hasAttribute("display")&&a.setAttribute("display",e.getAttribute("display")),e.parentElement.insertBefore(a,e),a.appendChild(e)),a.classList[r?"add":"remove"]("smart-editor-video-container"),n=a.querySelector(".smart-editor-image-caption"),n||(n=document.createElement("span"),n.setAttribute("contenteditable",!0),n.classList.add("smart-editor-image-caption"),a.appendChild(n)),n.textContent=t.caption,t.focusCaption)return delete o._toolbarItemClick,o._setSelectionRange(n),o._setResizeFrame(),void o.$.editableElement.scrollTo(n.offsetLeft,n.offsetTop)}else!t.caption&&a&&(a.hasAttribute("alignment")&&e.setAttribute("alignment",a.getAttribute("alignment")),a.hasAttribute("display")&&e.setAttribute("display",a.getAttribute("display")),a.parentElement.insertBefore(e,a),a.remove());o._resizeFrameObj&&o._resizeFrameObj.target&&o._setResizeFrame(o._resizeFrameObj.target,!0)}_handleVideoCaption(e,t){const o=this,n=e?e.nodeName.toLowerCase():void 0;if(!t||"video"!==n&&"iframe"!==n)return;let a=e.closest(".smart-editor-video-container");if(a||(a=document.createElement("span"),a.classList.add("smart-editor-image-container","smart-editor-video-container"),a.setAttribute("contenteditable",!1),e.parentElement.insertBefore(a,e),a.appendChild(e)),a.setAttribute("resizable",t.resizable),!1===t.draggable?a.setAttribute("draggable",!1):a.removeAttribute("draggable"),t.title&&(e.title=t.title),t.alignment){let e=t.alignment.toLowerCase();e=e.indexOf("left")>-1?"left":e.indexOf("right")>-1?"right":"center",a.setAttribute("alignment",e)}if(t.display){const e="inline"===t.display.toLowerCase()?"inline":"block";a.setAttribute("display",e)}if(t.caption){let e=a.querySelector(".smart-editor-image-caption");if(e||(e=document.createElement("span"),e.setAttribute("contenteditable",!0),e.classList.add("smart-editor-image-caption"),a.appendChild(e)),e.textContent=t.caption,t.focusCaption)return delete o._toolbarItemClick,o._setSelectionRange(e),o._setResizeFrame(),void o.$.editableElement.scrollTo(e.offsetLeft,e.offsetTop)}else if(!t.caption){let e=a.querySelector(".smart-editor-image-caption");e&&e.remove()}o._resizeFrameObj&&o._resizeFrameObj.target&&o._setResizeFrame(o._resizeFrameObj.target,!0)}_handleTableInsert(e){const t=this,o=t.editMode;if(!e)return;if("markdown"===o)return void t._insertTableMarkdown(e);const n=t._getSelectionRange();let a,i,r,l;if(e.cells){const t=e.cells;[r,l]=[t[1],t[0]]}else{let t=n.startContainer;[r,l]=[parseInt(e.cols),parseInt(e.rows)],t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),a=t&&t.closest&&t.closest(".smart-editor-editable table")}if(!a){const e=t.$.editableElement,o=t.$.iframe,r=(o?o.contentWindow:window).getSelection();r.removeAllRanges(),r.addRange(n);const l=t.id+"newTable"+Math.random().toString(36).substr(2,5);i=(o?o.contentDocument:document).execCommand("insertHTML",!1,`<table id="${l}"><tbody></tbody></table>`),a=e.querySelector("#"+l)}if(a&&"table"===a.nodeName.toLowerCase()){let o,n=a.querySelector("tbody");for(n?o=Array.from(n.children):(a.innerHTML="<tbody></tbody>",n=a.firstElementChild,o=[]);o.length>l;)o.pop().remove();for(let e=o.length,t=l;e<t;e+=1)o.push(document.createElement("tr"));for(let e=0,t=o.length;e<t;e+=1){const t=o[e],a=Array.from(t.children);for(;a.length>r;)a.pop().remove();for(let e=0,o=r;e<o;e+=1){let o=a[e];o||(o=t.appendChild(document.createElement("td")))}t.parentElement||n.appendChild(t)}void 0===e.tableheader?e.tableheader=!!a.querySelector("th"):void 0===e.altrows?e.altrows=a.hasAttribute("alternation"):void 0===e.dashedborders?e.dashedborders=a.hasAttribute("dashed-borders"):void 0===e.resizable&&(e.resizable="false"!==a.getAttribute("resizable")),t._handleTableHeader(a,e.tableheader),e.altrows?a.setAttribute("alternation",""):a.removeAttribute("alternation"),e.dashedborders?a.setAttribute("dashed-borders",""):a.removeAttribute("dashed-borders");const s=e.width,d=e.height;a.style.width=s?s+(s.indexOf("%")<0?"px":""):"",a.style.height=d?d+(d.indexOf("%")<0?"px":""):"",i&&a.removeAttribute("id"),a.setAttribute("aria-rowcount",l),a.setAttribute("aria-colcount",r),a.setAttribute("resizable",e.resizable)}t._setResizeFrame(a)}_insertTableMarkdown(e){const t=this,o=e.cells,[n,a]=o?[o[1],o[0]]:[parseInt(e.cols),parseInt(e.rows)],i=t.localize("alphabet"),r=t.localize("header"),l=t.localize("column");let s="";if(!1!==e.tableheader){let e="",t=Math.max(3,r.length)+3;for(;t>0;)e+="-",t--;for(let e=1;e<=n;e+=1)s+=`| ${r} ${e} `;s+="|\n";for(let t=0;t<n;t++)s+=`|${e} `;s+="|\n"}for(let e=0;e<a;e++){const t=i[Math.max(0,e-1)%i.length].toUpperCase();for(let e=1;e<=n;e+=1)s+=`| ${l} ${t} ${e} `;s+="|\n"}t._insertMarkDown(s)}_handleTableSelection(e){const t=this,o=t.$.editableElement;if(t._tableCell&&t._tableCell.removeAttribute("selected"),"false"!==o.getAttribute("contenteditable"))return e&&["th","td"].indexOf(e.nodeName.toLowerCase())>-1?(t._tableCell=e,void e.setAttribute("selected","")):void delete t._tableCell}_getItemOptionsViaWindow(e){const t=this._windowEditors[e.name];if(!t)return;const o=t.children;let n={};for(let e=0,t=o.length;e<t;e+=1){const t=o[e].getAttribute("type"),a=o[e].querySelector("[item-editor]");let i;if(t){if(a instanceof Smart.Input)if(void 0===a.$.input.dataValue&&a.dataSource&&a.dataSource.length){const e=a.dataSource[0];i="string"==typeof e?e:e.value||e.label}else i=a.$.input.dataValue||a.value;else a instanceof Smart.CheckBox||a instanceof Smart.RadioButton?i=a.checked:a instanceof Smart.FileUpload?i=a.value:a instanceof Smart.ListBox&&(i=a.selectedIndexes);n[t]=i}}return n}_closeToolbarItemDropDown(e){const t=this,o=()=>{e.opened||e.remove()};e&&(e.opened?(e.hasAnimation&&(e.removeEventListener("transitionend",o),e.addEventListener("transitionend",o,{once:!0})),e.close(),t._setAriaOwns(e)):o())}_openToolbarItemDropDown(e,t){const o=this,n=e.getBoundingClientRect();o._setupDropDown(e,t),t.style.width=n.width+"px",t.style.height=n.height+"px",e.contains(t)||e.appendChild(t),t.open(),o._setAriaOwns(t),o._setAriaControls(e,t)}_setupDropDown(e,t){const o=this,n=o.$.inlineToolbar,a=n&&n.contains(e)?o._inlineToolbarItemsObj:o._toolbarItemsObj,i=a?a[e.getAttribute("item-name")]:void 0;let r;if(i&&(r=i.dataSource),r||(r=[]),t instanceof Smart.ColorInput?t.dropDownClassList=["smart-editor-color-input"]:(t.dropDownClassList=["smart-editor-input"],t.dropDownHeight=300),t.classList.add("smart-editor-item-drop-down"),t.readonly=!0,t.dataSource=r,t.dropDownOpenMode="manual",t.dropDownButtonPosition=o.rightToLeft?"left":"right",void 0!==i.value){const e=i.name;t.value=e.indexOf("table")>-1||e.indexOf("paste")>-1?"":i.value+""}else t.value=""}_toggleToolbar(e){const t=this,o=t.$.toolbar,n=t.$.contentContainer,a=t.toolbarViewMode,i="toggle"===a,r=t.$.toolbarToggleButton,l=t.$.toolbarItemsPrimary,s=t.hasAnimation;o.style.transition=s&&i?"none":"",o.style.height="";const d=o.offsetHeight,c=n.offsetHeight;if(e&&"toggle"===a){if(r.removeAttribute("checked"),r.setAttribute("aria-pressed",!1),!o.hasAttribute("expanded"))return void(o.style.transition="");o.removeAttribute("expanded")}else{if(r.setAttribute("checked",""),r.setAttribute("aria-pressed",!0),o.hasAttribute("expanded"))return o.style.transition="",void(t.$.toolbarItemsSecondary.innerHTML&&t._refreshToolbarItems());"scroll"!==a?o.setAttribute("expanded",""):o.removeAttribute("expanded")}if(t._refreshToolbarItems(),"menu"!==t.toolbarMode)return void(o.hasAttribute("expanded")?(l.querySelector(".smart-editor-toolbar-tab[checked]")||t._selectToolbarTab(l.firstElementChild),t._toggleSecondaryToolbar(!0)):(t._selectToolbarTab(null),t._toggleSecondaryToolbar()));if(!i)return;const m=o.offsetHeight,u=t.$.inlineToolbar;u&&u.visible&&u.reposition(),t._resizeFrameObj&&t._setResizeFrame(t._resizeFrameObj.target),o.style.height=d+"px",n.style.height=c+"px",s&&requestAnimationFrame((()=>{o.style.transition="",o.style.height=m+"px",n.style.height=c+d-m+"px",requestAnimationFrame((()=>o.style.height=n.style.height=""))}))}_predefPropertyGetter(e="value"){const t=this;Object.defineProperty(t,e,{get:function(){return t.context===t?t.properties[e].value:t._getCurrentValue()},set(o){t._properties[e].value=t._getCurrentValue(),t.updateProperty(t,t._properties[e],o)}})}_getCurrentValue(){const e=this;if("markdown"===e.editMode)return e.$.input.value;let t=e.$.editableElement.innerHTML;return e.enableHtmlEncode&&(t=t.replaceAll("<","&lt;").replaceAll(">","&gt;")),t}_getInputValue(e,t){const o=this.$.input;return void 0===e&&(e=o.value),e=!t&&this.enableHtmlEncode?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e.replaceAll("&lt;","<").replaceAll("&gt;",">")}_handleEditMode(e){const t=this,o=t.$.input,n=t.$.editableElement,a=t.editMode,i=t._toolbarItemsObj.sourcecode,r=!!i&&i.value;t._closePopups(),"html"===e?r?o.value=n.innerHTML:n.innerHTML=o.value:"markdown"===e&&(r?n.innerHTML=window.marked?window.marked(o.value):o.value:o.value=n.textContent,t._closeSearchToolbar()),t.$.contentContainer.hasAttribute("split-mode")||("markdown"===a?r?(o.classList.add("smart-hidden"),n.classList.remove("smart-hidden")):(o.classList.remove("smart-hidden"),n.classList.add("smart-hidden")):r?(o.classList.remove("smart-hidden"),n.classList.add("smart-hidden")):(o.classList.add("smart-hidden"),n.classList.remove("smart-hidden"))),t.readonly||t.disableEditing||t.$.editableElement.setAttribute("contenteditable","markdown"!==a)}_handleInputContent(e,t){const o=this,n=o.$.editableElement,a=o.$.input,i=o.editMode;if(!o.isRendered&&o.autoLoad){const e=window.localStorage.getItem("smartEditor"+o.id);e&&o.set("value",e)}const r=o.value;void 0===t&&r&&(t=r),void 0!==t?"html"===i?o.$.editableElement.innerHTML=t:o.$.input.value=t:t||"markdown"!==i||(o.$.input.value=o.$.editableElement.textContent),o.$.contentContainer.hasAttribute("split-mode")?"markdown"===i?n.innerHTML=window.marked?window.marked(a.value):a.value:a.value=n.innerHTML.trim():o.classList.contains("preview-mode")&&("markdown"===i?n.innerHTML=window.marked?window.marked(a.value):a.value:a.value=n.innerHTML),n.textContent.length&&n.innerText.length?(n.removeAttribute("show-placeholder"),o._handleContentFiltering()):n.setAttribute("show-placeholder",""),o._clearSearchToolbar()}_sanitize(e,t){return this.sanitized?t.replaceAll(/(<[\/]?script[>]?)|([on].*=['"`]?.*['"`]?)|(SRC=['"`]?javascript:['"`]?)/gim,""):t}_handleContentFiltering(){const e=this,t=e.contentFiltering;if("html"===!e.editMode)return;const o=t.tags.map((e=>e.trim())),n=t.attributes.map((e=>e.trim())),a=t.styleAttributes.map((e=>e.trim()));if(!o.length&&!n.length&&!a.length)return;const i=t.tagFilterMode,r=t.attributeFilterMode,l=t.styleAttributeFilterMode;let s=e.$.editableElement.innerHTML;if(o.length){const e=new RegExp(/<\s*\/?\s*([a-z0-9]+).*?>/,"gmi");let t,n=[];for(;null!==(t=e.exec(s));){const e=t[1],a=o.indexOf(e)>-1;(a&&"blackList"===i||!a&&"whiteList"===i)&&n.push(t[0])}n.forEach((e=>s=s.replace(e,"")))}e.$.editableElement.innerHTML=s;const d=e.$.editableElement.querySelectorAll("*");for(let e=0,t=d.length;e<t;e+=1){const t=d[e];if(n.length){const e=Array.from(t.attributes);for(let o=0,a=e.length;o<a;o+=1){const a=e[o].name,i=n.indexOf(a)>-1;(i&&"blackList"===r||!i&&"whiteList"===r)&&t.removeAttribute(a)}}if(a.length){const e=t.getAttribute("style");if(!e)continue;const o=e.split(";");let n=[];for(let e=0,t=o.length;e<t;e+=1){const t=o[e],i=t.indexOf(":"),r=a.indexOf(t.slice(0,i>0?i:void 0))>-1;(r&&"whiteList"===l||!r&&"blackList"===l)&&n.push(t)}o.length&&(n.length?t.setAttribute("style",n.join(";")):t.removeAttribute("style"))}}e._setCharCount()}_handleContextMenuItemClick(e,t){if(!t||!t.classList.contains("smart-editor-context-menu-item"))return;const o=this,n=o.$.inlineToolbar,a=t.getAttribute("value");if(!n)return;const i=n.selector;switch(a){case"imageProperties":o._openWindow({name:"image"},i.closest(".smart-editor-editable img"));break;case"linkProperties":o._openWindow({name:"hyperlink"});break;case"tableProperties":o._openWindow({name:"table"},i.closest(".smart-editor-editable table"));break;case"videoProperties":{const e=i.closest(".smart-editor-video-container");if(e){const t=e.querySelectorAll(".smart-editor-video-container > video, .smart-editor-video-container > iframe");o._openWindow({name:"video"},t[0]||t[1])}break}case"insertRowAfter":case"insertRowBefore":case"deleteRow":o._handleTableRows(i.closest(".smart-editor-editable table"),{value:a});break;case"insertColumnLeft":case"insertColumnRight":case"deleteColumn":o._handleTableColumns(i.closest(".smart-editor-editable table"),{value:a});break;case"deleteImage":case"deleteTable":{const e=o._resizeFrameObj?o._resizeFrameObj.target:void 0;e&&o._deleteResizeFrameTarget(e);break}case"deleteVideo":{const e=i.closest(".smart-editor-video-container");if(e){const t=o._resizeFrameObj?o._resizeFrameObj.target:void 0;if(t===e){o._deleteResizeFrameTarget(t);break}e.remove()}break}case"createLink":o._openWindow({name:"hyperlink"},i.closest(".smart-editor-editable img"));break;case"deleteLink":o._handleLinkRemove(i);break;case"copyImage":o._handleImageCopy(i.closest(".smart-editor-editable img"));break;case"cutImage":o._handleImageCut(i.closest(".smart-editor-editable img"));break;case"copyVideo":o._handleImageCopy(i.closest(".smart-editor-video-container"));break;case"cutVideo":o._handleImageCut(i.closest(".smart-editor-video-container"));break;case"copy":case"cut":case"paste":o._handleClipboardAction(a);break;case"caption":{const e=i.closest(".smart-editor-editable img");let t;if(e&&"img"===e.nodeName.toLowerCase()){const n=e.closest(".smart-editor-image-container");n&&n.querySelector(".smart-editor-image-caption")||(t=o.localize("captionPlaceholder")),o._handleImgCaption(e,{caption:t,focusCaption:!0})}else if(i.classList.contains("smart-editor-video-container")){const e=i.querySelectorAll(".smart-editor-video-container > video, .smart-editor-video-container > iframe");i.querySelector(".smart-editor-image-caption")||(t=o.localize("captionPlaceholder")),o._handleVideoCaption(e[0]||e[1],{caption:t,focusCaption:!0})}break}case"selectAll":o._selectAll()}o.$.fireEvent("contextMenuItemClick",{originalEvent:e,value:a}),o._closeContextMenu()}_handleImageCopy(e){const t=this;if(!e||"img"!==e.nodeName.toLowerCase()&&!e.classList.contains("smart-editor-video-container"))return;const o=t._createWhiteSpaceChar(e,e.classList.contains("smart-editor-video-container")?e:void 0);t._setSelectionRange(e),t.$.editableElement.getRootNode().execCommand("copy"),o&&o.remove()}_handleImageCut(e){const t=this;if(!e||"img"!==e.nodeName.toLowerCase()&&!e.classList.contains("smart-editor-video-container"))return;const o=t._createWhiteSpaceChar(e,e.classList.contains("smart-editor-video-container")?e:void 0);t._setSelectionRange(e),t.$.editableElement.getRootNode().execCommand("cut"),t._setResizeFrame(),o&&o.remove()}_createWhiteSpaceChar(e,t){if(!t)return;const o=document.createElement("span");return o.innerHTML="&nbsp;",o.classList.add("smart-editor-video-white-space"),e.appendChild(o),o}_handleInputElement(){const e=this,t=e.iframeSettings,o=e.$.contentContainer,n=e.$.container,a=e.$.editableElement,i=e.$.input,r=e.readonly,l=e.disableEditing;if(a.contentEditable=!r&&!l,i.readonly=r||l,e._handlePlaceholder(),e._closePopups(),t.enabled?e._handleIframeSettings():n.contains(o)||(n.appendChild(o),a.setAttribute("contenteditable",!0),e.$.iframe&&(e.$.iframe.remove(),e._removeIframeEventListeners(),delete e.$.iframe)),"markdown"===e.editMode){const t=e.$.editableElement;e.$.input.classList.remove("smart-hidden"),t.classList.add("smart-hidden")}}_handleToolbarMode(){const e=this,t=e.$.toolbar,o=e.$.toolbarItemsSecondary,n=e.toolbarMode;e.$.toolbarItemsPrimary.innerHTML=o.innerHTML="","menu"===n?(o.classList.remove("smart-drop-down"),o.style.top=o.style.height="",t.contains(o)||t.appendChild(o),e._refreshToolbarItems(e._getToolbarItems())):(e._setToolbarTabs(),e._setToolbarItemGroups(),e._toolbarItemsObj||(e._toolbarItemsObj={}),e._refreshToolbarItems()),e._setToolbarGroupHeight()}_setToolbarTabs(){const e=this,t=e.toolbarRibbonConfig,o=e.$.toolbarToggleButton,n=e.$.toolbarItemsPrimary,a=n.querySelectorAll(".smart-editor-toolbar-tab"),i=document.createDocumentFragment();let r;for(let o=0,n=t.length;o<n;o+=1){const n=t[o];let l=a[o];l||(l=document.createElement("div")),l.classList.add("smart-editor-toolbar-tab"),l.setAttribute("tab-name",n.name),l.textContent=e.localize(n.name),!r&&l.hasAttribute("checked")&&(r=l),r!==l&&l.removeAttribute("checked"),l.classList[n.hidden?"add":"remove"]("smart-hidden"),i.appendChild(l)}o.hasAttribute("checked")&&!r&&i.children[0].setAttribute("checked",""),n.appendChild(i)}_setToolbarItemGroups(){const e=this,t=e.toolbarRibbonConfig,o=Array.from(e.$.toolbarItemsPrimary.querySelectorAll(".smart-editor-toolbar-tab")).find((e=>e.hasAttribute("checked")));if(!t||!o)return;const n=o.getAttribute("tab-name"),a=t.find((e=>e.name===n)),i=a?a.groups:null,r=e.$.toolbarItemsSecondary,l="singleLineRibbon"===e.toolbarMode;if(r.innerHTML="",!Array.isArray(i))return;const s=r.querySelectorAll(".smart-editor-toolbar-tab-group"),d=document.createDocumentFragment();for(let t=0,o=i.length;t<o;t+=1){const o=i[t],n=o.name;let a=s[t];if(a||(a=document.createElement("div")),l)a.innerHTML="",a.appendChild(e._getToolbarItems(e.$.toolbar,o.items));else{a.innerHTML='<div class="smart-editor-tab-group-container"></div><div class="smart-editor-tab-group-label"></div>';const t=a.firstElementChild;a.lastElementChild.innerHTML=e.localize(n),t.appendChild(e._getToolbarItems(e.$.toolbar,o.items))}a.classList.add("smart-editor-toolbar-tab-group"),a.setAttribute("group-name",n),d.appendChild(a)}r.appendChild(d),r.classList.remove("smart-visibility-hidden"),e._refreshToolbarTabs()}_refreshToolbarTabs(){const e=this,t=e._resizeFrameObj,o=Array.from(e.$.toolbarItemsPrimary.children).find((e=>"layouttab"===(e.getAttribute("tab-name")||"").toLowerCase()));if(!o)return;if(!t||!t.target||"singleLineRibbon"!==e.toolbarMode)return o.classList.add("smart-hidden"),void(o.hasAttribute("checked")&&e._selectToolbarTab(e.$.toolbarItemsPrimary.firstElementChild));const n=e.$.toolbarItemsSecondary.children,a=t.target,i=a.nodeName.toLowerCase();let r,l,s;for(let e=0,t=n.length;e<t;e+=1){const t=n[e],o=t.getAttribute("group-name");"tableGroup"===o?(l=t,l.classList.add("smart-hidden")):"imageGroup"===o?(r=t,r.classList.add("smart-hidden")):"videoGroup"===o&&(s=t,s.classList.add("smart-hidden"))}"table"===i?(o.classList.remove("smart-hidden"),l&&l.classList.remove("smart-hidden")):"img"===i?(o.classList.remove("smart-hidden"),r&&r.classList.remove("smart-hidden")):a.classList.contains("smart-editor-video-container")?(o.classList.remove("smart-hidden"),s&&s.classList.remove("smart-hidden")):o.classList.add("smart-hidden")}_handlePlaceholder(){const e=this.$.editableElement,t=this.placeholder;t?e.setAttribute("placeholder",t):e.removeAttribute("placeholder")}_handleIframeSettings(){const e=this;if(!e.iframeSettings.enabled)return;let t=e.$.iframe;t||(t=e.$.iframe=document.createElement("iframe")),t.parentElement||e.$.container.appendChild(t),!t.contentWindow.marked&&window.marked&&(t.contentWindow.marked=window.marked),e._handleIframeBody(),e._handleIframeAttributes(),e._handleIframeResources()}_removeIframeEventListeners(){const e=this,t=e.$.iframe.contentDocument,o=e.$iframe;o&&(o.unlisten("down"),o.unlisten("move"),o.unlisten("up")),t.removeEventListener("dragstart",e._iframeDragStartHandler),t.removeEventListener("dragend",e._iframeDragEndHandler),t.removeEventListener("selectionchange",e._iframeSelectionChangeHandler)}_handleIframeBody(){const e=this,t=e.$.iframe.contentDocument,o=t.body;if(!o)return;let n=e.$iframe;o.classList.add("smart-editor","smart-element","smart-editor-iframe-body"),o.appendChild(e.$.contentContainer),e._updateIframeBody(),n||(n=e.$iframe=Smart.Utilities.Extend(o)),e._iframeDownHandler=t=>e._documentDownHandler.call(e,t),e._iframeMoveHandler=t=>e._documentMoveHandler.call(e,t),e._iframeUpHandler=t=>e._documentUpHandler.call(e,t),e._iframeDragStartHandler=t=>e._dragStartHandler.call(e,t),e._iframeDragEndHandler=t=>e._dragEndHandler.call(e,t),e._iframeSelectionChangeHandler=t=>e._selectionChangeHandler.call(e,t),e._removeIframeEventListeners(),n.listen("down",e._iframeDownHandler),n.listen("move",e._iframeMoveHandler),n.listen("up",e._iframeUpHandler),t.addEventListener("dragstart",e._iframeDragStartHandler),t.addEventListener("dragend",e._iframeDragEndHandler),t.addEventListener("selectionchange",e._iframeSelectionChangeHandler)}_updateIframeBody(){const e=this,t=e.$.iframe;if(!t)return;const o=t.contentDocument.body;o&&(e.rightToLeft?o.setAttribute("right-to-left",""):o.removeAttribute("right-to-left"),e.theme?o.setAttribute("theme",e.theme):o.removeAttribute("theme"),o.setAttribute("animation",e.animation))}_handleIframeAttributes(){const e=this,t=e.$.iframe,o=e.iframeSettings.attributes;if(!t)return;if(t.hasAttribute("title")||t.setAttribute("title",e.localize("iframeTitle")),!o||"object"!=typeof o)return;const n=e.$.editableElement;for(let e in o){const a=o[e];"readonly"===e?n.setAttribute("contenteditable",!a):t[e]=a}}_handleIframeResources(){const e=this.iframeSettings.resources,t=this.$.iframe;if(!t||"object"!=typeof e)return;const o=document.styleSheets,n=t.contentDocument,a=n.head,i=n.body;for(let e in o){const n=o[e],a=n.ownerNode;"text/css"===n.type&&a&&["link","style"].indexOf(a.nodeName.toLocaleLowerCase())>-1&&t.contentDocument.head.appendChild(n.ownerNode.cloneNode())}for(let t in e){const o=t,n=e[t];let r;if((o+"").indexOf("style")>-1||"link"===o?(r=document.createElement("link"),r.rel="stylesheet",r.type="text/css","string"==typeof n&&(r.href=n)):"script"===o&&(r=document.createElement("script"),r.type="text/javascript","string"==typeof n&&(r.src=n)),"object"==typeof n&&"[object Object]"===n.toString())for(let e in n)r[e]=n[e];"module"===r.type?i.appendChild(r):a.appendChild(r)}}_handleMaxCharCount(){const e=this,t=e.$.input;null!==e.maxCharCount?t.maxLength=e.maxCharCount:t.removeAttribute("maxlength")}_getToolbarItems(e,t){const o=this;e||(e=o.$.toolbar),t||(t=o.toolbarItems);const n=e===o.$.toolbar?"toolbar":"inlineToolbar",a=e.querySelectorAll(".smart-editor-toolbar-item"),i=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){const r=o._getToolbarItemDetails(n,t[e]),l=r.name,s=r.type;let d=a[e];if(d?"custom"===d.getAttribute("item-type")&&(d.innerHTML=""):(d=document.createElement("div"),d.classList.add("smart-editor-toolbar-item")),"color-input"===s)d.innerHTML||(d.innerHTML=`<div class="smart-editor-item-action-button" item-name="${l}"></div>\n                                               <div class="smart-editor-item-drop-down-button"></div>`);else if("custom"===s){const e=r.template;d.innerHTML="",e&&e.closest&&!d.contains(e)?d.appendChild(e):"string"!=typeof e||d.innerHTML?"function"==typeof e&&e(d,r):d.innerHTML=e||""}else"toggle"===s&&(r.value?(d.setAttribute("checked",""),d.setAttribute("aria-pressed",!0)):(d.removeAttribute("checked"),d.setAttribute("aria-pressed",!1)),d.innerHTML&&(d.innerHTML=""));r.disabled||"paste"===l&&o._isFireFox?(d.setAttribute("disabled",""),d.setAttribute("aria-disabled",!0)):(d.removeAttribute("disabled"),d.removeAttribute("aria-disabled")),d.setAttribute("role","delimiter"===s?"separator":"button"),"color-input"===s||"drop-down"===s?d.setAttribute("aria-haspopup",!0):d.removeAttribute("aria-haspopup"),o._setItemValue(d,r),r.title?d.setAttribute("title",r.title):d.removeAttribute("title"),d.setAttribute("item-name",l),d.setAttribute("item-type",s),d.style.width=r.width||"",i.appendChild(d)}return i}_setItemValue(e,t){const o=this;let n=t.value;e&&t&&("button"===t.type?n?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)):(n||"color-input"!==t.type?["fontname","formats"].indexOf(t.name)>-1&&(n=o.localize(t.value)||t.label||t.value):n="transparent",n?(e.setAttribute("item-value",n),e.style.setProperty("--item-value",n)):(e.removeAttribute("item-value"),e.style.removeProperty("--item-value"))))}_refreshToolbarItems(e){const t=this,o=t.$.toolbar,n=t.$.toolbarToggleButton,a=t.$.toolbarItemsPrimary,i=t.$.toolbarItemsSecondary;if("menu"===t.toolbarMode){if(a.scrollTop=a.scrollLeft=0,e)a.appendChild(e);else{const e=Array.from(i.children),t=document.createDocumentFragment(),o=e.length;for(let n=0;n<o;n+=1)t.appendChild(e[n]);o>0&&a.appendChild(t)}if("toggle"===t.toolbarViewMode){const e=a.offsetHeight;if(o.hasAttribute("expanded")){let t=[];e:for(;a.scrollHeight>e;){const e=a.lastElementChild;if(!e)break e;t.push(e),e.remove()}t.reverse();for(let e=0,o=t.length;e<o;e+=1)i.appendChild(t[e])}else a.scrollHeight===e&&n.classList.add("smart-visibility-hidden")}}else n.classList.remove("smart-visibility-hidden")}_resizeHandler(e){const t=this,o=t.$.inlineToolbar;if(e.target===t){if("toggle"===t.toolbarViewMode){const e=t.$.toolbarItemsPrimary,o=t.$.toolbarItemsSecondary;t.$.toolbar.hasAttribute("expanded")&&t._refreshToolbarItems();const n=t.$.toolbarToggleButton;e.scrollHeight!==e.offsetHeight||o.children.length?n.classList.remove("smart-visibility-hidden"):n.classList.add("smart-visibility-hidden")}if("menu"===t.toolbarMode||t.$.toolbarItemsSecondary.classList.contains("smart-visibility-hidden")||t._setToolbarGroupHeight(),o&&o.visible){const e=o.selector;e.classList.contains("smart-editor-toolbar-item")&&e.offsetTop>=t.$.toolbar.offsetHeight?o.close():o.reposition()}t._positionWindow(),t._resizeFrameObj&&t._setResizeFrame(t._resizeFrameObj.target)}}_setToolbarItemAttr(e,t,o){const n=this,a=n.$.toolbar,i=n.$.inlineToolbar,r=[n._toolbarItemsObj,n._inlineToolbarItemsObj];for(let n=0,l=r.length;n<l;n+=1){const l=r[n],s=l?l[e]:void 0;if(s){const n=l==l?a:i;if(s[t]=o,!n||!n.parentElement)continue;const r=n.querySelector(`.smart-editor-toolbar-item[item-name="${e}"]`);if(!r)continue;null==o||!1===o?(r.removeAttribute(t),"disabled"===t&&r.removeAttribute("aria-disabled")):(r.setAttribute(t,o),"disabled"===t&&r.setAttribute("aria-disabled",!0))}}}_setToolbarVisibility(){const e=this,t=e.$.toolbar,o=e.$.toolbarToggleButton;"toggle"!==e.toolbarViewMode||o.hasAttribute("checked")?t.setAttribute("expanded",""):t.removeAttribute("expanded")}_getToolbarItemDetails(e,t){const o=this;let n,a=o[`_${e}ItemsObj`];if(n="string"==typeof t?t:"object"==typeof t&&t.name?t.name+"":"",n=n.trim().toLowerCase(),a){if(void 0!==a[n])return a[n]}else a=o[`_${e}ItemsObj`]={};const i=a[n]={};return i.title=t.title||o.localize(n),i.name=n,i.toolbarName=e,i.advanced=!!t.advanced,i.inlineToolbarItems=t.inlineToolbarItems,o._setItemType(t,i,n),o._setItemData(t,i,n),o._setItemTemplate(t,i,n),o._setItemSpecifics(t,i,n),i}_setItemType(e,t,o){let n;if(t){switch(o){case"sourcecode":case"splitmode":case"fullscreen":n="toggle";break;case"alignment":case"fontname":case"fontsize":case"formats":case"tablerows":case"tablecolumns":case"tablevalign":case"tablestyle":n="drop-down";break;case"backgroundcolor":case"fontcolor":n="color-input";break;case"bold":case"italic":case"underline":case"strikethrough":case"delete":case"redo":case"undo":case"indent":case"outdent":case"openlink":case"editlink":case"createlink":case"removelink":case"hyperlink":case"cut":case"copy":case"image":case"video":case"lowercase":case"uppercase":case"print":case"caption":case"clearformat":case"table":case"tableheader":case"orderedlist":case"unorderedlist":case"subscript":case"superscript":case"findandreplace":n="button";break;case"paste":n=t.advanced?"drop-down":"button";break;default:n="string"==typeof e?"delimiter":"custom"}t.type=n}}_setItemData(e,t,o){const n=this;let a,i;if(!t||!e)return;const r=t.type;let l=e.width;if("drop-down"===r||"color-input"===r){if("object"==typeof e&&(a=e.dataSource,void 0!==e.value&&(i=e.value+"")),a&&Array.isArray(a)||(a=n._getDefaultDataSource(o,t)),void 0===i&&("fontsize"===t.name&&(i=parseInt(window.getComputedStyle(n.$.editableElement).fontSize)),isNaN(i)&&a.length)){const e=a[0];i=e["alignment"===o?"value":"label"]||e}o.indexOf("table")>-1&&(i="")}void 0!==l&&("number"==typeof l?l+="px":(l+="",l.includes("%")||(l=parseFloat(e.width),l=isNaN(l)?"":l+"px"))),t.dataSource=a,t.value=i,t.disabled=!!e.disabled,t.width=l}_setItemSpecifics(e,t,o){if(!t||"object"!=typeof e)return;let n=e.editor,a=t.editor;if(a||(a=t.editor={}),!n)return;let i=[],r=[];switch(o){case"createlink":case"removelink":case"hyperlink":i=["address","text","target"];break;case"image":i=["allowedTypes","uploadUrl","removeUrl","path","display"],r=["draggable","resizable"];break;case"table":i=["cols","rows","tableheader"],r=["altrows","dashedborders","resizable"]}for(let e in n){let t=n[e];void 0!==t&&(i.indexOf(e)>-1?"display"===e?t="block"===t?"block":"inline":t+="":r.indexOf(e)>-1?t=!!t:"width"!==e&&"height"!==e||"string"==typeof t||(t+="px"),a[e]=t)}}_getDefaultDataSource(e,t){const o=this;let n=[];switch(e){case"alignment":n=[{label:o.localize("alignLeft"),value:"left",icon:"editor-icon"},{label:o.localize("alignCenter"),value:"center",icon:"editor-icon"},{label:o.localize("alignRight"),value:"right",icon:"editor-icon"}],t&&"toolbar"===t.toolbarName&&n.push({label:o.localize("alignJustify"),value:"justify",icon:"editor-icon"});break;case"display":n=[{label:o.localize("displayInline"),value:"inline"},{label:o.localize("displayBlock"),value:"block"}];break;case"fontname":["segoeUi","arial","georgia","impact","tahoma","timesNewRoman","verdana"].forEach((e=>{n.push({label:o.localize(e),value:e})}));break;case"fontsize":["8","10","12","14","18","24","36"].forEach((e=>{n.push({label:e,value:e})}));break;case"formats":["p","pre","blockquote","h1","h2","h3","h4"].forEach((e=>{n.push({label:o.localize(e),value:e})}));break;case"backgroundcolor":case"fontcolor":["#000000","#FFFFFF","#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161",""].forEach((e=>{n.push({label:e,value:e})}));break;case"paste":n=[{label:o.localize("plainText"),value:"plainText"},{label:o.localize("keepFormat"),value:"keepFormat"},{label:o.localize("cleanFormat"),value:"cleanFormat"}];break;case"target":n=[{label:o.localize("linkBlankDescr"),value:"_blank"},{label:o.localize("linkSelfDescr"),value:"_self"},{label:o.localize("linkParentDescr"),value:"_parent"},{label:o.localize("linkTopDescr"),value:"_top"},{label:o.localize("linkCustomDescr"),value:""}];break;case"tablerows":n=[{label:o.localize("insertRowBefore"),value:"insertRowBefore",icon:"editor-icon"},{label:o.localize("insertRowAfter"),value:"insertRowAfter",icon:"editor-icon"},{label:o.localize("deleteRow"),value:"deleteRow",icon:"editor-icon"}];break;case"tablecolumns":n=[{label:o.localize("insertColumnLeft"),value:"insertColumnLeft",icon:"editor-icon"},{label:o.localize("insertColumnRight"),value:"insertColumnRight",icon:"editor-icon"},{label:o.localize("deleteColumn"),value:"deleteColumn",icon:"editor-icon"}];break;case"tablevalign":n=[{label:o.localize("alignTop"),value:"top"},{label:o.localize("alignMiddle"),value:"middle"},{label:o.localize("alignBottom"),value:"bottom"}];break;case"tablestyle":n=[{label:o.localize("dashedborders"),value:"dashedborders"},{label:o.localize("altrows"),value:"altrows"}]}return n}_setItemTemplate(e,t){let o=e.template;t&&(o?(o&&o.closest?o="content"in o?document.importNode(o.content,!0):o:"function"==typeof o?o=o.bind(this):"string"==typeof o&&(o=document.getElementById(o)||o),t.template=o):delete t.template)}_setAriaSettings(){const e=this,t=e.$.input,o=e.$.editableElement;e.setAttribute("role","application"),e.setAttribute("aria-roledescription",e.localize("roleDescription")),e.$.toolbarToggleButton.setAttribute("aria-label",e.localize("toolbarButtonAriaLabel")),e.$.toolbarItemsPrimary.setAttribute("aria-label",e.localize("primaryToolbarAriaLabel")),e.$.toolbarItemsSecondary.setAttribute("aria-label",e.localize("secondaryToolbarAriaLabel")),t.setAttribute("aria-label",e.localize("inputAreaLabel")),t.id=e.id+"TextArea",o.id=e.id+"EditableElement",o.setAttribute("aria-label",e.localize("inputAriaLabel"))}_setAriaControls(e,t){const o=this;e&&e.nodeName&&(t.id||(t.id=o.id+"Popup"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),e.setAttribute("aria-controls",t.id))}_setAriaOwns(e){const t=this;if(!e)return;const o=e.id;let n=(t.getAttribute("aria-owns")||"").split(" ").filter((e=>e.length));const a=n.indexOf(o);if(a>-1){if(e.parentElement&&(e.opened||e.visible))return;n.splice(a,1)}else n.push(o);n.length?t.setAttribute("aria-owns",n.join(" ")):t.removeAttribute("aria-owns")}_setFocusable(){const e=this,t=e.$.editableElement;if(e.disabled||e.unfocusable)return void(t&&t.removeAttribute("tabindex"));const o=e.tabIndex>0?e.tabIndex:0;t&&(t.tabIndex=o)}_selectAll(){const e=this,t=e.$.input,o=e.$.editableElement;t.classList.contains("smart-hidden")||t.select(),o.classList.contains("smart-hidden")||e._setSelectionRange(o)}_selectStartHandler(e){const t=this._resizeFrameObj,o=this._inlineToolbarClickObj;(t&&t.resizeDetails||o&&o.resizeDetails)&&e.preventDefault()}_selectionChangeHandler(e){const t=this;if(t.disabled||!e.target.getSelection)return;const o=e.target.getSelection().focusNode;if(t.$.contentContainer.contains(o)){if(t._ignoreSelectionChange||o.classList&&o.classList.contains("smart-search-input"))return;t._selectionChangeFired=!0,t._setSelectionRange(),t._updateToolbarItems(),delete t._selectionChangeFired}}_selectToolbarTab(e){const t=this,o=t.$.toolbar,n=t.$.toolbarItemsPrimary,a=e&&!e.hasAttribute("checked"),i=n.querySelectorAll(".smart-editor-toolbar-tab");for(let t=0,o=i.length;t<o;t+=1){const o=i[t];e===o&&a?o.setAttribute("checked",""):o.removeAttribute("checked")}let r=t._tabSelectionBar;r||(t._tabSelectionBar=r=document.createElement("div"),r.classList.add("smart-editor-toolbar-tab-selection-bar")),r.classList.add("smart-visibility-hidden"),e&&e.hasAttribute("checked")?(o.setAttribute("toolbar-tab-selected",""),r.style.left=e.offsetLeft+"px",r.style.width=e.offsetWidth+"px",n.contains(r)||n.appendChild(r),t._setToolbarItemGroups(),requestAnimationFrame((()=>r.classList.remove("smart-visibility-hidden")))):o.removeAttribute("toolbar-tab-selected")}}),Smart("smart-table-picker",class extends Smart.BaseElement{static get properties(){return{columns:{value:10,type:"number"},messages:{extend:!0,value:{en:{buttonLabel:"Insert Table"}}},rows:{value:3,type:"number"},value:{value:[],type:"array"}}}static get listeners(){return{"tableGrid.mouseover":"_cellOver","tableGrid.mouseleave":"_cellLeave","tableGrid.click":"_cellOver"}}template(){return'<div id="container" role="presentation">\n                    <div id="tableGrid" class="smart-table-picker-grid" role="presentation"></div>\n                    <div class="smart-table-picker-separator" role="separator"></div>\n                    <smart-button id="tableButton" class="smart-table-picker-button" right-to-left="[[rightToLeft]]"></smart-button>\n                </div>'}propertyChangedHandler(e,t,o){const n=this;switch(e){case"value":n._selectCell(o,t,!0);break;case"rows":case"columns":n._createTableGrid();break;case"messages":n._setTableButton();break;default:super.propertyChangedHandler(e,t,o)}}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._createTableGrid(),e._setTableButton(),e._setAria(),super.render()}_setAria(){this.setAttribute("role","grid")}_createTableGrid(){const e=this,t=e.$.tableGrid,o=e.columns,n=e.rows,a=t.children,i=document.createDocumentFragment();let r=a.length;for(;r>n;){const e=a[0];if(!e)break;e.remove(),r--}for(let e=r,t=n;e<t;e+=1){const e=document.createElement("div");e.setAttribute("role","row"),i.appendChild(e)}i.children.length&&t.appendChild(i);for(let e=0,t=n;e<t;e+=1){const t=a[e],n=t.children;let i=n.length;for(;i>o&&n[0];)n[0].remove(),i--;for(let e=i,n=o;e<n;e+=1){const e=document.createElement("span");e.setAttribute("role","gridcell"),e.classList.add("smart-table-picker-cell"),t.appendChild(e)}}e._selectCell(e.value)}_cellOver(e){const t=this,o=e.target;let n=[];if(!t.$.tableGrid.contains(o))return void t._selectCell(t.value);const a=o.closest(".smart-table-picker-cell");if(a){const o=a.parentElement,i=Array.from(o.children);n[0]=Math.max(0,Array.from(t.$.tableGrid.children).indexOf(o)+1),n[1]=Math.max(0,i.indexOf(a)+1),t._selectCell(n,t.value,"click"===e.type)}}_cellLeave(){this._selectCell(this.value)}_selectCell(e,t,o){const n=this,a=n.$.tableGrid,i=Array.from(a.children),r=i.length;let l=0,s=0;e&&(l=e[0]||0,s=e[1]||0);for(let e=0,t=r;e<t;e+=1){const t=i[e].children;if(l<e+1)for(let e=0,o=t.length;e<o;e+=1)t[e].removeAttribute("selected");else for(let e=0,o=t.length;e<o;e+=1)s>=e+1?t[e].setAttribute("selected",""):t[e].removeAttribute("selected")}a.setAttribute("value",l+"x"+s),o&&(void 0===t&&(t=n.value),n.set("value",[l,s]),t[0]===l&&t[1]===s||n.$.fireEvent("change",{value:e,oldValue:t}))}_setTableButton(){this.$.tableButton.innerHTML=this.localize("buttonLabel")}});