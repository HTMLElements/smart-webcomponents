
/* Smart UI v9.3.53 (2021-05-10) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-editor",class extends Smart.ContentElement{static get properties(){return{autoLoad:{value:!1,type:"boolean"},autoSave:{value:!1,type:"boolean"},autoSaveInterval:{value:1e3,type:"number"},chartCountFormatFunction:{value:null,type:"function?"},dataExport:{value:{style:{value:null,type:"object"},fileName:{value:"smartEditor",type:"string?"},pageOrientation:{value:"portrait",type:"string"}},type:"object"},disableEditing:{value:!1,type:"boolean"},editMode:{allowedValues:["html","markdown"],value:"html",type:"string"},enableHtmlEncode:{value:!1,type:"boolean"},enableTabKey:{value:!1,type:"boolean"},hideToolbar:{value:!1,type:"boolean"},hideInlineToolbar:{value:!1,type:"boolean"},innerHTML:{type:"string",validator:"_sanitize",reflectToAttribute:!1},inlineToolbarOffset:{value:[0,-5],type:"array"},iframeSettings:{value:{attributes:{value:null,type:"object?"},enabled:{value:!1,type:"boolean"},resources:{value:null,type:"object?"}},type:"object"},placeholder:{value:"",type:"string"},pasteFormat:{allowedValues:["prompt","plainText","keepFormat","cleanFormat"],value:"keepFormat",type:"string"},showCharCount:{value:!1,type:"boolean"},splitModeRefreshTimeout:{value:100,type:"number"},toolbarItems:{value:["bold","italic","underline","|","formats","alignment","orderedList","unorderedList","|","hyperlink","image","|","sourceCode","redo","undo"],reflectToAttribute:!1,type:"array"},toolbarViewMode:{allowedValues:["toggle","multiRow","scroll"],value:"toggle",type:"string"},toolbarSticky:{value:!1,type:"boolean"},value:{value:"",type:"string",validator:"_sanitize",reflectToAttribute:!1},maxCharCount:{value:null,type:"number?"},messages:{extend:!0,value:{en:{invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",permissionsRequired:"{{elementType}}: Permissions are required for the following action {{actionName}}.",ok:"Ok",cancel:"Cancel",alignLeft:"Align Left",alignCenter:"Align Center",alignRight:"Align Right",alignJustify:"Align Justify",segoeUi:"Segoe UI",arial:"Arial",georgia:"Georgia",impact:"Impact",tahoma:"Tahoma",timesNewRoman:"Times New Roman",verdana:"Verdana",p:"Paragraph",pre:"Code",code:"Code",blockquote:"Quotation",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",orderedlist:"Ordered List",unorderedlist:"Unordered List",subscript:"Subscript",superscript:"Superscript",alignment:"Alignments",fontname:"Font Name",fontsize:"Font Size",formats:"Formats",backgroundcolor:"Background Color",fontcolor:"Font Color",redo:"Redo",undo:"Undo",indent:"Indent",outdent:"Outdent",createlink:"Hyperlink",hyperlink:"Hyperlink",editlink:"Hyperlink",removelink:"Remove link",openlink:"Open link",image:"Image",table:"Table",lowercase:"Lower Case",uppercase:"Upper Case",print:" Print",cut:" Cut",copy:" Copy",paste:" Paste",clearformat:"Clear Format",fullscreen:"Full Screen",restore:"Restore Screen",sourcecode:"Source Code",preview:"Preview",splitmode:"Split Editor",address:"Web Address",text:"Display Text",addressPlaceholder:"http://example.com",textPlaceholder:"Enter Text",targetPlaceholder:"Select Target",titlePlaceholder:"Enter a Title",urlPlaceholder:"http://example.com/image.png",captionPlaceholder:"Caption",altPlaceholder:"Alternative Text",widthPlaceholder:"auto",heightPlaceholder:"auto",target:"Open Link in",linkBlankDescr:"New Window",linkSelfDescr:"Same Window",linkParentDescr:"Parent Frame",linkTopDescr:"Full Body of the Window",linkCustomDescr:"Custom Frame Name",title:"Title",url:"You can also provide the URL to an image",width:"Width",height:"Height",alt:"Alternative Text",caption:"Caption",display:"Display",displayPlaceholder:"Display",displayBlock:"Block",displayInline:"Inline",draggable:"Enable Dragging",resizable:"Enable Resizing",browse:"Browse",connectionError:"{{elementType}}: File Upload requires connection to the server.",wrongItemIndex:"{{elementType}}: There is no file with such an index in the list of uploaded files.",tooLongFileName:"{{elementType}}: File name is too long.",totalFiles:"Total files: ",cancelFile:"Cancel File",dashedborders:"Dashed Borders",altrows:"Alternate Rows",insertRowBefore:"Insert Row Before",insertRowAfter:"Insert Row After",deleteRow:"Delete Row",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteColumn:"Delete Column",alignTop:"Align Top",alignMiddle:"Align Middle",alignBottom:"Align Bottom",delete:"Delete",tablerows:"Table Rows",tablecolumns:"Table Columns",tablevalign:"Table Cell Vertical Align",tablestyle:"Table Style",tableheader:"Table Header",buttonLabel:"Custom Table",pasteLabel:"Choose the paste format action:",cols:"Columns",rows:"Rows",alphabet:"abcdefghijklmnopqrstuvwxyz",header:"Header",column:"Column",plainText:"Plain Text",keepFormat:"Keep Format",cleanFormat:"Clean Format",roleDescription:"Text Editor",iframeTitle:"Editor Content is Encloused in it's own DOM inside an iFrame",toolbarButtonAriaLabel:"Toolbar Toggle Button",primaryToolbarAriaLabel:"Primary Toolbar",secondaryToolbarAriaLabel:"Secondary Toolbar",inputAriaLabel:"Enter Text"}}},sanitized:{value:!1,type:"boolean"}}}static get listeners(){return{"document.down":"_documentDownHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","document.selectstart":"_selectStartHandler","document.selectionchange":"_selectionChangeHandler","container.dragend":"_dragEndHandler","container.change":"_changeHandler","container.beforeinput":"_beforeInputHandler","container.input":"_afterInputHandler","contentContainer.keydown":"_editableElementKeyDownHandler","contentContainer.keyup":"_updateOnInputChange","contentContainer.paste":"_updateOnInputChange","input.focus":"_editableElementFocusHandler","input.blur":"_editableElementBlurHandler","input.change":"_inputChangeEvent","editableElement.focus":"_editableElementFocusHandler","editableElement.blur":"_editableElementBlurHandler","editableElement.wheel":"_editableElementWheelHandler","editableElement.move":"_editableElementMoveHandler",resize:"_resizeHandler"}}static get requires(){return{"Smart.Button":"smart.button.js","Smart.Window":"smart.window.js","Smart.Tooltip":"smart.tooltip.js"}}static get styleUrls(){return["smart.editor.css"]}template(){return'<div id="container" role="presentation">\n                    <div id="toolbar" class="smart-editor-toolbar" role="presentation">\n                        <div id="toolbarItemsPrimary" class="smart-editor-toolbar-items-primary" role="toolbar"></div>\n                        <div id="toolbarToggleButton" class="smart-editor-toolbar-toggle-button" role="button"></div>\n                        <div id="toolbarItemsSecondary" class="smart-editor-toolbar-items-secondary" role="toolbar"></div>\n                    </div>\n                    <div id="contentContainer" class="smart-editor-content-container" role="presentation">\n                        <div class="smart-editor-editable" contenteditable="true" id="editableElement" aria-placeholder="[[placeholder]]"\n                        inner-h-t-m-l="[[innerHTML]]" spellcheck="false" role="textbox" aria-multiline="true"><content></content></div>\n                        <textarea id="input" class="smart-hidden" placeholder="[[placeholder]]" aria-placeholder="[[placeholder]]"\n                        spellcheck="false" autocapitalize="none" autocomplete="off"></textarea>\n                    </div>\n                </div>'}propertyChangedHandler(e,t,o){const n=this;switch(e){case"disabled":n._setFocusable();break;case"hideToolbar":o&&n._updateToolbarItems(void 0,n.$.toolbar);break;case"innerHTML":case"value":n._handleInputContent(e,o),n.$.fireEvent("change",{oldValue:n._value||t,value:n._value=n._getCurrentValue()});break;case"editMode":n._handleEditMode(o);break;case"hideInlineToolbar":{const e=n.$.inlineToolbar;e&&e.visible&&e.classList.contains("smart-editor-inline-toolbar")&&e.close();break}case"toolbarViewMode":this._toggleToolbar("toggle"===o);break;case"locale":delete n._toolbarItemsObj,delete n._inlineToolbarItemsObj,n._refreshToolbarItems(n._getToolbarItems()),n._closeToolbar(),n._closeWindow();break;case"iframeSettings":n._handleInputElement();break;case"maxCharCount":n._handleMaxCharCount(),n._setCharCount();break;case"placeholder":n._handlePlaceholder();break;case"pasteFormat":n._closeWindow();break;case"readonly":n.$.input.readonly=o,n.$.editableElement.setAttribute("contenteditable","markdown"!==n.editMode&&!o),n._closePopups(),n._setResizeFrame(),n._closeWindow();break;case"showCharCount":n._setCharCount();break;case"rightToLeft":case"animation":case"theme":n._updateIframeBody();break;default:super.propertyChangedHandler(e,t,o)}}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._isFireFox=Smart.Utilities.Core.Browser.Firefox,e._handleMaxCharCount(),e._handleInputContent(),e._setToolbarVisibility(),e._refreshToolbarItems(e._getToolbarItems()),e._handleInputElement(),e._handleEditMode(),e._predefPropertyGetter(),e._setCharCount(),e._setFocusable(),e._setAriaSettings(),super.render()}detached(){const e=this;super.detached(),delete e._dragDetails,delete e._resizeFrameObj,delete e._toolbarItemClick,e._endInlineToolbarClick(),e._closeWindow(),e._closeToolbarItemDropDown(e.$.inputPopup),e._closeToolbarItemDropDown(e.$.colorInputPopup),e._closeToolbar(),e._handleTableSelection()}focus(){const e=this,t="markdown"===e.editMode?e.$.input:e.$.editableElement;t&&t.focus()}blur(){const e=this,t="markdown"===e.editMode?e.$.input:e.$.editableElement;t&&t.blur()}collapseToolbar(){this._toggleToolbar(!0)}disableToolbarItem(e){this._setToolbarItemAttr(e,"disabled",!0)}enableToolbarItem(e){this._setToolbarItemAttr(e,"disabled",!1)}expandToolbar(){this._toggleToolbar()}executeCommand(e,t){return this.$.editableElement.getRootNode().execCommand(e,!1,t)}getCharCount(){const e=this;if("html"===e.editMode){const t=e.$.editableElement,o=t.textContent.length,n=t.innerText.length;return n&&o?n:0}return e.$.input.value.length}getSelectionRange(){return this._selectionRange}selectAll(){const e=this,t=e.$.input,o=e.$.editableElement;t.classList.contains("smart-hidden")||t.select(),o.classList.contains("smart-hidden")||e._setSelectionRange(o)}clearContent(){this.$.editableElement.innerHTML=this.$.input.value=""}getHTML(){const e=this;if("markdown"===e.editMode){const t=e.$.input;return window.marked?window.marked(t.value):t.value}return e.$.editableElement.innerHTML}getText(){const e=this;return"markdown"===e.editMode?e.$.input.value:e.$.editableElement.innerText}getMarkdown(){const e=this;if(!window.marked)return"";if("markdown"===e.editMode){const t=e.$.input;return window.marked(t.value)}return""}selectRange(e,t,o){this._setSelectionRange(e,t,o)}clearState(){const e=this;e.id?window.localStorage.removeItem("smartEditor"+e.id):e.warn(e.localize("noId"))}saveState(){const e=this;e.id?window.localStorage.setItem("smartEditor"+e.id,e.$.editableElement.innerHTML):e.warn(e.localize("noId"))}loadState(e){const t=this;t.id?(e||(e=window.localStorage.getItem("smartEditor"+t.id)),"string"==typeof e&&(t.set("value",e),t.$.editableElement.innerHTML=t.$.input.value=e)):t.warn(t.localize("noId"))}splitMode(e){const t=this;t.$.fireEvent("actionStart",{name:"splitMode"}).defaultPrevented||(t._handleSplitMode(t._toggleItem("splitmode",e)),t.$.fireEvent("actionEnd",{name:"splitMode"}))}previewMode(e){const t=this;t.$.contentContainer.hasAttribute("split-mode")||t.$.fireEvent("actionStart",{name:"sourcecode"}).defaultPrevented||(t._handleSourceCodeMode(t._toggleItem("sourcecode",e)),t.$.fireEvent("actionEnd",{name:"sourcecode"}))}fullScreenMode(e){const t=this;t.$.fireEvent("actionStart",{name:"fullScreenMode"}).defaultPrevented||(t._handleFullScreenMode(t._toggleItem("fullscreen",e)),t.$.fireEvent("actionEnd",{name:"fullScreenMode"}))}exportData(e,t){this._handleDataExport(e,t)}print(){this._handlePrint()}_toggleItem(e,t){const o=this._toolbarItemsObj;if(!o)return;const n=o[e],a=this.$.toolbar.querySelector(`.smart-editor-toolbar-item[item-name="${e}"]`);return n&&a?((t=n.value=void 0===t?!n.value:!!t)?(a.setAttribute("checked",""),a.setAttribute("aria-pressed",!0)):(a.removeAttribute("checked"),a.setAttribute("aria-pressed",!1)),a):void 0}_afterInputHandler(){const e=this,t=e._beforeInputObj,o=e.$.editableElement;let n,a;if(t&&t.type&&(n=t.type,a=t.rangeDetails),delete e._beforeInputObj,"insertParagraph"!==n&&o.innerHTML){if(n&&a&&n.indexOf("delete")>-1){const t=a.startOffset!==a.endOffset&&a.startContainer!==a.endContainer,n=e._resizeFrameObj;t&&"html"===e.editMode&&!o.textContent.trim().length&&(o.innerHTML="<p><br/></p>",e._setSelectionRange(o.childNodes[0],0,0),e._setResizeFrame(),e._closePopups()),n&&n.target&&!o.contains(n.target)&&e._setResizeFrame()}}else{let t=e._getSelectionRange().startContainer;if(t.nodeType===Node.TEXT_NODE&&(t=t.parentElement),t&&t.classList&&(t.closest(".smart-editor-image-caption")||t.closest(".smart-editor-editable table")))return;const n=e.$.iframe,[a,i]=n?[n.contentWindow,n.contentDocument]:[window,document];"div"!==a.getSelection().anchorNode.nodeName.toLowerCase()&&t!==o||i.execCommand("insertHTML",!1,"<p><br></p>")}o.textContent.length&&o.innerText.length?o.removeAttribute("show-placeholder"):o.setAttribute("show-placeholder",""),e._setCharCount()}_beforeInputHandler(e){const t=this,o=t.$.iframe;let n=e.inputType;const a=t.$.contentContainer,i=t.$.editableElement,r=(o?o.contentWindow:window).getSelection().getRangeAt(0);if(n&&(t._beforeInputObj={type:n,rangeDetails:{startOffset:r.startOffset,endOffset:r.endOffset,startContainer:r.startContainer,endContainer:r.endContainer}}),a.classList.contains("char-count-maxed")&&n.indexOf("delete")<0)e.preventDefault();else if("insertParagraph"===n){const e=t._getSelectionRange().startContainer;e.nodeType===Node.TEXT_NODE&&e.parentElement===i&&i.getRootNode().execCommand("formatBlock",!1,"p")}}_changeHandler(e){const t=this,o=e.target,n=e.detail,a=o.closest(".smart-editor-toolbar-item");if(e.stopPropagation(),t._toolbarItemsObj||t._inlineToolbarItemsObj)return a&&o===t.$.inputPopup||o===t.$.colorInputPopup?(t._ignoreSelectionChange=!0,t._updateToolbarItem(a,n),void delete t._ignoreSelectionChange):void 0}_updateToolbarItem(e,t){const o=this,n=o.editMode,a=e.getAttribute("item-name"),i=o.$.toolbar,r=o.$.inlineToolbar,l="markdown"===n?o.$.input:o.$.editableElement,s=(e,n,a)=>{n&&(n.label=t["alignment"===n.name?"value":"label"],n.value=t.value,e&&o._setItemValue(e,n),a&&o._updateToolbarTarget(n))};if(r&&r.contains(e)?(s(e,o._inlineToolbarItemsObj[a],!0),o._toolbarItemsObj&&o._toolbarItemsObj[a]&&s(i.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),o._toolbarItemsObj[a])):i.contains(e)&&o._toolbarItemsObj&&(s(e,o._toolbarItemsObj[a],!0),r&&r.visible&&o._inlineToolbarItemsObj&&s(r.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),o._inlineToolbarItemsObj[a])),l.getRootNode().activeElement!==l){const e=o._selectionRange;e&&("markdown"===n?o._setSelectionRange(l,e.selectionStart,e.selectionEnd):o._setSelectionRange(e.startContainer,e.startOffset,e.endOffset)),l.focus({preventScroll:!0})}}_updateToolbarTarget(e){const t=this,o=t._resizeFrameObj;if(!e)return;const n=t.$.inlineToolbar;let a;o&&o.target?a=o.target:n&&n.visible&&(a=n.selector,a=a.closest?a.closest(".smart-editor-editable img")||a.closest(".smart-editor-editable table"):void 0);const i=a?a.nodeName.toLowerCase():"";if(a&&"img"===i)return"alignment"===e.name&&(a.closest(".smart-editor-image-container")||a).setAttribute("alignment",e.value),t._setResizeFrame(a),void(n&&n.visible&&n.reposition());if(a&&"table"===i)return void t._handleTableToolbarAction(e,a);const r=t._getSelectionRange();if(r&&(r.startContainer||void 0!==r.selectionStart)){const o=e.name;if(t.$.fireEvent("actionStart",{name:o}).defaultPrevented)return;switch(o){case"backgroundcolor":t._handleBackgroundColor(e);break;case"fontcolor":t._handleFontColor(e);break;case"alignment":t._handleTextAlignment(e);break;case"fontsize":t._handleFontSize(e);break;case"fontname":t._handleFontName(e);break;case"formats":t._handleFormats(e);break;case"paste":t._handlePaste(e);break;default:{const t=r.startContainer.closest?r.startContainer:r.startContainer.parentElement;return void(t&&t.closest&&t.setAttribute(e.name,e.value))}}o&&t.$.fireEvent("actionEnd",{name:o})}}_setSelectionRange(e,t,o){const n=this,a=n.$.iframe;let i;if("markdown"===n.editMode||n.$.editableElement.classList.contains("smart-hidden")){i=n.$.input,n._selectionRange={selectionStart:void 0!==t?t:i.selectionStart,selectionEnd:void 0!==o?o:i.selectionEnd};const e=n._selectionRange;return void(n._selectionChangeFired||i.setSelectionRange(e.selectionStart,e.selectionEnd))}const r=(a?a.contentWindow:window).getSelection();let l;i=n.$.editableElement,e?(l=document.createRange(),"number"==typeof t&&"number"==typeof o?(l.setStart(e,Math.min(parseInt(t),e.length)),l.setEnd(e,Math.min(parseInt(o),e.length))):l.selectNodeContents(e),r.removeAllRanges(),r.addRange(l)):r.rangeCount&&(l=r.getRangeAt(0)),l&&i.contains(l.startContainer)&&(n._selectionRange=l),n._selectionRange||(l=document.createRange(),l.selectNodeContents(i),l.collapse(!1),n._selectionRange=l)}_getSelectionRange(){const e=this,t=e.editMode;let o=e._selectionRange;return o&&("markdown"===t&&void 0===o.selectionStart||"html"===t&&void 0===o.startContainer)&&(delete e._selectionRange,o=void 0),o||e._setSelectionRange(),e._selectionRange}_setCharCount(){const e=this,t=e.$.contentContainer;if(!e.showCharCount)return void t.removeAttribute("char-count");const o=e.maxCharCount;let n,a;if("html"===e.editMode){const t=e.$.editableElement,o=t.textContent.length,n=t.innerText.length;a=n&&o?n:0}else a=e.$.input.value.length;if(n=e.chartCountFormatFunction?e.chartCountFormatFunction(a,o)+"":o?`${a} / ${o}`:a+"",t.setAttribute("char-count",n),null===o)return void t.classList.remove("char-count-low","char-count-medium");const i=parseFloat((a/o).toFixed(2));t.classList[i>=.7&&i<=.9?"add":"remove"]("char-count-warning"),t.classList[i>=.9?"add":"remove"]("char-count-error"),t.classList[a>=o?"add":"remove"]("char-count-maxed")}_documentDownHandler(e){const t=this,o=t.$.iframe,n=t.$.inlineToolbar,a=t.$.window,i=e.originalEvent||e,r=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target;if(n&&n.contains(r)){const e=r.closest(".smart-editor-toolbar-item");return t._handleToolbarItemDown(e,r),void i.preventDefault()}if(t.$.container.contains(r)||o&&o.contentDocument.body.contains(r))return void t._handleDownInside(i,r);const l=r.closest(".smart-input-drop-down-menu");let s;if(l&&(s=l.ownerElement),a&&a.opened&&!a.contains(s||r)&&a.close(),t._handleTableSelection(),s&&(t.$.toolbar.contains(s)||n&&n.contains(s)))return t._toolbarItemClick={},void i.preventDefault();t._setResizeFrame(),t._closePopups()}_handleDownInside(e,t){const o=this,n=e.originalEvent||e,a=t.closest(".smart-editor-toolbar-item"),i=o.$.inlineToolbar,r=o.$.window;if(t===o.$.toolbarToggleButton)o._toolbarItemClick={},e.preventDefault();else{if(a)return o._handleToolbarItemDown(a,t),void e.preventDefault();{const e={x:n.pageX+window.pageXOffset,y:n.pageY+window.pageYOffset};r&&r.opened&&r.close();const a=o._getInlineToobarTarget(t,e);a?o._handleInlineToolbarItemDown(a,e):!i||i.contains(t)&&i.classList.contains("smart-editor-drop-down-toolbar")||(o._closeToolbar(),o._handleTableSelection())}}o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup)}_handleToolbarItemDown(e,t){const o=this,n=o.$.inlineToolbar,a=o.$.window;if(!e)return;const i=e.getAttribute("item-type"),r=e.getAttribute("item-name");switch(!a||!a.opened||a._target&&a._target.item.name===r||a.close(),o._toolbarItemClick={toolbarItem:e},o._resizeFrameObj&&o._resizeFrameObj.target?o._toolbarItemClick.target=o._resizeFrameObj.target:o._setResizeFrame(),o._setSelectionRange(),i){case"button":["hyperlink","createlink","image"].includes(r)?o._toolbarItemClick.callback=o._toggleWindow:"table"===r&&(o._toolbarItemClick.callback=n&&n.contains(e)?o._toggleWindow:o._toggleDropDownToolbar);break;case"toggle":e.toggleAttribute("checked"),e.hasAttribute("checked")?e.setAttribute("aria-pressed",!0):e.setAttribute("aria-pressed",!1),o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup);break;case"drop-down":o._toolbarItemClick.callback=o._toggleItemDropDown;break;case"color-input":t.closest(".smart-editor-item-drop-down-button")&&(o._toolbarItemClick.callback=o._toggleItemDropDown)}}_handleInlineToolbarItemDown(e,t){const o=this,n=e.closest(".smart-editor-editable table"),a=o.$.editableElement;if(o._inlineToolbarClickObj&&o._inlineToolbarClickObj.target&&o._inlineToolbarClickObj.target.removeAttribute("drag-id"),e&&"img"===e.nodeName.toLowerCase()&&e.setAttribute("drag-id",Math.random().toString(36).substr(2,5)),o._inlineToolbarClickObj={},n&&a.hasAttribute("table-cell-resize")){const i=a.getAttribute("table-cell-resize");o._inlineToolbarClickObj.resizeDetails={x:t.x,y:t.y,position:i,target:"vertical"===i?e.closest("tr"):e,table:n},e=void 0}o._handleTableSelection(e),o._inlineToolbarClickObj.target=e}_getInlineToobarTarget(e,t){const o=this;let n,a=e.closest(".smart-editor-editable img")||e.closest(".smart-editor-editable a");return a||(n=e.closest(".smart-editor-editable table"),n&&(a=e.closest(".smart-editor-editable td")||e.closest(".smart-editor-editable th"))),e.closest(".smart-editor-resize-frame")&&o._resizeFrameObj?(o._resizeFrameObj.resizeDetails={x:t.x,y:t.y,position:e.getAttribute("position")},a=o._resizeFrameObj.target):a&&(a&&"img"===a.nodeName.toLowerCase()||n)||o._setResizeFrame(),a}_documentMoveHandler(e){const t=this,o=t._resizeFrameObj,n=t._inlineToolbarClickObj,a=e.originalEvent||e;o&&o.resizeDetails?t._handleFrameResize(a):n&&n.resizeDetails&&t._handleTableCellResize(a)}_dragStartHandler(e){const t=this,o=t._resizeFrameObj,n=t._inlineToolbarClickObj;if(o&&o.resizeDetails||n&&n.resizeDetails)return e.preventDefault(),void delete t._dragDetails;if(!n||!n.target)return void e.preventDefault();const a=t._inlineToolbarClickObj.target;if(a&&a&&["img","table"].indexOf(a.nodeName.toLowerCase())>-1){if("false"===a.getAttribute("draggable"))return void e.preventDefault();const o=e.target,n=o.parentElement;t._closeToolbar(),t._setResizeFrame(),t._dragDetails={target:o,scrollTop:t.$.editableElement.scrollTop,container:o.closest(".smart-editor-image-container"),anchor:n&&"a"===n.nodeName.toLowerCase()?n:void 0}}}_dragEndHandler(){const e=this,t=e.$.inlineToolbar;if(e._dragDetails){const o=e._dragDetails.target,n=e.$.editableElement,a=n.querySelector(`[drag-id="${o.getAttribute("drag-id")}"]`);if(a){const o=e._dragDetails,i=o.container,r=o.anchor;a.removeAttribute("drag-id"),i&&!i.contains(a)&&a.parentElement&&(i.remove(),a.parentElement.insertBefore(i,a),i.insertBefore(a,i.firstElementChild)),r&&a.parentElement!==r&&(r.innerHTML="",a.parentElement.insertBefore(r,a),r.appendChild(a)),void 0!==o.scrollTop&&(n.scrollTop=o.scrollTop),e._setResizeFrame(a);const l=e._resizeFrameObj;t&&t.visible||!l.target||e._openInlineToolbar(l.target)}return void delete e._dragDetails}e._setSelectionRange();const o=e._getSelectionRange();o&&o.startOffset!==o.endOffset&&(e._handleInlineToolbar(o.startContainer),e._focusEditableElement())}_documentUpHandler(e){const t=this,o=t._resizeFrameObj,n=t.$.inlineToolbar,a=e.originalEvent||e,i=t.shadowRoot||t.isInShadowDOM?a.composedPath()[0]:a.target;if(o&&(o.resizeDetails&&o.target&&t.$.fireEvent("resizeEnd",{target:o.target}),delete o.resizeDetails),t._dragDetails)return t._endInlineToolbarClick(),void delete t._toolbarItemClick;const r=t.$.iframe;if(t.$.container.contains(i)||n&&n.contains(i)||r&&r.contentDocument.body.contains(i)){const e=i.closest(".smart-editor-toolbar-item");e?t._handleToolbarUp(e):t._handleContentUp(i)}t._endInlineToolbarClick(),delete t._dragDetails,delete t._toolbarItemClick}_handleToolbarUp(e){const t=this,o=t._toolbarItemClick,n=e.getAttribute("item-type");if(o&&o.toolbarItem===e){const e=o.toolbarItem;"custom"!==n&&(t._handleToolbarItemClick(event,e),t._focusEditableElement())}}_handleContentUp(e){const t=this,o=t._inlineToolbarClickObj,n=t.$.toolbarToggleButton;if(e===n||n.contains(e))t._toggleToolbar(t.$.toolbar.hasAttribute("expanded"));else if(o){const n=o.target;n&&(n===e||n.contains(e))&&(t._handleInlineToolbar(n),t._focusEditableElement())}else if(t.$.editableElement.contains(e)||"markdown"===t.editMode&&e===t.$.input){const e=t.$.iframe,o=e?e.contentWindow:window;requestAnimationFrame((()=>{e&&t._setSelectionRange();const n=t._getSelectionRange();if(n instanceof o.Range){let e=n.startContainer;n.startOffset!==n.endOffset&&(t._handleInlineToolbar(e),t._focusEditableElement())}}))}}_endInlineToolbarClick(){const e=this,t=e._inlineToolbarClickObj;if(t){const o=t.resizeDetails;if(!e._dragDetails&&t.target&&t.target.removeAttribute("drag-id"),o&&o.target){if("horizontal"===o.position){const e=o.cells,t=o.table.offsetWidth;e&&e.forEach((e=>{e.style.width&&(e.style.width=100*parseFloat((e.offsetWidth/t).toFixed(2))+"%")}))}e.$.editableElement.removeAttribute("table-cell-resize"),o.target.removeAttribute("resizing"),o.isInlineToolbarOpened&&e._handleInlineToolbar(o.target)}delete e._inlineToolbarClickObj}}_updateToolbarItems(e,t){const o=this;if(o._dragDetails||"markdown"===o.editMode||o.readonly)return;const n=o._getSelectionRange(),a=o.$.inlineToolbar;let i,r;if(!n)return;if(t||(t=o.$.toolbar),a&&t!==a&&!o.hideInlineToolbar&&a.visible&&(o._updateToolbarItems(e,a),i=!0),t!==o.$.toolbar||o.hideToolbar?i||o.hideInlineToolbar||(r=o._inlineToolbarItemsObj):r=o._toolbarItemsObj,!r)return;const l=o.$.editableElement;let s,d=n.startOffset>n.endOffset?n.endContainer:n.startContainer;if(d&&(d.closest||(d=d.parentElement),d&&d.closest)){e||(e=["alignment","bold","italic","strikethrough","underline","fontsize","fontname","formats","fontcolor","backgroundcolor","orderedlist","unorderedlist","subscript","superscript"]);for(let n=0,a=e.length;n<a;n+=1){const a=e[n],i=r[a];if(i){let e;if("alignment"===a)e=d.style.textAlign;else if("bold"===a)e=!!o._getNodeFromList(d,["b","strong","h1","h2","h3","h4","h5","h6"]);else if("italic"===a)e=!!o._getNodeFromList(d,["i"]);else if("underline"===a)e=!!o._getNodeFromList(d,["u"]);else if("strikethrough"===a)e=!!o._getNodeFromList(d,["strike"]);else if("fontsize"===a){const t=d.closest(".smart-editor-editable font");t&&(e=t.style.fontSize),e||(s||(s=window.getComputedStyle(d)),e=s.fontSize),e=parseInt(e),isNaN(e)&&(e="")}else if("fontname"===a){const t=d.closest(".smart-editor-editable font");t&&t.hasAttribute("face")?e=t.getAttribute("face"):(s||(s=window.getComputedStyle(d)),e=s.fontFamily.split(",")[0])}else if("formats"===a&&d!==l){const t=i.dataSource;if(e="",t){const n=t.map((e=>e.value));e=o._getNodeFromList(d,n)||""}}else if("fontcolor"===a){const t=d.closest(".smart-editor-editable font");t?e=t.color:(s||(s=window.getComputedStyle(d)),e=s.color)}else"backgroundcolor"===a?(e=o._getNodeBackgroundColor(d),e||(s||(s=window.getComputedStyle(d)),e=s.backgroundColor)):"orderedlist"===a||"unorderedlist"===a?e=!!d.closest(`.smart-editor-editable ${"orderedlist"===a?"ol":"ul"} li`):"subscript"===a?e=!!d.closest(".smart-editor-editable sub"):"superscript"===a&&(e=!!d.closest(".smart-editor-editable sup"));if(!e&&i.dataSource){const t=i.dataSource[0];t&&(e=t.value||t)}null!==e&&(i.value=e,o._setItemValue(t.querySelector(`.smart-editor-toolbar-item[item-name=${a}]`),i))}}}}_getNodeFromList(e,t){const o=this.$.editableElement;if(e&&t)for(;e&&e!==o;){const o=e.nodeName.toLocaleLowerCase();if(t.indexOf(o)>-1)return o;e=e.parentElement}}_getNodeBackgroundColor(e){const t=this.$.editableElement;for(;e&&e!==t;){const t=e.style.backgroundColor;if(t)return t;e=e.parentElement}}_editableElementBlurHandler(){const e=this,t=e.$.contentContainer;if(!e._toolbarItemClick&&!t.contains(t.getRootNode().activeElement)){const t=e._value,o=e._getCurrentValue();t!==o&&e.$.fireEvent("change",{oldValue:t,value:o}),e.removeAttribute("focus"),e.removeAttribute("aria-activedescendant")}}_editableElementFocusHandler(e){const t=this,o=t.editMode,n="markdown"===o?t.$.input:t.$.editableElement;let a=t._autoSaveObj;t.setAttribute("focus",""),e.target.id&&t.setAttribute("aria-activedescendant",e.target.id),t._value=t._getCurrentValue(),t.autoSave?(a||(a=t._autoSaveObj={}),clearInterval(a.interval),a.interval=setInterval((()=>{n.getRootNode().activeElement!==n&&clearInterval(a.interval),window.localStorage.setItem("smartEditor"+t.id,"markdown"===o?n.value:n.innerHTML)}),t.autoSaveInterval)):a&&(clearInterval(a.interval),delete t._autoSaveObj)}_inputChangeEvent(e){e.stopPropagation()}_updateOnInputChange(e){const t=this;if("paste"===e.type){const o=e.clipboardData;if(o&&o.types.length){const n=o.types.indexOf("text/html")>-1?"text/html":"text/plain",[a,i]=["\x3c!--StartFragment--\x3e","\x3c!--EndFragment--\x3e"];let r=o.getData(n);e.preventDefault(),r.indexOf(a)>-1&&r.indexOf(i)>-1&&(r=r.slice(r.indexOf(a),r.indexOf(i))),t._handlePasteAction(r,{advanced:!0,value:t.pasteFormat},n)}}if(!t.$.contentContainer.hasAttribute("split-mode"))return void delete t._refreshTimeout;const o=t.$.editableElement.getRootNode().activeElement;let n=t.$.input.value;clearTimeout(t._refreshTimeout),t._refreshTimeout=setTimeout((()=>{clearTimeout(t._refreshTimeout),"markdown"===t.editMode?t.$.editableElement.innerHTML=window.marked?window.marked(n):n:o===t.$.input?t.$.editableElement.innerHTML=n:t.$.input.value=t.$.editableElement.innerHTML.trim()}),t.splitModeRefreshTimeout)}_editableElementWheelHandler(){const e=this.$.inlineToolbar;this._setResizeFrame(),e&&e.visible&&e.close()}_editableElementKeyDownHandler(e){const t=this,o=t.$.editableElement,n=e.target.getRootNode().activeElement,a=e.key.toLowerCase();if(t.disabled||t.readonly)return;const i=t.$.iframe;switch(a){case"escape":n===o&&t._closeToolbar();break;case"a":{if(!e.ctrlKey)break;const o=(i?i.contentDocument:document).activeElement;if(o.classList.contains("smart-editor-image-caption"))return e.preventDefault(),t._setSelectionRange(o),void t._handleInlineToolbar(t._getSelectionRange().startContainer);if(t._tableCell)return e.preventDefault(),t._setSelectionRange(t._tableCell),void t._handleInlineToolbar(t._getSelectionRange().startContainer);break}case"delete":{const e=t._resizeFrameObj?t._resizeFrameObj.target:void 0;e&&"img"===e.nodeName.toLowerCase()&&t._deleteResizeFrameTarget(e);break}case"tab":t.enableTabKey&&(e.preventDefault(),t._handleTabInsert());break;default:t._handleToolbarShortcuts(e)}t._closeToolbar()}_handleToolbarShortcuts(e){const t=this,o=e.key;if(!e.ctrlKey)return;const n=t._resizeFrameObj;let a;switch(n&&n.target&&(a=n.target),o.toLocaleLowerCase()){case"k":e.preventDefault(),t._openWindow({name:"hyperlink"},a);break;case"i":e.shiftKey?(e.preventDefault(),t._openWindow({name:"image"},a)):(e.preventDefault(),t._handleTextDecorations("italic"));break;case"e":e.shiftKey?(e.preventDefault(),t._openWindow({name:"table"},a)):(e.preventDefault(),t._updateToolbarTarget({name:"alignment",value:"center"}));break;case"b":e.preventDefault(),t._handleTextDecorations("bold");break;case"u":e.shiftKey?(e.preventDefault(),t._handleTextCase("uppercase")):(e.preventDefault(),t._handleTextDecorations("underline"));break;case"s":e.shiftKey&&(e.preventDefault(),t._handleTextDecorations("strikethrough"));break;case"l":e.shiftKey?(e.preventDefault(),t._handleTextCase("lowercase")):(e.preventDefault(),t._updateToolbarTarget({name:"alignment",value:"left"}));break;case"+":e.shiftKey&&(e.preventDefault(),t._handleSubSuperScript("superscript"));break;case"=":e.shiftKey?(e.preventDefault(),t._handleSubSuperScript("superscript")):(e.preventDefault(),t._handleSubSuperScript("subscript"));break;case"]":e.preventDefault(),t._handleIndentation("indent");break;case"[":e.preventDefault(),t._handleIndentation("outdent");break;case"h":if(e.shiftKey){const o=t._toolbarItemsObj.sourcecode;o&&(o.value=void 0===o.value||!o.value),e.preventDefault(),t._handleSourceCodeMode()}break;case"f":if(e.shiftKey){const o=t._toolbarItemsObj.fullscreen;o&&(o.value=void 0===o.value||!o.value),e.preventDefault(),t._handleFullScreenMode()}break;case"j":e.preventDefault(),t._updateToolbarTarget({name:"alignment",value:"justify"});break;case"r":e.shiftKey?(e.preventDefault(),t._handleClearFormat()):(e.preventDefault(),t._updateToolbarTarget({name:"alignment",value:"right"}));break;case"o":e.shiftKey?(e.preventDefault(),t._handleList("orderedlist")):e.altKey&&(e.preventDefault(),t._handleList("unorderedlist"))}}_editableElementMoveHandler(e){const t=this,o=t.$.editableElement,n=e.originalEvent||e,a=n.clientX,i=n.clientY,r=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(e.stopPropagation(),!r||!r.closest||t._isMobile||"false"===o.getAttribute("contenteditable"))return void o.removeAttribute("table-cell-resize");const l=t._inlineToolbarClickObj;if(l&&l.resizeDetails||t._dragDetails)return;const s=r.tagName.toLowerCase();if(!r.closest(".smart-editor-editable table")||"td"!==s&&"th"!==s)return void o.removeAttribute("table-cell-resize");const d=r.getBoundingClientRect();i<d.bottom+5&&i>d.bottom-5?o.setAttribute("table-cell-resize","vertical"):a<d.right+5&&a>d.right-5&&r.nextElementSibling?o.setAttribute("table-cell-resize","horizontal"):o.removeAttribute("table-cell-resize")}_focusEditableElement(){const e=this,t=e.$.iframe,o=e.editMode;let n=e.$.editableElement;if(("markdown"===o||n.classList.contains("smart-hidden"))&&(n=e.$.input),t&&t.focus({preventScroll:!0}),n.getRootNode().activeElement!==n){const a=e._getSelectionRange(),i=t?t.contentWindow:window;if(n.focus({preventScroll:!0}),"markdown"===o||n.classList.contains("smart-hidden"))return void(void 0!==a.selectionStart&&e._setSelectionRange(a.selectionStart,a.selectionEnd));if(a instanceof i.Range){const e=(t?t.contentWindow:window).getSelection();e.removeAllRanges(),e.addRange(a)}}}_getTextFromCarret(){const e=this._getSelectionRange(),t=e.startContainer,o=t.textContent;let n,a;if(o.length>0&&o.indexOf(" ")>-1){const t=o.slice(0,e.startOffset).lastIndexOf(" ")+1;let i=o.slice(e.endOffset).indexOf(" ");i<0&&(i=o.length-1),n=t>-1?t:e.startOffset,a=Math.max(e.endOffset,e.endOffset+i)}else n=0,a=t.length;return{selectionStartIndex:n,selectionEndIndex:a}}_handleToolbarItemClick(e,t){const o=this;if(!t)return;const n=o.$.inlineToolbar,a=o._toolbarItemClick,i=t.getAttribute("item-type"),r=t.getAttribute("item-name");let l,s;if(e&&(l=e.originalEvent||e,s=o.shadowRoot||o.isInShadowDOM?l.composedPath()[0]:l.target),"custom"!==i&&l&&(o.hasRippleAnimation&&"delimiter"!==i&&Smart.Utilities.Animation.Ripple.animate(s,l.pageX,l.pageY),a&&a.callback))return a.callback.call(o,t,a.target),void o.$.fireEvent("toobarItemClick",{value:r,originalEvent:l});o.$.fireEvent("actionStart",{name:r}).defaultPrevented||(o._handleToolbarItemAction(t),o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup),n&&n.close(),l&&o.$.fireEvent("toobarItemClick",{value:r,originalEvent:l}),r&&o.$.fireEvent("actionEnd",{name:r}))}_handleToolbarItemAction(e){const t=this,o=t._toolbarItemClick;if(!e)return;const n=e.getAttribute("item-type"),a=e.getAttribute("item-name");if("custom"!==n)switch(a){case"bold":case"italic":case"underline":case"strikethrough":t._handleTextDecorations(a);break;case"clearformat":t._handleClearFormat();break;case"redo":case"undo":t._handleUndoRedo(a);break;case"lowercase":case"uppercase":t._handleTextCase(a);break;case"backgroundcolor":t._handleBackgroundColor(e.getAttribute("item-value"));break;case"fontcolor":t._handleFontColor(e.getAttribute("item-value"));break;case"editlink":t._openWindow(e);break;case"openlink":{const o=t.$.inlineToolbar;if(o&&o.contains(e)){const e=o.selector;let t;e.nodeName!==Node.TEXT_NODE&&(t=e.closest(".smart-editor-editable a")),t&&window.open(t.href,t.target)}break}case"caption":{if(!o)break;const e=o.target;if(e&&"img"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-image-container");let n;o&&o.querySelector(".smart-editor-image-caption")||(n=t.localize("captionPlaceholder")),t._handleImgCaption(e,{caption:n,focusCaption:!0})}break}case"cut":case"copy":case"paste":t._handleClipboardAction(a);break;case"delete":t._resizeFrameObj&&t._resizeFrameObj.target?t._deleteResizeFrameTarget(o.target):t._handleTextDelete();break;case"removelink":t._handleLinkRemove(a);break;case"tableheader":case"tablerows":case"tablecolumns":case"tablevalign":case"tablestyle":t._handleTableToolbarAction(e);break;case"sourcecode":t._handleSourceCodeMode(e);break;case"splitmode":t._handleSplitMode(e);break;case"fullscreen":t._handleFullScreenMode(e);break;case"orderedlist":case"unorderedlist":t._handleList(a);break;case"indent":case"outdent":t._handleIndentation(a);break;case"subscript":case"superscript":t._handleSubSuperScript(a);break;case"print":t._handlePrint();break;default:t._inlineToolbarItemsObj?t._updateEditorViaWindow(t._inlineToolbarItemsObj[a]):t._toolbarItemsObj&&t._updateEditorViaWindow(t._toolbarItemsObj[a])}}_handleCommonToolbarAction(e,t){const o=this;if("html"===o.editMode){const n=o._getSelectionRange(),a=o.$.iframe,[i,r]=a?[a.contentDocument,a.contentWindow]:[document,window];let l,s=n.startContainer;if(!s)return;const d=e=>"string"==typeof e?i.execCommand(e):"object"==typeof e?i.execCommand(e.name,!1,e.value):void 0;if(n.startOffset===n.endOffset&&s.nodeType===Node.TEXT_NODE){const{selectionStartIndex:e,selectionEndIndex:t}=o._getTextFromCarret();l=n.startOffset-e,o._setSelectionRange(s,e,t)}d(e)&&void 0!==l&&o._setSelectionRange(r.getSelection().focusNode,l,l),t&&o._updateToolbarItems(t)}}_handleClearFormat(){this._handleCommonToolbarAction("removeFormat")}_handleFontName(e){this._handleCommonToolbarAction(e)}_handleFontSize(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange();let n,a=o.startContainer;if(a){if(o.startOffset===o.endOffset){if(a.nodeType!==Node.TEXT_NODE){const n=document.createElement("font");return o.insertNode(n),t._setSelectionRange(n),void(n.style.fontSize=e.value+"px")}{const{selectionStartIndex:e,selectionEndIndex:i}=t._getTextFromCarret();n=o.startOffset-e,t._setSelectionRange(a,e,i)}}if((t.$.editableElement.getRootNode()||document).execCommand("fontSize",!1,3)){const a=t.$.iframe,i=a?a.contentWindow:window;if(o.commonAncestorContainer.closest){const t=o.commonAncestorContainer.querySelectorAll("font[size]");for(let o=0,n=t.length;o<n;o+=1){const n=t[o];n.removeAttribute("size"),n.style.fontSize=e.value+"px"}}else{const t=i.getSelection().focusNode;if(!t)return;const o=t.closest?t.closest(".smart-editor-editable font"):t.parentElement;"font"===o.nodeName.toLowerCase()&&(o.removeAttribute("size"),o.style.fontSize=e.value+"px")}void 0!==n&&t._setSelectionRange(i.getSelection().focusNode,n,n)}}}_handleFormats(e){const t=this;if("markdown"!==t.editMode)t._getSelectionRange().startContainer&&t.$.editableElement.getRootNode().execCommand("formatBlock",!1,e.value);else{let o;switch(e.value){case"h1":o="#";break;case"h2":o="##";break;case"h3":o="###";break;case"h4":o="####";break;case"h5":o="#####";break;case"h6":o="######";break;case"code":o="```\n\n```";break;case"blockquote":o=">";break;default:o=e.value}0===o.indexOf("#")||0===o.indexOf(">")?(o+=" ",t._insertMarkDown(o,t.$.input.selectionStart+o.length)):t._insertMarkDown(o,t.$.input.selectionStart+o.length/2)}}_handleSubSuperScript(e){this._handleCommonToolbarAction(e,["subscript","superscript"])}_handleTextDecorations(e){const t=this;if("markdown"===t.editMode){const o=t.$.input;let n;switch(e){case"bold":n="****";break;case"italic":n="**";break;case"underline":n="<ins></ins>";break;case"strikethrough":n="~~~~"}return void t._insertMarkDown(n,o.selectionStart+n.length/2)}const o=t._getSelectionRange();let n,a=o.startContainer;if(a){if(o.startOffset===o.endOffset&&a.nodeType===Node.TEXT_NODE){const{selectionStartIndex:e,selectionEndIndex:i}=t._getTextFromCarret();n=o.startOffset-e,t._setSelectionRange(a,e,i)}if((t.$.editableElement.getRootNode()||document).execCommand(e))if(void 0!==n){const e=t.$.iframe,o=e?e.contentWindow:window,a=o.getSelection().focusNode;a.textContent=a.textContent.trim(),t._setSelectionRange(o.getSelection().focusNode,n,n)}else t._setSelectionRange();t._updateToolbarItems([e])}}_handlePasteAction(e,t,o){if(!e)return;const n=this;if(t&&!t.name&&"prompt"===n.pasteFormat){const a={name:"paste",text:e,textType:o};return t&&(a.value=t.value,a.advanced=t.advanced),void n._openWindow(a)}n._handleTextPaste(e,t,o)}_handleTextPaste(e,t,o){const n=this,a=n.$.input;if("markdown"===n.editMode)return void n._insertMarkDown(e);e=e.replace(/<!--StartFragment-->|<!--EndFragment-->/gi,"");let i,r=n.pasteFormat;if(t&&t.advanced&&(r=t.value),!o||"plainText"===r){const t=document.createElement("div");t.innerHTML=e,e=t.innerText}if(o&&"text/plain"!==o?(i=document.createElement("div"),i.innerHTML=e,i=i.firstChild):i=document.createTextNode(e),!i)return;if(a.getRootNode().activeElement===a){const e=a.value;return void(a.value=e.slice(0,a.selectionStart)+(i.nodeType===Node.TEXT_NODE?i.textContent:i.outerHTML)+e.slice(a.selectionEnd))}const l=n._getSelectionRange(),s=n.$.iframe,[d,c]=s?[s.contentWindow,s.contentDocument]:[window,document];if(l instanceof d.Range){if(l.deleteContents(),l.insertNode(i),"cleanFormat"===r&&i.nodeType!==Node.TEXT_NODE){const e=i.querySelectorAll("[style]");for(let t=0,o=e.length;t<o;t+=1)e[t].removeAttribute("style");i.removeAttribute("style")}l.collapse()}else c.execCommand("paste")}_handlePaste(e){const t=this,o=navigator.clipboard,n=o.read?"read":"readText",a=()=>{o[n]&&o[n]().then((o=>{if(Array.isArray(o)&&o.length){const n=o[0],a=n.types.indexOf("text/html")>-1?"text/html":"text/plain";n.getType(a).then((o=>{o.text().then((o=>t._handlePasteAction(o,e,a)))}))}else"string"==typeof o&&t._handlePasteAction(o,e)}))};if(navigator.permissions&&navigator.permissions.query&&!t._isFireFox)try{navigator.permissions.query({name:"clipboard-read"}).then((e=>{("granted"===e.state||"prompt"===e.state&&o[n])&&a()}))}catch(e){t.error(t.localize("permissionsRequired",{elementType:t.nodeName.toLowerCase(),actionName:"paste"}))}else if(o[n])return void a();t.$.editableElement.getRootNode().execCommand("paste")}_handlePasteViaWindow(e){const t=this,o=t._getItemOptionsViaWindow(e);if(!e||"paste"!==e.name)return;let n=t.pasteFormat;for(let e in o)if(o[e]){n=e;break}e.value=n,t._handleTextPaste(e.text,e,e.textType)}_handleClipboardAction(e){const t=this,o=navigator.clipboard,n=t.editMode,a=t.$.input;if("paste"!==e)if(o){const i=t._getSelectionRange();if("copy"===e||"cut"===e){let r;if(r="markdown"===n?a.value.slice(a.selectionStart,a.selectionEnd):i.toString(),o.writeText(r),"cut"===e)if("markdown"===n){const e=a.value,o=a.selectionStart;a.value=e.slice(0,o)+e.slice(a.selectionEnd),t._setSelectionRange(a,o,o),t._refreshMarkdownPreview()}else i.deleteContents()}}else a.getRootNode().execCommand(e);else t._handlePaste()}_handleLinkRemove(){const e=this,t=e._toolbarItemClick.target;let o;if(t&&t&&"img"===t.nodeName.toLowerCase())o=t.parentElement,o&&"a"===o.nodeName.toLowerCase()&&(o.parentElement.insertBefore(t,o),o.remove());else{const t=e.$.iframe;let o,n;t?(o=t.contentDocument,n=t.contentWindow):(o=document,n=window);const a=n.getSelection(),i=e._getSelectionRange();a.removeAllRanges(),a.addRange(i);const r=a.anchorNode?a.anchorNode.parentElement:void 0;if(!r||"a"!==r.nodeName.toLowerCase())return;i.selectNode(a.anchorNode),o.execCommand("unlink",!1,!1)}}_handleBackgroundColor(e){const t=this;if("markdown"===t.editMode)return;const o=t.$.iframe,n="string"==typeof e?e:e.value,[a,i]=o?[o.contentDocument,o.contentWindow]:[document,window],r=t.$.inlineToolbar,l=t._getSelectionRange(),s=r&&r.visible?r.selector:l.commonAncestorContainer;let d;if(s&&["th","td"].indexOf(s.nodeName.toLowerCase())>-1){if(l.startOffset===l.endOffset)return void(s.style.backgroundColor=n);d=s.style.backgroundColor}const c=l.startOffset,m=l.endOffset,u=l.startContainer;let b;if(u&&u.nodeType===Node.TEXT_NODE&&l.startOffset===l.endOffset){const{selectionStartIndex:e,selectionEndIndex:o}=t._getTextFromCarret();b=l.startOffset-e,t._setSelectionRange(u,e,o)}else u.closest&&c!==m&&t._setSelectionRange(u,c,m);const p=a.execCommand("hiliteColor",!1,n&&"transparent"!==n?n:"transparent");s&&d?s.style.backgroundColor=d:p&&void 0!==b&&t._setSelectionRange(i.getSelection().focusNode,b,b)}_handleFontColor(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange(),n="string"==typeof e?e:e.value,a=o.startContainer,i=t.$.iframe,r=n?"foreColor":"removeFormat",[l,s]=i?[i.contentDocument,i.contentWindow]:[document,window];let d;if(a&&a.nodeType===Node.TEXT_NODE&&o.startOffset===o.endOffset){const e=a.parentElement;if("font"===e.nodeName.toLocaleLowerCase())return void(e.color=n);const{selectionStartIndex:i,selectionEndIndex:r}=t._getTextFromCarret();d=o.startOffset-i,t._setSelectionRange(a,i,r)}l.execCommand(r,!1,n)&&void 0!==d&&t._setSelectionRange(s.getSelection().focusNode,d,d)}_handlePrint(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const o=window.open("","","width=800,height=500"),n=o.document.open(),a='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>'+t+"</title></head><body>"+e._handleDataExport("html")+"</body></html>";try{n.write(a),n.close(),setTimeout((function(){o.print(),o.close()}),100)}catch(e){}e.dataExport.fileName=t}_handleDataExport(e,t){const o=this;if(!Smart.Utilities.DataExporter)return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"smart.export.js"}));try{new JSZip}catch(e){return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"jszip.min.js"}))}if("pdf"===e&&!window.pdfMake)return void o.error(o.localize("missingReference",{elementType:o.nodeName.toLowerCase(),methodName:"exportData",files:"pdfMake.min.js"}));const n=new Smart.Utilities.DataExporter({exportHeader:!1,pageOrientation:o.dataExport.pageOrientation,style:o.dataExport.style});let a;if(o._setExportStyles(n,e),"markdown"===o.editMode){const t=o.$.input;a="md"!==e&&window.marked?window.marked(t.value):t.value}else a=o.$.editableElement["pdf"===e?"textContent":"innerHTML"];const i=[{value:a}];return n.exportData(i,e,o.dataExport.fileName,t)}_setExportStyles(e,t){const o=this;if(e.style)return;const n=window.getComputedStyle(o),a=n.getPropertyValue("--smart-border-width")||"1px",i=n.getPropertyValue("--smart-border")||"black",r=n.getPropertyValue("--smart-editor-table-column-width")||"initial",l=n.getPropertyValue("--smart-editor-table-cell-min-height")||"20px",s=n.getPropertyValue("--smart-editor-table-cell-min-width")||l,d=n.getPropertyValue("--smart-surface")||"#333",c=n.getPropertyValue("--smart-alternation-index0-background")||d;e.style={border:"initial",width:"100%",height:o.$.editableElement.scrollHeight+"px",removeDefault:!0,custom:`\n            ${"html"===t&&o.rightToLeft?"body { direction: rtl; }":""}\n\n          .column table {\n            width: 100%;\n            border-collapse: collapse;\n            empty-cells: show;\n            border-spacing: 0;\n            table-layout: fixed;\n          }\n          \n          .column td, .column th {\n            border: ${a} solid ${i};\n            width: ${r};\n            min-height: ${l};\n            min-width: ${s};\n            padding: 2px 5px;\n            vertical-align: middle;\n          }\n          \n          .column table img {\n            max-width: 100%;\n          }\n          \n          .column table table {\n            width: 100%;\n          }\n          \n          .column table th {\n            background: ${d};\n          }\n\n          .column th:empty::before,\n          .column td:empty::before {\n            content: 'A';\n            visibility: hidden;\n          }\n          \n          .column table[dashed-borders] th, .column table[dashed-borders] td {\n            border-style: dashed;\n          }\n          \n          .column table[alternation] tr:nth-child(2n) {\n            background-color: ${c};\n          }\n          \n          .column .smart-editor-image-container {\n            display: inline-block;\n          }\n          \n          .column .smart-editor-image-container[display="block"] {\n            display: block;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="left"] img {\n            margin-left: 0;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="left"] .smart-editor-image-caption {\n            text-align: left;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="right"] img {\n            margin-right: 0;\n          }\n          \n          .column .smart-editor-image-container[display="block"][alignment="right"] .smart-editor-image-caption {\n            text-align: right;\n          }\n          \n          .column .smart-editor-image-container:not([display="block"])[alignment="left"] {\n            float: left;\n          }\n          \n          .column .smart-editor-image-container:not([display="block"])[alignment="right"] {\n            float: right;\n          }\n          \n          .column .smart-editor-image-container .smart-editor-image-caption {\n            display: block;\n            text-align: center;\n            outline: none;\n          }`}}_handleSourceCodeMode(e){const t=this,o=t.editMode,n=t._toolbarItemsObj.sourcecode;let a;if(t.$.contentContainer.hasAttribute("split-mode"))return;e?a=e.hasAttribute("checked"):(a=n?n.value:!t.classList.contains("preview-mode"),e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="sourcecode"]')),t._closePopups(),t._closeWindow(),t._setResizeFrame(),t._handleTableSelection();const i=t.$.editableElement,r=t.$.input;"markdown"===o?a&&i.classList.contains("smart-hidden")?(i.innerHTML=window.marked?window.marked(r.value):r.value,i.classList.remove("smart-hidden"),r.classList.add("smart-hidden"),i.focus({preventScroll:!0})):!a&&r.classList.contains("smart-hidden")&&(i.classList.add("smart-hidden"),r.classList.remove("smart-hidden"),r.focus({preventScroll:!0})):a&&r.classList.contains("smart-hidden")?(r.value=i.innerHTML,i.classList.add("smart-hidden"),r.classList.remove("smart-hidden"),r.focus({preventScroll:!0})):!a&&i.classList.contains("smart-hidden")&&(i.innerHTML=r.value,r.classList.add("smart-hidden"),i.classList.remove("smart-hidden"),i.focus({preventScroll:!0})),a?t.classList.add("preview-mode"):t.classList.remove("preview-mode"),n&&(n.value=a),e&&n&&(a?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)),t._setToolbarItemAttr("sourcecode","disabled",n.disabled))}_handleFullScreenMode(e){const t=this,o=t._toolbarItemsObj.fullscreen;let n;e?n=e.hasAttribute("checked"):(n=o?o.value:!t.classList.contains("full-screen-mode"),e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="fullscreen"]')),t._closePopups(),t._setResizeFrame(),t._handleTableSelection(),n?(t.classList.add("full-screen-mode"),t._lastToolbarExpandedState=t.$.toolbar.hasAttribute("expanded")):(t.classList.remove("full-screen-mode"),t._lastToolbarExpandedState&&t._toggleToolbar()),o&&(o.value=n),e&&o&&(n?(e.setAttribute("cheched",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)),o.disabled?(e.setAttribute("disabled",""),e.setAttribute("aria-disabled",!0)):(e.removeAttribute("disabled"),e.removeAttribute("aria-disabled")))}_handleSplitMode(e){const t=this,o=t.$.editableElement,n=t.$.input,a=t.$.contentContainer,i=t._toolbarItemsObj,r=i.splitmode,l=i.sourcecode,s=e?e.hasAttribute("checked"):!a.hasAttribute("split-mode"),d=t.editMode;t._closePopups(),s?("markdown"===d?o.innerHTML=window.marked?window.marked(n.value):n.value:n.value=o.innerHTML.trim(),a.setAttribute("split-mode",""),n.classList.remove("smart-hidden"),o.classList.remove("smart-hidden"),l&&t._setToolbarItemAttr("sourcecode","disabled",!0)):(a.removeAttribute("split-mode",""),"markdown"===d?o.classList.add("smart-hidden"):n.classList.add("smart-hidden"),l&&t._setToolbarItemAttr("sourcecode","disabled",!1)),r&&(r.value=s),e||(e=t.$.toolbar.querySelector('.smart-editor-toolbar-item[item-name="splitmode"]')),e&&(s?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1))),t.classList.contains("preview-mode")&&t._handleSourceCodeMode()}_handleUndoRedo(e){this.$.editableElement.getRootNode().execCommand(e)}_handleTextCase(e){const t=this;if("markdown"===t.editMode)return;const o=t._getSelectionRange(),n=o.startContainer;if(!n)return;const a=n.textContent;let i,r,l,s,d=o.startOffset;n.nodeType===Node.TEXT_NODE&&o.startOffset===o.endOffset?(({selectionStartIndex:l,selectionEndIndex:s}=t._getTextFromCarret()),r=a.slice(l,s)):([l,s]=[d,o.endOffset],r=a.slice(d,o.endOffset),i=o.endOffset),r="lowercase"===e?r.toLowerCase():r.toUpperCase(),n.textContent=a.slice(0,l)+r+a.slice(s),t._setSelectionRange(n,d,i||d)}_handleList(e){const t=this;if(!e)return;if("markdown"===t.editMode){const o="orderedlist"===e?"1. ":"- ";return void t._insertMarkDown(o,t.$.input.selectionStart+o.length)}let o,n,a=t._getSelectionRange();if(a.startContainer===a.endContainer&&(o=a.startOffset,n=a.endOffset),t.$.editableElement.getRootNode().execCommand("insert"+e,!1)){const e=t.$.iframe;a=(e?e.contentWindow:window).getSelection(),void 0!==n&&void 0!==n&&t._setSelectionRange(a.focusNode,o,n),t._updateToolbarItems(["orderedlist","unorderedlist"])}}_handleIndentation(e){"markdown"!==this.editMode&&this.$.editableElement.getRootNode().execCommand(e,!1)}_handleTextDelete(){this.$.editableElement.getRootNode().execCommand("delete")}_handleTabInsert(){this.$.editableElement.getRootNode().execCommand("insertHTML",!1,"&#009")}_handleTableToolbarAction(e,t){const o=this,n=o._toolbarItemClick;if(!t&&n&&(t=n.target),!t||"table"!==t.nodeName.toLowerCase()||!e)return;const a=e.getAttribute?e.getAttribute("item-name"):e.name,i=o.$.inlineToolbar;let r=e;if(r.closest){const e=o.$.inlineToolbar;r=(e&&e.contains(r)?o._inlineToolbarItemsObj:o._toolbarItemsObj)[a]}if(!n&&o.$.fireEvent("actionStart",{name:a}).defaultPrevented)return;switch(a){case"backgroundcolor":o._handleBackgroundColor(r);break;case"fontcolor":o._handleFontColor(r);break;case"fontsize":o._handleFontSize(r);break;case"tableheader":o._handleTableHeader(t);break;case"tablerows":o._handleTableRows(t,r);break;case"tablecolumns":o._handleTableColumns(t,r);break;case"tablevalign":o._handleTableVAlignment(t,r);break;case"alignment":o._handleTextAlignment(r);break;case"tablestyle":o._handleTableStyle(t,r);break;default:o._handleToolbarItemAction(e)}!n&&a&&o.$.fireEvent("actionEnd",{name:a}),i&&i.visible&&(o.$.editableElement.contains(i.selector)?i.reposition():o._closeToolbar());const l=o._getSelectionRange().startContainer,s=["th","td"].indexOf(l.nodeName.toLowerCase())>-1;o._setResizeFrame(s&&t.contains(l)?t:void 0)}_handleTableHeader(e,t){let o,n,a=e.querySelector("th"),i=e.querySelector("tbody tr"),r=e.querySelector("thead");if(i&&(n=Array.from(i.children)),t||!r&&!a){if(void 0===t||!0===t){let t=e.querySelectorAll("tbody tr:first-of-type td").length;r||(r=document.createElement("thead")),o=r.querySelector("tr"),o||(o=document.createElement("tr"));const a=Array.from(o.children);for(;a.length>t;)a.pop().remove();for(let e=a.length;e<t;e+=1){const t=document.createElement("th");n[e]&&(t.style.width=n[e].style.width,n[e].style.width=""),o.appendChild(t)}r.appendChild(o),e.insertBefore(r,e.querySelector("tbody")||e.querySelector("tr"))}}else r&&r.remove(),a&&(o=a.closest("tr"),o&&o.remove(),Array.from(o.children).forEach(((e,t)=>n[t].style.width=e.style.width)))}_handleTableRows(e,t){const o=this,n=o.$.inlineToolbar.selector;let a;if(!(n&&["th","td"].indexOf(n.nodeName.toLowerCase())>-1))return;if(a=n.closest("tr"),!a)return;const i=t.value,r=a.closest("thead");switch(i){case"insertRowAfter":case"insertRowBefore":{const t=document.createElement("tr"),o=a.parentElement;if(!o)break;let n=parseInt(e.getAttribute("aria-colcount"));const l=r?"th":"td";n&&!isNaN(n)||(n=e.querySelectorAll("tr:first-of-type td").length);for(let e=0;e<n;e+=1)t.appendChild(document.createElement(l));o.insertBefore(t,i.indexOf("Before")>-1?a:a.nextElementSibling);break}case"deleteRow":o._closeToolbar(),a.remove(),r&&!r.children.length&&r.remove()}const l=e.querySelectorAll("tr").length;l?e.setAttribute("aria-rowcount",l):e.remove()}_handleTableColumns(e,t){const o=this,n=o.$.inlineToolbar.selector;if(!(n&&["th","td"].indexOf(n.nodeName.toLowerCase())>-1))return;const a=t.value,i=Array.from(e.querySelectorAll("tr"));if(!i.length)return o._closeToolbar(),void e.remove();const r=Array.from(n.parentElement.children).indexOf(n);switch(a){case"insertColumnLeft":case"insertColumnRight":{const e=a.indexOf("Left")>-1;for(let t=0,o=i.length;t<o;t+=1){const o=i[t],n=o.children[r];if(n){const t="th"===n.tagName.toLowerCase()?"th":"td";o.insertBefore(document.createElement(t),e?n:n.nextElementSibling)}}break}case"deleteColumn":o._closeToolbar();for(let e=0,t=i.length;e<t;e+=1){const t=i[e].children[r];t&&t.remove()}}const l=i[0].children.length;l?e.setAttribute("aria-colcount",l):e.remove()}_handleTextAlignment(e){if("markdown"===this.editMode)return;const t="justify"===e.value?"full":e.value;this.$.editableElement.getRootNode().execCommand("justify"+t.charAt(0).toUpperCase()+t.slice(1),!1,null)}_handleTableVAlignment(e,t){const o=this.$.inlineToolbar;if(!o)return;const n=o.selector;n&&["th","td"].indexOf(n.nodeName.toLowerCase())>-1&&(n.style.verticalAlign=t.value)}_handleTableStyle(e,t){const o=this.$.inlineToolbar.selector;if(o&&["th","td"].indexOf(o.nodeName.toLowerCase())>-1)switch(t.value){case"altrows":e.toggleAttribute("alternation");break;case"dashedborders":e.toggleAttribute("dashed-borders")}}_handleInlineToolbar(e){const t=this,o=e.nodeName.toLowerCase();"a"===o?t._openInlineToolbar(e):"img"===o||["td","th"].indexOf(o)>-1?(t._setResizeFrame(e),t._openInlineToolbar(e)):e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length&&t._openInlineToolbar(e)}_handleTableCellResize(e){const t=this,o=t._inlineToolbarClickObj,n=o?o.resizeDetails:void 0;if(!n)return;const a=n.target,i=n.position,r=t.$.inlineToolbar;switch(n.started||t.$.fireEvent("resizeStart",{target:a}),a.setAttribute("resizing",""),n.started=!0,r&&r.visible&&(n.isInlineToolbarOpened=!0,t._closeToolbar()),i){case"horizontal":{const o=e.pageX+window.pageXOffset;if(t._setTableResizeDetails(n),!n.shrinkingCell)break;t._handleHorizontalTableCellResize(n,o);break}case"vertical":{const o=n.table;o.style.height&&(o.querySelectorAll("tr").forEach((e=>e.style.height=e.offsetHeight+"px")),o.style.height=""),t._resizeFrameObj&&t._resizeFrameObj.target&&t._setResizeFrame();const i=e.pageY+window.pageYOffset,r=n.y-i;let l=a.offsetHeight;l-=r,a.style.height=Math.max(1,l)+"px",l===a.offsetHeight&&(n.y=i+Math.abs(Math.min(0,l)));break}}}_setTableResizeDetails(e){const t=e.table,o=e.target;let n,a=e.expandingCell,i=e.shrinkingCell,r=e.isLastCell,l=e.areAllCellsResized;if(!a){const i=t.querySelector("tr"),r=Array.from(o.parentElement.children).indexOf(o);n=e.cells=Array.from(i.children),a=e.expandingCell=n[r]}e.shrinkingCell||(i=e.shrinkingCell=a.nextElementSibling,l=e.areAllCellsResized=!n.some((e=>e!==a&&e!==i&&!e.style.width)),r=e.isLastCell=l&&null===i.nextElementSibling,l&&!e.lastCell&&(e.lastCell=n[n.length-1]),r&&(i.style.width=""))}_handleHorizontalTableCellResize(e,t){const o=30,n=e.isLastCell;let a=e.expandingCell,i=e.shrinkingCell,r=a.offsetWidth,l=i.offsetWidth,s=e.x-t;const d=e.x-r+o,c=e.x+i.offsetWidth-o;if(n){const n=r+l-o;a.style.width=Math.min(Math.max(o,r-s),n)+"px",a.offsetWidth!==r&&(e.x=Math.min(c,Math.max(d,t)))}else{let n;s>0&&([a,i]=[i,a],[r,l]=[l,r],s*=-1),i.style.width=Math.max(o,l+s)+"px",n=i.offsetWidth-l,a.style.width=Math.max(o,a.offsetWidth-n)+"px",0!==n&&(e.x=Math.min(c,Math.max(d,t))),e.lastCell&&(e.lastCell.style.width="")}}_handleFrameResize(e){const t=this,o=t._resizeFrameObj;if(!o)return;t._closeToolbar();const n=o.target,a=o.resizeDetails,i=a.position,r=e.pageX+window.pageXOffset,l=e.pageY+window.pageYOffset,s=a.x-r,d=a.y-l;let c,m,u;"img"===n.nodeName.toLowerCase()?(c=n.width,m=n.height,u=i.indexOf("center")<0):(c=n.offsetWidth,m=n.offsetHeight),a.started||t.$.fireEvent("resizeStart",{target:n}),a.started=!0;const b=c,p=m,h=!u&&t.rightToLeft?-1:1;switch(i){case"top-left":n.style.width=Math.max(0,b+h*(u?d:s))+"px",n.style.height=Math.max(0,p+d)+"px",c=n.offsetWidth,m=n.offsetHeight,b!==c&&(a.x-=h*(c-b)),p!==m&&(a.y-=m-p);break;case"bottom-left":case"bottom-right":n.style.width=Math.max(0,b-h*(u?d:s))+"px",n.style.height=Math.max(0,p-d)+"px",c=n.offsetWidth,m=n.offsetHeight,b!==c&&(a.x+=h*(c-b)),p!==m&&(a.y+=m-p);break;case"top-right":n.style.width=Math.max(0,b+h*(u?d:-s))+"px",n.style.height=Math.max(0,p+d)+"px",c=n.offsetWidth,m=n.offsetHeight,p!==m&&(a.y-=m-p),b!==c&&(a.x+=h*(c-b));break;case"top-center":n.style.height=Math.max(0,p+d)+"px",m=n.offsetHeight,p!==m&&(a.y-=m-p);break;case"bottom-center":n.style.height=Math.max(0,p-d)+"px",m=n.offsetHeight,p!==m&&(a.y+=m-p);break;case"left-center":n.style.width=Math.max(0,b+h*s)+"px",c=n.offsetWidth,b!==c&&(a.x-=h*(c-b));break;case"right-center":n.style.width=Math.max(0,b-h*s)+"px",c=n.offsetWidth,b!==c&&(a.x+=h*(c-b))}t._positionResizeHandles()}_deleteResizeFrameTarget(e){const t=this;if(e&&"img"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-editable .smart-editor-image-container"),n=(o||e).parentElement,a=n&&"a"===n.nodeName.toLowerCase()?n:void 0;t._setResizeFrame(),(a||o||e).remove(),URL.revokeObjectURL(e.src)}else if(e&&"table"===e.nodeName.toLowerCase()){const o=e.closest(".smart-editor-editable table");o&&(t._setResizeFrame(),o.remove())}t._setCharCount()}_setResizeFrame(e,t){const o=this,n=o.$.editableElement;let a,i=e?e.nodeName.toLowerCase():"",r=o._resizeFrameObj;if("td"!==i&&"th"!==i||(e=e.closest(".smart-editor-editable table")),i=e?e.nodeName.toLowerCase():"",e&&e.parentElement&&("img"===i||"table"===i)&&"false"!==n.getAttribute("contenteditable"))if(r?a=r.element:(r=o._resizeFrameObj={},a=r.element=document.createElement("span"),a.classList.add("smart-editor-resize-frame"),a.innerHTML='<span position="top-left"></span><span position="top-right"></span>\n                                     <span position="bottom-left"></span><span position="bottom-right"></span>\n                                     <span position="top-center"></span><span position="bottom-center"></span>\n                                     <span position="left-center"></span><span position="right-center"></span>'),r.target=e,"false"!==e.getAttribute("resizable")){if(e.setAttribute("show-resize-frame",""),o._positionResizeHandles(),a.parentElement||o.$.contentContainer.appendChild(a),!t&&"img"===i){const e=o.$.iframe;(e?e.contentWindow:window).getSelection().collapse(null),o._updateToolbarItems()}}else e.removeAttribute("show-resize-frame");else r&&(r.element.remove(),r.target&&r.target.removeAttribute("show-resize-frame"),delete r.target)}_positionResizeHandles(){const e=this,t=e._resizeFrameObj;if(!e._resizeFrameObj)return;const o=t.element,n=e.rightToLeft,a=n?"right":"left",i=t.target.getBoundingClientRect(),r=o.children,l=r[0],s=r[1],d=r[2],c=r[3],m=r[4],u=r[5],b=r[6],p=r[7],h=e.$.editableElement,g=e.$.contentContainer.getBoundingClientRect(),f=i.top-g.top+h.offsetTop,_=i.width,w=i.height;let v;n?(v=g.right-i.right+(h.offsetLeft+h.offsetWidth-g.width),l.style.left=d.style.left=b.style.left=""):(v=i.left-g.left+h.offsetLeft,l.style.right=d.style.right=b.style.right=""),l.style.top=s.style.top=m.style.top=f+"px",l.style[a]=d.style[a]=b.style[a]=v+"px",d.style.top=c.style.top=u.style.top=f+w+"px",s.style[a]=c.style[a]=p.style[a]=_+v+"px",m.style[a]=u.style[a]=v+_/2+"px",b.style.top=p.style.top=f+w/2+"px"}_openInlineToolbar(e){const t=this,o=t.$.editableElement;let n=t.$.inlineToolbar;if(t._closeToolbarItemDropDown(t.$.inputPopup),t._closeToolbarItemDropDown(t.$.colorInputPopup),"false"===o.getAttribute("contenteditable")||t.hideInlineToolbar)return void(n&&n.visible&&n.close());n||(n=t._createToolbar()),t._setupToolbar(e,"inline"),n.parentElement||t.getShadowRootOrBody().appendChild(n);const a=t._getInlineToolbarContent(e);n.clear(),a instanceof DocumentFragment&&(n.appendChild(a),n.open(),t._setAriaOwns(n)),t._updateToolbarItems(void 0,n)}_closeToolbar(){const e=this.$.inlineToolbar;e&&e.close()}_closePopups(){const e=this;e._closeToolbar(),e._closeToolbarItemDropDown(e.$.inputPopup),e._closeToolbarItemDropDown(e.$.colorInputPopup)}_createToolbar(){const e=this;let t=e.$.inlineToolbar;return t||(t=document.createElement("smart-tooltip"),t.classList.add("smart-editor-toolbar"),e.$.inlineToolbar=t,e.$inlineToolbar=Smart.Utilities.Extend(t),t)}_setupToolbar(e,t){const o=this,n=o.$.iframe,a=o.$.inlineToolbar,i=o.$inlineToolbar;if(!a.visible){const e=e=>o._tooltipVisibilityHandler.call(o,e),t=e=>o._tooltipVisibilityHandler.call(o,e),n=e=>o._tooltipChangeHandler.call(o,e),a=e=>o._tooltipClickHandler.call(o,e),r=e=>o._tooltipTransitionEndHandler.call(o,e);i.unlisten("open"),i.unlisten("close"),i.unlisten("change"),i.unlisten("click"),i.unlisten("transitionend"),i.listen("open",e),i.listen("close",t),i.listen("change",n),i.listen("click",a),i.listen("transitionend",r)}if(a.locale=o.locale,a.rightToLeft=o.rightToLeft,a.theme=o.theme,a.animation=o.animation,a.position="auto",a.openMode="manual","inline"!==t)return a.iframeRect=null,a.arrow=!1,a.align=o.rightToLeft?"right":"left",a.offset=[0,-5],a.selector=e,a.classList.add("smart-editor-drop-down-toolbar"),void a.classList.remove("smart-editor-inline-toolbar");if(a.iframeRect=n?n.getBoundingClientRect():null,a.arrow=!0,a.align="center",a.offset=o.inlineToolbarOffset,a.classList.add("smart-editor-inline-toolbar"),a.classList.remove("smart-editor-drop-down-toolbar"),a.selector&&!a.selector.closest&&delete a.selector.getBoundingClientRect,e.closest)a.selector=e;else{const t=e.parentElement,n=o._getSelectionRange();t.getBoundingClientRect=()=>n.getBoundingClientRect(),a.selector=t}}_getInlineToolbarContent(e){const t=this,o=t.$.inlineToolbar;if(o.innerHTML&&o.selector.nodeName===e.nodeName)return;let n;const a=t._toolbarItemsObj,i=e.nodeName.toLowerCase(),r=(e=[])=>{let t;for(let o=0,n=e.length;o<n;o+=1){const n=a[e[o]];if(n){t=n;break}}return t};let l;switch(i){case"a":l=r(["hyperlink","createlink"]);break;case"#text":l=r(["cut","copy","paste"]);break;case"img":l=r(["image"]);break;case"td":case"th":l=r(["table"]);break;default:return}return n=l&&Array.isArray(l.inlineToolbarItems)?l.inlineToolbarItems:t._getDefaultInlineToolbarItems(e,i),n.length?t._getToolbarItems(o,n):void 0}_getDefaultInlineToolbarItems(e,t){let o;switch(t){case"a":o=["openlink","editlink","removelink"];break;case"#text":o=["cut","copy","paste"];break;case"img":o=["image","alignment","createlink","delete","caption"],"a"===e.parentElement.nodeName.toLowerCase()&&o.splice(o.indexOf("createlink")+1,0,"openlink","removelink");break;case"td":case"th":o=["table","tableheader","tablerows","tablecolumns","backgroundcolor","delete","alignment","tablevalign","tablestyle"];break;default:return[]}return o}_tooltipChangeHandler(e){const t=this,o=e.target,n=t.$.inlineToolbar;n&&n.classList.contains("smart-editor-drop-down-toolbar")&&n.visible&&n.contains(o)?o.classList.contains("smart-table-picker")&&(t._handleTableInsert({cells:e.detail.value}),n.close()):t._changeHandler(e)}_tooltipClickHandler(e){const t=this,o=e.target,n=t.$.inlineToolbar;if(n&&n.classList.contains("smart-editor-drop-down-toolbar")&&n.contains(e.target)&&o.closest(".smart-table-picker-button")){const e=t._getSelectionRange();let o;return e.startContainer&&["th","td"].indexOf(e.startContainer.nodeName.toLowerCase())>-1&&(o=e.startContainer.closest(".smart-editor-editable table")),void t._openWindow(n.selector,o)}}_tooltipVisibilityHandler(e){const t=this,o=t.$.inlineToolbar,n=e.type;if(e.target!==o)return;const a=(o.classList.contains("smart-editor-drop-down-toolbar")?"inline":"dropDown")+"Toolbar",i=t.$.inlineToolbar,r=t.$inlineToolbar;e.stopPropagation(),"close"===e.type&&(i.selector&&!i.selector.closest&&delete i.selector.getBoundingClientRect,i.hasAnimation||(r.unlisten(e.type),r.unlisten("change"),r.unlisten("click"),i.remove(),t._focusEditableElement())),t._setAriaOwns(o),t.$.fireEvent(a+n.slice(0,1).toUpperCase()+n.slice(1),e.detail)}_tooltipTransitionEndHandler(e){const t=this;if(!(e.target instanceof Smart.Tooltip))return;const o=(e.target===t.$.inlineToolbar?"inline":"dropDown")+"Toolbar",n=t.$[o],a=t[`$${o}`];n.visible||(a.unlisten("transitionend"),n.style.top=n.style.left=0,n.remove(),t._setAriaOwns(n))}_toggleItemDropDown(e){const t=this,o=e.getAttribute("item-type");let n;if("drop-down"===o?(t.$.inputPopup||(t.$.inputPopup=document.createElement("smart-input")),n=t.$.inputPopup):"color-input"===o&&(t.$.colorInputPopup||(t.$.colorInputPopup=document.createElement("smart-color-input")),n=t.$.colorInputPopup),n.noRipple=!0,t.$.inputPopup&&n===t.$.colorInputPopup&&t.$.inputPopup.parentElement?t._closeToolbarItemDropDown(t.$.inputPopup):t.$.colorInputPopup&&n===t.$.inputPopup&&t.$.colorInputPopup.parentElement&&t._closeToolbarItemDropDown(t.$.colorInputPopup),n)if(n.locale=t.locale,n.rightToLeft=t.rightToLeft,n.theme=t.theme,n.animation=t.animation,e.contains(n)&&n.opened)t._closeToolbarItemDropDown(n);else{const o=t.$.inlineToolbar;o&&!o.contains(e)&&t._closeToolbar(),n.remove(),t._openToolbarItemDropDown(e,n)}}_toggleDropDownToolbar(e){const t=this;if(!e)return;if("table"!==e.getAttribute("item-name"))return;const o=t.$.inlineToolbar;if(o&&o.visible&&o.classList.contains("smart-editor-drop-down-toolbar")){if(o.contains(e)){const o=t._getSelectionRange();let n;return o.startContainer&&["th","td"].indexOf(o.startContainer.nodeName.toLowerCase())>-1&&(n=o.startContainer.closest(".smart-editor-editable table")),void t._openWindow(e,n)}o.classList.contains("smart-editor-drop-down-toolbar")&&o.close()}else t._closeToolbarItemDropDown(t.$.inputPopup),t._closeToolbarItemDropDown(t.$.colorInputPopup),t._openDropDownToolbar(e)}_openDropDownToolbar(e){const t=this;let o=t.$.inlineToolbar;o||(o=t._createToolbar()),t._setupToolbar(e,"dropDown"),o.parentElement||t.getShadowRootOrBody().appendChild(o),t._setDropDownToolbarContent(e),o.open(),t._setAriaControls(e,o)}_setDropDownToolbarContent(e){const t=this,o=t.$.inlineToolbar,n=e.getAttribute("item-name");let a=t._dropDownToolbarObj;a||(a=t._dropDownToolbarObj={});let i=a[n];i||(i=document.createElement("smart-table-picker"),a[n]=i),i.rightToLeft=t.rightToLeft,i.locale=t.locale,i.messages=t.messages,i.value=[1,1],o.contains(i)||(o.clear(),o.appendChild(i))}_toggleWindow(e,t){const o=this;if(!e)return;const n=e.getAttribute("item-name"),a=o.$.window;if(!a)return void o._openWindow(e,t);const i=a._target?a._target.item:void 0;!i||i.name!==n||i.name===n&&!a.opened?o._openWindow(e,t):a.close()}_openWindow(e,t){const o=this;if(!e||!o._toolbarItemsObj||o._window&&o._window.opened)return;let n;if(e.closest){if(!e.classList.contains("smart-editor-toolbar-item"))return;n=(e.closest(".smart-editor-inline-toolbar")?o._inlineToolbarItemsObj:o._toolbarItemsObj)[e.getAttribute("item-name")]}else"object"==typeof e&&"string"==typeof e.name&&(n=e);if(!n)return;const a=o._createWindow(n);o.$.fireEvent("dialogOpening",{target:a,item:n}).defaultPrevented||(o._closeToolbarItemDropDown(o.$.inputPopup),o._closeToolbarItemDropDown(o.$.colorInputPopup),a._target={item:n,itemTarget:t,originalTarget:e},o._closeToolbar(),a.parentElement||o.getShadowRootOrBody().appendChild(a),a.isCompleted?o._setupWindow():a.whenReady((()=>o._setupWindow())))}_closeWindow(){const e=this.$.window;e&&e.opened&&e.close()}_setupWindow(){const e=this,t=e.$.window,o=t._target,n=o.item;function a(){e._positionWindow(),t.opened?(t.bringToFront(),t._handleActiveState(),t._onOpenCallback&&t._onOpenCallback()):t.open()}if(t.locale=e.locale,t.rightToLeft=e.rightToLeft,t.theme=e.theme,t.animation=e.animation,e.windowCustomizationFunction?e.windowCustomizationFunction(t,n):(e._setPopupWindowTemplate("header",n),e._setPopupWindowTemplate("footer",n),e._setPopupWindowTemplate("content",n)),!t.opened){const o=e.$window,n=t=>e._windowOpenHandler.call(e,t),a=t=>e._windowCloseHandler.call(e,t),i=t=>e._windowClickHandler.call(e,t),r=t=>e._windowChangeHandler.call(e,t),l=t=>e._windowKeyDownHandler.call(e,t),s=t=>e._windowTransitionendHandler.call(e,t),d=t=>e._fileUploadCompletedHandler.call(e,t),c=t=>e._fileUploadErrorHandler.call(e,t);o.unlisten("transitionend"),o.unlisten("open"),o.unlisten("close"),o.unlisten("click"),o.unlisten("change"),o.unlisten("keydown"),o.unlisten("uploadCompleted"),o.unlisten("uploadError"),t._onOpenCallback=()=>{((t.shadowRoot||t).querySelector(".smart-input.smart-element")||t).focus({preventScroll:!0})},t.hasAnimation&&o.listen("transitionend",s),o.listen("open",n),o.listen("close",a),o.listen("click",i),o.listen("change",r),o.listen("keydown",l),o.listen("uploadCompleted",d),o.listen("uploadError",c)}t.shadowRoot?e._onShadowDomLoaded(t,"smart.window.css",a):a(),e._setAriaOwns(t),e._setAriaControls(o.originalTarget,t)}_setPopupWindowTemplate(e,t){const o=this,n=o.$.window;if(!n)return;if("content"===e)return void o._setWindowContent(t);n[e+"Template"]||(n[e+"Template"]=o._createWindowTemplate(e,t));const a=n._target.item;if("header"===e)n.label=o.localize(a.name)||"";else if("footer"===e){const e=(n.shadowRoot||n).querySelectorAll(".smart-editor-window-button");for(let t=0;t<e.length;t++){const n=e[t];n.innerHTML='<span class="smart-icon"></span>',n.theme=o.theme,n.rightToLeft=o.rightToLeft,n.animation=o.animation,n.classList.contains("ok")?(n.innerHTML+=o.localize("ok"),n.setAttribute("aria-label","ok")):n.classList.contains("cancel")&&(n.innerHTML+=o.localize("cancel"),n.setAttribute("aria-label","cancel"));const a=n.querySelector(".smart-ripple");a&&a.parentElement.removeChild(a)}}}_setWindowContent(e){const t=this,o=t.$.window,n=o._target.originalTarget,a=[].slice.call(o.getElementsByClassName("smart-editor-window-editor"));if((!o.innerHTML||a.length)&&n){switch(e.name){case"createlink":case"editlink":case"hyperlink":case"image":case"table":case"paste":t._createWindowEditors(e)}n.id&&o.setAttribute("aria-controls",n.id)}}_createWindowEditors(e){const t=this,o=t.$.window,n=e.name;let a,i=t._windowEditors,r=o.querySelector(".smart-editor-window-content-wrapper");r||(r=document.createElement("div"),r.classList.add("smart-editor-window-content-wrapper"),o.appendChild(r)),t._windowEditors||(i=t._windowEditors={}),i&&(a=i[n]),a||(a=document.createElement("div"),a.classList.add(`smart-editor-window-${n}`),a.innerHTML=t._getWindowEditorTemplate(n),i[n]=a),r.contains(a)||(r.innerHTML="",r.appendChild(a));const l=a.querySelectorAll(".smart-editor-window-editor[type]");for(let e=0;e<l.length;e++)t._setPopupWindowEditor(l[e])}_getWindowEditorTemplate(e){switch(e){case"createlink":case"editlink":case"hyperlink":return'\n                <div class="smart-editor-window-editor" type="address">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="text">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="title">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="target">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>';case"image":return'\n                <div class="smart-editor-window-editor" type="file">\n                    <smart-file-upload item-editor></smart-file-upload>\n                </div>\n                <div class="smart-editor-window-editor" type="url">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="width">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="height">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="alt">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="title">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="caption">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="display">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="alignment">\n                    <label></label>\n                    <smart-input item-editor></smart-input>\n                </div>\n                <div class="smart-editor-window-editor" type="draggable">\n                    <smart-check-box item-editor></smart-check-box>\n                </div>\n                <div class="smart-editor-window-editor" type="resizable">\n                    <smart-check-box item-editor></smart-check-box>\n                </div>';case"table":return'\n                    <div class="smart-editor-window-editor" type="cols">\n                        <label></label>\n                        <smart-number-input item-editor></smart-number-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="rows">\n                        <label></label>\n                        <smart-number-input item-editor></smart-number-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="width">\n                        <label></label>\n                        <smart-input item-editor></smart-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="height">\n                        <label></label>\n                        <smart-input item-editor></smart-input>\n                    </div>\n                    <div class="smart-editor-window-editor" type="tableheader">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="altrows">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="dashedborders">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>\n                    <div class="smart-editor-window-editor" type="resizable">\n                        <smart-check-box item-editor></smart-check-box>\n                    </div>';case"paste":return'\n                    <div class="smart-editor-window-editor" type="keepFormat">\n                        <label></label>\n                        <smart-radio-button checked group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>\n                    <div class="smart-editor-window-editor" type="cleanFormat">\n                        <smart-radio-button group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>\n                    <div class="smart-editor-window-editor" type="plainText">\n                        <smart-radio-button group-name="editorPasteViaWindow" item-editor></smart-radio-button>\n                    </div>';default:return""}}_setPopupWindowEditor(e){const t=this,o=e.getAttribute("type"),n=e.querySelector("label"),a=t.$.window._target,i=a.item,r="markdown"===t.editMode,l=i.editor;let s,d=e.querySelector("[item-editor]");if(n&&("paste"===i.name?(n.id=t.id+"pasteLabel",n.innerHTML=t.localize("pasteLabel")||""):(n.id=t.id+o+"Label",n.innerHTML=t.localize(o)||"")),!d)return;const c=t._toolbarItemClick;let m;if(c&&(m=c.target),"hyperlink"===i.name||"createlink"===i.name||"editlink"===i.name){const n=t._getSelectionRange();let a=n.startContainer;a&&"a"!==a.nodeName.toLowerCase()&&(a=a.parentElement),a&&"a"===a.nodeName.toLowerCase()?"address"===o?s=a.getAttribute("href"):"text"===o?s=a.textContent:"title"===o?s=a.title:"target"===o&&(s=a.target):s="text"===o?r?t.$.input.value.slice(n.selectionStart,n.selectionEnd):n.toString():l&&void 0!==l[o]?l[o]+"":"","target"===o&&r||c&&m&&"img"===m.nodeName.toLowerCase()&&["title","text"].indexOf(o)>-1?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden")}else if("image"===i.name){const n=t._toolbarItemClick,i=n?n.target:a.itemTarget;if(i&&"img"===i.nodeName.toLowerCase()){const e=i.closest(".smart-editor-image-container");switch(o){case"file":i.file instanceof File&&(s=i.file);break;case"url":s=i.file instanceof File?"":i.src;break;case"alt":s=i.alt;break;case"title":s=i.title;break;case"width":s=i.style.width||i.width;break;case"height":s=i.style.height||i.height;break;case"caption":if(e){const t=e.querySelector(".smart-editor-image-caption");t&&(s=t.textContent)}void 0===s&&(s="");break;case"alignment":s=(e||i).getAttribute("alignment")||"";break;case"display":s=(e||i).getAttribute("display")||"";break;case"draggable":case"resizable":{const e=i.getAttribute(o);s=null==e||"true"===e;break}}}else s=l?("draggable"===o||"resizable"===o)&&void 0===l[o]||(void 0!==l[o]?l[o]+"":""):"draggable"===o||"resizable"===o||"";r&&["file","url","alt","title"].indexOf(o)<0?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden")}else if("table"===i.name){const t=a.itemTarget&&"table"===a.itemTarget.nodeName.toLowerCase()?a.itemTarget:void 0;switch(o){case"width":case"height":s=t?t.style[o]:l&&void 0!==l[o]?l[o]:"";break;case"cols":s=t?t.querySelector("tbody > tr").children.length+"":l&&void 0!==l[o]?l[o]:"1";break;case"rows":s=t?t.querySelectorAll("tbody > tr").length+"":l&&void 0!==l[o]?l[o]:"1";break;case"tableheader":s=!!r||(t?null!==t.querySelector("thead"):!(!l||void 0===l[o])&&l[o]);break;case"altrows":s=t?t.hasAttribute("alternation"):!(!l||void 0===l[o])&&l[o];break;case"dashedborders":s=t?t.hasAttribute("dashed-borders"):!(!l||void 0===l[o])&&l[o];break;case"resizable":s=t?!("false"===t.getAttribute("resizable")):!l||void 0===l[o]||l[o]}r&&["cols","rows","tableheader"].indexOf(o)<0?e.classList.add("smart-hidden"):e.classList.remove("smart-hidden")}else"paste"===i.name&&(s=o===t.pasteFormat);t._setupEditorElement(d,o,s),t._setEditorCommonProperties(d)}_setupEditorElement(e,t,o){const n=this,a=n.$.window._target.item,i=a.editor;if((e instanceof Smart.CheckBox||e instanceof Smart.RadioButton)&&(e.innerHTML=n.localize(t)||"",e.checked=!!o),e instanceof Smart.NumberInput)e.min=1,e.value=parseInt(o);else{if(e instanceof Smart.FileUpload)return"file"===t&&e.isCompleted&&(e.cancelAll(),o&&e.addFile(o)),e.uploadUrl="",e.removeUrl="",e.autoUpload=!1,i&&(i.uploadUrl&&(e.uploadUrl=i.uploadUrl,e.autoUpload=!0),i.removeUrl&&(e.removeUrl=i.removeUrl)),e.dropZone=e.parentElement,e.accept=a.allowedTypes||"image/*",void(e.hideFooter=!0);if("string"==typeof e.placeholder&&(e.placeholder=n.localize(t+"Placeholder")||""),e.dropDownClassList&&(e.dropDownClassList=["smart-editor-input"]),void 0!==e.dataSource){if("target"===t||"alignment"===t||"display"===t){e.dataSource.length||(e.dataSource=n._getDefaultDataSource(t)),"alignment"!==t||o||(o="center");const a=o?e.dataSource.find((e=>"object"==typeof e&&e.value===o)):void 0;a&&"object"==typeof a&&(o=a.label||o),e.readonly=!a&&!o||a&&""!==a.value}else e.dataSource=[];"string"==typeof e.dropDownButtonPosition&&(e.dropDownButtonPosition=e.dataSource.length?n.rightToLeft?"left":"right":"none")}e.value=o+""}}_setEditorCommonProperties(e){const t=this;if(e){const o=e.messages,n=t.messages,a=t.locale;for(let e in o.en){const t=n[a][e];void 0!==t&&(o[a]||(o[a]={}),o[a][e]=t)}e.locale=t.locale,e.rightToLeft=t.rightToLeft,e.animation=t.animation,e.theme=t.theme}}_createWindow(){const e=this,t=e.$.window;if(t)return t;const o=document.createElement("smart-window");return o.classList.add("smart-editor-window"),o.id=e.id+"Window",o.setAttribute("smart-id","window"),e.$.window=o,e.$window=Smart.Utilities.Extend(o),o.rightToLeft=e.rightToLeft,o.theme=e.theme,o.animation=e.animation,o.disableSnap=!0,o.headerButtons=["close"],o}_createWindowTemplate(e){const t=this,o=t.animation,n=t.theme,a=t.rightToLeft;let i;return"footer"===e&&(i=document.createElement("template"),i.innerHTML=`<smart-button class="smart-editor-window-button ok primary"\n                    animation="${o}" theme="${n}" ${a?"right-to-left":""}>\n                </smart-button>\n                <smart-button class="smart-editor-window-button cancel"\n                    animation="${o}" theme="${n}" ${a?"right-to-left":""}>\n                </smart-button>`),i}_positionWindow(){const e=this,t=e.getShadowRootOrBody(),o=e.$.window;if(!o||!t.contains(o))return;const n=e.getBoundingClientRect();o.opened||(o.style.left=o.style.top=""),o.style.left=Math.max(n.left+window.pageXOffset,n.left+window.pageXOffset+n.width/2-o.offsetWidth/2)+"px",o.style.top=Math.max(n.top+window.pageYOffset,n.top+window.pageYOffset+n.height/2-o.offsetHeight/2)+"px"}_windowChangeHandler(e){const t=e.detail,o=this.$.window._target.item;let n=(e.originalEvent||e).target;const a=n.closest(".smart-editor-window-editor");if(!n.hasAttribute("item-editor")||!o||!a)return;const i=a.getAttribute("type");o.name.indexOf("link")>0&&"target"===i&&n instanceof Smart.Input&&(n.readonly=!!t.value.length)}_windowClickHandler(e){const t=this;let o=(e.originalEvent||e).target;o.shadowRoot&&(o=(e.originalEvent||e).composedPath()[0]);const n=t.$.window,a=o.closest(".smart-editor-window-button");n&&a&&n._target&&(a.classList.contains("ok")&&!1===t._updateEditorViaWindow(n._target.item)||(n.close(),delete n._target))}_windowClosingHandler(e){const t=this;if(!e.target.classList.contains("smart-editor-window"))return;const o=t.$window;if(o){if(t.$.fireEvent("dialogClosing",{target:e.target,item:e.target._target.item}).defaultPrevented)return void e.preventDefault();if(o.unlisten(e.type),t.hasAttribute("aria-owns")){const e=t.getAttribute("aria-owns").replace(o.id,"").trim();e?t.setAttribute("aria-owns",e):t.removeAttribute("aria-owns")}}}_windowCloseHandler(e){const t=this,o=e.target;if(!o.classList.contains("smart-editor-window"))return;const n=t.$window;if(n){t.$.fireEvent("dialogClose",{target:e.target,item:e.target._target.item}),n.unlisten("close"),n.unlisten("click"),n.unlisten("change"),n.unlisten("keydown"),n.unlisten("uploadCompleted"),n.unlisten("uploadError"),t.hasAttribute("aria-owns")&&t.removeAttribute("aria-owns"),t.hasAnimation||(o.remove(),t._setAriaOwns(o));const a=o._target.itemTarget;if(t._focusEditableElement(),a&&["img","th","td","table"].indexOf(a.nodeName.toLowerCase())>-1)return void t._setResizeFrame(a)}}_windowKeyDownHandler(e){const t=this,o=t.$.window;if(e.stopPropagation(),"Enter"!==e.key||!o._target)return;const n=o._target.item,a=o.getRootNode().activeElement;if(n&&a.closest(".smart-editor-window-editor")){if(!1===t._updateEditorViaWindow(n))return;e.preventDefault(),o.close(),delete o._target}}_windowOpenHandler(e){const t=this,o=e.target;if(!o.classList.contains("smart-editor-window"))return;const n=t.$window;n&&(t._setAriaOwns(o),t.$.fireEvent("dialogOpen",{target:e.target,item:o._target.item}),n.unlisten("open"))}_windowTransitionendHandler(e){const t=this,o=e.target;o.classList.contains("smart-editor-window")&&(o.opened||"visibility"!==e.propertyName||(t.$window.unlisten("transitionend"),t.$.window.remove(),t._setAriaOwns(o)))}_updateEditorViaWindow(e){const t=this;if(!e||!t._windowEditors)return;const o=t.$.iframe,n=t.$.editableElement;let a,i;t.$.contentContainer.contains(n.getRootNode().activeElement)||t._focusEditableElement(),o?(a=o.contentWindow,i=a.getSelection()):(a=window,i=window.getSelection());const r=t._windowEditors[e.name],l=t._getSelectionRange();let s;if(r&&!t.$.fireEvent("actionStart",{name:e.name}).defaultPrevented){switch(l instanceof a.Range&&(i.removeAllRanges(),i.addRange(l)),e.name){case"editlink":case"createlink":case"hyperlink":s=t._handleLinksInsert(e);break;case"image":s=t._handleImageInsert(e);break;case"table":t._handleTableInsert(t._getItemOptionsViaWindow(e));break;case"paste":t._handlePasteViaWindow(e)}return t.$.fireEvent("actionEnd",{name:e.name}),s?(s(),!1):void 0}}_focusFirstInputCallback(e,t){const o=this._windowEditors[e];if(o)return()=>{const e=o.querySelector(`.smart-editor-window-editor[type="${t}"] .smart-input[item-editor]`);e&&e.focus({preventScroll:!0})}}_fileUploadCompletedHandler(e){e.stopPropagation(),this.$.fireEvent("imageUploadSuccess",{target:e.target,item:e.target._target.item})}_fileUploadErrorHandler(e){e.stopPropagation(),this.$.fireEvent("imageUploadFailed",{target:e.target,item:e.target._target.item})}_handleImageInsert(e){const t=this,o=t._getItemOptionsViaWindow(e),n=t.$.window;if(!n)return;let a,i,r,l,s,d=n._target.itemTarget;if(o.file.length?(l=o.file[0],a=URL.createObjectURL(l)):o.url&&(a=o.url+""),!a&&o)return t._focusFirstInputCallback(e.name,"url");if("markdown"===t.editMode)return i=o.title?` "${o.title}"`:"",void t._insertMarkDown(`![${o.alt}](${a}${i})`);const c=t.$.iframe,m=t.$.editableElement,u=c?c.contentDocument:document;if(!d||"img"!==d.nodeName.toLowerCase()){const e=t.id+"newImage"+Math.random().toString(36).substr(2,5);s=u.execCommand("insertHTML",!1,`<img id="${e}"></img>`),d=m.querySelector("#"+e)}if(d&&"img"===d.nodeName.toLowerCase()){const e="inline"===o.display.toLowerCase()?"inline":"block",n=o.width+"",i=o.height+"";if(t._handleImgCaption(d,o),s&&(d.id=""),URL.revokeObjectURL(d.src),l&&(d.file=l),d.src=a,d.removeAttribute("width"),d.removeAttribute("height"),d.style.width=n?n+(n.indexOf("%")>-1?"%":"px"):"",d.style.height=i?i+(i.indexOf("%")>-1?"%":"px"):"",o.alt&&(d.alt=o.alt),o.title&&(d.title=o.title),o.alignment){const e=o.alignment.toLowerCase();r=e.indexOf("left")>-1?"left":e.indexOf("right")>-1?"right":"center"}d.setAttribute("resizable",o.resizable),d.setAttribute("draggable",o.draggable);const c=d.closest(".smart-editor-image-container");c?(c.setAttribute("alignment",r),c.setAttribute("display",e),d.removeAttribute("alignment"),d.removeAttribute("display")):(d.setAttribute("alignment",r),d.setAttribute("display",e))}}_insertMarkDown(e,t){const o=this;if("markdown"!==o.editMode)return;const n=o.$.input,a=n.value,i=o._getSelectionRange();n.value=a.slice(0,n.selectionStart)+e+a.slice(n.selectionEnd),o._refreshMarkdownPreview(),void 0!==i.selectionStart&&(void 0===t&&(t=i.selectionStart+e.length),o._setSelectionRange(n,t,t))}_handleLinksInsert(e){const t=this,o=t.$.window,n=t.editMode,a=t._getItemOptionsViaWindow(e);if(!a.address)return t._focusFirstInputCallback(e.name,"address");if("markdown"===n){let e;return e=a.title?`[${a.text}](${a.address}, "${a.title}")`:`[${a.text}](${a.address})`,void t._insertMarkDown(e)}const i=t.$.iframe,[r,l]=i?[i.contentDocument,i.contentWindow]:[document,window],s=l.getSelection();let d,c,m=s.anchorNode?s.anchorNode.parentElement:void 0,u=o&&o._target?o._target.itemTarget:void 0;u&&"img"===u.nodeName.toLowerCase()?(d=o._target.itemTarget,m=d.parentElement,m&&"a"===m.nodeName.toLowerCase()||(m=document.createElement("a"),d.parentElement.insertBefore(m,d),m.appendChild(d))):m=s.anchorNode?s.anchorNode.parentElement:void 0,a.address&&"a"!==m.nodeName.toLowerCase()&&(c=r.execCommand("createLink",!1,a.address),m=s.anchorNode.parentElement),"a"===m.nodeName.toLowerCase()&&(a.address?c||m.setAttribute("href",a.address):m.setAttribute("href",""),a.text?m.textContent=a.text:m.innerHTML||(m.textContent=a.address||""),m.title=a.title||"",m.target=a.target||"",d||s.selectAllChildren(m))}_refreshMarkdownPreview(){const e=this,t=e.$.input;if(e.$.contentContainer.hasAttribute("split-mode")){let o=t.value;e.$.editableElement.innerHTML=window.marked?window.marked(o):o}}_handleImgCaption(e,t){const o=this;if(!t)return;let n,a=e.closest(".smart-editor-image-container");if(t.caption){if(a||(a=document.createElement("span"),a.classList.add("smart-editor-image-container"),a.setAttribute("draggable",!1),a.setAttribute("contenteditable",!1),e.hasAttribute("alignment")&&a.setAttribute("alignment",e.getAttribute("alignment")),e.hasAttribute("display")&&a.setAttribute("display",e.getAttribute("display")),e.parentElement.insertBefore(a,e),a.appendChild(e)),n=a.querySelector(".smart-editor-image-caption"),n||(n=document.createElement("span"),n.setAttribute("contenteditable",!0),n.classList.add("smart-editor-image-caption"),a.appendChild(n)),n.textContent=t.caption,t.focusCaption)return delete o._toolbarItemClick,o._setSelectionRange(n),o._setResizeFrame(),void o.$.editableElement.scrollTo(n.offsetLeft,n.offsetTop)}else!t.caption&&a&&(a.hasAttribute("alignment")&&e.setAttribute("alignment",a.getAttribute("alignment")),a.hasAttribute("display")&&e.setAttribute("display",a.getAttribute("display")),a.parentElement.insertBefore(e,a),a.remove());o._resizeFrameObj&&o._resizeFrameObj.target&&o._setResizeFrame(o._resizeFrameObj.target,!0)}_handleTableInsert(e){const t=this,o=t.editMode;if(!e)return;if("markdown"===o)return void t._insertTableMarkdown(e);const n=t._getSelectionRange(),a=n.startContainer;let i,r,l,s;if(e.cells){const t=e.cells;[l,s]=[t[1],t[0]]}else[l,s]=[parseInt(e.cols),parseInt(e.rows)],i=a.closest&&a.closest(".smart-editor-editable table");if(!i){const e=t.$.editableElement,o=t.$.iframe,a=(o?o.contentWindow:window).getSelection();a.removeAllRanges(),a.addRange(n);const l=t.id+"newTable"+Math.random().toString(36).substr(2,5);r=(o?o.contentDocument:document).execCommand("insertHTML",!1,`<table id="${l}"><tbody></tbody></table>`),i=e.querySelector("#"+l)}if(i&&"table"===i.nodeName.toLowerCase()){let o,n=i.querySelector("tbody");for(n?o=Array.from(n.children):(i.innerHTML="<tbody></tbody>",n=i.firstElementChild,o=[]);o.length>s;)o.pop().remove();for(let e=o.length,t=s;e<t;e+=1)o.push(document.createElement("tr"));for(let e=0,t=o.length;e<t;e+=1){const t=o[e],a=Array.from(t.children);for(;a.length>l;)a.pop().remove();for(let e=0,o=l;e<o;e+=1){let o=a[e];o||(o=t.appendChild(document.createElement("td")))}t.parentElement||n.appendChild(t)}void 0===e.tableheader?e.tableheader=!!i.querySelector("th"):void 0===e.altrows?e.altrows=i.hasAttribute("alternation"):void 0===e.dashedborders?e.dashedborders=i.hasAttribute("dashed-borders"):void 0===e.resizable&&(e.resizable="false"!==i.getAttribute("resizable")),t._handleTableHeader(i,e.tableheader),e.altrows?i.setAttribute("alternation",""):i.removeAttribute("alternation"),e.dashedborders?i.setAttribute("dashed-borders",""):i.removeAttribute("dashed-borders");const a=e.width,d=e.height;i.style.width=a?a+(a.indexOf("%")<0?"px":""):"",i.style.height=d?d+(d.indexOf("%")<0?"px":""):"",r&&i.removeAttribute("id"),i.setAttribute("aria-rowcount",s),i.setAttribute("aria-colcount",l),i.setAttribute("resizable",e.resizable)}t._setResizeFrame(i)}_insertTableMarkdown(e){const t=this,o=e.cells,[n,a]=o?[o[1],o[0]]:[parseInt(e.cols),parseInt(e.rows)],i=t.localize("alphabet"),r=t.localize("header"),l=t.localize("column");let s="";if(!1!==e.tableheader){let e="",t=Math.max(3,r.length)+3;for(;t>0;)e+="-",t--;for(let e=1;e<=n;e+=1)s+=`| ${r} ${e} `;s+="|\n";for(let t=0;t<n;t++)s+=`|${e} `;s+="|\n"}for(let e=0;e<a;e++){const t=i[Math.max(0,e-1)%i.length].toUpperCase();for(let e=1;e<=n;e+=1)s+=`| ${l} ${t} ${e} `;s+="|\n"}t._insertMarkDown(s)}_handleTableSelection(e){const t=this,o=t.$.editableElement;if(t._tableCell&&t._tableCell.removeAttribute("selected"),"false"!==o.getAttribute("contenteditable"))return e&&["th","td"].indexOf(e.nodeName.toLowerCase())>-1?(t._tableCell=e,void e.setAttribute("selected","")):void delete t._tableCell}_getItemOptionsViaWindow(e){const t=this._windowEditors[e.name];if(!t)return;const o=t.children;let n={};for(let e=0,t=o.length;e<t;e+=1){const t=o[e].getAttribute("type"),a=o[e].querySelector("[item-editor]");let i;if(t){if(a instanceof Smart.Input)if(void 0===a.$.input.dataValue&&a.dataSource&&a.dataSource.length){const e=a.dataSource[0];i="string"==typeof e?e:e.value||e.label}else i=a.$.input.dataValue||a.value;else a instanceof Smart.CheckBox||a instanceof Smart.RadioButton?i=a.checked:a instanceof Smart.FileUpload&&(i=a.value);n[t]=i}}return n}_closeToolbarItemDropDown(e){const t=this,o=()=>{e.opened||e.remove()};e&&(e.opened?(e.hasAnimation&&(e.removeEventListener("transitionend",o),e.addEventListener("transitionend",o,{once:!0})),e.close(),t._setAriaOwns(e)):o())}_openToolbarItemDropDown(e,t){const o=this,n=e.getBoundingClientRect();o._setupDropDown(e,t),t.style.width=n.width+"px",t.style.height=n.height+"px",e.contains(t)||e.appendChild(t),t.open(),o._setAriaOwns(t),o._setAriaControls(e,t)}_setupDropDown(e,t){const o=this,n=o.$.inlineToolbar,a=n&&n.contains(e)?o._inlineToolbarItemsObj:o._toolbarItemsObj,i=a?a[e.getAttribute("item-name")]:void 0;let r;if(i&&(r=i.dataSource),r||(r=[]),t instanceof Smart.ColorInput?t.dropDownClassList=["smart-editor-color-input"]:(t.dropDownClassList=["smart-editor-input"],t.dropDownHeight=300),t.classList.add("smart-editor-item-drop-down"),t.readonly=!0,t.dataSource=r,t.dropDownOpenMode="manual",t.dropDownButtonPosition=o.rightToLeft?"left":"right",void 0!==i.value){const e=i.name;t.value=e.indexOf("table")>-1||e.indexOf("paste")>-1?"":i.value+""}else t.value=""}_toggleToolbar(e){const t=this,o=t.$.toolbar,n=t.$.contentContainer,a=t.toolbarViewMode,i="toggle"===a,r=t.$.toolbarToggleButton,l=t.hasAnimation;o.style.transition=l&&i?"none":"",o.style.height="";const s=o.offsetHeight,d=n.offsetHeight;if(e&&"toggle"===a){if(r.removeAttribute("checked"),r.setAttribute("aria-pressed",!1),!o.hasAttribute("expanded"))return void(o.style.transition="");o.removeAttribute("expanded")}else{if(r.setAttribute("checked",""),r.setAttribute("aria-pressed",!0),o.hasAttribute("expanded"))return o.style.transition="",void(t.$.toolbarItemsSecondary.innerHTML&&t._refreshToolbarItems());"scroll"!==a?o.setAttribute("expanded",""):o.removeAttribute("expanded")}if(t._refreshToolbarItems(),!i)return;const c=o.offsetHeight,m=t.$.inlineToolbar;m&&m.visible&&m.reposition(),t._resizeFrameObj&&t._setResizeFrame(t._resizeFrameObj.target),o.style.height=s+"px",n.style.height=d+"px",l&&requestAnimationFrame((()=>{o.style.transition="",o.style.height=c+"px",n.style.height=d+s-c+"px",requestAnimationFrame((()=>o.style.height=n.style.height=""))}))}_predefPropertyGetter(e="value"){const t=this;Object.defineProperty(t,e,{get:function(){return t.context===t?t.properties[e].value:t._getCurrentValue()},set(o){t.updateProperty(t,t._properties[e],o)}})}_getCurrentValue(){const e=this;if("markdown"===e.editMode)return e.$.input.value;let t=e.$.editableElement.innerHTML;return e.enableHtmlEncode&&(t=t.replaceAll("<","&lt;").replaceAll(">","&gt;")),t}_handleEditMode(e){const t=this,o=t.$.input,n=t.$.editableElement,a=t.editMode,i=t._toolbarItemsObj.sourcecode,r=!!i&&i.value;t._closePopups(),"html"===e?r?o.value=n.innerHTML:n.innerHTML=o.value:"markdown"===e&&(r?n.innerHTML=window.marked?window.marked(o.value):o.value:o.value=n.textContent),t.$.contentContainer.hasAttribute("split-mode")||("markdown"===a?r?(o.classList.add("smart-hidden"),n.classList.remove("smart-hidden")):(o.classList.remove("smart-hidden"),n.classList.add("smart-hidden")):r?(o.classList.remove("smart-hidden"),n.classList.add("smart-hidden")):(o.classList.add("smart-hidden"),n.classList.remove("smart-hidden"))),t.readonly||t.disableEditing||t.$.editableElement.setAttribute("contenteditable","markdown"!==a)}_handleInputContent(e,t){const o=this,n=o.$.editableElement,a=o.$.input,i=o.editMode;if(!o.isRendered&&o.autoLoad){const e=window.localStorage.getItem("smartEditor"+o.id);e&&o.set("value",e)}const r=o.value;void 0===t&&r&&(t=r),void 0!==t?"html"===i?o.$.editableElement.innerHTML=t:o.$.input.value=t:t||"markdown"!==i||(o.$.input.value=o.$.editableElement.textContent),o.$.contentContainer.hasAttribute("split-mode")?"markdown"===i?n.innerHTML=window.marked?window.marked(a.value):a.value:a.value=n.innerHTML.trim():o.classList.contains("preview-mode")&&("markdown"===i?n.innerHTML=window.marked?window.marked(a.value):a.value:a.value=n.innerHTML),n.textContent.length&&n.innerText.length?n.removeAttribute("show-placeholder"):n.setAttribute("show-placeholder","")}_sanitize(e,t){return this.sanitized?t.replaceAll(/(<[\/]?script[>]?)|([on].*=['"`]?.*['"`]?)|(SRC=['"`]?javascript:['"`]?)/gim,""):t}_handleInputElement(){const e=this,t=e.iframeSettings,o=e.$.contentContainer,n=e.$.container,a=e.$.editableElement,i=e.$.input,r=e.readonly,l=e.disableEditing;if(a.contentEditable=!r&&!l,i.readonly=r||l,e._handlePlaceholder(),e._closePopups(),t.enabled?e._handleIframeSettings():n.contains(o)||(n.appendChild(o),a.setAttribute("contenteditable",!0),e.$.iframe&&(e.$.iframe.remove(),e._removeIframeEventListeners(),delete e.$.iframe)),"markdown"===e.editMode){const t=e.$.editableElement;e.$.input.classList.remove("smart-hidden"),t.classList.add("smart-hidden")}}_handlePlaceholder(){const e=this.$.editableElement,t=this.placeholder;t?e.setAttribute("placeholder",t):e.removeAttribute("placeholder")}_handleIframeSettings(){const e=this;if(!e.iframeSettings.enabled)return;let t=e.$.iframe;t||(t=e.$.iframe=document.createElement("iframe")),t.parentElement||e.$.container.appendChild(t),!t.contentWindow.marked&&window.marked&&(t.contentWindow.marked=window.marked),e._handleIframeBody(),e._handleIframeAttributes(),e._handleIframeResources()}_removeIframeEventListeners(){const e=this,t=e.$.iframe.contentDocument,o=e.$iframe;o&&(o.unlisten("down"),o.unlisten("move"),o.unlisten("up")),t.removeEventListener("dragstart",e._iframeDragStartHandler),t.removeEventListener("dragend",e._iframeDragEndHandler),t.removeEventListener("selectionchange",e._iframeSelectionChangeHandler)}_handleIframeBody(){const e=this,t=e.$.iframe.contentDocument,o=t.body;if(!o)return;let n=e.$iframe;o.classList.add("smart-editor","smart-element","smart-editor-iframe-body"),o.appendChild(e.$.contentContainer),e._updateIframeBody(),n||(n=e.$iframe=Smart.Utilities.Extend(o)),e._iframeDownHandler=t=>e._documentDownHandler.call(e,t),e._iframeMoveHandler=t=>e._documentMoveHandler.call(e,t),e._iframeUpHandler=t=>e._documentUpHandler.call(e,t),e._iframeDragStartHandler=t=>e._dragStartHandler.call(e,t),e._iframeDragEndHandler=t=>e._dragEndHandler.call(e,t),e._iframeSelectionChangeHandler=t=>e._selectionChangeHandler.call(e,t),e._removeIframeEventListeners(),n.listen("down",e._iframeDownHandler),n.listen("move",e._iframeMoveHandler),n.listen("up",e._iframeUpHandler),t.addEventListener("dragstart",e._iframeDragStartHandler),t.addEventListener("dragend",e._iframeDragEndHandler),t.addEventListener("selectionchange",e._iframeSelectionChangeHandler)}_updateIframeBody(){const e=this,t=e.$.iframe;if(!t)return;const o=t.contentDocument.body;o&&(e.rightToLeft?o.setAttribute("right-to-left",""):o.removeAttribute("right-to-left"),e.theme?o.setAttribute("theme",e.theme):o.removeAttribute("theme"),o.setAttribute("animation",e.animation))}_handleIframeAttributes(){const e=this,t=e.$.iframe,o=e.iframeSettings.attributes;if(!t)return;if(t.hasAttribute("title")||t.setAttribute("title",e.localize("iframeTitle")),!o||"object"!=typeof o)return;const n=e.$.editableElement;for(let e in o){const a=o[e];"readonly"===e?n.setAttribute("contenteditable",!a):t[e]=a}}_handleIframeResources(){const e=this.iframeSettings.resources,t=this.$.iframe;if(!t||"object"!=typeof e)return;const o=document.styleSheets,n=t.contentDocument,a=n.head,i=n.body;for(let e in o){const n=o[e],a=n.ownerNode;"text/css"===n.type&&a&&["link","style"].indexOf(a.nodeName.toLocaleLowerCase())>-1&&t.contentDocument.head.appendChild(n.ownerNode.cloneNode())}for(let t in e){const o=t,n=e[t];let r;if((o+"").indexOf("style")>-1||"link"===o?(r=document.createElement("link"),r.rel="stylesheet",r.type="text/css","string"==typeof n&&(r.href=n)):"script"===o&&(r=document.createElement("script"),r.type="text/javascript","string"==typeof n&&(r.src=n)),"object"==typeof n&&"[object Object]"===n.toString())for(let e in n)r[e]=n[e];"module"===r.type?i.appendChild(r):a.appendChild(r)}}_handleMaxCharCount(){const e=this,t=e.$.input;null!==e.maxCharCount?t.maxLength=e.maxCharCount:t.removeAttribute("maxlength")}_getToolbarItems(e,t){const o=this;e||(e=o.$.toolbar),t||(t=o.toolbarItems);const n=e===o.$.toolbar?"toolbar":"inlineToolbar",a=e.querySelectorAll(".smart-editor-toolbar-item"),i=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){const r=o._getToolbarItemDetails(n,t[e]),l=r.name,s=r.type;let d=a[e];if(d?"custom"===d.getAttribute("item-type")&&(d.innerHTML=""):(d=document.createElement("div"),d.classList.add("smart-editor-toolbar-item")),"color-input"===s)d.innerHTML||(d.innerHTML=`<div class="smart-editor-item-action-button" item-name="${l}"></div>\n                                               <div class="smart-editor-item-drop-down-button"></div>`);else if("custom"===s){const e=r.template;d.innerHTML="",e&&e.closest&&!d.contains(e)?d.appendChild(e):"string"!=typeof e||d.innerHTML?"function"==typeof e&&e(d,r):d.innerHTML=e||""}else"toggle"===s&&(r.value?(d.setAttribute("checked",""),d.setAttribute("aria-pressed",!0)):(d.removeAttribute("checked"),d.setAttribute("aria-pressed",!1)),d.innerHTML&&(d.innerHTML=""));r.disabled||"paste"===l&&o._isFireFox?(d.setAttribute("disabled",""),d.setAttribute("aria-disabled",!0)):(d.removeAttribute("disabled"),d.removeAttribute("aria-disabled")),d.setAttribute("role","delimiter"===s?"separator":"button"),"color-input"===s||"drop-down"===s?d.setAttribute("aria-haspopup",!0):d.removeAttribute("aria-haspopup"),o._setItemValue(d,r),r.title?d.setAttribute("title",r.title):d.removeAttribute("title"),d.setAttribute("item-name",l),d.setAttribute("item-type",s),d.style.width=r.width||"",i.appendChild(d)}return i}_setItemValue(e,t){const o=this;let n=t.value;e&&t&&("button"===t.type?n?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)):(n||"color-input"!==t.type?["fontname","formats"].indexOf(t.name)>-1&&(n=o.localize(t.value)||t.label||t.value):n="transparent",n?(e.setAttribute("item-value",n),e.style.setProperty("--item-value",n)):(e.removeAttribute("item-value"),e.style.removeProperty("--item-value"))))}_refreshToolbarItems(e){const t=this,o=t.$.toolbar,n=t.$.toolbarItemsPrimary,a=t.$.toolbarItemsSecondary;if(n.scrollTop=n.scrollLeft=0,e)n.appendChild(e);else{const e=Array.from(a.children),t=document.createDocumentFragment(),o=e.length;for(let n=0;n<o;n+=1)t.appendChild(e[n]);o>0&&n.appendChild(t)}if("toggle"===t.toolbarViewMode){const e=n.offsetHeight;if(o.hasAttribute("expanded")){let t=[];e:for(;n.scrollHeight>e;){const e=n.lastElementChild;if(!e)break e;t.push(e),e.remove()}t.reverse();for(let e=0,o=t.length;e<o;e+=1)a.appendChild(t[e])}else n.scrollHeight===e&&t.$.toolbarToggleButton.classList.add("smart-visibility-hidden")}}_resizeHandler(e){const t=this,o=t.$.inlineToolbar;if(e.target===t){if("toggle"===t.toolbarViewMode){const e=t.$.toolbarItemsPrimary,o=t.$.toolbarItemsSecondary;t.$.toolbar.hasAttribute("expanded")&&t._refreshToolbarItems();const n=t.$.toolbarToggleButton;e.scrollHeight!==e.offsetHeight||o.children.length?n.classList.remove("smart-visibility-hidden"):n.classList.add("smart-visibility-hidden")}if(o&&o.visible){const e=o.selector;e.classList.contains("smart-editor-toolbar-item")&&e.offsetTop>=t.$.toolbar.offsetHeight?o.close():o.reposition()}t._resizeFrameObj&&t._setResizeFrame(t._resizeFrameObj.target)}}_setToolbarItemAttr(e,t,o){const n=this,a=n.$.toolbar,i=n.$.inlineToolbar,r=[n._toolbarItemsObj,n._inlineToolbarItemsObj];for(let n=0,l=r.length;n<l;n+=1){const l=r[n],s=l?l[e]:void 0;if(s){const n=l==l?a:i;if(s[t]=o,!n||!n.parentElement)continue;const r=n.querySelector(`.smart-editor-toolbar-item[item-name="${e}"]`);if(!r)continue;null==o||!1===o?(r.removeAttribute(t),"disabled"===t&&r.removeAttribute("aria-disabled")):(r.setAttribute(t,o),"disabled"===t&&r.setAttribute("aria-disabled",!0))}}}_setToolbarVisibility(){const e=this,t=e.$.toolbar,o=e.$.toolbarToggleButton;"toggle"!==e.toolbarViewMode||o.hasAttribute("checked")?t.setAttribute("expanded",""):t.removeAttribute("expanded")}_getToolbarItemDetails(e,t){const o=this;let n,a=o[`_${e}ItemsObj`];if(n="string"==typeof t?t:"object"==typeof t&&t.name?t.name+"":"",n=n.toLowerCase(),a){if(void 0!==a[n])return a[n]}else a=o[`_${e}ItemsObj`]={};const i=a[n]={};return i.title=t.title||o.localize(n),i.name=n,i.toolbarName=e,i.advanced=!!t.advanced,i.inlineToolbarItems=t.inlineToolbarItems,o._setItemType(t,i,n),o._setItemData(t,i,n),o._setItemTemplate(t,i,n),o._setItemSpecifics(t,i,n),i}_setItemType(e,t,o){let n;if(t){switch(o){case"sourcecode":case"splitmode":case"fullscreen":n="toggle";break;case"alignment":case"fontname":case"fontsize":case"formats":case"tablerows":case"tablecolumns":case"tablevalign":case"tablestyle":n="drop-down";break;case"backgroundcolor":case"fontcolor":n="color-input";break;case"bold":case"italic":case"underline":case"strikethrough":case"delete":case"redo":case"undo":case"indent":case"outdent":case"openlink":case"editlink":case"createlink":case"removelink":case"hyperlink":case"cut":case"copy":case"image":case"lowercase":case"uppercase":case"print":case"caption":case"clearformat":case"table":case"tableheader":case"orderedlist":case"unorderedlist":case"subscript":case"superscript":n="button";break;case"paste":n=t.advanced?"drop-down":"button";break;default:n="string"==typeof e?"delimiter":"custom"}t.type=n}}_setItemData(e,t,o){const n=this;let a,i;if(!t||!e)return;const r=t.type;let l=e.width;if("drop-down"===r||"color-input"===r){if("object"==typeof e&&(a=e.dataSource,void 0!==e.value&&(i=e.value+"")),a&&Array.isArray(a)||(a=n._getDefaultDataSource(o,t)),void 0===i&&("fontsize"===t.name&&(i=parseInt(window.getComputedStyle(n.$.editableElement).fontSize)),isNaN(i)&&a.length)){const e=a[0];i=e["alignment"===o?"value":"label"]||e}o.indexOf("table")>-1&&(i="")}void 0!==l&&("number"==typeof l?l+="px":(l+="",l.includes("%")||(l=parseFloat(e.width),l=isNaN(l)?"":l+"px"))),t.dataSource=a,t.value=i,t.disabled=!!e.disabled,t.width=l}_setItemSpecifics(e,t,o){if(!t||"object"!=typeof e)return;let n=e.editor,a=t.editor;if(a||(a=t.editor={}),!n)return;let i=[],r=[];switch(o){case"createlink":case"removelink":case"hyperlink":i=["address","text","target"];break;case"image":i=["allowedTypes","uploadUrl","removeUrl","path","display"],r=["draggable","resizable"];break;case"table":i=["cols","rows","tableheader"],r=["altrows","dashedborders","resizable"]}for(let e in n){let t=n[e];void 0!==t&&(i.indexOf(e)>-1?"display"===e?t="block"===t?"block":"inline":t+="":r.indexOf(e)>-1?t=!!t:"width"!==e&&"height"!==e||"string"==typeof t||(t+="px"),a[e]=t)}}_getDefaultDataSource(e,t){const o=this;let n=[];switch(e){case"alignment":n=[{label:o.localize("alignLeft"),value:"left",icon:"editor-icon"},{label:o.localize("alignCenter"),value:"center",icon:"editor-icon"},{label:o.localize("alignRight"),value:"right",icon:"editor-icon"}],t&&"toolbar"===t.toolbarName&&n.push({label:o.localize("alignJustify"),value:"justify",icon:"editor-icon"});break;case"display":n=[{label:o.localize("displayInline"),value:"inline"},{label:o.localize("displayBlock"),value:"block"}];break;case"fontname":["segoeUi","arial","georgia","impact","tahoma","timesNewRoman","verdana"].forEach((e=>{n.push({label:o.localize(e),value:e})}));break;case"fontsize":["8","10","12","14","18","24","36"].forEach((e=>{n.push({label:e,value:e})}));break;case"formats":["p","pre","blockquote","h1","h2","h3","h4"].forEach((e=>{n.push({label:o.localize(e),value:e})}));break;case"backgroundcolor":case"fontcolor":["#000000","#FFFFFF","#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161",""].forEach((e=>{n.push({label:e,value:e})}));break;case"paste":n=[{label:o.localize("plainText"),value:"plainText"},{label:o.localize("keepFormat"),value:"keepFormat"},{label:o.localize("cleanFormat"),value:"cleanFormat"}];break;case"target":n=[{label:o.localize("linkBlankDescr"),value:"_blank"},{label:o.localize("linkSelfDescr"),value:"_self"},{label:o.localize("linkParentDescr"),value:"_parent"},{label:o.localize("linkTopDescr"),value:"_top"},{label:o.localize("linkCustomDescr"),value:""}];break;case"tablerows":n=[{label:o.localize("insertRowBefore"),value:"insertRowBefore",icon:"editor-icon"},{label:o.localize("insertRowAfter"),value:"insertRowAfter",icon:"editor-icon"},{label:o.localize("deleteRow"),value:"deleteRow",icon:"editor-icon"}];break;case"tablecolumns":n=[{label:o.localize("insertColumnLeft"),value:"insertColumnLeft",icon:"editor-icon"},{label:o.localize("insertColumnRight"),value:"insertColumnRight",icon:"editor-icon"},{label:o.localize("deleteColumn"),value:"deleteColumn",icon:"editor-icon"}];break;case"tablevalign":n=[{label:o.localize("alignTop"),value:"top"},{label:o.localize("alignMiddle"),value:"middle"},{label:o.localize("alignBottom"),value:"bottom"}];break;case"tablestyle":n=[{label:o.localize("dashedborders"),value:"dashedborders"},{label:o.localize("altrows"),value:"altrows"}]}return n}_setItemTemplate(e,t){let o=e.template;t&&(o?(o&&o.closest?o="content"in o?document.importNode(o.content,!0):o:"function"==typeof o?o=o.bind(this):"string"==typeof o&&(o=document.getElementById(o)||o),t.template=o):delete t.template)}_setAriaSettings(){const e=this,t=e.$.input,o=e.$.editableElement;e.setAttribute("role","application"),e.setAttribute("aria-roledescription",e.localize("roleDescription")),e.$.toolbarToggleButton.setAttribute("aria-label",e.localize("toolbarButtonAriaLabel")),e.$.toolbarItemsPrimary.setAttribute("aria-label",e.localize("primaryToolbarAriaLabel")),e.$.toolbarItemsSecondary.setAttribute("aria-label",e.localize("secondaryToolbarAriaLabel")),t.setAttribute("aria-label",e.localize("inputAreaLabel")),t.id=e.id+"TextArea",o.id=e.id+"EditableElement",o.setAttribute("aria-label",e.localize("inputAriaLabel"))}_setAriaControls(e,t){const o=this;e&&e.nodeName&&(t.id||(t.id=o.id+"Popup"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),e.setAttribute("aria-controls",t.id))}_setAriaOwns(e){const t=this;if(!e)return;const o=e.id;let n=(t.getAttribute("aria-owns")||"").split(" ").filter((e=>e.length));const a=n.indexOf(o);if(a>-1){if(e.parentElement&&(e.opened||e.visible))return;n.splice(a,1)}else n.push(o);n.length?t.setAttribute("aria-owns",n.join(" ")):t.removeAttribute("aria-owns")}_setFocusable(){const e=this,t=e.$.editableElement;if(e.disabled||e.unfocusable)return void(t&&t.removeAttribute("tabindex"));const o=e.tabIndex>0?e.tabIndex:0;t&&(t.tabIndex=o)}_selectStartHandler(e){const t=this._resizeFrameObj,o=this._inlineToolbarClickObj;(t&&t.resizeDetails||o&&o.resizeDetails)&&e.preventDefault()}_selectionChangeHandler(e){const t=this,o=e.target.getSelection();if(t.$.contentContainer.contains(o.focusNode)){if(t._ignoreSelectionChange)return;t._selectionChangeFired=!0,t._setSelectionRange(),t._updateToolbarItems(),delete t._selectionChangeFired}}}),Smart("smart-table-picker",class extends Smart.BaseElement{static get properties(){return{columns:{value:10,type:"number"},messages:{extend:!0,value:{en:{buttonLabel:"Insert Table"}}},rows:{value:3,type:"number"},value:{value:[1,1],type:"array"}}}static get listeners(){return{"tableGrid.mouseover":"_cellOver","tableGrid.mouseleave":"_cellLeave","tableGrid.click":"_cellOver"}}template(){return'<div id="container" role="presentation">\n                    <div id="tableGrid" class="smart-table-picker-grid" role="presentation"></div>\n                    <div class="smart-table-picker-separator" role="separator"></div>\n                    <smart-button id="tableButton" class="smart-table-picker-button" right-to-left="[[rightToLeft]]"></smart-button>\n                </div>'}propertyChangedHandler(e,t,o){const n=this;switch(e){case"value":n._selectCell(o,t,!0);break;case"rows":case"columns":n._createTableGrid();break;case"messages":n._setTableButton();break;default:super.propertyChangedHandler(e,t,o)}}render(){const e=this;e._isMobile=Smart.Utilities.Core.isMobile,e._createTableGrid(),e._setTableButton(),e._setAria(),super.render()}_setAria(){this.setAttribute("role","grid")}_createTableGrid(){const e=this,t=e.$.tableGrid,o=e.columns,n=e.rows,a=t.children,i=document.createDocumentFragment();let r=a.length;for(;r>n;){const e=a[0];if(!e)break;e.remove(),r--}for(let e=r,t=n;e<t;e+=1){const e=document.createElement("div");e.setAttribute("role","row"),i.appendChild(e)}i.children.length&&t.appendChild(i);for(let e=0,t=n;e<t;e+=1){const t=a[e],n=t.children;let i=n.length;for(;i>o&&n[0];)n[0].remove(),i--;for(let e=i,n=o;e<n;e+=1){const e=document.createElement("span");e.setAttribute("role","gridcell"),e.classList.add("smart-table-picker-cell"),t.appendChild(e)}}e._selectCell(e.value)}_cellOver(e){const t=this,o=e.target;let n=[];if(!t.$.tableGrid.contains(o))return void t._selectCell(t.value);const a=o.closest(".smart-table-picker-cell");if(a){const o=a.parentElement,i=Array.from(o.children);n[0]=Math.max(0,Array.from(t.$.tableGrid.children).indexOf(o)+1),n[1]=Math.max(0,i.indexOf(a)+1),t._selectCell(n,t.value,"click"===e.type)}}_cellLeave(){this._selectCell(this.value)}_selectCell(e,t,o){const n=this,a=n.$.tableGrid,i=Array.from(a.children),r=i.length;let l=0,s=0;e&&(l=e[0]||0,s=e[1]||0);for(let e=0,t=r;e<t;e+=1){const t=i[e].children;if(l<e+1)for(let e=0,o=t.length;e<o;e+=1)t[e].removeAttribute("selected");else for(let e=0,o=t.length;e<o;e+=1)s>=e+1?t[e].setAttribute("selected",""):t[e].removeAttribute("selected")}a.setAttribute("value",l+"x"+s),o&&(void 0===t&&(t=n.value),n.set("value",[l,s]),t[0]===l&&t[1]===s||n.$.fireEvent("change",{value:e,oldValue:t}))}_setTableButton(){this.$.tableButton.innerHTML=this.localize("buttonLabel")}});