
/* Smart UI v9.4.1 (2021-07-03) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-scheduler",class extends Smart.ScrollViewer{static get properties(){return{autoScrollStep:{value:30,type:"number"},colorScheme:{value:["#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161",""],type:"array"},currentTimeIndicator:{value:!1,type:"boolean"},currentTimeIndicatorInterval:{value:1,validator:"_currentTimeIndicatorIntervalValidator",type:"number"},contextMenuDataSource:{value:null,type:"any",reflectToAttribute:!1},contextMenuClipboardActions:{value:!1,type:"boolean"},eventTemplate:{value:null,type:"any",reflectToAttribute:!1},eventCollectorTemplate:{value:null,type:"any"},eventRenderMode:{allowedValues:["classic","modern"],value:"modern",type:"string"},eventTooltipTemplate:{value:null,type:"any"},cellTemplate:{value:null,type:"any",reflectToAttribute:!1},dateCurrent:{value:new Date,type:"any",validator:"_dateValidator"},dataExport:{value:{header:{value:!0,type:"boolean"},columns:{value:[],type:"array"},style:{value:null,type:"object"},fileName:{value:"smartScheduler",type:"string?"},pageOrientation:{value:"portrait",type:"string"}},type:"object"},dataSource:{value:[],type:"any",reflectToAttribute:!1},dateSelectorFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},dayFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},disableAutoScroll:{value:!1,type:"boolean"},disableDrag:{value:!1,type:"boolean"},disableDrop:{value:!1,type:"boolean"},disableResize:{value:!1,type:"boolean"},disableSelection:{value:!1,type:"boolean"},disableWindowEditor:{value:!1,type:"boolean"},disableContextMenu:{value:!1,type:"boolean"},disableEventMenu:{value:!1,type:"boolean"},disableViewMenu:{value:!1,type:"boolean"},disableDateMenu:{value:!1,type:"boolean"},dragFeedbackFormatFunction:{value:null,type:"function?",reflectToAttribute:!1},dragOffset:{value:[10,10],type:"array"},filterable:{value:!1,type:"boolean"},filter:{value:null,type:"any"},filterMode:{value:"equals",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},firstDayOfWeek:{value:0,type:"number",defaultValue:0,validator:"_firstDayOfWeekValidator"},footerTemplate:{value:null,type:"any",reflectToAttribute:!1},groupByDate:{value:!1,type:"boolean"},groupOrientation:{allowedValues:["horizontal","vertical"],value:"horizontal",type:"string"},groupTemplate:{value:null,type:"any",reflectToAttribute:!1},groups:{value:[],type:"array"},hourEnd:{value:23,type:"number",validator:"_hourValidator"},hourStart:{value:0,type:"number",validator:"_hourValidator"},hourFormat:{value:"numeric",allowedValues:["numeric","2-digit"],type:"string"},headerTemplate:{value:null,type:"any",reflectToAttribute:!1},headerDatePosition:{value:"near",allowedValues:["near","far"],type:"string"},headerNavigationStyle:{value:"flat",allowedValues:["flat","raised"],type:"string"},headerViewPosition:{value:"far",allowedValues:["near","far"],type:"string"},hideAllDay:{value:!1,type:"boolean"},hideNonworkingWeekdays:{value:!1,type:"boolean"},hideTodayButton:{value:!1,type:"boolean"},hideViewMenuCheckableItems:{value:!1,type:"boolean"},hideWeekend:{value:!1,type:"boolean"},legendLocation:{allowedValues:["header","footer"],value:"footer",type:"string"},legendPosition:{allowedValues:["near","far"],value:"near",type:"string"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},maxEventsPerCell:{value:null,type:"number?"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},messages:{extend:!0,value:{en:{invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",invalidTimeZone:"{{elementType}}: Invalid timeZone value. TimeZone should be the id of an allowed timeZone value.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",noId:"smartScheduler requires an id in order to save/load/clear a state.",agenda:"Agenda",agendaPlaceholder:"No events to display",day:"Day",week:"Week",month:"Month",allDay:"All Day",timelineDay:"Timeline Day",timelineWeek:"Timeline Week",timelineMonth:"Timeline Month",newEvent:"New Event",ok:"Ok",cancel:"Cancel",delete:"Delete",label:"Label",dateStart:"Start Date",dateEnd:"End Date",repeat:"Repeat",description:"Description",repeatFreq:"Repeat",repeatInterval:"Repeat Every",repeatOn:"Repeat On",repeatEnd:"End Repeat",repeatEndOption:"Never",repeatEndOnOption:"On",repeatEndAfterOption:"After",repeatEndAfter:"occurrence(s)",hidden:"Hidden",hourly:"Hourly",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",repeatConfirm:"Do you want to edit only the current event or the whole series ?",repeatConfirmLabel:"Edit Repeating Event",create:"Create new",edit:"Edit",cut:"Cut",copy:"Copy",paste:"Paste",editEvent:"Edit event",editSeries:"Edit series",eventException:"Event Exception",collector:"more",repeatEveryHour:"hours",repeatEveryDay:"days",repeatEveryWeek:"weeks",repeatEveryMonth:"months",repeatEveryYear:"years",backgroundColor:"Background Color",status:"Status",resources:"Resources",selectPlaceholder:"Select...",none:"None",free:"Free",busy:"Busy",tentative:"Tentative",outOfOffice:"Out of Office",exceptions:"Exceptions",resetExceptions:"Reset Exceptions",notifications:"Notification(s)",notificationMessage:"is starting on",today:"Today",agendaShortcut:"A",dayShortcut:"D",weekShortcut:"W",monthShortcut:"M",timelineDayShortcut:"T+D",timelineWeekShortcut:"T+W",timelineMonthShortcut:"T+M",showWeekends:"Show weekends",beforeAt:"before at",days:"days",weeks:"weeks",placeholder:"Add notification",now:"Now",dateTabLabel:"DATE",timeTabLabel:"TIME",hours:"Hours",minutes:"Minutes",am:"am",pm:"pm",loadingIndicatorPlaceholder:"Loading...",duplicate:"Copy"}},type:"object"},minuteFormat:{value:"2-digit",allowedValues:["numeric","2-digit"],type:"string"},monthFormat:{value:"long",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},nonworkingDays:{value:[],type:"array",validator:"_nonworkingDayValidator"},nonworkingHours:{value:[],type:"array",validator:"_nonworkingTimeValidator"},notificationInterval:{value:60,validator:"_currentTimeIndicatorIntervalValidator",type:"number"},resizeHandlesVisibility:{allowedValues:["auto","hidden","visible"],value:"auto",type:"string"},resizeInterval:{value:0,type:"number"},resources:{value:[],type:"any",reflectToAttribute:!1},restrictedDates:{value:[],type:"array",validator:"_datesValidator"},restrictedHours:{value:[],type:"array",validator:"_nonworkingTimeValidator"},scrollButtonsPosition:{value:"near",allowedValues:["near","far","both"],type:"string"},shadeUntilCurrentTime:{value:!1,type:"boolean"},showLegend:{value:!1,type:"boolean"},spinButtonsDelay:{value:80,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},statuses:{value:[{label:"None",value:void 0},{label:"Free",value:"free"},{label:"Tentative",value:"tentative"},{label:"Busy",value:"busy"},{label:"Out of Office",value:"outOfOffice"}],type:"array"},timelineHeaderFormatFunction:{value:null,type:"function?",reflectToAttribute:!1},timelineDayScale:{value:"hour",allowedValues:["hour","halfHour","quarterHour","tenMinutes","fiveMinutes"],type:"string"},timeRulerTicks:{value:!1,type:"boolean"},timeZone:{value:"local",type:"string",validator:"_timeZoneValidator"},timeZones:{value:[],type:"array",validator:"_timeZonesValidator"},tooltipDelay:{value:0,type:"number"},tooltipOffset:{value:[],type:"array"},undoRedoSteps:{value:100,type:"number"},view:{value:"day",type:"string",validator:"_viewValidator"},viewType:{allowedValues:["agenda","day","week","month","timelineDay","timelineWeek","timelineMonth"],defaultReflectToAttribute:!0,value:"day",type:"string",validator:"_viewTypeValidator"},views:{value:["day","week","month"],type:"array",validator:"_viewsValidator"},viewSelectorType:{allowedValues:["auto","tabs","menu"],value:"menu",type:"string"},weekdayFormat:{value:"short",allowedValues:["long","short","narrow"],type:"string"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},windowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"}}}template(){return'<div id="container" role="presentation">\n                    <div id="header" class="smart-scheduler-header" role="heading" aria-level="1">\n                        <div id="dateSelectorContainer" class="smart-scheduler-date-nav" role="presentation">\n                            <smart-button today id="todayDate" right-to-left="[[rightToLeft]]" class="smart-scheduler-nav"></smart-button>\n                            <smart-repeat-button prev id="previousDate" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]"\n                             aria-label="Previous date" class="smart-scheduler-nav"></smart-repeat-button>\n                             <smart-repeat-button next id="nextDate" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]"\n                              aria-label="Next date" class="smart-scheduler-nav"></smart-repeat-button>\n                            <smart-button current id="currentDate" right-to-left="[[rightToLeft]]" class="smart-scheduler-nav"></smart-button>\n                        </div>\n                        <div id="viewSelectorContainer" class="smart-scheduler-view-nav" role="presentation">\n                            <div id="viewItemsContainer" class="smart-scheduler-items-container" role="listbox" aria-label="View Items"></div>\n                            <smart-button id="viewItemsButton" class="smart-scheduler-view-items-button smart-visibility-hidden"\n                            aria-label="View Selector DropDown" right-to-left="[[rightToLeft]]"></smart-button>\n                        </div>\n                    </div>\n                    <div class="smart-scheduler-view-container" id="viewContent" role="presentation">\n                        <div id="timeline" class="smart-scheduler-view">\n                                <div id="timelineHeaderHorizontal" class="smart-scheduler-view-header-horizontal" role="rowgroup">\n                                    <div class="smart-scheduler-view-time-container" id="timelineViewCellsContainer" role="row">\n                                        <div class="smart-scheduler-view-label-container" id="timelineViewCellsLabelContainer" role="presentation"></div>\n                                        <div class="smart-scheduler-view-header-horizontal-content" id="timelineHeaderHorizontalContent" role="presentation">\n                                            <div class="smart-scheduler-view-details" role="row"></div>\n                                            <div class="smart-scheduler-view-time" role="row">\n                                                <div class="smart-scheduler-cells" role="presentation"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="smart-scheduler-view-all-day" id="timelineViewAllDay" role="row">\n                                        <div class="smart-scheduler-view-all-day-label-container" id="timelineAllDayLabelContainer" role="presentation">\n                                            <div class="smart-scheduler-view-all-day-label" id="timelineViewAllDaylabel" role="presentation"></div>\n                                            <div class="smart-scheduler-time-zone-container" id="timelineTimeZoneLabelContainer"></div>\n                                        </div>\n                                        <div class="smart-scheduler-view-all-day-content" id="timelineViewAllDayContent" role="presentation">\n                                            <div class="smart-scheduler-cells-container" id="timelineViewAllDayCellsContainer" role="row"></div>\n                                            <div class="smart-scheduler-events-container" id="allDayEventsContainer" role="menu"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div id="timelineHeaderVertical" class="smart-scheduler-view-header-vertical" role="rowgroup">\n                                    <div class="smart-scheduler-view-header-vertical-content" id="timelineHeaderVerticalContent" role="presentation">\n                                        <div class="smart-scheduler-view-time" role="row">\n                                            <div class="smart-scheduler-cells" role="presentation"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div id="timelineContainer" class="smart-scheduler-scrollable-container" role="rowgroup">\n                                    <div id="timelineContent" class="smart-scheduler-content" role="presentation">\n                                        <div id="timelineCellsContainer" class="smart-scheduler-cells-container" role="presentation"></div>\n                                        <div id="timelineEventsContainer" class="smart-scheduler-events-container" role="menu"></div>\n                                        <div id="timelineIndicatorsContainer" class="smart-scheduler-indicators-container" role="presentation"></div>\n                                    </div>\n                                </div>\n                        </div>\n                        <smart-scroll-bar wait id="verticalScrollBar" class="smart-scheduler-view-scroll-bar" orientation="vertical"\n                        right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]"></smart-scroll-bar>\n                        <smart-scroll-bar wait id="horizontalScrollBar" class="smart-scheduler-view-scroll-bar"\n                        right-to-left="[[rightToLeft]]" aria-controls="[[id]]" animation="[[animation]]"></smart-scroll-bar>\n                    </div>\n                    <div id="footer" class="smart-scheduler-footer"></div>\n                    <smart-tooltip id="tooltip" class="smart-scheduler-tooltip" role="presentation" position="auto" arrow open-mode="manual"\n                        right-to-left="[[rightToLeft]]"  delay="[[tooltipDelay]]" offset="[[tooltipOffset]]"></smart-tooltip>\n                </div>'}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.click":"_containerClickHandler","container.contextmenu":"_containerContextMenuHandler","container.wheel":"_mouseWheelHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler",move:"_moveHandler",resize:"_resizeEventHandler","tooltip.open":"_tooltipVisibilityHandler","tooltip.opening":"_tooltipVisibilityHandler","tooltip.closing":"_tooltipVisibilityHandler","tooltip.close":"_tooltipVisibilityHandler","tooltip.change":"_tooltipChangeHandler","tooltip.click":"_tooltipClickHandler","tooltip.keydown":"_tooltipKeyDownHandler","tooltip.keyup":"_tooltipKeyUpHandler","tooltip.down":"_tooltipDownHandler","tooltip.contextmenu":"_tooltipContextMenuHandler","timeline.focus":"_timelineFocusHandler","timeline.focusin":"_timelineFocusHandler","timeline.focusout":"_timelineFocusHandler"}}static get styleUrls(){return["smart.scheduler.css"]}static get requires(){return{"Smart.Window":"smart.window.js","Smart.Calendar":"smart.calendar.js","Smart.Tooltip":"smart.tooltip.js"}}propertyChangedHandler(e,t,n){super.propertyChangedHandler(e,t,n);const i=this;switch(e){case"contextMenuClipboardActions":{const e=i.$.tooltip;e.visible&&e.contains(i._contextList)&&i._getContextMenu(e.selector);break}case"dataSource":i._handleDataAdapter(),i._createEvents(),i._createTimeline(),i.closeWindow();break;case"disabled":i._setFocusable(),i._refreshEvents();break;case"disableSelection":i._handleCellSelection();break;case"disableContextMenu":case"disableDateMenu":case"disableEventMenu":case"disableViewMenu":i.$.tooltip.close();break;case"disableWindowEditor":i.closeWindow();break;case"currentTimeIndicator":case"shadeUntilCurrentTime":i._setCurrentTimeIndicators();break;case"eventRenderMode":i._refreshEvents();break;case"filter":case"filterable":case"filterMode":if("filter"===e){const e=i._legend;e&&i.$.container.contains(e)&&e.querySelectorAll(".smart-scheduler-legend-res-item").forEach((e=>{e.removeAttribute("unselected"),e.setAttribute("aria-selected",!0)})),delete i._eventsBetween,i._createTimeline()}else i._refreshTimelineEvents();break;case"firstDayOfWeek":case"max":case"min":i._calendar&&(i._calendar[e]=n),i._createTimeline(),i._refreshDateNavButtons();break;case"maxEventsPerCell":i._refreshEvents();break;case"hideAllDay":["day","week"].indexOf(i.viewType)>-1&&i._createTimeline();break;case"hideWeekend":case"hideNonworkingWeekdays":i._checkHideWekendItem(),i.viewType.toLowerCase().indexOf("day")<0&&i._createTimeline();break;case"hideViewMenuCheckableItems":i._refreshViewSelector();break;case"timeZone":i._events.forEach((e=>i._setEventTimeZone(e,t))),i._createTimeline();break;case"timeZones":i._createTimeline();break;case"dateCurrent":case"groups":case"groupOrientation":case"hourStart":case"hourEnd":case"nonworkingDays":case"nonworkingHours":case"timelineDayScale":case"resources":case"rightToLeft":{const t=i.$.schedulerWindow,r=i.$.confirmSchedulerWindow;if([i.$.toast,i.$.tooltip,i._calendar,i._list,t,r].forEach((t=>t?t[e]=n:void 0)),t&&t.opened){const i=t.querySelectorAll(".smart-element[event-editor]"),r=n?"left":"right";for(let t=0;t<i.length;t++){const l=i[t];l[e]=n,l.calendarButtonPosition?l.calendarButtonPosition=r:"none"!==l.dropDownButtonPosition&&(l.dropDownButtonPosition=r)}}"resources"===e&&i._setLegend(),i._createTimeline(),i._refreshDateSelector();break}case"undoRedoSteps":delete i._undoRedoHistory;break;case"view":i._handleViewSelection(),i._createTimeline(),i._refreshDateSelector(),i._scrollToView(),i.$.fireEvent("viewChange",{oldValue:t,value:n});break;case"views":i._refreshViewSelector();break;case"viewSelectorType":i._setHeader();break;case"headerTemplate":i._setHeader(),i._createTimeline();break;case"footerTemplate":i._setFooter(),i._createTimeline();break;case"cellTemplate":case"groupTemplate":i._templates&&delete i._templates[e],i._createTimeline();break;case"unfocusable":i._setFocusable(),i._refreshEvents();break;case"hourFormat":case"minuteFormat":case"dayFormat":case"monthFormat":case"weekdayFormat":case"yearFormat":case"dateSelectorFormatFunction":case"timelineHeaderFormatFunction":case"messages":case"locale":{i._createTimeline(),i._setHeader(),i._calendar&&"locale"===e&&(i._calendar[e]=n);const t=i.$.schedulerWindow,r=i.$.confirmSchedulerWindow;if(t&&t.opened){const e=t._target;t.close(),i._openWindow(e.event,e.originalTarget)}else if(r&&r.opened){const e=r._target;r.close(),i._openWindow(e.event,e.originalTarget)}break}case"legendLocation":case"showLegend":i._setLegend(),i._createTimeline();break;case"restrictedDates":case"restrictedHours":delete i._eventsBetween,i._createTimeline();break;case"windowCustomizationFunction":{const e=i.$.schedulerWindow||i.$.confirmSchedulerWindow;if(!e)return;if(null===n)e.clear();else if(e.opened){const t=e===i.$.confirmSchedulerWindow?"confirm":"";i.windowCustomizationFunction(e,t,i._cloneObject(e._target))}break}}}attached(){const e=this;super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.timeline,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=[e.$.schedulerWindow,e.$.confirmSchedulerWindow],n=e.$.tooltip;n.visible&&e.getShadowRootOrBody().appendChild(n);for(let n=0;n<t.length;n++){const i=t[n];if(i&&i.opened){const t=e.$schedulerWindow;e._handleModal(!0),t.listen("open",e._windowOpenHandler.bind(e)),t.listen("close",e._windowCloseHandler.bind(e)),t.listen("closing",e._windowClosingHandler.bind(e)),t.listen("click",e._windowClickHandler.bind(e)),t.listen("change",e._windowChangeHandler.bind(e)),t.listen("keydown",e._windowKeyDownHandler.bind(e)),i.hasAnimation&&i.listen("transitionend",e._windowTransitionendHandler.bind(e)),e.getShadowRootOrBody().appendChild(i)}}e.$.container.contains(e.$.toast)||e._checkNotifications(!0)}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),e._scrollView.disableSwipeScroll=!1,delete e._scrollView),e._touchmoveInside=!1,delete e._dragDetails,Smart.Scheduler.schedulerStart===e&&(Smart.Scheduler.feedback.remove(),delete Smart.Scheduler.schedulerStart,delete Smart.Scheduler.hoveredCell,delete Smart.Scheduler.hoveredScheduler,delete Smart.Scheduler.feedback);const t=[e.$.schedulerWindow,e.$.confirmSchedulerWindow],n=e.$.tooltip;e.$.container.contains(n)||e.$.container.appendChild(n),e._removeToast();for(let n=0;n<t.length;n++){const i=t[n];if(e._handleModal(),i){i.remove();const t=i===e.$.schedulerWindow?e.$schedulerWindow:e.$confirmSchedulerWindow;t.unlisten("open"),t.unlisten("close"),t.unlisten("closing"),t.unlisten("click"),t.unlisten("change"),t.unlisten("keydown"),t.unlisten("transitionend")}}}ready(){this._customScrollView=!0,super.ready()}render(){const e=this;e._isViewUpdated=!0,e._setViewType(e.view),delete e._isViewUpdated,e.hasAttribute("role")||e.setAttribute("role","grid"),window.rrule&&window.rrule.RRule||e.error(e.localize("missingReference",{elementType:e.nodeName.toLowerCase(),files:"rrule.min.js"})),e._rRule=window.rrule.RRule,Smart.Utilities.Core.isMobile&&(e._isMobile=!0,e.$.timeline.setAttribute("mobile","")),e._handleDataAdapter(),e._setFocusable(),e._setScrollBars(),e._setHeader(),e._setFooter(),e._createEvents(),e._createTimeline(),e.checkLicense(),super.render()}get events(){const e=this,t=e._events;return e.isReady&&t&&t.length?t.map((t=>e._cloneObject(t))):[]}clearState(){const e=this;e.id?window.localStorage.removeItem("smartScheduler"+e.id):e.warn(e.localize("noId"))}getState(){const e=this,t=e._events||[];return{dateCurrent:e.dateCurrent.toISOString(),dataSource:JSON.parse(JSON.stringify(t.map((t=>e._cloneObject(t,!0))))),timeZone:e.timeZone}}loadState(e){const t=this;if(!e){if(!t.id)return;e=JSON.parse(window.localStorage.getItem("smartScheduler"+t.id))}if(!e)return;let n=JSON.parse(JSON.stringify(e.dataSource)),i=new Date(e.dateCurrent),r=e.timeZone;i instanceof Date&&!isNaN(i.getTime())&&(t.set("dateCurrent",i),t._refreshDateSelector()),Array.isArray(n)&&(t.set("dataSource",n),t._createEvents(void 0,r),t._createTimeline())}saveState(e){const t=this;t.id?(e||(e=t.getState()),window.localStorage.setItem("smartScheduler"+t.id,JSON.stringify(e))):t.warn(t.localize("noId"))}containsEvent(e){return!!this._containsEvent(e)}insertEvent(e,t){const n=this,i=n._events;if(i.indexOf(e)>-1||n._containsEvent(e))return;const r=n._createEvents(Array.isArray(e)?e:[e])[0];if(!r)return;if("number"==typeof t?i.splice(Math.max(0,Math.min(i.length,t)),0,r):i.push(r),n._isUpdating)return;n._refreshTimelineEvents(),n._updateUndoRedo(void 0,n._cloneObject(r),"itemInsert");const l=n._cloneObject(r);n.$.fireEvent("itemInsert",{item:l}),n.$.fireEvent("itemChange",{type:"insert",item:l})}updateEvent(e,t){const n=this,i=n._events;if(!(e="number"==typeof e&&i?i[e]:n._containsEvent(e)))return;for(let n in t)e[n]=t[n];if(e.dateStart=n._dateValidator(void 0,e.dateStart),e.dateEnd=n._dateValidator(void 0,e.dateEnd),e.dateEnd=new Date(Math.max(e.dateStart.getTime(),e.dateEnd.getTime())),n._isUpdating)return;n._refreshTimelineEvents();const r=n._cloneObject(e);n.$.fireEvent("itemUpdate",{item:r}),n.$.fireEvent("itemChange",{type:"update",item:r})}removeEvent(e){const t=this,n=t._events;if(!(e="number"==typeof e&&n?n[e]:t._containsEvent(e)))return;if(n.splice(n.indexOf(e),1),t._isUpdating)return;t._refreshTimelineEvents(),t._updateUndoRedo(t._cloneObject(e),void 0,"itemRemove");const i=t._cloneObject(e);t.$.fireEvent("itemRemove",{item:i}),t.$.fireEvent("itemChange",{type:"remove",item:i})}exportData(e,t){const n=this;if(!Smart.Utilities.DataExporter)return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",files:"smart.export.js"}));try{new JSZip}catch(e){return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",files:"jszip.min.js"}))}if("pdf"===e&&!window.pdfMake)return void n.error(n.localize("missingReference",{elementType:n.nodeName.toLowerCase(),methodName:"exportData",files:"pdfMake.min.js"}));const i=n._events;if(!i||!i.length)return;if("ical"===(e+"").toLowerCase())return n._exportToICal(t);const r=new Smart.Utilities.DataExporter({exportHeader:n.dataExport.header,pageOrientation:n.dataExport.pageOrientation,style:n.dataExport.style}),l=n._getExportRecord();let a={columns:[]};for(let e in l)a.columns.push({label:l[e],dataField:e});r.header=a,n._setExportStyles(r,e);let o=[];for(let e=0;e<i.length;e++)o.push(n._getExportRecord(i[e]));return r.exportData(o,e,n.dataExport.fileName,t)}print(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const n=e.exportData("html"),i=window.open("","","width=800,height=500"),r=i.document.open(),l='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>'+t+"</title></head><body>"+n+"</body></html>";try{r.write(l),r.close(),setTimeout((function(){i.print(),i.close()}),100)}catch(e){}e.dataExport.fileName=t}refresh(e){const t=this;e?t.isRendered&&t._createTimeline():t._refresh()}beginUpdate(){const e=this;e._isUpdating||(e._isUpdating=!0,e.$.fireEvent("beginUpdate"))}endUpdate(){const e=this;e._isUpdating&&(e._refreshTimelineEvents(),e.$.fireEvent("endUpdate"))}scrollToDate(e,t){const n=this;if(e instanceof Date)e=new Date(e);else{if(e instanceof HTMLElement&&(!e.classList.contains("smart-scheduler-cell")||!n.$.timeline.contains(e)))return;if("object"==typeof e){const t=new Date(n.dateCurrent);e.year=void 0!==e.year?e.year:t.getFullYear(),e.month=void 0!==e.month?e.month:t.getMonth(),e.date=void 0!==e.date?e.date:t.getDate(),e=new Date(e.year,e.month,e.date,e.hours,e.getMinutes)}}e&&!isNaN(e.getTime())&&n._scrollTo(e,t)}scrollToEvent(e){const t=this,n=t._events;(e="number"==typeof e&&n?n[e]:t._containsEvent(e))&&t._scrollTo(e)}openNotification(e,t){const n=this;if(!(e+=""))return;n._setToast();const i=n.$.toast;if(i){if("object"==typeof t)for(let e in t)i[e]=t[e];n._appendToast(),i.open(e)}}closeNotifications(){this._checkNotifications(!0)}openWindow(e){const t=this;let n=e;if(void 0===e||"object"==typeof e){if(e=t._containsEvent(e))return void t._openWindow(e);e=new Date(t.dateCurrent)}else if("string"==typeof e){if(n=t._events.find((t=>t.id+""===e)),n)return void t._openWindow(n);n||(n=new Date(e))}else if("number"==typeof e)return n=t._events[e],void(n&&t._openWindow(n));if(e instanceof Date){if(isNaN(e.getTime()))return;e={dateStart:new Date(t.dateCurrent)}}"object"!=typeof e||e.dateStart||(e.dateStart=new Date(t.dateCurrent)),(e=t._createEvents([e]))&&t._openWindow(e[0])}closeWindow(){const e=this.$.confirmSchedulerWindow,t=this.$.schedulerWindow;t&&(t.close(),delete t._target),e&&(e.close(),delete e._target)}occurrences(e,t=100){const n=this._rRule;if(!n||!e)return;const i=this._getEventRepeatOptions(e);return i?(t=parseInt(t),t=isNaN(t)?100:t,new n(i).all(((e,n)=>!(!i.count&&n===t))).map((e=>new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())))):void 0}occurrencesBetween(e,t,n){const i=this,r=i._rRule;if(!r||!e||isNaN(new Date(t).getTime())||isNaN(new Date(n).getTime()))return;const l=i._getEventRepeatOptions(e);return l?(t=new Date(Math.min(t.getTime(),n.getTime())),n=new Date(Math.max(t.getTime(),n.getTime())),new r(l).between(new Date(Date.UTC(...i._getDateArgs(t))),new Date(Date.UTC(...i._getDateArgs(n))),!0).map((e=>new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())))):void 0}occurrenceAfter(e,t){return this._occurrence(e,t,"after")}occurrenceBefore(e,t){return this._occurrence(e,t,"before")}getCellDateRange(e){if(e&&this.$.timelineCellsContainer.contains(e)&&e.classList.contains("smart-scheduler-cell"))return e.classList.contains("scale")&&(e=e.children[0]),this._getCellDateRange(e)}undo(e){return this._handleUndoRedo("undo",e)}redo(e){return this._handleUndoRedo("redo",e)}deleteUndoRedoHistory(){this._updateUndoRedo()}canUndo(){return this._isUndoPossible()}canRedo(){return this._isRedoPossible()}_occurrence(e,t,n){const i=this,r=i._rRule;if(!r||!e||isNaN(new Date(t).getTime()))return;const l=i._getEventRepeatOptions(e);if(!l)return;const a=new r(l)[n](new Date(Date.UTC(...i._getDateArgs(t))),!0);return a?new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()):void 0}openEventTooltip(e){const t=this,n=t.$.tooltip,i=t._events;if((e="number"==typeof e&&i?i[e]:t._containsEvent(e))&&n){const n=t.$.timeline.querySelectorAll(".smart-scheduler-event");for(let i=0;i<n.length;i++){const r=n[i].$?[n[i]]||0:void 0;if(r&&r.some((t=>{const n=t.$?t.$.event:void 0;return n&&(n===e||n.$&&n.$.event===e)}))){delete t._openEventMenu,t._handleTooltipContent(r[0]);break}}}}closeEventTooltip(){const e=this.$.tooltip;e.visible&&e.contains(this._eventList)&&e.close()}isEventRestricted(e){return e&&e.classList&&e.classList.contains("smart-scheduler-event")&&(e=e.$?e.$.event:void 0),!!(e&&e.dateStart instanceof Date&&e.dateEnd instanceof Date)&&this._isEventRestricted(e)}isDateRestricted(e){return e&&e.classList&&e.classList.contains("smart-scheduler-cell")&&(e=e.$&&e.$.cellObj?new Date(e.$.cellObj.time):void 0),!(!e||void 0===e.getTime||isNaN(e.getTime()))&&this._isDateRestricted(e)}isHourRestricted(e){return e&&e.classList&&e.classList.contains("smart-scheduler-cell")&&(e=e.$&&e.$.cellObj?new Date(e.$.cellObj.time):void 0),this._isHourRestricted(e)}_checkDoubleClick(e){const t=this;if(void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),e!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=e,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout((function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0),t._openEventMenu&&(t._handleTooltipContent(t._openEventMenu),delete t._openEventMenu)}),250),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,delete t._openEventMenu,!0}_cloneObject(e,t,n){const i=this;let r={};for(let n in e){let l=e[n];if(l instanceof Date)r[n]=t?l.toISOString():new Date(l);else if("repeat"===n){if(r[n]=Object.assign({},l),r[n].exceptions){const e=r[n].exceptions=r[n].exceptions.slice();for(let t=0;t<e.length;t++)e[t]=i._cloneObject(e[t])}}else r[n]=l}return n||(delete r.$,r.repeat&&r.repeat.exceptions&&r.repeat.exceptions.forEach((e=>delete e.$))),r}_doubleClickHandler(e){const t=this;if(t.disabled||t.disableWindowEditor)return;const n=t.$.tooltip;let i=e.closest?e.closest(".smart-scheduler-cell:not(.scale)"):void 0;if(t.$.timelineContainer.contains(i)||t.$.timelineViewAllDay.contains(i))t._openWindow();else if(i=e.classList.contains("smart-scheduler-event")?e:e.closest(".smart-scheduler-event-content"),i&&(t.$.timeline.contains(i)||n.contains(i))){i=i.closest(".smart-scheduler-event");let e=i&&i.$?i.$:void 0;if(!e||e.events)return;e=e.event;const r=e.$?e.$.event:void 0,l=r&&r.repeat?r.repeat.exceptions:void 0;let a;if(l&&l.indexOf(e)>-1)a=e;else{const t=i.$;a=r?Object.assign({},e,{dateStart:t.dateStart,dateEnd:t.dateEnd}):e}n.close(),t._openWindow(a,r?i:void 0)}}_createEventFromSelection(e){const t=this;if(e||(e=t._selectedCellObj),e instanceof HTMLElement&&e.$&&(e={from:e.$.cellObj,to:e.$.cellObj}),!e||!e.from)return;const n=e.from,i=e.to,r=new Date(Math.min(n.time,i.time)),l=new Date(Math.max(n.time,i.time)),a=n.horizontal.group||n.vertical.group;!n.allDay&&t.viewType.toLowerCase().indexOf("month")<0?l.setHours(l.getHours(),l.getMinutes()+60/t._getCellsScaleCount(),0,0):l.setHours(23,59,59,999);const o={allDay:!!n.allDay,dateStart:r,dateEnd:l};if(!t._isEventRestricted(o)){if(a)for(let e in a)o[e]=a[e];return o}}_downHandler(e){const t=this,n=t.$.tooltip,i=e.originalEvent;let r=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target;if(e.stopPropagation(),0===e.button&&n.contains(t._contextList)&&r&&r.closest&&!r.closest(".smart-scheduler-nav[current]")&&!r.closest(".smart-scheduler-view-items-button")&&!n.contains(r)&&n.close(),t._dragDetails)return t._endDrag(),t._endResize(),delete t._dragDetails,clearInterval(t._scrollInterval),void delete t._scrollInterval;if(!t.$.timeline.contains(r)&&!t.$.tooltip.contains(r))return;if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),r=(t.shadowRoot||document).elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset),t.$.timelineContent.classList.remove("hide-overlay")),!r||!r.closest)return;t._dragDetails={target:r,button:e.button,timestamp:Date.now()};const l=r.closest(".smart-scheduler-cell:not(.scale)");if(l&&l.$&&(t.$.timelineContainer.contains(l)||t.$.timelineViewAllDay.contains(l))){const n=l.$.cellObj;if(!n)return;if(t._dragDetails.timelineCellObj=Object.assign({},n),0===e.button&&t._checkDoubleClick(r))return;if(t._isMobile)return;if(0!==e.button&&e.shiftKey&&t._selectedCellObj)t._handleCellSelection(t._selectedCellObj.from,n);else{if(0!==e.button&&t._isCellObjSelected(n))return;t._handleCellSelection(n)}return void(t._dragDetails.selectedCellObj=Object.assign({},t._selectedCellObj))}const a=r.closest(".smart-scheduler-event");if(a){if(0===e.button&&t._checkDoubleClick(r))return;t._dragDetails.schedulerEvent=a,t._dragDetails.coordinates={x:e.pageX,y:e.pageY},t._dragDetails.originialEvent=e,("visible"===t.resizeHandlesVisibility||t._isMobile&&"auto"===t.resizeHandlesVisibility)&&t._checkEventResizability(e)}}_documentMoveHandler(e){const t=this,n=e.originalEvent,i=t._dragDetails,r=Smart.Scheduler.schedulerStart;let l=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(r)t._setDropTarget(e);else if(!i)return void t._checkEventResizability(e);if(i&&0===i.button)if(t.$.timeline.getAttribute("event-hovered"))t._handleEventResize(e);else if(t.disableDrag||!i.schedulerEvent||r){if(r===t){const n=t.dragOffset,i=Smart.Scheduler.feedback;return i.parentElement||document.body.appendChild(i),t.rightToLeft?i.style.left=e.pageX-n[0]-i.offsetWidth+"px":i.style.left=e.pageX+n[0]+"px",void(i.style.top=e.pageY+n[1]+"px")}if(t._isMobile){const e=t.$.tooltip;r===t&&e.visible&&e.close()}else if(!t.disableSelection&&"agenda"!==t.viewType&&!e.shiftKey){Smart.Utilities.Core.Browser.Firefox&&(l=(t.shadowRoot||document).elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset));const e=i.timelineCellObj,r=t.$.timeline.contains(l)?l.closest(".smart-scheduler-cell:not(.scale)"):void 0;e&&r&&t._selectCell(e,r)}}else t._setDragStart(e)}_documentUpHandler(e){const t=this,n=e.originalEvent,i=t._dragDetails,r=n.pageX-window.pageXOffset,l=n.pageY-window.pageYOffset;let a=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target;if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),a=(t.shadowRoot||document).elementFromPoint(r,l),t.$.timelineContent.classList.remove("hide-overlay")),t._upHandler(),clearInterval(t._scrollInterval),delete t._scrollInterval,i&&Smart.Scheduler.schedulerStart)return void t._endDrag(e,a);if(i&&t.hasAttribute("resized"))return void t._endResize(e);const o=t.$.tooltip;if(!o.visible||o.contains(a)||(t.shadowRoot||t).contains(a)||o.close(),a&&a.closest){if(!i){const e=t.$.schedulerWindow;return void(t.contains(a)&&a.classList.contains("smart-scheduler-window-modal")&&e&&e.focus())}{const n=a.closest(".smart-scheduler-event");if(i.schedulerEvent===n){t._handleCellSelection(),t.$.fireEvent("itemClick",{item:n,type:"event",itemObj:t._cloneObject(n.$.event)});const e=!t._isMobile||Date.now()-i.timestamp<250;!o.contains(a)&&e&&0===i.button&&(t._dblClickDetails&&0===t._dblClickDetails.clicks?(t._handleTooltipContent(n),delete t._openEventMenu):t.disableEventMenu?delete t._openEventMenu:t._openEventMenu=n)}else{delete t._openEventMenu;const n=o.selector;0!==i.button||e.shiftKey&&t._selectedCellObj||o.contains(a)&&n&&n.classList.contains("smart-scheduler-cell")||t._handleCellSelection(i.timelineCellObj,a)}}}delete t._dragDetails}_handleDataAdapter(){const e=this;if(e.dataSource&&e.dataSource instanceof Smart.DataAdapter){const t=e.querySelector(".smart-loader-container");if(t&&t.remove(),e.dataSource.url){const t=document.createElement("div");t.classList.add("smart-loader-container","smart-scheduler-loading-container"),t.innerHTML=`<span id='loadingIndicator' class='smart-scheduler-loader smart-loader'></span>\n                <span id='loadingIndicatorPlaceholder' class ='smart-loader-label'>${e.localize("loadingIndicatorPlaceholder")}</span>`,e.appendChild(t)}e.dataSource.notify((function(t){if(e.dataSource._updating)return;const n=e.querySelector(".smart-loader-container");n&&n.remove();let i=t.data,r=t.index;switch(t.action){case"add":case"insert":i=e._parseAdapterData(i.length?i:[i]),e.insertEvent(i,r);break;case"update":i=e._parseAdapterData(i.length?i:[i]),e.updateEvent(r,i);break;case"remove":case"removeLast":e.removeEvent(void 0!==r?r:e._events.length-1);break;case"bindingComplete":e.dataSource.canNotify=!1,e.dataSource.dataSource=e._parseAdapterData(e.dataSource.toArray()).filter((e=>void 0!==e)),e.dataSource.canNotify=!0,e._createEvents(),e._createTimeline(),e.closeWindow()}}))}}_parseAdapterData(e){const t=this,n=["month","agenda"].indexOf(t.viewType.toLowerCase())>-1;Array.isArray(e)||(e=Array.from(e));for(let i=0;i<e.length;i++){const r=e[i],l=r.dateStart,a=r.dateEnd;let o=[];if(!n&&l instanceof Date&&a instanceof Date&&a.getTime()-l.getTime()>=864e5&&(r.allDay=!0),r.rrule&&t._parseIcalRrule(r),r.extdate){let e=r.extdate;e.indexOf("EXDATE:")>=0&&(e=e.substring(e.indexOf("EXDATE:")+7)),e.indexOf(",")>=0?o=e.split(","):o.push(e)}if(r.reccurenceId){const n=e.find((e=>e.uid===r.uid&&!e.reccurenceId));if(!n)continue;t._parseICalReccurenceId(r,n,o),e[i]=void 0}r.alarm&&t._parseICalAlarm(r),r.categories&&t._parseICalCategories(r)}return e}_parseIcalRrule(e){const t=this,n=t._rRule;if(!n)return;const i=n.parseString(e.rrule);let r;if(i){let l;switch(n.FREQUENCIES[i.freq].toLowerCase()){case"weekly":void 0!==i.byweekday&&(l=(Array.isArray(i.byweekday)?i.byweekday:Array.from(i.byweekday)).map((e=>(e.weekday+1+7)%7)));break;case"monthly":void 0!==i.bymonthday&&(l=i.bymonthday);break;case"yearly":void 0!==i.bymonth&&void 0!==i.bymonthday&&(l={month:i.bymonth-1,date:i.bymonthday})}e.repeat={repeatFreq:n.FREQUENCIES[i.freq].toLowerCase(),repeatInterval:i.interval,repeatOn:l},i.until instanceof Date?r=new Date(Date.UTC(...t._getUTCDateArgs(i.until))):"number"==typeof i.count&&(r=i.count),void 0!==r&&(e.repeat.repeatEnd=r)}}_parseICalReccurenceId(e,t,n){const i=e.reccurenceId;if(!e)return;const r=this._cloneObject(e);delete r.repeat,r.date=(e=>{let t;e.indexOf("VALUE=DATE:")>-1&&(e=e.replace("VALUE=DATE:",""),t=!0);const n=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/.exec(e);if(!n)throw new Error("Invalid DATE value: "+e);return t?new Date(n[1],n[2]-1,n[3],0,0,0,0):new Date(Date.UTC(n[1],n[2]-1,n[3],n[5]||0,n[6]||0,n[7]||0))})(i),n.indexOf(r.date)>-1&&(r.hidden=!0),t.repeat&&(t.repeat.exceptions||(t.repeat.exceptions=[]),t.repeat.exceptions.push(r))}_parseICalAlarm(e){if(!e)return;const t=JSON.parse(e.alarm),n=e.dateStart.getTime();if(Array.isArray(t)){let i=[],r=/^(-)?P(\d+)DT(\d{1,2})H(\d{1,2})M(\d{1,2})S$/;for(let e=0;e<t.length;e++){const l=t[e],a=l.TRIGGER;if(r.test(a)){const e=r.exec(a);if(!e)continue;let t,o=parseInt(e[2]),s="-"===e[1]?-1:1,d=new Date(n);d.setDate(d.getDate()+s*o),d=new Date(d.getTime()+s*(1e3*(e[3]||0)*60*60+1e3*(e[4]||0)*60+1e3*(e[5]||0))),o>28?(o=Math.round(o/7),t="weeks"):t="days",i.push({interval:o,type:t,time:[d.getHours(),d.getMinutes()],message:l.description||""})}}delete e.alarm,e.notifications=i}}_parseICalCategories(e){e&&(e.categories.split(",").forEach((t=>{const n=t.split("/");void 0!==n[1]&&(e[n[0]]=parseInt(n[1]))})),delete e.categories)}_exportToICal(e){const t=this,n=t.id,i=t._rRule,r=t.resources,l=t._getUTCDate(new Date),a=t._events;let o=`BEGIN:VCALENDAR\r\nPRODID:-//HTMLElements//Smart Scheduler//EN\r\nVERSION:2.0\r\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\r\nX-WR-CALNAME:${n}\r\nX-WR-TIMEZONE:${t.timeZone}\r\n`;for(let e=0;e<a.length;e++){const s=a[e],d=t._getEventRepeatOptions(s,!0),c=r.filter((e=>s[e.value])),u=s.status,h=s.id?s.id:n+Math.floor(65536*(1+Math.random())).toString(16).substring(1);if(o+="BEGIN:VEVENT\r\n",o+=t._getICalEventDates(s),o+=`DTSTAMP:${l}\r\nUID:${h}\r\nCREATED:${l}\r\nDESCRIPTION:${s.description||""}\r\nTRANSP:${u&&"free"!==u?"OPAQUE":"TRANSPARENT"}\r\nSEQUENCE:0\r\nSTATUS:${t._getICalStatus(s.status)}\r\nSUMMARY:${s.label||""}\r\n`,c.length&&(o+=`CATEGORIES:${c.map((e=>`${e.value}/${s[e.value]}`)).toString()}\r\n`),o+=t._getICalNotifications(s),d){const e=s.repeat.exceptions;if(delete d.dtstart,o+=new i(d).toString()+"\r\n",e&&e.length){for(let n=0;n<e.length;n++){const i=e[n];i.hidden&&(o+=`EXDATE;VALUE=DATE:${t._getUTCDate(i.date,s.allDay)}\r\n`)}o+="END:VEVENT\r\n";for(let n=0;n<e.length;n++){const i=e[n];if(!i.hidden&&i.dateStart&&i.dateEnd){const e=r.filter((e=>i[e.vlaue]));o+="BEGIN:VEVENT\r\n",o+=t._getICalEventDates(i),o+=`DTSTAMP:${l}\r\nUID:${h}\r\nRECURRENCE-ID${s.allDay?";VALUE=DATE":""}:${t._getUTCDate(i.date,s.allDay)}\r\nCREATED:${l}\r\nDESCRIPTION:${i.description||""}\r\nSEQUENCE:1\r\nSTATUS:${t._getICalStatus(i.status)}\r\nSUMMARY:${i.label||""}\r\n`,e.length&&(o+=`CATEGORIES:${e.map((e=>`${e.value}/${i[e.value]}`)).toString()}\r\n`),o+="END:VEVENT\r\n"}}continue}}o+="END:VEVENT\r\n"}o+="END:VCALENDAR";const s=(new Smart.Utilities.DataExporter).downloadFile(o,"text/calendar",t.dataExport.fileName);return e&&s&&e(s),s}_getICalEventDates(e){const t=this;if(!e.dateStart||!e.dateEnd)return"";if(e.allDay||e.$&&e.$.event.allDay){const n=new Date(e.dateEnd);return n.setDate(n.getDate()+1),`DTSTART;VALUE=DATE:${t._getUTCDate(e.dateStart,!0)}\r\nDTEND;VALUE=DATE:${t._getUTCDate(n,!0)}\r\n`}return`DTSTART:${t._getUTCDate(e.dateStart)}\r\nDTEND:${t._getUTCDate(e.dateEnd)}\r\n`}_getICalNotifications(e){let t="";if(!e)return t;const n=e.notifications;if(n&&n.length){const i=e.dateStart.getTime();for(let e=0;e<n.length;e++){const r=n[e],l="days"===r.type||0===r.type?r.interval:7*r.interval,a=r.time,o=new Date(i-24*l*60*60*1e3);o.setHours(a[0]%23,a[1]%60,0,0);let s=o.getTime()-i;const d=s<0?"-":"";s=Math.abs(s);const c=Math.max(0,Math.floor(s/864e5));s-=1e3*c*60*60*24;const u=Math.max(0,Math.floor(s/36e5));s-=1e3*u*60*60;const h=Math.max(0,Math.floor(s/6e4));t+=`BEGIN:VALARM\r\nACTION:DISPLAY\r\nDESCRIPTION:${r.message}\r\nTRIGGER:${d}P${c}DT${u}H${h}M0S\r\nEND:VALARM\r\n`}}return t}_getUTCDate(e,t){function n(e){return e<10?`0${e}`:`${e}`}return e instanceof Date||(e=new Date(e)),t?`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}`:`${e.getUTCFullYear()}${n(e.getUTCMonth()+1)}${n(e.getUTCDate())}T${n(e.getUTCHours())}${n(e.getUTCMinutes())}${n(e.getUTCSeconds())}Z`}_getICalStatus(e){switch(e){case"tentative":return"TENTATIVE";case"canceled":return"CANCELED";case"draft":return"DRAFT";case"final":return"FINAL";case"in-process":return"IN-PROCESS";case"needs-action":return"NEEDS-ACTION";default:return"CONFIRMED"}}_setDropTarget(e){const t=this,n=e.originalEvent;let i,r=t.shadowRoot||t.isInShadowDOM?n.composedPath()[0]:n.target,l=Smart.Scheduler.hoveredCell,a=Smart.Scheduler.hoveredScheduler;if((t.shadowRoot||t).contains(r)&&(a&&a!==t&&(a.removeAttribute("dragged"),clearInterval(a._scrollInterval),delete a._scrollInterval),Smart.Scheduler.hoveredScheduler=a=t,t.setAttribute("dragged","")),t._isMobile&&a&&(a.$.timelineContent.classList.add("hide-overlay"),r=(t.shadowRoot||document).elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset),a.$.timelineContent.classList.remove("hide-overlay")),r&&r.closest&&!r.closest(".smart-scheduler-groups-container")&&(i=r.closest(".smart-scheduler-cell:not(.scale)")),i&&i!==l&&(t.shadowRoot||t).contains(i)){const e=document.body;l&&l.classList.remove("smart-scheduler-feedback"),t.disableDrop&&delete Smart.Scheduler.hoveredCell,Smart.Scheduler.hoveredCell=i,i.hasAttribute("restricted")?(e.classList.remove("smart-dragging"),e.classList.add("smart-dragging-disabled")):(i.classList.add("smart-scheduler-feedback"),e.classList.remove("smart-dragging-disabled"),e.classList.add("smart-dragging")),Smart.Scheduler.hoveredScheduler=a=t}else i||(a!==t||t.$.container.contains(r)||(t.removeAttribute("dragged"),clearInterval(t._scrollInterval),delete t._scrollInterval,delete Smart.Scheduler.hoveredScheduler),l&&(l.classList.remove("smart-scheduler-feedback"),delete Smart.Scheduler.hoveredCell));a&&a._autoScroll(n)}_setDragStart(e){const t=this,n=t.$.tooltip,i=t._dragDetails;let r=!0;if(t._isMobile&&(r=Date.now()-i.timestamp>=250,n.contains(i.schedulerEvent)&&t._list?t._list.disableSwipeScroll=t._list._touchmoveInside=r:t._scrollView.disableSwipeScroll=t._touchmoveInside=r),!r||Math.abs(e.pageX-i.coordinates.x)<5&&Math.abs(e.pageY-i.coordinates.y)<5)return;if(i.schedulerEvent.hasAttribute("collector")||"agenda"===t.viewType||i.resizeDetails)return;const l=i.schedulerEvent.$.event;if(!l||l.disableDrag)return;const a=t._cloneObject(l);if(t.$.fireEvent("dragStart",{target:i.schedulerEvent,item:a,itemDateRange:{dateStart:new Date(a.dateStart),dateEnd:new Date(a.dateEnd)},originalEvent:i.originialEvent}).defaultPrevented)return;i.originalBodyOverflow={overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY,overflow:document.body.style.overflow};const o=(document.scrollingElement||document.documentElement).scrollHeight>document.documentElement.clientHeight,s=(document.scrollingElement||document.documentElement).scrollWidth>document.documentElement.clientWidth;document.body.style.overflow=document.body.style.overflowX=document.body.style.overflowY="",o&&!s?document.body.style.overflowX="hidden":s&&!o?document.body.style.overflowY="hidden":s||o||(document.body.style.overflow="hidden"),n.contains(i.schedulerEvent)&&t._list&&(t._list.disableSwipeScroll=t._list._touchmoveInside=!0),n.close(),Smart.Scheduler.schedulerStart=t,Smart.Scheduler.feedback=t._createDragFeedback(a),t._dragDetails.schedulerEventObj=a,t._scrollView.disableSwipeScroll=t._touchmoveInside=!0,t.setAttribute("dragged",""),document.body.classList.add("smart-dragging")}_endDrag(e,t){const n=this;if(!Smart.Scheduler.schedulerStart)return;const i=n._dragDetails,r=Smart.Scheduler.schedulerStart,l=Smart.Scheduler.schedulerStart._dragDetails.schedulerEvent,a=Smart.Scheduler.schedulerStart._dragDetails.schedulerEventObj,o=Smart.Scheduler.hoveredScheduler,s=Smart.Scheduler.hoveredCell,d=document.body;if(r!==n)return;let c={};if(Smart.Scheduler.feedback.remove(),delete Smart.Scheduler.hoveredScheduler,delete Smart.Scheduler.hoveredCell,delete Smart.Scheduler.schedulerStart,delete Smart.Scheduler.feedback,i.originalBodyOverflow&&(d.style.overflow=i.originalBodyOverflow.overflow,d.style.overflowX=i.originalBodyOverflow.overflowX,d.style.overflowY=i.originalBodyOverflow.overflowY),o&&(o.removeAttribute("dragged"),clearInterval(o._scrollInterval),delete o._scrollInterval,s)){const t={event:e,schedulerEvent:l,hoveredCell:s,hoveredScheduler:o,schedulerEventObj:a};s.classList.remove("smart-scheduler-feedback"),n._setEventDropDates(t),n._completeEventDragDrop(t),c.dateStart=t.newDateStart,c.dateEnd=t.newDateEnd,i.schedulerEventObj=t.schedulerEventObj}e&&(n.$.fireEvent("dragEnd",{target:t,item:i.schedulerEventObj,itemDateRange:c,originalEvent:e}),n.$.fireEvent("itemChange",{type:"drag",item:i.schedulerEventObj})),d.classList.remove("smart-dragging"),d.classList.remove("smart-dragging-disabled"),r.removeAttribute("dragged"),n._scrollView.disableSwipeScroll=n._touchmoveInside=!1,n._list&&(n._list.disableSwipeScroll=n._list._touchmoveInside=!1);const u=n._handleEventFocus({type:"focusin",target:l});u&&u.focus({preventScroll:!0}),delete n._dragDetails}_endResize(e){const t=this,n=t._dragDetails,i=n?n.resizeDetails:void 0;if(t.removeAttribute("resized"),!n||!i)return;const r=n.schedulerEvent;let l={};r.removeAttribute("resized"),e?(t._setEventResizeDates(l),t._completeEventResize(l),t.$.fireEvent("resizeEnd",{target:n.schedulerEvent,item:i.schedulerEventObj,itemDateRange:l,originalEvent:e.originialEvent||e}),t.$.fireEvent("itemChange",{type:"resize",item:i.schedulerEventObj})):(r.style.left=i.originalPosition.x+"px",r.style.top=i.originalPosition.y+"px",r.style.width=i.originalSize.width+"px",r.style.height=i.originalSize.height+"px"),t._scrollView.disableSwipeScroll=t._touchmoveInside=!1,delete t._dragDetails,t._handleEventHover(),t._refreshTimelineEvents(),r.focus({preventScroll:!0}),t._handleEventFocus({type:"focusin",target:r})}_completeEventResize(e){const t=this,n=t._dragDetails,i=n.resizeDetails,r=i.cellObj,l=e.dateStart,a=e.dateEnd;if(!(r&&e&&l&&a))return;const o=n.schedulerEvent;let s=o.$.event;if(!o||!s||s.dateStart.getTime()===l.getTime()&&s.dateEnd.getTime()===a.getTime())return;if(t._isEventRestricted({dateStart:l,dateEnd:a}))return;const d=s.$&&s.$.event?s.$.event:void 0;let c;d?(c=t._cloneObject(d),t._handleEventExceptionDrop(s)):c=t._cloneObject(s);const u=s.dateStart.getTime()!==l.getTime();s.dateStart=new Date(l),s.dateEnd=new Date(a),["day","week"].indexOf(t.viewType)>-1&&s.allDay&&!i.isAllDay&&delete s.allDay,u&&(o.$.cellTime=l.getTime()),t._validateEventDateRange(s),t._updateUndoRedo(c,t._cloneObject(d||s),"resizeEnd")}_setEventResizeDates(e){const t=this,n=t._dragDetails,i=n.resizeDetails,r=i.cellObj;if(!r)return;const l=i.side,a=n.schedulerEvent,[o,s]="left"===l||"right"===l?["x","width"]:["y","height"];let d=a.$.event;if(!i.resizeFromMiddle&&i.originalPosition[o]===i.position[o]&&i.originalSize[s]===i.size[s])return e.dateStart=new Date(d.dateStart),void(e.dateEnd=new Date(d.dateEnd));const c=t.viewType,u=t.rightToLeft,h=60/t._getCellsScaleCount(),m=r.date,v=i.scaleIndex||0;let g,f;if("top"===l)f="dateStart",g=new Date(d.dateStart),g.setHours(m.getHours(),m.getMinutes()+h*v,0,0);else if("bottom"===l)f="dateEnd",g=new Date(d.dateEnd),g.setHours(m.getHours(),m.getMinutes()+h*(v+1),0,0);else{f="left"===l&&!u||"right"===l&&u?"dateStart":"dateEnd";const e=d[f];if("month"===c){const n=t._getCellObjOffset(a,i.position,"dateStart"===f?"bottom":"top").cellObj;g=new Date(e);const r=g.getHours(),l=g.getMinutes(),o="dateEnd"===f&&0===r&&0===l;g=new Date(n.date),g.setDate(g.getDate()+(m.getDay()-t.firstDayOfWeek+7)%7),o?g.setDate(g.getDate()+1):g.setHours(e.getHours(),e.getMinutes(),e.getSeconds())}else g=new Date(m),"timelineMonth"===c?"dateEnd"===f&&0===g.getHours()&&0===g.getMinutes()?(g.setDate(g.getDate()+1),g.setHours(0,0,0,0)):g.setHours(e.getHours(),e.getMinutes(),e.getSeconds()):["day","week"].indexOf(c)>-1&&i.isAllDay?(g=new Date(m),"dateEnd"===f&&g.setHours(23,59,59,999)):g.setMinutes(m.getMinutes()+h*(v+("dateStart"===f?0:1)),0,0)}"dateStart"===f?(e.dateStart=g,e.dateEnd=new Date(d.dateEnd)):(e.dateStart=new Date(d.dateStart),e.dateEnd=g)}_completeEventDragDrop(e){const t=this,n=e.event,i=e.schedulerEvent,r=e.hoveredCell,l=e.hoveredScheduler,a=e.schedulerEventObj,o=e.newDateStart,s=e.newDateEnd;if(l.disableDrop||n&&"keydown"===n.type&&"Escape"===n.key||!o||!s||t._isEventRestricted({dateStart:o,dateEnd:s}))return;const d=t.view,c=t.views.find((e=>e.value&&e.value===d))||{},u=c&&c.groupOrientation?c.groupOrientation:t.groupOrientation,h=i.$.event,m=h.$?h.$.event:void 0,v=r.$.cellObj,g=v[u].group,f=h.dateStart.getTime(),p=r.$.cellObj.time;let w,y;if(l===t?(y=t._cloneObject(m||h),w=h):w=a,l===t&&f===p||t._handleEventExceptionDrop(h,w),w.dateStart=new Date(o),w.dateEnd=new Date(s),["day","week"].indexOf(t.viewType)>-1&&(w.allDay=!!v.allDay),f!==p&&(i.$.cellTime=p),w.allDay||delete w.allDay,g&&!t._isEventPartOfGroup(h,g)){t.groups.forEach((e=>delete w[e]));for(let e in g)w[e]=g[e]}l===t?(t._validateEventDateRange(w),t._refreshTimelineEvents(),e.schedulerEventObj=t._cloneObject(m||w),t._updateUndoRedo(y,t._cloneObject(m||w),"dragEnd")):(m||t.removeEvent(h),l.insertEvent(w))}_setEventDropDates(e){const t=this,n=e.schedulerEvent,i=e.hoveredScheduler,r=e.hoveredCell,l=n.$.event,a=r.$.cellObj,o=l.dateStart.getTime(),s=r.$.cellObj.time,d=a[t.groupOrientation].group;if(i===t&&o===s&&!!a.allDay==!!l.allDay&&(!d||t._isEventPartOfGroup(l,d)))return e.newDateStart=new Date(l.dateStart),void(e.newDateEnd=new Date(l.dateEnd));const c=e.schedulerEventObj,u=["day","week"].indexOf(t.viewType)>-1,h=i===t?l:c;let m,v;if(m=new Date(s),u&&!!h.allDay!=!!a.allDay)v=t._getCellDateRange(a).dateEnd;else{const e=h.dateEnd.getTime()-h.dateStart.getTime();v=new Date(m.getTime()+e)}u&&a.allDay&&(m.setHours(0,0,0,0),0!==v.getHours()&&0!==v.getMinutes()&&0!==v.getSeconds()&&v.setHours(23,59,59,999)),e.newDateStart=m,e.newDateEnd=v}_checkEventResizability(e){const t=this,n=t._dragDetails,i=e.originalEvent||e;let r=i.target;if(t._isMobile){if(!n)return;t.$.timelineContent.classList.add("hide-overlay"),r=(t.shadowRoot||document).elementFromPoint(i.pageX-window.pageXOffset,i.pageY-window.pageYOffset),t.$.timelineContent.classList.remove("hide-overlay")}else t.shadowRoot&&r===t&&(r=e.originalEvent.composedPath()[0]);const l=t.$.timeline;let a=r&&r.closest&&!t.disabled?r.closest(".smart-scheduler-event"):void 0;if(t._handleEventHover(a),!a||t.disableResize||"agenda"===t.viewType)return;const o=a.$?a.$.event:void 0;if(!l.contains(a)||a.hasAttribute("collector")||!o||o.disableResize)return;const s=t.viewType,d=t.$.timelineViewAllDay.contains(a),c=e.pageX-window.pageXOffset,u=e.pageY-window.pageYOffset,h="visible"===t.resizeHandlesVisibility||t._isMobile?20:5,m=a.getBoundingClientRect();if(s.toLowerCase().indexOf("timeline")>-1||"month"===s||d){if(Math.round(m.left)+h>=c&&Math.round(m.left)-h<=c)return void l.setAttribute("event-hovered","left");if(Math.round(m.right)+h>=c&&Math.round(m.right)-h<=c)return void l.setAttribute("event-hovered","right")}else{if(Math.round(m.top)+h>=u&&Math.round(m.top)-h<=u)return void l.setAttribute("event-hovered","top");if(Math.round(m.bottom)+h>=u&&Math.round(m.bottom)-h<=u)return void l.setAttribute("event-hovered","bottom")}l.hasAttribute("event-hovered")&&l.setAttribute("event-hovered","")}_handleEventHover(e){const t=this,n=t.$.timeline;if(!e&&!n.hasAttribute("event-hovered")||e&&e.hasAttribute("hover"))return;const i=e&&e.$?e.$.event:void 0;let r=[].concat(Array.from(t.$.timelineEventsContainer.children),Array.from(t.$.allDayEventsContainer.children));t._eventList&&(r=r.concat(Array.from(t._eventList.children)));for(let t=0;t<r.length;t++){const n=r[t],l=n.$.event;n===e||i&&i===l?n.setAttribute("hover",""):n.removeAttribute("hover")}i||e?n.setAttribute("event-hovered",""):n.removeAttribute("event-hovered")}_handleEventResize(e){const t=this,n=t._dragDetails,i=n?n.schedulerEvent:void 0;if(t.disableResize||!n||!i||"agenda"===t.viewType||t._isMobile&&Date.now()-n.timestamp<250)return;t.hasAttribute("resized")||t._setResizeStart(i);const r=n.resizeDetails;if(!r)return;const l=e.pageX-window.pageXOffset,a=e.pageY-window.pageYOffset,o=r.side,s=t.$.timelineContainer.getBoundingClientRect();let d;d=r.rightToLeft?s.right-l:l-s.left;const c={x:Math.max(0,d+t.scrollLeft),y:Math.max(0,a-s.top+t.scrollTop)},u=t._getCellObjOffset(i,c,o);if(t._autoScroll(e),u)if(r.cellObj=u.cellObj,r.scaleIndex=u.scaleIndex,"left"===o||"right"===o){if(!t._resizeEventHorizontal(u,o))return}else if(!t._resizeEventVertical(u,o))return}_setResizeStart(e){const t=this,n=t._dragDetails,i=e.$.event,r=t.$.timeline,l=t._eventList;if(!i||i.disableResize||Smart.Scheduler.schedulerStart||l&&l.contains(e))return;const a=t._cloneObject(i);if(t.$.fireEvent("resizeStart",{target:n.schedulerEvent,item:a,itemDateRange:{dateStart:new Date(i.dateStart),dateEnd:new Date(i.dateEnd)},originalEvent:n.originialEvent}).defaultPrevented)return;t.$.tooltip.close(),t.setAttribute("resized",""),e.setAttribute("resized",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0;const o=t.rightToLeft,s=parseFloat(e.style[o?"right":"left"]),d=parseFloat(e.style.top),c={width:parseFloat(e.style.width),height:parseFloat(e.style.height)},u=r.getAttribute("event-hovered"),h={x:s,y:d},m=e.closest(".smart-scheduler-events-container").children;let v;for(let t=0;t<m.length;t++){const n=m[t],r=n.$?n.$.event:void 0,l=parseFloat(n.style.left),a=parseFloat(n.style.top);r===i&&e!==n&&("left"===u&&(a<d||a===d&&l<s)||"right"===u&&(a>d||a===d&&l>s))&&(n.classList.add("smart-hidden"),v=!0)}n.resizeDetails={side:u,originalSize:c,originalPosition:h,position:{x:h.x,y:h.y},size:{width:c.width,height:c.height},isAllDay:t.$.timelineViewAllDay.contains(e),rightToLeft:o,resizeFromEnd:"bottom"===u||"right"===u&&!o||"left"===u&&o,resizeFromMiddle:v,schedulerEventObj:a}}_resizeEventHorizontal(e,t){const n=this._dragDetails,i=n.schedulerEvent,r=this.rightToLeft,l=n.resizeDetails;let a,o=l.position.x,s=e.offset;if("left"===t&&!r||"right"===t&&r){const e=l.originalPosition.x;if(o===s)return;if(o<s?(s=o<e?Math.min(e,s):s,a=l.size.width-(s-o)):(s=o>e?Math.max(e,s):s,a=l.size.width+(o-s)),a<=0)return;l.position.x=s,r?(i.style.left="",i.style.right=s+"px"):(i.style.right="",i.style.left=s+"px")}else{if(o+=l.size.width,s+=e.size,o===s)return;if(a=o<s?l.size.width+(s-o):l.size.width-(o-s),a<=0)return}return l.size.width=a,i.style.width=l.size.width+"px",!0}_resizeEventVertical(e,t){const n=this._dragDetails,i=n.schedulerEvent,r=n.resizeDetails;let l,a=r.position.y,o=e.offset;if("top"===t){const e=r.originalPosition.y;if(a===o)return;if(a<o?(o=a<e?Math.min(e,o):o,l=r.size.height-(o-a)):(o=a>e?Math.max(e,o):o,l=r.size.height+(a-o)),l<=0)return;r.position.y=o,i.style.top=o+"px"}else{if(a+=r.size.height,o+=e.size,a===o)return;if(l=a<o?r.size.height+(o-a):r.size.height-(a-o),l<=0)return}return r.size.height=l,i.style.height=r.size.height+"px",!0}_getCellObjOffset(e,t,n){const i=this,r=i._dragDetails.resizeDetails,l=i._timelineCells,a=e.$.event,o=r.isAllDay?1:i._getCellsScaleCount(),[s,d,c,u]="right"===n||"left"===n?["width","left","horizontal","x"]:["height","top","vertical","y"],h=r.resizeFromEnd,m=l[c],v=r.originalSize[s];let g,f,p,w,y,_=r.originalPosition[u],b=_,C=t[u];h?(_=parseFloat((_+v).toFixed(2)),C=Math.max(b,C),w=b):(b=parseFloat((b+v).toFixed(2)),C=Math.min(b,C),y=b);for(let e=0;e<m.length;e++){const t=m[e];if(t.group&&!i._isEventPartOfGroup(a,t.group))continue;const n=parseFloat((t[d]+t[s]).toFixed(2));f||(void 0===w?n>C&&(f=t):n>w&&(f=t)),void 0===y?t[d]<=C&&(p=t):t[d]<y&&(p=t),C!==b&&t[d]<=C&&n>=C&&(g=t)}if(g||(g=h&&b===C||!h&&b!==C?f:p),!g)return;let D,E=g[d],T=parseFloat((g[s]/o).toFixed(2));for(let e=0;e<o;e++){const t=parseFloat((g[d]+T*e).toFixed(2));(b!==C&&t===C||t+T===C||t<C&&t+T>=C)&&(E=t,D=e)}return _>E&&_<parseFloat((E+T).toFixed(2))&&(h&&C<=_?T=_-E:!h&&C>=_&&(E=_)),{offset:E,size:T,cellObj:g,scaleIndex:D}}_handleEventExceptionDrop(e,t){const n=e.$?e.$.event:void 0;if(t||(t=e),e!==t)return delete t.repeat,void delete t.date;if(!n)return;const i=n.repeat;if(t.date||(t.date=new Date(t.dateStart)),delete t.repeat,i){const e=i.exceptions;e?e.indexOf(t)<0&&e.push(t):i.exceptions=[t]}}_dragStartHandler(e){const t=this,n=e.target.closest;(t._dragDetails||n&&n.call(t,"smart-scheduler")===t)&&e.preventDefault()}_autoScroll(e){const t=this,n=t.$.timelineContainer,i=(e.originalEvent||e).target,r=t.autoScrollStep,l=t._dragDetails,a=t.rightToLeft;function o(n,i){i?(t.scrollTop-=r*n,l&&(l.coordinates.y+=r*n)):(t.scrollLeft-=(a?-1:1)*r*n,l&&(l.coordinates.x+=r*n)),t.hasAttribute("resized")&&t._handleEventResize(e)}if(t.disableAutoScroll||!e||!n.contains(i)||!t.hasAttribute("dragged")&&!t.hasAttribute("resized"))return void clearInterval(t._scrollInterval);clearInterval(t._scrollInterval);const s=n.getBoundingClientRect(),d=!(!l||!l.resizeDetails)&&l.resizeDetails.isAllDay;t._scrollInterval=setInterval((function(){(t.scrollLeft||a)&&e.clientX<=s.left+50?o(1):t.scrollLeft!==(a?0:t.scrollWidth)&&e.clientX>=s.left+s.width-50?o(-1):d||(t.scrollTop&&e.clientY<=s.top+50?o(1,!0):t.scrollTop!==t.scrollHeight&&e.clientY>=s.top+s.height-50?o(-1,!0):(clearInterval(t._scrollInterval),t._scrollInterval=void 0))}),1)}_createDragFeedback(e){const t=this,n=t.theme,i=t.rightToLeft,r=t._dragDetails.schedulerEvent;let l=document.createElement("div");return t.dragFeedbackFormatFunction?l.innerHTML=t.dragFeedbackFormatFunction(e)||"":(l=r.cloneNode(!0),l.setAttribute("view-type",t.viewType),l.setAttribute("event-render-mode",t.eventRenderMode)),l.classList.remove("smart-scheduler-event"),l.classList.add("smart-scheduler-drag-feedback"),l.setAttribute("parent-scheduler-id",t.id),t._isMobile&&l.setAttribute("mobile",""),n&&l.setAttribute("theme",n),i&&l.setAttribute("right-to-left",""),l}_containsEvent(e){const t=this._events;if(!e)return;if(t.indexOf(e)>-1)return e;const n=["label","description"],i=this.groups,r="string"==typeof e?e:e.id;for(let l=0;l<t.length;l++){const a=t[l];if(void 0!==a.id&&a.id+""===r)return a;if(n.every((t=>a[t]instanceof Date?new Date(a[t]).getTime()===new Date(e[t]).getTime():a[t]===e[t]))&&(!i.length||i.every((t=>e[t]===a[t]))))return a}}_keyDownHandler(e){const t=this;if(t.readonly||t.hasAttribute("modal"))return void delete t._keyPressed;const n=t.$.tooltip,i=e.key,r=t.$.viewItemsContainer,l=e.target;switch(i){case"End":case"Home":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"PageDown":case"PageUp":e.preventDefault(),t._handleKeyNavigation(e);break;case"Enter":case"Escape":if("Enter"===i){if(n.contains(l)){const i=n.querySelector("[selected]");if(!i)return;if(l===r){const e=t.$.showWeekendItem;e&&e.hasAttribute("selected")&&t._checkHideWekendItem(e),n.close(),t.$.viewItemsButton.focus({preventScroll:!0})}else l.classList.contains("smart-scheduler-event-button")?(t._deleteEventViaWindow(l.closest(".smart-scheduler-event").$.event),n.close(),t.$.timeline.focus({preventScroll:!0})):i.classList.contains("smart-scheduler-event")?t._doubleClickHandler(i):i.classList.contains("smart-scheduler-context-menu-item")&&t._handleContextMenuItemClick(i);e.preventDefault()}else if(l.classList.contains("smart-scheduler-event"))t._doubleClickHandler(l);else if(l.classList.contains("smart-scheduler-legend-res-item")){if(!t.filterable)return;t._handleLegendItemClick(l)}else l===t.$.timeline&&(t._openWindow(),e.preventDefault());break}"Escape"===i&&(Smart.Scheduler.schedulerStart===t?(t._endDrag(e,t),e.preventDefault()):t.hasAttribute("resized")&&(t._endResize(),e.preventDefault())),n.close(),n.selector&&n.selector.focus({preventScroll:!0});break;case"Tab":{const i=l;let r;if((i.classList.contains("smart-scheduler-event")||i.classList.contains("smart-scheduler-view"))&&(r=Array.from(t.$.timeline.querySelectorAll(".smart-scheduler-event"))),!r)break;const a=r.indexOf(i),o=a<0?r[0]:r[a+(e.shiftKey?-1:1)];if(n.visible&&n.contains(i))return;o&&(e.preventDefault(),o.focus({preventScroll:!0}));break}case"c":case"C":case"x":case"X":!t._dragDetails&&e.ctrlKey&&l.classList.contains("smart-scheduler-event")&&(t._updateClipboard(l.$.event,"c"===i?"copy":"cut"),t._handleEventCut(l));break;case"z":case"Z":case"y":case"Y":{const n=t.getRootNode(),r=n?n.activeElement.classList:void 0;if(!r.contains("smart-scheduler-event")&&!r.contains("smart-scheduler-view")&&!r.contains("smart-scheduler"))return;!t._dragDetails&&e.ctrlKey&&t._handleUndoRedo("z"===i?"undo":"redo");break}case"v":case"V":!t._dragDetails&&e.ctrlKey&&l.classList.contains("smart-scheduler-view")&&t._selectedCellObj&&t._pasteEvent(t._selectedCellObj.from);break;case"Delete":if(!t._dragDetails&&l.classList.contains("smart-scheduler-event")&&!l.hasAttribute("collector")){if(t.$.fireEvent("eventShortcutKey",{key:i,target:l,eventObj:t._cloneObject(l.$.event)}).defaultPrevented)return;e.preventDefault(),n.close(),delete t._openEventMenu,t._deleteEventViaWindow(l.$.event),t.$.timeline.focus({preventScroll:!0})}break;case" ":t.filterable&&l.classList.contains("smart-scheduler-legend-res-item")&&t._handleLegendItemClick(l);break;default:if(l===r||l.closest(".smart-scheduler-view-items-button")){let l=t._keyPressed;l||(l=t._keyPressed={}),l[i.toLowerCase()]=!0;const a=Object.keys(l),o=Array.from(r.children).find((e=>{const t=(e.getAttribute("shortcut-key")||"").toLowerCase().split("+");return t.forEach((e=>e.trim())),a.length===t.length&&a.every((e=>t.indexOf(e)>-1))}));o&&(t._handleViewSelection(o),e.preventDefault(),n.close())}}}_keyUpHandler(e){const t=this;if(t.disabled||t.readonly)return void delete t._keyPressed;let n=t._keyPressed;n&&(delete n[e.key.toLowerCase()],Object.keys(n).length||delete t._keyPressed)}_handleContextMenuItemClick(e){const t=this,n=t.$.tooltip,i=n.selector,r=e.getAttribute("value");let l;switch(r){case"create":if(i.classList.contains("smart-scheduler-cell"))if(t._selectedCellObj)l=t._createEventFromSelection();else{const e=t._getCellDateRange(i),n=i.$.cellObj,r=n.vertical.group||n.horizontal.group;if(l={dateStart:e.dateStart,dateEnd:e.dateEnd,allDay:i.hasAttribute("all-day")},r)for(let e in r)l[e]=r[e]}else if(i.classList.contains("smart-scheduler-event")){const e=Object.assign({},i.$.event);l={dateStart:new Date(e.dateStart),dateEnd:new Date(e.dateEnd),allDay:e.allDay}}t._openWindow(l);break;case"edit":t._doubleClickHandler(i);break;case"copy":case"cut":i.classList.contains("smart-scheduler-event")&&!i.hasAttribute("collector")&&(t._updateClipboard(i.$.event,r),t._handleEventCut(i));break;case"paste":if(e.hasAttribute("disabled"))return;i.classList.contains("smart-scheduler-cell")&&t._pasteEvent(i);break;case"delete":if(!i.classList.contains("smart-scheduler-event")||i.hasAttribute("collector"))return;t._deleteEventViaWindow(i.$.event)}if(e instanceof HTMLElement){const n={item:e,type:"context",value:e.getAttribute("value")};l&&(n.itemObj=t._cloneObject(l)),t.$.fireEvent("itemClick",n)}n.close()}_updateClipboard(e,t){const n=this;if(!e||!t)return void delete n._clipboard;n._clipboard={target:e,action:t};let i=[],r=[];const l=n.locale,a={year:n.yearFormat,month:n.monthFormat,day:n.dayFormat,hour:n.hourFormat,minute:n.minuteFormat},o=[{label:"id",value:"Id"},{label:"label",value:"Label"},{label:"description",value:"Description"},{label:"dateStart",value:"Date Start"},{label:"dateEnd",value:"Date End"},{label:"allDay",value:"All Day"},{label:"repeat",value:"Repeat"},{label:"notifications",value:"Notifications"}];for(let t=0;t<o.length;t++){const n=o[t].label;if(void 0!==e[n]){let s=e[n];s instanceof Date?s=new Intl.DateTimeFormat(l,a).format(new Date(s)):"repeat"===n?s=(Object.keys(s).length>0)+"":"notifications"===n&&(s=(Array.isArray(s)&&s.length>0)+""),r.push(o[t].value),i.push(s+"")}}if(i=r.join(",")+"\n"+i.join(","),navigator.clipboard)navigator.clipboard.writeText(i);else if(document.execCommand){const e=document.createElement("textarea"),t=n.getRootNode().activeElement;return e.value=i,e.style.position="fixed",document.body.appendChild(e),e.focus({preventScroll:!0}),e.select(),document.execCommand("copy"),document.body.removeChild(e),void(t&&t.focus({preventScroll:!0}))}}_handleEventCut(e){const t=this,n=t._clipboard,i=Array.from(t.$.timelineEventsContainer.children).concat(Array.from(t.$.allDayEventsContainer.children));let r;if(n&&"cut"===n.action||(e=void 0),e?r=e.$.event:!e&&n&&"cut"===n.action&&(r=n.target),r&&r.$&&r.$.event){const e=r.$.event;e&&e.repeat&&(!e.repeat.exceptions||e.repeat.exceptions.indexOf(r)<0)&&(r=void 0)}for(let e=0;e<i.length;e++){const t=i[e];r&&t.$&&t.$.event===r?t.setAttribute("cut",""):t.removeAttribute("cut")}}_pasteEvent(e){const t=this,n=t._clipboard;if(!n)return;let i=n.target;if(!i)return;if(!(e=e instanceof HTMLElement?e.$.cellObj:e))return;const r=i.$&&i.$.event?i.$.event:void 0;if(r&&r.repeat&&(!r.repeat.exceptions||r.repeat.exceptions.indexOf(i)<0))return;const l=t.view,a=t.views.find((e=>e.value&&e.value===l))||{},o=e[a&&a.groupOrientation?a.groupOrientation:t.groupOrientation].group,s=["day","week"].indexOf(t.viewType)>-1;let d,c,u,h;switch(n.action){case"copy":{if(r)return;const e=t.localize("duplicate"),n=new RegExp(`\\s?-\\s?${e}\\s?(\\(([0-9]+)\\))?$`,"g"),l=t._events;let a=(i.label+"").replace(n,""),o=0;i=t._cloneObject(i);for(let e=0;e<l.length;e++){const t=l[e];if(t.label.indexOf(a)>-1&&(n.lastIndex=0,n.test(t.label))){n.lastIndex=0;const e=n.exec(t.label);o=Math.max(o,parseInt(e[2])||1)+1}}i.label=o>1?`${a} - ${e} (${o})`:`${a} - ${e}`,delete i.id,t._events.push(i),u="itemInsert";break}case"cut":h=t._cloneObject(r||i),o&&!t._isEventPartOfGroup(i,o)&&t.groups.forEach((e=>delete i[e])),t._updateClipboard(),u="itemUpdate"}if(d=new Date(e.time),c=s&&!!i.allDay!=!!e.allDay?t._getCellDateRange(e).dateEnd:new Date(d.getTime()+(i.dateEnd.getTime()-i.dateStart.getTime())),s&&(e.allDay&&(d.setHours(0,0,0,0),0!==c.getHours()&&0!==c.getMinutes()&&0!==c.getSeconds()&&c.setHours(23,59,59,999)),i.allDay=!!e.allDay),i.allDay||delete i.allDay,i.dateStart=d,i.dateEnd=c,o)for(let e in o)i[e]=o[e];t._validateEventDateRange(i),t._refreshTimelineEvents(),"itemInsert"===u?t._updateUndoRedo(void 0,t._cloneObject(r||i),u):t._updateUndoRedo(h,t._cloneObject(r||i),u);const m=t._cloneObject(r||i);t.$.fireEvent(u,{item:m}),t.$.fireEvent("itemChange",{item:m})}_handleKeyNavigation(e){const t=this,n=t.viewType.toLowerCase(),i=n.indexOf("timeline")>-1,r=t.$.tooltip,l=t.rightToLeft,a=e.key;let o=t.enableShadowDOM?e.composedPath()[0]:e.target;if(r.visible){const e=r.$.content instanceof HTMLElement?r.$.content.querySelector("[tabindex]"):null;e&&(e.focus({preventScroll:!0}),o=e)}if(o===t.$.timeline){const r=t.$.timelineContent,o=t.$.timelineViewAllDay,s=o.offsetHeight>0;if(!t._selectedCellObj)return t._handleCellSelection((s?o:r).querySelector(".smart-scheduler-cell:not(.scale)")),void(t._selectedCellObj&&t._scrollTo(t._selectedCellObj.to));const d=t._selectedCellObj[e.shiftKey?"to":"from"],c=t._getCellsScaleCount(),u=d.scaleIndex||0,h=c-1;let m,v,[g,f,p]=[d.horizontal,d.vertical,u],w=d.allDay;switch(a){case"Home":case"End":m=t._timelineCells[i?"horizontal":"vertical"],[v,p,w]="Home"===a?[m[0],0,!e.shiftKey&&s]:[m[m.length-1],h,!1],[g,f]=i?[v,f]:[g,v];break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{const e=["ArrowUp","ArrowDown"].indexOf(a)>-1,n=l&&"ArrowRight"===a||!l&&"ArrowLeft"===a||"ArrowUp"===a?-1:1;[m,v]=e?[t._timelineCells.vertical,f]:[t._timelineCells.horizontal,g],e&&i||!e&&!i?v=m[m.indexOf(v)+n]:(p+=n,(p<0||p>h)&&(v=m[m.indexOf(v)+n],p=p>h?0:h)),[g,f]=e?[g,v]:[v,f];break}case"PageDown":case"PageUp":{if(i||d.allDay)break;const e=d.vertical.top+t._scrollViewSize.height*("PageUp"===a?-1:1),n=t._timelineCells.vertical;f=t._timelineCells.vertical.find((t=>t.top>=e)),f||(f="PageUp"===a?n[0]:n[n.length-1]);break}}e.shiftKey||(w&&"ArrowDown"===a?(f=t._timelineCells.vertical[0],p=0,w=!1):"ArrowUp"!==a||f||(w=s));const y=t._getCellByObj({horizontal:g,vertical:f,scaleIndex:p,allDay:w});if(y){const i=t._selectedCellObj.from;t._handleCellSelection("agenda"!==n&&e.shiftKey&&!!i.allDay==!!w?i:y,y)}}else if(o===t.$.viewItemsContainer){const e=t.$.viewItemsContainer.children,n=Array.from(e).find((e=>e.hasAttribute("selected")));let i;n&&"Home"!==a?"End"===a?i=e[e.length-1]:(t.$.tooltip.contains(o)&&("ArrowUp"===a||"ArrowDown"===a)||t.$.header.contains(o)&&("ArrowLeft"===a||"ArrowRight"===a))&&(i=n["ArrowUp"===a||"ArrowLeft"===a&&!l||"ArrowRight"===a&&l?"previousElementSibling":"nextElementSibling"]):i=e[0],i&&n!==i&&t._handleViewSelection(i)}else if(o===t._list){const e=(t._list.contains(t._eventList)?t._eventList:t._contextList).children,n=Array.from(e).find((e=>e.hasAttribute("selected")));let i;n&&"Home"!==a?"End"===a?i=e[e.length-1]:"ArrowUp"!==a&&"ArrowDown"!==a||(i=n["ArrowUp"===a?"previousElementSibling":"nextElementSibling"]):i=e[0],i&&n!==i&&t._handleEventItemSelection(e,i)}}_handleEventItemSelection(e,t){const n=this;if((n._eventList||n._contextList)&&(n._list.contains(n._eventList)?n._eventList:n._contextList)){e||(e=(n._list.contains(n._eventList)?n._eventList:n._contextList).children);for(let n=0;n<e.length;n++){const i=e[n];i===t?i.setAttribute("selected",""):i.removeAttribute("selected")}}}_getCellByObj(e){const t=this;if(!e)return;if(!t._scrollTo(e))return;const n=e.allDay,i=n?t.$.timelineViewAllDay:t.$.timelineCellsContainer,r=Array.from(i.querySelectorAll(".smart-scheduler-cell:not(.scale)"));n&&delete e.vertical;const l=Object.keys(e);return r.find((t=>l.every((n=>e[n]===t.$.cellObj[n]||void 0===t.$.cellObj[n]))))}_scrollTo(e,t){const n=this,i=n._getCellsScaleCount(),r=n.viewType.toLowerCase().indexOf("timeline")>-1;let l,a,o,s,d,c,u,h;if(e instanceof HTMLElement&&e.classList.contains("smart-scheduler-event")||n._events&&n._events.indexOf(e)>-1){const t=n._scrollToEvent(e);if(!t)return;[l,a,o,s]=[t.hCell,t.vCell,t.scaleIndex,t.allDay]}else if(e instanceof Date){const t=n._getCellObjByDate(e);if(!t)return;[l,a,o,s]=[t.hCell,t.vCell,t.scaleIndex,t.allDay]}else{if(e instanceof HTMLElement&&e.$&&(e=e.$.cellObj),!e)return;l=e.horizontal||e,a=e.vertical||e,o=e.scaleIndex||0,s=e.allDay}const m=()=>{const e=n[d];t||e>h?(n[d]=h,n.isCompleted||(n.$.timelineContainer[d]=n[d],n._recycle())):e+u<h+c&&(n[d]=Math.max(0,h+c-u),n.isCompleted||(n.$.timelineContainer[d]=n[d],n._recycle()))};return l&&([d,c,u]=["scrollLeft",l.width/(r?i:1),n._scrollViewSize.width],h=l.left+c*(r?o:0),m()),a&&!s&&([d,c,u]=["scrollTop",a.height/(r?1:i),n._scrollViewSize.height],h=a.top+c*(r?0:o),m()),!0}_scrollToEvent(e){const t=this;if(!e)return;e instanceof HTMLElement&&e.classList.contains("smart-scheduler-event")&&!t.$.timeline.contains(e)&&(e=e.$?e.$.event:void 0);const n=t._events;if(!e||!n||n.indexOf(e)<0)return;const i=t._getEventHorizontallCellObjs(e),r=t._getEventVerticalCellObjs(e),l=i.start||i.first,a=r.start||r.first;let o=0;return e.allDay||(o=t._getEventScaleIndex(e,t.viewType.indexOf("timeline")>-1?l:a).start),{hCell:l,vCell:r,scaleIndex:o,allDay:e.allDay}}_getCellObjByDate(e){if(!(e instanceof Date)||!e||isNaN(e.getTime()))return;const t=this,n=t.viewType.toLowerCase(),i=t._timelineCells.horizontal,r=t._timelineCells.vertical,l=n.indexOf("month")>-1;let a,o,s,[d,c,u,h,m]=[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getDay()];if("agenda"===n){if(o=r.find((e=>{const t=e.date;return t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u})),!o)return}else if(n.indexOf("timeline")<0){if(a=i.find((e=>{const t=e.date;return l&&t.getDay()===m||t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u})),l&&(s=new Date,s.setDate(s.getDate()-s.getDay()+t.firstDayOfWeek),[d,c,u,h,m]=[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getDay()]),o=r.find((e=>{const t=e.date;return l?t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u&&t.getHours()===h:t.getHours()===h})),!a||!o)return}else if(a=i.find((e=>{const t=e.date;return t.getFullYear()===d&&t.getMonth()===c&&t.getDate()===u&&(l||t.getHours()===h)})),!a)return;return{hCell:a,vCell:o,scaleIndex:Math.floor(e.getMinutes()/60*t._getCellsScaleCount())}}_mouseWheelHandler(e){const t=this,n=e.target;t.$.viewSelectorContainer.contains(n)?t._handleViewNavigation(e):t.disabled||n.closest(".smart-scheduler-window-modal")||(e.shiftKey&&t.computedHorizontalScrollBarVisibility?t._handleHorizontalScroll(e):t.computedVerticalScrollBarVisibility&&t._handleVerticalScroll(e))}_handleCellSelection(e,t){const n=this,i=n._dragDetails?n._dragDetails.selectedCellObj:n._selectedCellObj;let r,l,a,o;i&&(r=i.from,l=i.to),n.disableSelection?n._selectCell():n._selectCell(e,t),n._selectedCellObj&&(a=n._selectedCellObj.from,o=n._selectedCellObj.to);const s={dateStart:void 0,dateEnd:void 0,group:void 0};let d,c,u,h,m,v;r&&(d=new Date(r.time),c=new Date(l.time),m=r.horizontal.group||r.vertical.group),a&&(u=new Date(a.time),v=a.horizontal.group||a.vertical.group,s.dateStart=u,s.group=v,h=new Date(o.time),s.dateEnd=h),(r&&!a||!r&&a||d&&(d.getTime()!==u.getTime()||c.getTime()!==h.getTime()||m!==v))&&n.$.fireEvent("change",s)}_selectCell(e,t){const n=this;function i(){const e=n.$.timeline.querySelectorAll(".smart-scheduler-cell[selected]");for(let t=0;t<e.length;t++)e[t].removeAttribute("selected");delete n._selectedCellObj}if(t||(t=e),!e||"agenda"===n.viewType)return void i();let r=e,l=t;if(e.closest){const t=e.closest(".smart-scheduler-cell:not(.scale)");if(!t||!n.$.timeline.contains(t))return;r=t.$?t.$.cellObj:void 0}if(t.closest){const e=t.closest(".smart-scheduler-cell:not(.scale)");if(!e||!n.$.timeline.contains(e))return;l=e.$?e.$.cellObj:void 0}if(!r||!l||n._isMobile&&Object.keys(r).some((e=>r[e]!==l[e]))||void 0===r.time||void 0===l.time)return;if(r.allDay&&!l.allDay){const e=n.$.timelineViewAllDayCellsContainer.children;for(let t=0;t<e.length;t++){const n=e[t];if(!n.$)continue;const i=n.$.cellObj;if(i.horizontal===l.horizontal){l=i;break}}}if(r.allDay!==l.allDay)return;const a=n.view,o=n.views.find((e=>e.value&&e.value===a))||{},s=o&&o.groupOrientation?o.groupOrientation:n.groupOrientation,d=(r[s]||r).group;if(d!==(l[s]||l).group)return;i();let c,[u,h]=[r.time,l.time];if("agenda"===n.viewType&&u!==h)return;let m={};if(u>h){const e=u;u=h,h=e}m.from=Object.assign({},r),m.to=Object.assign({},l),n._selectedCellObj=m;const v=(r.allDay?n.$.timelineViewAllDay:n.$.timelineContent).querySelectorAll(".smart-scheduler-cell:not(.scale)");for(let e=0;e<v.length;e++){if(c=v[e],c.removeAttribute("selected"),!c.$)continue;const t=c.$.cellObj;if((t[s]||t).group!==d)continue;const n=t.time,i=Object.keys(t);n>=u&&n<=h&&c.setAttribute("selected",r===l||i.every((e=>t[e]===r[e]))?"start":"")}n._scrollTo(l)}_isCellObjSelected(e){const t=this,n=t._selectedCellObj;if(!n||!e)return;const i=n.from,r=n.to,l=t.view,a=t.views.find((e=>e.value&&e.value===l))||{},o=a&&a.groupOrientation?a.groupOrientation:t.groupOrientation;if((i[o]||i).group!==(e[o]||e).group)return;const s=i.time,d=r.time,c=e.time;return c>=s&&c<=d||void 0}_getCellTime(e){if(!e)return 0;const t=this,n=t.viewType;let i,r;if(e instanceof HTMLElement&&e.closest(".smart-scheduler-cell:not(.scale)")){if(!e.$||!e.$.cellObj)return 0;i=e.$.cellObj}else i=e;if("agenda"===n)return i.vertical.date.getTime();if("month"===n){r=new Date(i.vertical.date);const e=new Date(i.horizontal.date).getDay()-t.firstDayOfWeek;return r.setDate(r.getDate()+(e<0?7+e:e)),r.getTime()}const l=i.scaleIndex||0,a=60/t._getCellsScaleCount()*60*1e3;return n.indexOf("timeline")<0?(r=new Date(i.horizontal.date),i.allDay||r.setHours(i.vertical.date.getHours())):r=new Date(i.horizontal.date),r.getTime()+a*l}_handleVerticalScroll(e){const t=this;if(!t.computedVerticalScrollBarVisibility)return!0;const n=t.scrollTop;0===n&&e.deltaY<0||n===t.scrollHeight&&e.deltaY>0?e.stopPropagation():(e.preventDefault(),t.scrollTo(n+t._getScrollCoefficient(e,t.offsetHeight)))}_handleHorizontalScroll(e){const t=this;if(!t.computedHorizontalScrollBarVisibility)return!0;const n=t.scrollLeft;0===n&&e.deltaY<0||n===t.scrollWidth&&e.deltaY>0?e.stopPropagation():(e.preventDefault(),t.scrollWidth>0&&t.scrollTo(void 0,t.scrollLeft+t._getScrollCoefficient(e,t.offsetWidth)))}_horizontalScrollbarHandler(e){const t=this;t.$.timelineContainer.scrollLeft=t._getScrollLeft(e.detail.value),t._recycle(e)}_verticalScrollbarHandler(e){this.$.timelineContainer.scrollTop=Math.round(e.detail.value),this._recycle(e)}_recycle(e){const t=this,n=t._timelineCells,i=t.$.tooltip;if(n.vertical&&n.horizontal){if(i.visible&&t.$.timeline.contains(i.selector)&&i.close(),!e)return t._recycleHeaderCells(t.$.timelineHeaderHorizontalContent),t._recycleHeaderCells(t.$.timelineHeaderVerticalContent),t._refreshTimelineContentCells(),t._refreshTimelineAllDayCells(),void t._refreshEvents();if("horizontal"===e.context.orientation)return t._recycleHeaderCells(t.$.timelineHeaderHorizontalContent),t._refreshTimelineContentCells(),t._refreshTimelineAllDayCells(),void t._refreshEvents();t._recycleHeaderCells(t.$.timelineHeaderVerticalContent),t._refreshTimelineContentCells(),t._refreshEvents()}}_recycleHeaderCells(e){const t=this,n=t.rightToLeft,[i,r,l,a]=e===t.$.timelineHeaderHorizontalContent?["horizontal","left","width","scrollLeft"]:["vertical","top","height","scrollTop"],o=e.querySelector(".smart-scheduler-view-time"),s=t._timelineCells[i];if(!s||!s.length)return;const d=t._getFirstCellObjInView(i),c=t._getTimelineVisibleCellsCount(i),u=o.children;for(let e=0;e<u.length;e++){const a=u[e],o=a.children;let h=document.createDocumentFragment();for(;o.length;)h.appendChild(a.firstElementChild);t._recycleContainerCells({fragment:h,cellsNeeded:c});let m=s.indexOf(d);for(let a=0;a<h.children.length;a++){const o=h.children[a],d=s[m];if(o.$={cellObj:d},!d)break;"horizontal"===i?n?(o.style.left="",o.style.right=d.left+"px"):(o.style.right="",o.style.left=d.left+"px"):o.style[r]=d[r]+"px",o.style[l]=d[l]+"px",o.innerHTML=`<div>${d.noLabel?"":t._getDateString({date:new Date(d.date),timeZone:u[e].timeZone},i)}</div>`,d.weekend?o.setAttribute("weekend",""):o.removeAttribute("weekend"),d.nonworking?o.setAttribute("nonworking",""):o.removeAttribute("nonworking"),d.separator?o.setAttribute("separator",""):o.removeAttribute("separator"),d.groupSeparator?o.setAttribute("group-separator",""):o.removeAttribute("group-separator"),d.showLabel?o.setAttribute("show-label",d.showLabel):o.removeAttribute("show-label"),d.restricted?o.setAttribute("restricted",""):o.removeAttribute("restricted"),m++}a.appendChild(h)}t._refreshHeaderDetailCells(i),t._refreshHeaderGroupCells(i),e[a]="scrollLeft"===a?t._getScrollLeft(t[a]):t[a]}_moveHandler(e){const t=this;t._isMobile||e.stopPropagation(),(t.hasAttribute("dragged")||t.hasAttribute("resized"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_getScrollLeft(e){return this.rightToLeft?e*=-1:e}_containerClickHandler(e){const t=this;if(t.readonly||t.hasAttribute("modal"))return;const n=t.$.tooltip;let i=(e||e.originalEvent).target;if(t.$.dateSelectorContainer.contains(i)){const e=i.closest(".smart-scheduler-nav");return e&&e.hasAttribute("current")&&t.disableDateMenu?void n.close():void t._handleDateSelection(e)}if(!n.contains(i)){if(i.closest(".smart-scheduler-view-items-button")){if(t.disableViewMenu)return void n.close();const e=n.visible&&!n.contains(t.$.viewItemsContainer);return t._handleTooltipContent(t.$.viewItemsButton),void(e||n.toggle())}if(i.classList.contains("smart-scheduler-legend-res-item"))t._handleLegendItemClick(i);else if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),i=(t.shadowRoot||document).elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset),t.$.timelineContent.classList.remove("hide-overlay")),!i.closest(".smart-scheduler-event")&&(n.close(),t.$.viewSelectorContainer.contains(i))){const e=i.closest(".smart-scheduler-nav");if(e)return void t._handleViewNavigation(e);const n=i.closest(".smart-scheduler-item");n===t.$.showWeekendItem?t._checkHideWekendItem(n):t._handleViewSelection(n)}}}_handleLegendItemClick(e){const t=this,n=t._legend;if(!t.filterable||!n)return;e.hasAttribute("unselected")?(e.removeAttribute("unselected"),e.setAttribute("aria-selected",!0)):(e.setAttribute("unselected",""),e.setAttribute("aria-selected",!1));const i=n.querySelectorAll(".smart-scheduler-legend-res-item[unselected]");let r=[],l={};for(let e=0;e<i.length;e++){const t=i[e],n=t.getAttribute("resource"),r=t.getAttribute("resource-id");l[n]||(l[n]=[]),l[n].push(r+"")}for(let e in l)r.push({name:e,value:t=>!l[e].includes(t+"")});t.set("filter",null),r.length&&t.set("filter",r),t._refreshTimelineEvents()}_containerContextMenuHandler(e){const t=this;let n=e.target;if(t.disableContextMenu)return;const i=e.pageX-window.pageXOffset,r=e.pageY-window.pageYOffset;if(t._isMobile&&(t.$.timelineContent.classList.add("hide-overlay"),n=(t.shadowRoot||document).elementFromPoint(i,r),t.$.timelineContent.classList.remove("hide-overlay")),t.$.timelineContent.contains(n)||t.$.timelineViewAllDayContent.contains(n)){if(e.preventDefault(),n=n.closest(".smart-scheduler-event")||n.closest(".smart-scheduler-cell"),!n||t.disableContextMenu)return;n.classList.contains("smart-scheduler-event")&&t._handleCellSelection(),t._handleTooltipContent(n,{x:e.pageX,y:e.pageY})}else t.$.tooltip.close()}_handleViewNavigation(e){const t=this;let n;if(!e)return;const i=t.$.viewItemsContainer;n=e instanceof Smart.RepeatButton?10*(e.hasAttribute("prev")?-1:1):e.deltaY,i.scrollLeft+=t._getScrollLeft(n);const r=t._viewButtons;if(!r)return;n=i.scrollLeft;const l=r.prev,a=r.next;l.disabled=!n,a.disabled=i.offsetWidth+Math.abs(n)===i.scrollWidth}_handleDateSelection(e){const t=this,n=t.$.tooltip;if(e instanceof HTMLElement)if(e.hasAttribute("prev"))n.close(),t._navigateDate(-1);else if(e.hasAttribute("current")){const e=n.visible&&!n.contains(t._calendar);t._handleTooltipContent(t.$.currentDate),e||n.toggle()}else e.hasAttribute("next")?(n.close(),t._navigateDate(1)):e.hasAttribute("today")&&(n.close(),t._navigateDate())}_navigateDate(e){const t=this,n=t.viewType.toLowerCase();let i=t.dateCurrent,r=new Date(i);if(void 0===e)r=new Date;else{if(r.setHours(0,0,0,0),n.includes("day"))r.setDate(r.getDate()+e);else if(n.includes("week")||"agenda"===n)r.setDate(r.getDate()+7*e);else{let t=new Date(r);e>0?(t.setDate(1),t.setMonth(t.getMonth()+2),t.setDate(0)):t.setDate(0),r.setMonth(r.getMonth()+e),r.getMonth()!==t.getMonth()&&(r=t)}r.setHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())}t._refreshDateNavButtons(r),r.getTime()>t.max||r.getTime()<t.min||(t.set("dateCurrent",r),i.getTime()!==r.getTime()&&t.$.fireEvent("dateChange",{oldValue:new Date(i),value:new Date(r)}),t._calendar&&(t._calendar.selectedDates=[new Date(r)],t.$.tooltip.contains(t._calendar))||(t._createTimeline(),t._scrollTo(r),t._refreshDateSelector()))}_refreshDateNavButtons(e){const t=this;e||(e=t.dateCurrent);const n=t.$.dateSelectorContainer,i=n.querySelector(".smart-scheduler-nav[prev]"),r=n.querySelector(".smart-scheduler-nav[next]");i&&(i.disabled=e.getTime()<=t.min),r&&(r.disabled=e.getTime()>=t.max)}_handleTooltipContent(e,t){const n=this,i=n.$.tooltip;if(e){if(e===n.$.currentDate){i.selector=e,i.position="auto",i.arrow=!0;let t=n._calendar;t||(t=document.createElement("smart-calendar"),t.firstDayOfWeek=n.firstDayOfWeek,t.selectionMode="oneExtended",t.selectedDates=[new Date(n.dateCurrent)],t.max=n.max,t.min=n.min,t.rightToLeft=n.rightToLeft,t.locale=n.locale,t.id=n.id+"Calendar",t.classList.add("smart-scheduler-calendar-popup"),n._calendar=t),r(t)}else if(e===n.$.viewItemsButton)i.selector=e,i.position="auto",i.arrow=!0,r(n.$.viewItemsContainer),n._handleViewSelection(),n._checkHideWekendItem();else if(e.classList.contains("smart-scheduler-event")||e.classList.contains("smart-scheduler-cell")){let l,a=n._list;if(a||(n._list=a=document.createElement("smart-scroll-viewer"),a.horizontalScrollBarVisibility="hidden"),a.theme=n.theme,a.tabIndex=n.tabIndex,a.rightToLeft=n.rightToLeft,n.inverted?a.setAttribute("inverted",""):a.removeAttribute("inverted"),l=t?n._getContextMenu(e):n._getEventList(e),!l||!l.innerHTML)return;if(n._handleEventItemSelection(),a.contains(l)){if(i.selector===e&&i.contains(a)){if(t){const e=n.getBoundingClientRect();return i.style.top=Math.min(t.y+1,e.bottom+window.pageYOffset-i.offsetHeight)+"px",i.style.left=Math.min(t.x+1,e.right+window.pageXOffset-i.offsetWidth)+"px",i.visible&&n._fireTooltipVisibilityEvent({type:"opening",detail:{owner:i.selector}})?(n._skipEventFiring=!0,i.close(),void delete n._skipEventFiring):void i.open()}return i.visible&&i.selector&&i.selector.focus({preventScroll:!0}),a.refresh(),void i.toggle()}}else a.isCompleted&&a.removeAll(),a.appendChild(l);if(i.selector=e,r(a),a.refresh(),t){const e=n.getBoundingClientRect();i.style.top=Math.min(t.y+1,e.bottom+window.pageYOffset-i.offsetHeight)+"px",i.style.left=Math.min(t.x+1,e.right+window.pageXOffset-i.offsetWidth)+"px"}if(i.visible)return n._fireTooltipVisibilityEvent({type:"opening",detail:{owner:i.selector}})?(n._skipEventFiring=!0,i.close(),void delete n._skipEventFiring):void(t||i.reposition());i.visible||i.open()}}else i.close();function r(e){e&&!i.contains(e)&&(i.clear(),i.appendChild(e))}}_getContextMenu(e){const t=this,n=t.$.tooltip;let i,r,l,a=t._contextList,o=t.contextMenuDataSource;if(e.classList.contains("smart-scheduler-event")&&!e.hasAttribute("collector")){const n=e.$?e.$.event:void 0;if(n&&n.$&&n.$.event){const e=n.$.event;r=!0,e.repeat&&e.repeat.exceptions&&(l=e.repeat.exceptions.some((e=>e===n)))}o||(o=["create","edit","delete"],t.contextMenuClipboardActions&&["copy","cut"].forEach((e=>o.push(e))))}else{if(!e.classList.contains("smart-scheduler-cell"))return void n.close();i=!0,o||(o=["create"],t.contextMenuClipboardActions&&o.push("paste"))}n.position="absolute",n.arrow=!1,a||(t._contextList=a=document.createElement("div"),a.classList.add("smart-scheduler-context-menu"),a.setAttribute("role","listbox"),a.setAttribute("aria-label","Context Menu"));const s=document.createDocumentFragment(),d=Array.from(a.children);let c=["copy","cut"];l||c.push("delete");for(let e=0;e<d.length;e++){const t=d[e];o.indexOf(t.getAttribute("value"))<0&&t.remove()}for(let n=0;n<o.length;n++){const l=o[n];let a,u,h=d[n];"object"==typeof l?(a=l.label,u=l.value):a=u=l+"",h||(h=document.createElement("div"),h.classList.add("smart-scheduler-context-menu-item"),h.setAttribute("role","option")),h.parentElement||s.appendChild(h),e.hasAttribute("restricted")?h.setAttribute("disabled",""):i&&"paste"===u?t._clipboard?h.removeAttribute("disabled"):h.setAttribute("disabled",""):r&&c.indexOf(u)>-1?h.setAttribute("disabled",""):h.removeAttribute("disabled"),h.innerHTML=t.localize(a)||a,h.setAttribute("value",u)}return a.appendChild(s),a}_getEventList(e){const t=this;if(!e.classList.contains("smart-scheduler-event")||!e.$)return;const n=e.hasAttribute("collector"),i=n?e.$.events:[e.cloneNode(!0)];let r=t._eventList;if(!i||!i.length)return void(r&&(r.innerHTML=""));const l=t.$.tooltip;l.position="auto",l.arrow=!0,r||(r=document.createElement("div"),r.classList.add("smart-scheduler-collector-event-list"),r.setAttribute("role","menu"),r.id=t.id+"EventMenu",t._eventList=r),r._target=e;const a=document.createDocumentFragment(),o=Array.from(r.children),s={isAllDayEvent:t.$.timelineViewAllDay.contains(e),isTooltipEvent:!0};for(let e=0;e<o.length;e++){const t=o[e];i.indexOf(t)<0&&t.remove()}for(let r=0;r<i.length;r++){const l=i[r];n||(l.$=e.$),s.eventObj=l.$.event,s.isAllDayEvent=s.eventObj.allDay,t._setEventCellContent(l,s),a.appendChild(i[r])}return r.appendChild(a),r}_tooltipVisibilityHandler(e){const t=this,n=e.type,i=t.$.tooltip,r=t.getRootNode().host||t.getRootNode();e.stopPropagation(),t._skipEventFiring||!t._fireTooltipVisibilityEvent(e)?(r===document||document.body.contains(r))&&("opening"===n?(i.classList.remove("smart-visibility-hidden"),t.getShadowRootOrBody().appendChild(i)):"closing"===n&&(t.hasAnimation?i.addEventListener("animationend",(()=>{i.visible||(i.classList.add("smart-visibility-hidden"),i.style.top=i.style.left=0,t.$.container.appendChild(i))}),{once:!0}):t.$.container.appendChild(i))):e.preventDefault()}_fireTooltipVisibilityEvent(e){const t=this,n=e.type,i=t.$.tooltip,r=i.contains(t._contextList),l=i.contains(t._eventList),a=e.detail.owner;let o;if("open"===n||"close"===n){r?o="contextMenu":l?o="eventMenu":i.contains(t._calendar)?o="dateMenu":i.contains(t.$.viewItemsContainer)&&(o="viewMenu");let e=(t.getAttribute("aria-owns")||"")+" "+i.id;return"open"===n?t.setAttribute("aria-owns",e.trim()):t.hasAttribute("aria-owns")&&(e=t.getAttribute("aria-owns").replace(i.id,"").trim(),e?t.setAttribute("aria-owns",e):t.removeAttribute("aria-owns")),void(o&&t.$.fireEvent(o+("open"===n?"Open":"Close"),{target:i}))}let s={target:i,owner:a,cellObj:void 0,eventObj:void 0};if(r){if(a.classList.contains("smart-scheduler-event"))s.eventObj=[t._cloneObject(a.$.event)];else{let e,n;if(t._selectedCellObj){const i=t._selectedCellObj.from,r=t._selectedCellObj.to,l=Math.min(i.time,r.time),a=Math.max(i.time,r.time);e=l===a?[new Date(l)]:[new Date(l),new Date(a)],n=i.vertical.group||i.horizontal.group}else{const t=a.$.cellObj;e=[new Date(t.time)],n=t.vertical.group||t.horizontal.group}s.cellObj={date:e,group:n}}o="opening"===n?"contextMenuOpening":"contextMenuClosing"}else l&&(o="opening"===n?"eventMenuOpening":"eventMenuClosing",a.$.events?s.eventObj=a.$.events.map((e=>t._cloneObject(e.$.event))):a.$.event&&(s.eventObj=[t._cloneObject(a.$.event)]));if(o&&t.$.fireEvent(o,s).defaultPrevented)return!0}_tooltipChangeHandler(e){const t=this,n=t._calendar;if(e.target===n)return e.stopPropagation(),t.set("dateCurrent",n.selectedDates[0]||t.dateCurrent),t._refreshDateSelector(),t._createTimeline(),void e.context.close()}_tooltipClickHandler(e){const t=this,n=t.$.tooltip,i=t.isInShadowDOM?(e||e.originalEvent).composedPath()[0]:(e||e.originalEvent).target;if(t.$.viewItemsContainer.contains(i)){const e=i.closest(".smart-scheduler-item");return e===t.$.showWeekendItem?t._checkHideWekendItem(e):t._handleViewSelection(e),void n.close()}const r=i.closest(".smart-scheduler-event");if(r)return i.closest(".smart-scheduler-event-button")?(t._deleteEventViaWindow(r.$.event),n.close(),void t.$.timeline.focus({preventScroll:!0})):void t._doubleClickHandler(i);const l=i.closest(".smart-scheduler-context-menu-item");l&&t._handleContextMenuItemClick(l)}_tooltipKeyDownHandler(e){this._keyDownHandler(e)}_tooltipKeyUpHandler(e){this._keyUpHandler(e)}_tooltipDownHandler(e){e.stopPropagation(),this._downHandler(e)}_tooltipContextMenuHandler(e){const t=e.target;t&&t.closest&&t.closest(".smart-scheduler-event")&&e.preventDefault()}_timelineFocusHandler(){const e=this;if("focusin"===event.type||"focusout"===event.type)return void e._handleEventFocus(event);if(e.readonly||e.hasAttribute("modal"))return;const t=e.$.timelineViewAllDay,n=t.offsetHeight>0;e._isMobile||e._dragDetails&&e._dragDetails.timelineCellObj||(e._selectedCellObj?e._selectedCellObj.from.time!==e._selectedCellObj.to.time&&e._handleCellSelection(e._selectedCellObj.from):e._handleCellSelection((n?t:e.$.timelineContent).querySelector(".smart-scheduler-cell:not(.scale)")))}_handleEventFocus(e){const t=e&&"focusin"===e.type?e.target:void 0,n=t&&t.$?t.$.event:void 0,i=this.$.timeline.querySelectorAll(".smart-scheduler-event");let r;for(let e=0;e<i.length;e++){const l=i[e],a=l.$.event;l===t||n&&n===a?(l.setAttribute("focus",""),r=l):l.removeAttribute("focus")}return r}_handleViewSelection(e){const t=this,n=t.$.showWeekendItem,i=t.$.viewItemsContainer.children,r=t.view;let l;if(e instanceof HTMLElement&&(l=e.$?e.$.value:null),l||(l=t.view),l===r||!t.$.fireEvent("viewChanging",{oldValue:r,value:l}).defaultPrevented){for(let t=0;t<i.length;t++){const n=i[t];n.removeAttribute("selected"),!e&&n.$&&n.$.value===l&&(e=n)}e&&e.setAttribute("selected",""),e!==n&&(l!==r&&(t.set("view",l),t._createTimeline(),t._refreshDateSelector(),t._checkHideWekendItem(),t._scrollToView(e),t.$.fireEvent("viewChange",{oldValue:r,value:l})),t.$.viewItemsButton.innerHTML=`<span>${e?e.textContent.trim():t.localize(l)||l}</span>`)}}_checkHideWekendItem(e){const t=this,n=t.viewType.toLowerCase().indexOf("day")<0,i=t.view,r=t.views.find((e=>e.value&&e.value===i))||{},l=r&&void 0!==r.hideWeekend?r.hideWeekend:void 0,a=l&&r.hideWeekend||t.hideWeekend;if(!e){if(!(e=t.$.showWeekendItem)||!e.parentElement)return;return e&&(a&&n?e.removeAttribute("checked"):e.setAttribute("checked","")),void(t.viewType.toLowerCase().indexOf("day")>-1?e.setAttribute("disabled",""):e.removeAttribute("disabled"))}if(!e||!e.parentElement||e!==t.$.showWeekendItem)return;e.hasAttribute("checked")?(e.removeAttribute("checked"),t.set("hideWeekend",!0)):(e.setAttribute("checked",""),t.set("hideWeekend",!1));const o=t.hideWeekend;void 0!==l&&(r.hideWeekend=o),a!==o&&n&&t._createTimeline()}_scrollToView(e){const t=this;if("tabs"!==t.viewSelectorType)return;const n=t.$.viewItemsContainer;if(!(e=e||n.querySelector(".smart-scheduler-item[selected]")))return;const i=n.offsetWidth,r=e.offsetLeft,l=r+e.offsetWidth;let a=n.scrollLeft;a>r?a=n.scrollLeft=r:a+i<l&&(a=n.scrollLeft=l-i);const o=t._viewButtons;o&&(o.prev.disabled=!a,o.next.disabled=Math.abs(a)+i===n.scrollWidth)}_resizeEventHandler(e){const t=this;function n(){if(t._noResizeHandler)return void delete t._noResizeHandler;t._refreshHeaderControlsVisibility();const e=t.$.tooltip;t._positionWindow(),t._createTimeline(),e.visible&&(e.contains(t._contextList)?e.close():e.reposition()),t._refreshViewSelector()}(e?t.enableShadowDOM?e.composedPath()[0]:e.target:void 0)===t&&(clearTimeout(t._resizeTimeout),t.resizeInterval?t._resizeTimeout=setTimeout(n.bind(t),t.resizeInterval):n())}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.timeline,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,n=e._scrollView.hScrollBar;n.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),t.hasStyleObserver=!1,n.hasStyleObserver=!1,t.hasResizeObserver=!1,n.hasResizeObserver=!1,n.wait=!1,t.wait=!1,e._refresh()}_setFocusable(){const e=this;if(e.disabled||e.unfocusable)return e.removeAttribute("tabindex"),e.$.timeline.removeAttribute("tabindex"),void e.$.viewItemsContainer.removeAttribute("tabindex");const t=e.tabIndex>0?e.tabIndex:0;e.tabIndex=t,e.$.tooltip.tabIndex=t,e.$.timeline.tabIndex=t,e.$.viewItemsContainer.tabIndex=t}_toHex(e){function t(e){const t=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]}return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+t(e[1])+t(e[2])+t(e[3]).toUpperCase():"#ffffff"}_setExportStyles(e,t){const n=this;if(e.style)return;const i=e.header.columns,r=window.getComputedStyle(n),l={height:r.getPropertyValue("--smart-scheduler-timeline-header-horizontal-cells-size"),border:"1px solid "+n._toHex(r.borderColor),fontFamily:"Helvetica",fontSize:r.fontSize,color:n._toHex(r.color),backgroundColor:n._toHex(r.backgroundColor),fontWeight:"400"},a={border:"1px solid "+n._toHex(r.borderColor),fontFamily:r.fontFamily,fontSize:r.fontSize},o=n._timelineCells;let s,d;o&&o.vertical&&o.horizontal&&(s=o.vertical[0]?o.vertical[0].height:void 0,d=o.horizontal[0]?o.horizontal[0].width:void 0),void 0===s&&(s=Math.max(parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-height"))||0,parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-min-height")||0))),void 0===d&&(d=Math.max(parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-width"))||0,parseFloat(r.getPropertyValue("--smart-scheduler-timeline-cell-min-width")||0))),"pdf"===t?d=100/i.length+"%":d+="px",s+="px";for(let e=0;e<i.length;e++){const t=i[e];l[t.dataField]={textAlign:"center",width:d},a[t.dataField]={textAlign:"start",format:t.dataField.indexOf("date")>-1?"f":""}}e.style={border:"1px solid "+n._toHex(r.borderColor),borderCollapse:"collapse",header:l,columns:a,rows:{height:s}}}_getExportRecord(e){const t=this,n=t._events,i=t.resources,r=n[0];let l=t.dataExport.columns,a={};if(!l||!l.length){const e=["id","label","description","dateStart","dateEnd"];l=Object.keys(r).filter((t=>e.indexOf(t)>-1)),i.forEach((e=>l.push(e.value)))}for(let r=0;r<l.length;r++){const o=l[r],s=i.find((e=>e.value===o));if(e){if(s&&e[s.value]){if(s&&s.dataSource){const t=s.dataSource.find((t=>t.id===e[s.value]));a[o]=t&&t.label||""}}else a[o]=e[o]||"";a._keyDataField=n.indexOf(e)}else a[o]=(s?s.label:t.localize(o)||o)||""}return a}_refresh(){const e=this;function t(){const t=e.$.timelineContent.offsetWidth-e.$.timelineContainer.offsetWidth;return t>0&&"hidden"!==e.horizontalScrollBarVisibility||"visible"===e.horizontalScrollBarVisibility?e.$container.addClass("hscroll"):e.$container.removeClass("hscroll"),t}function n(){const t=e.$.timelineContent.offsetHeight-e.$.timelineContainer.offsetHeight;return t>0&&"hidden"!==e.verticalScrollBarVisibility||"visible"===e.verticalScrollBarVisibility?e.$container.addClass("vscroll"):e.$container.removeClass("vscroll"),t}const i=e.scrollWidth,r=e.scrollHeight;let l=t(),a=n();a&&r===a||(l=t()),l&&i===l||(a=n()),e.scrollWidth=l,e.scrollHeight=a,e.$.horizontalScrollBar.refresh(),e.$.verticalScrollBar.refresh()}_setHeader(){const e=this,t=e.$.header,n=e.$.todayDate;if(e.headerTemplate)e._applyTemplate("headerTemplate",t);else{const n=e.$.dateSelectorContainer;t.contains(n)||(t.innerHTML="",t.appendChild(n),t.appendChild(e.$.viewSelectorContainer)),e._setLegend(t)}t.contains(n)&&(n.innerHTML=`<span>${e.localize("today")}</span>`),e._refreshDateSelector(),e._refreshViewSelector(),e._refreshHeaderControlsVisibility()}_refreshHeaderControlsVisibility(){const e=this,t=e.viewSelectorType;if("tabs"===t||"auto"===t&&!e._isMobile)return;const n=e.offsetWidth,i=e.$.todayDate,r=e.$.currentDate;n<=500?i.classList.add("smart-hidden"):i.classList.remove("smart-hidden"),n<=320?r.classList.add("smart-hidden"):r.classList.remove("smart-hidden")}_setFooter(){const e=this,t=e.$.footer;if(null===e.footerTemplate)return t.innerHTML=null,e._setLegend(t),void(t.children.length||e.$.container.removeAttribute("show-footer"));e.$.container.setAttribute("show-footer",""),e._applyTemplate("footerTemplate",t)}_setLegend(e){const t=this,n=t.$.footer,i="header"===t.legendLocation?t.$.header:n;if(e&&e!==i)return;let r=t._legend;if(!t.showLegend)return r&&(r.innerHTML="",r.remove()),void(i!==n||n.children.length||t.$.container.removeAttribute("show-footer"));r||(r=t._legend=document.createElement("div"),r.classList.add("smart-scheduler-legend"),r.setAttribute("role","presentation"));const l=t.resources,a=1===l.length,o=r.children;for(let e=0;e<l.length;e++)l[e].dataSource.length&&t._refreshLegendItems(e,a);for(;l.length<o.length;)o.lastElementChild.remove();i.contains(r)||i.appendChild(r)}_refreshLegendItems(e,t){const n=this,i=n.resources[e],r=n._legend;let l,a,o=r.children[e];o||(o=document.createElement("div"),o.classList.add("smart-scheduler-legend-item"),o.setAttribute("role","listbox")),o.setAttribute("resource",i.value+"");const s=o.children;for(let e=0;e<s.length;e++){const t=s[e];t.classList.contains("smart-scheduler-legend-res-label")?l=t:t.classList.contains("smart-scheduler-legend-res-items")&&(a=t)}l||t?l&&t&&l.remove():(l=document.createElement("label"),l.classList.add("smart-scheduler-legend-res-label"),l.id=n.id+"LegendResourceLabel"),l&&(l.textContent=i.label||"",o.setAttribute("aria-labelledby",l.id)),a||(a=document.createElement("div"),a.classList.add("smart-scheduler-legend-res-items"),a.setAttribute("role","presentation")),n._refereshLegendResItems(i,a),o.contains(a)||o.appendChild(a),t||o.contains(l)||o.insertBefore(l,a),r.contains(o)||r.appendChild(o)}_refereshLegendResItems(e,t){const n=this.filter,i=t.children,r=Math.max(this.tabIndex,0),l=e.dataSource,a=e.value;for(let e=0;e<l.length;e++){const o=l[e];let s=i[e];if(s||(s=document.createElement("div"),s.classList.add("smart-scheduler-legend-res-item"),s.setAttribute("role","option")),s.innerHTML=`<span>${o.label||""}</span>`,s.setAttribute("aria-label",o.label),s.setAttribute("resource",a+""),s.setAttribute("resource-id",o.id+""),n&&Array.isArray(n)){let e=n.find((e=>e.name===a));e&&"function"==typeof e.value&&!e.value(o.id)?s.setAttribute("unselected",""):s.removeAttribute("unselected")}else s.removeAttribute("unselected");o.disabled?(s.setAttribute("disabled",""),s.removeAttribute("tabindex"),s.removeAttribute("aria-selected")):(s.removeAttribute("disabled"),s.setAttribute("tabindex",r),s.hasAttribute("unselected")?s.setAttribute("aria-selected",!1):s.setAttribute("aria-selected",!0)),o.backgroundColor?s.style.setProperty("--smart-scheduler-legend-item-background",o.backgroundColor):s.style.removeProperty("--smart-scheduler-legend-item-background"),t.contains(s)||t.appendChild(s)}for(;l.length<i.length;)t.lastElementChild.remove()}_refreshDateSelector(){const e=this,t=e.locale,n=e.$.currentDate;if(!e.$.header.contains(n))return;let i=new Smart.Utilities.DateTime(new Date(e.dateCurrent)).toDate(e.timeZone);isNaN(i.getTime())&&(i=new Date);let r="";if(e.dateSelectorFormatFunction)r=e.dateSelectorFormatFunction(i)+"";else{const n=e.viewType.toLowerCase(),l=e.dayFormat,a=e.monthFormat,o=e.yearFormat;if(n.indexOf("day")>-1)r=new Intl.DateTimeFormat(t,{day:l}).format(i);else if(n.indexOf("week")>-1||"agenda"===n){const s=new Date(i);"agenda"!==n&&s.setDate(s.getDate()-s.getDay()+e.firstDayOfWeek);const d=new Date(s);d.setDate(d.getDate()+6),r=new Intl.DateTimeFormat(t,{day:l}).format(s),s.getMonth()!==d.getMonth()&&(r+=" "+new Intl.DateTimeFormat(t,{month:a}).format(s)),s.getFullYear()!==d.getFullYear()&&(r+=" "+new Intl.DateTimeFormat(t,{year:o}).format(s)),r+="-"+new Intl.DateTimeFormat(t,{day:l}).format(d),i=d}r+=" "+new Intl.DateTimeFormat(t,{month:a}).format(i)+" "+new Intl.DateTimeFormat(t,{year:o}).format(i)}n.innerHTML=r}_refreshViewSelector(){const e=this,t=e.views,n=e.viewSelectorType,i=e.$.viewSelectorContainer,r=e.$.viewItemsContainer,l=e.$.viewItemsButton,a=e.$.tooltip,o=a.contains(r);let s=e.$.showWeekendItem;if(!e.$.header.contains(l))return;for(i.classList.add("smart-visibility-hidden"),l.classList.add("smart-visibility-hidden"),i.classList.remove("no-overflowing"),r.remove(),s&&s.remove();t.length<r.children.length;)r.firstElementChild.remove();for(;t.length>r.children.length;){const e=document.createElement("div");e.classList.add("smart-scheduler-item"),e.setAttribute("role","option"),r.appendChild(e)}const d=r.children;for(let n=0;n<d.length;n++){const i=d[n],r=t[n];let l,a;if("string"==typeof t[n])i.innerHTML="<div>"+e.localize(l=t[n])+"</div>";else{const t=r.label;l=r.value,i.innerHTML="<div>"+("string"!=typeof t&&isNaN(t)?e.localize(l):t)+"</div>",a=r.shortcutKey}void 0===a&&(a=e.localize(l+"Shortcut")),a?i.setAttribute("shortcut-key",e.localize(a)||a):i.removeAttribute("shortcut-key"),i.$={value:l}}if(i.appendChild(r),e._viewButtons)for(let t in e._viewButtons)e._viewButtons[t].remove();const c=i.offsetWidth-r.offsetWidth<0;if("tabs"===n){let t,n;return o&&a.close(),c&&(e._viewButtons||(t=document.createElement("smart-repeat-button"),n=document.createElement("smart-repeat-button"),t.classList.add("smart-scheduler-nav"),n.classList.add("smart-scheduler-nav"),t.setAttribute("prev",""),n.setAttribute("next",""),t.setAttribute("aria-label","Previous View"),n.setAttribute("aria-label","Next View"),e._viewButtons={prev:t,next:n}),t=e._viewButtons.prev,n=e._viewButtons.next,i.classList.add("no-overflowing"),i.insertBefore(t,r),i.appendChild(n),e._scrollToView()),i.removeAttribute("show-menu"),i.classList.remove("smart-visibility-hidden"),void e._handleViewSelection()}delete e._viewButtons,"menu"===n||c?(e.hideViewMenuCheckableItems?s&&s.remove():r.contains(s)||(s||(s=e.$.showWeekendItem=document.createElement("div"),s.classList.add("smart-scheduler-item"),s.setAttribute("checkable",""),s.setAttribute("separator","")),s.innerHTML="<div>"+e.localize("showWeekends")+"</div>",e._checkHideWekendItem(),r.appendChild(s)),o?(a.clear(),a.appendChild(r)):r.remove(),i.setAttribute("show-menu",""),l.classList.remove("smart-visibility-hidden")):(i.removeAttribute("show-menu"),o&&a.close()),i.classList.remove("smart-visibility-hidden"),e._handleViewSelection()}_checkNotifications(e){const t=this,n=t._events,i=t.$.toast;if(e&&(i&&i.isCompleted&&i.items.forEach((e=>{e.classList.contains("smart-scheduler-event-notification")&&i.closeItem(e)})),delete t._notificationObj,delete t._notificationsInterval),clearInterval(t._notificationsInterval),!n)return t._removeToast(),delete t._notificationsInterval,void delete t._notificationObj;let r=t._notificationObj;if(r||(r=t._notificationObj={events:n.filter((e=>Array.isArray(e.notifications)))}),!r.events)return t._removeToast(),void delete t._notificationsInterval;t._notificationsInterval||t._refreshNotifications(),t._notificationsInterval=setInterval(t._refreshNotifications.bind(t),1e3*t.notificationInterval)}_removeToast(){const e=this,t=e.$.toast;if(t){const n=e.$toast;n.unlisten("open"),n.unlisten("close"),t.remove()}}_appendToast(){const e=this,t=e.$.toast;if(!e.$.container.contains(t)){const n=e.$toast;n.listen("open",e._toastVisibilityHandler.bind(e)),n.listen("close",e._toastVisibilityHandler.bind(e)),e.$.container.appendChild(t)}}_toastVisibilityHandler(e){const t=this.$.toast;e.target===t&&(e.stopPropagation(),this.$.fireEvent("open"===e.type?"notificationOpen":"notificationClose",e.detail))}_refreshNotifications(){const e=this,t=e._notificationObj;if(!t)return void clearInterval(e._notificationsInterval);const n=t.events;let i=new Date;if(i.setSeconds(0,0),i=i.getTime(),t.time===i)return;t.time=i;const r=e._getNotificationEvents(n,i);let l=[];for(let e=0;e<r.length;e++){const t=r[e],n=t.dateStart.getTime(),a=t.notifications;Array.isArray(a)&&a.forEach((e=>{const r=(e.interval||0)*("days"===e.type||0===e.type?1:7),a=e.time,o=new Date(n-24*r*60*60*1e3);o.setHours(a[0]%23,a[1]%60,0,0),o.getTime()===i&&l.push({dateStart:t.dateStart,label:t.label,message:e.message,iconType:e.iconType})}))}e._notifyForUpcomingEvents(l)}_getNotificationEvents(e,t){const n=this;let i=[];const r=t+24192e5,l=n._rRule,a={isMonthView:!0,hourStart:n.hourStart,hourEnd:n.hourEnd,restrictedDates:n.restrictedDates,restrictedHours:n.restrictedHours,dateStart:new Date(t),dateEnd:new Date(r),rRule:l,targetEvents:i};for(let o=0;o<e.length;o++){const s=e[o],d=s.dateStart,c=s.dateEnd;if(!d||!c)continue;const u=d.getTime(),h=c.getTime();if(s.repeat&&l){const e=n._getEventRepeatOptions(s);if(e){a.event=s,a.repeatObj=s.repeat,a.options=e,a.eventTimeStart=u,a.eventTimeEnd=h,n._setRepeatingEvents(a);continue}}else u>=t&&u<=r&&i.push(s)}return i}_notifyForUpcomingEvents(e){const t=this;if(!e.length)return;t._setToast();const n=t.$.toast;t._appendToast();const i=t.dayFormat,r=t.monthFormat,l=t.weekdayFormat,a=t.locale,o=t.hourFormat,s=t.minuteFormat,d=Smart.Utilities.DateTime,c=t.timeZone;for(let u=0;u<e.length;u++){const h=e[u],m=new d(h.dateStart).toDate(c),v=h.message?h.message:h.label+" "+t.localize("notificationMessage")+" "+new Intl.DateTimeFormat(a,{day:i,weekday:l,month:r}).format(m)+" at "+new Intl.DateTimeFormat(a,{hour:o,minute:s}).format(m);n.open(v,h.iconType)}}_setToast(){const e=this;let t=e.$.toast;t||(e.$.toast=t=document.createElement("smart-toast"),t.appendTo=e.$.timeline,t.showCloseButton=!0,t.itemClass="smart-scheduler-event-notification",e.$toast=Smart.Utilities.Extend(t)),t.rightToLeft=e.rightToLeft,t.theme=e.theme,t.animation=e.animation}_createEvents(e,t){const n=this;let i=void 0!==e;if(i||(e=n.dataSource,n._clearEvents()),n.dataSource instanceof Smart.DataAdapter&&(e="ics"===n.dataSource.dataSourceType?n.dataSource.dataSource:n.dataSource.toArray()),!Array.isArray(e)||!e.length)return;const r=n.viewType;let l=[];for(let i=0;i<e.length;i++){const a=e[i];if(!a)continue;let o,s,d=a.allDay;if("string"==typeof d&&(d="true"===d),d=!!d,o=n._dateValidator(void 0,a.dateStart),s=n._dateValidator(void 0,a.dateEnd),!o||!o.getTime())continue;switch(s&&s.getTime()||(s=new Date(o),s.setHours(s.getHours(),s.getMinutes()+60/n._getCellsScaleCount(),0,0)),s=new Date(Math.max(o.getTime(),s.getTime())),r){case"week":case"day":case"timelineWeek":case"timelineDay":d?s.setHours(23,59,59,999):o.getTime()===s.getTime()&&(s=new Date(s.getTime()+60/n._getCellsScaleCount()*60*1e3));break;default:d&&0===s.getHours()&&0===s.getMinutes()&&0===s.getSeconds()&&0===s.getMilliseconds()&&(s=new Date(s.getTime()-1))}const c=Object.assign({},a,{dateStart:o,dateEnd:s,allDay:d,label:a.label||""});let u=c.repeat;if(u){u=c.repeat=Object.assign({},u);const e=["hourly","daily","weekly","monthly","yearly"];for(let t in u)if("repeatFreq"===t&&e.indexOf(u[t])<0)u[t]=e[0];else if("repeatInterval"===t)u[t]=isNaN(u[t])?1:u[t];else if("exceptions"===t){let e=u[t];e=Array.isArray(e)?e.slice():[e];for(let t=0;t<e.length;t++){let i=e[t];void 0===i.date?i={date:n._parseDate(i)}:(i=Object.assign({},i),i.date?i.date instanceof Date||(i.date=n._parseDate(i.date)):i.date=new Date(i.dateStart)),i.dateStart?i.dateStart instanceof Date||(i.dateStart=n._parseDate(i.dateStart)):i.dateStart=new Date(i.date),i.dateEnd?i.dateEnd instanceof Date||(i.dateEnd=n._parseDate(i.dateEnd)):i.dateEnd=new Date(i.dateStart.getTime()+c.dateEnd.getTime()-c.dateStart.getTime()),delete i.$,e[t]=i}e&&(u[t]=e)}}n._containsEvent(c)||(n._setEventTimeZone(c,t),l.push(c))}if(i)return l;n._removeToast(),delete n._notificationsInterval,delete n._notificationObj,n._events=l}_setEventTimeZone(e,t="local"){const n=(new(0,Smart.Utilities.DateTime)).timeZones,i=this.timeZone.toLowerCase(),r=(t||this.timeZone).toLowerCase();if(!e||!e.dateStart||!e.dateEnd)return;if(t&&i===r)return;const l=n.find((e=>e.id.toLowerCase()===i));if(!l)return;let a=n.find((e=>e.id.toLowerCase()===r)),o=new Date(e.dateStart),s=new Date(e.dateEnd);const d=n.find((e=>"local"===e.id.toLowerCase()));a||(a=d);const c=d.offset,u=60*(-1*o.getTimezoneOffset()-d.offset)*1e3,h=60*(-1*s.getTimezoneOffset()-d.offset)*1e3,m=60*a.offset*1e3,v=60*l.offset*1e3;if(e.allDay||(e.dateStart=new Date(o.getTime()-u-m+v),e.dateEnd=new Date(s.getTime()-h-m+v)),e.repeat&&e.repeat.exceptions){const t=e.repeat.exceptions;for(let e=0;e<t.length;e++){const n=t[e];if(n.allDay)continue;const i=60*(-1*n.date.getTimezoneOffset()-c)*1e3,r=60*(-1*n.dateStart.getTimezoneOffset()-c)*1e3,l=60*(-1*n.dateEnd.getTimezoneOffset()-c)*1e3;n.date=new Date(n.date.getTime()-i-m+v),n.dateStart=new Date(n.dateStart.getTime()-r-m+v),n.dateEnd=new Date(n.dateEnd.getTime()-l-m+v)}}}_clearEvents(){const e=this;e._events=[],e._eventList&&(e._eventList.innerHTML=null),e.$.timelineEventsContainer.innerHTML="",e.$.allDayEventsContainer.innerHTML="",delete e._eventsBetween,e.rendered&&e._refreshTimelineEvents()}_refreshEvents(){const e=this,t=e._events,n=e.$.timelineEventsContainer,i=e.$.allDayEventsContainer,r=e._timelineCells;if(!(t&&r.horizontal&&r.horizontal.length&&r.vertical&&r.vertical.length))return n.innerHTML="",i.innerHTML="",void delete e._eventsBetween;let l=e._eventsBetween?e._eventsBetween.eventCellDetails:void 0,a=[],o={};const s=e.view,d=e.views.find((e=>e.value&&e.value===s))||{},c=d?parseFloat(d.maxEventsPerCell):NaN;if(isNaN(c)?null!==e.maxEventsPerCell&&(o.maxEventsPerCell=e.maxEventsPerCell):o.maxEventsPerCell=c,l){const t=l.eventGroups,n=l.cellRanges,i=l.allDayEventGroups,r=l.allDayEventCellRanges;for(let i=0;i<t.length;i++)o.events=t[i],o.eventCells=n[i],a=a.concat(e._createTimelineEvents(o));for(let t=0;t<i.length;t++)o.events=i[t],o.eventCells=r[t],o.isAllDay=!0,a=a.concat(e._createTimelineEvents(o))}else a=e._createViewEvents();if(e.hasAttribute("resized"))return;const u=Array.from(n.children).concat(Array.from(i.children)),h=e._eventList;for(let e=0;e<u.length;e++){const t=u[e];a.indexOf(t)<0&&(t.remove(),h&&h._target===t&&(h.innerHTML="",delete h._target))}e._handleEventCut()}_createViewEvents(){const e=this,t=e._events,n=e._timelineCells.groups,i=e._getViewEvents();let r=[];const l=e.$.timeline.querySelectorAll(".smart-scheduler-event[collector]");for(let e=0;e<l.length;e++)l[e].$&&(l[e].$.events=l[e].$.events.reduce(((e,n)=>(t.indexOf(n)>-1&&e.push(n),e)),[]));return r=n&&n.length>0?e._createGroupedEvents(i,n):e._createNonGroupedEvents(i),r}_createNonGroupedEvents(e){const t=this;let n=[],i={};const r={eventGroups:[],cellRanges:[],allDayEventGroups:[],allDayEventCellRanges:[]},l=t.view,a=t.views.find((e=>e.value&&e.value===l))||{},o=a?parseFloat(a.maxEventsPerCell):NaN;isNaN(o)?null!==t.maxEventsPerCell&&(i.maxEventsPerCell=t.maxEventsPerCell):i.maxEventsPerCell=o;const s=t._getTimelineEventCells(e,[]),d=t._separateAllDayEvents(e,s);return d.events.length&&(i.events=d.events,i.eventCells=d.eventCells,r.eventGroups.push(d.events),r.cellRanges.push(d.eventCells),n=n.concat(t._createTimelineEvents(i))),d.allDayEvents.length&&(i.events=d.allDayEvents,i.eventCells=d.allDayEventCells,i.isAllDay=!0,r.allDayEventGroups.push(d.allDayEvents),r.allDayEventCellRanges.push(d.allDayEventCells),n=n.concat(t._createTimelineEvents(i))),t._eventsBetween.eventCellDetails=r,n}_createGroupedEvents(e,t){const n=this;let i=[],r={};const l=n.view,a=n.views.find((e=>e.value&&e.value===l))||{},o=a?parseFloat(a.maxEventsPerCell):NaN;isNaN(o)?null!==n.maxEventsPerCell&&(r.maxEventsPerCell=n.maxEventsPerCell):r.maxEventsPerCell=o;const s={eventGroups:[],cellRanges:[],allDayEventGroups:[],allDayEventCellRanges:[]};let d=[];const c=t[t.length-1].cells;let u={events:[],eventCells:[]};for(let t=0;t<c.length;t++){const l=e.filter((e=>n._isEventPartOfGroup(e,c[t]))),a=n._getTimelineEventCells(l,d),o=n._separateAllDayEvents(l,a);u.events=u.events.concat(o.allDayEvents),u.eventCells=u.eventCells.concat(o.allDayEventCells),o.events.length&&(r.events=o.events,r.eventCells=o.eventCells,s.eventGroups.push(o.events),s.cellRanges.push(o.eventCells),i=i.concat(n._createTimelineEvents(r)))}const h=u.events.slice();n._sortEventCellObjs(u.events,["day","week"].indexOf(n.viewType)>-1),u.eventCells=u.events.map((e=>u.eventCells[h.indexOf(e)]));for(let e=0;e<u.events.length;e++)r.events=u.events,r.eventCells=u.eventCells,r.isAllDay=!0,s.allDayEventGroups.push(u.events),s.allDayEventCellRanges.push(u.eventCells),i=i.concat(n._createTimelineEvents(r));return n._eventsBetween.eventCellDetails=s,i}_separateAllDayEvents(e,t){let[n,i,r,l]=[[],[],[],[]];if(["day","week"].indexOf(this.viewType)<0)r=e,l=t;else for(let a=0;a<e.length;a++){const o=e[a];o.allDay||o.dateEnd.getTime()-o.dateStart.getTime()>=864e5?(n.push(o),i.push(t[a])):(r.push(o),l.push(t[a]))}return{allDayEvents:n,allDayEventCells:i,events:r,eventCells:l}}_getViewEvents(){const e=this,t=e.viewType.toLowerCase(),n=e.dateCurrent,i=e.firstDayOfWeek;let r=new Date(n),l=new Date(n);if("agenda"===t)r.setHours(0,0,0,0),l.setDate(l.getDate()+6),l.setHours(23,59,59,999);else if(t.indexOf("month")>-1){r.setDate(1),r.setDate(r.getDate()-(r.getDay()-i+7)%7),r.setHours(0,0,0,0),l=new Date(r);for(let e=0;e<5;e++)l.setDate(l.getDate()+7);l.setDate(l.getDate()+6),l.setHours(23,59,59,999)}else t.indexOf("week")>-1?(r.setDate(r.getDate()-r.getDay()+i),l.setDate(r.getDate()+6),r.setHours(0,0,0,0),l.setHours(23,59,59,999)):t.indexOf("day")>-1&&(r.setHours(0,0,0,0),l.setHours(23,59,59,999));return e._getEventsBetween(r,l)}_refreshTimelineEvents(){const e=this;delete e._eventsBetween,"agenda"===e.viewType?e._createTimeline():(e._refreshEvents(),e._checkNotifications(!0))}_getTimelineEventCells(e,t){const n=this,i=["day","week"].indexOf(n.viewType)>-1,r=n.hideAllDay;let l=[];for(let a=0;a<e.length;a++){const o=e[a];let s,d=[];i&&(o.allDay||o.dateEnd.getTime()-o.dateStart.getTime()>=864e5)&&(s=!0),o.hidden||s&&r?l.push(d):(d=n._getEventTimelineCells(o,t,s),l.push(n._getEventTimelineCellRanges(d,s)))}return l}_createTimelineEvents(e){const t=this,n=e.events,i=e.eventCells,r=e.isAllDay,l=t.viewType,a=t.eventRenderMode,o=e.maxEventsPerCell,s="classic"===a?"month"===l?t._monthViewNumberSize:0:t._eventCollectorSize,d=["day","week"].indexOf(l)>-1,c=t._getCellSize(),u=c[d?"width":"height"]-s,h=void 0!==o?u/o:Math.min(u,t._eventSize);let m={events:n,eventCells:i,viewType:l,isAllDayEvent:r,isMobile:t.$.timeline.hasAttribute("mobile"),isDayOrWeekView:d,rightToLeft:t.rightToLeft,eventRenderMode:a,eventSize:h,collectorSize:s,usedEventCells:[],eventIndexes:[],maxEventsPerCell:o};return r?(m.cellSize={height:t._allDayCellSize,width:c.width},m.spaceAvailable=t._allDayCellSize-s,m.currentEvents=t.$.allDayEventsContainer.children,void 0!==o&&(m.eventSize=m.spaceAvailable/o),t._setVerticalTimelineEvents(m)):(m.cellSize=c,m.spaceAvailable=u,m.currentEvents=t.$.timelineEventsContainer.children,d?t._setHorizontalTimelineEvents(m):t._setVerticalTimelineEvents(m)),m.usedEventCells}_setHorizontalTimelineEvents(e){const t=this,n=e.events,i=e.eventCells,r=e.eventRenderMode;if("modern"===r&&e.isMobile)return t._setAgendaOrMobileEvents(e);const l=e.eventIndexes,a=e.spaceAvailable,o="classic"===r?1:void 0!==e.maxEventsPerCell?e.eventSize:t._eventSize,[s,d]=[t.scrollTop,t.scrollLeft],[c,u]=[s+t._scrollViewSize.height,d+t._scrollViewSize.width],h=t._getEventsCollisionIndexes(e),m=h.eventOverlaps,v=h.eventCollisionsCount;for(let h=0;h<n.length;h++){const g=i[h],f=n[h];let p=v[h];for(let i=0;i<g.length;i++){const w=g[i],y=w[0];if(!y)continue;const _=w[w.length-1],[b,C]=[y.vertical,_.vertical],[D,E]=[y.horizontal,_.horizontal];if(C.top+C.height<s||b.top>c||E.left+E.width<d||D.left>u)continue;const T=l[h],S=m.filter((e=>e.indexOf(f)>-1));for(let e=0;e<S.length;e++){const t=S[e].reduce(((e,t)=>Math.max(e,v[n.indexOf(t)]||1)),1);p=Math.max(p,t)}"modern"===r&&(p=Math.min(Math.floor(a/o),p));let O=1;for(let e=T+1;e<p&&S.every((t=>t.map((e=>l[n.indexOf(e)])).indexOf(e)<0));e++)O++;e.eventObj=f,e.cellEventsCount=p,e.cellRange=w,e.eventIndex=T,e.eventSize=a/p*O,"modern"===r&&(T+1)*o>a?t._addEventToCollector(e):t._setEventCell(e)}}return e.usedEventCells}_getAllEventCollisions(e,t,n){const i=this;n||(n=t);for(let r=0;r<n.length;r++){let l=e.filter((e=>n[r].some((t=>e.indexOf(t)>-1))&&t.indexOf(e)<0));l.length&&(t=i._getAllEventCollisions(e,t.concat(l),l))}return t}_getEventsCollisionIndexes(e){const t=this,n=e.events,i=e.eventCells,r=e.eventIndexes;let l=[],a=[],o=0;for(let s=0;s<n.length;s++){const d=n[s];if(!i[s].length)continue;e.eventObj=d;const c=t._getEventsInCollision(e);let u=l.filter((e=>c.some((t=>e.indexOf(t)>-1))));if(a[s]=c.length,u.length){o!==a[s]&&(u=t._getAllEventCollisions(l,u)),u.sort(((e,t)=>t.length-e.length));let e=Math.max(c.length,u[0].length);u.forEach((t=>t.forEach((t=>{const i=n.indexOf(t);a[i]=Math.max(a[i]||0,e)}))))}o=Math.max(o,a[s]),l[s]=c,r[s]=c.indexOf(d)}return{eventOverlaps:l,eventCollisionsCount:a}}_getEventsInCollision(e){const t=this,n=t._getEventCellDetails(e),i=n.eventCellStartTime,r=n.eventCellEndTime,l=n.hCellGroup,a=n.vCellGroup,o=e.isDayOrWeekView&&void 0!==a?void 0:a||l;let s=e.events,d=[],c=[];for(let e=0;e<s.length;e++){const n=s[e];if(o&&!t._isEventPartOfGroup(n,o))continue;const l=n.dateStart.getTime(),a=n.dateEnd.getTime();l>=i&&l<=r?d.push(n):a>i&&l<r&&c.push(n)}return!d.length&&c.length&&(d=c,c=[]),t._sortEventCellObjs(d,e.isDayOrWeekView),t._getOrderedEventCollision(e,d,c)}_sortEventCellObjs(e,t){t?e.sort(((e,t)=>{const n=e instanceof HTMLElement?e.$.event:e,i=t instanceof HTMLElement?t.$.event:t,r=n.dateStart.getTime(),l=i.dateStart.getTime();return r===l?i.dateEnd.getTime()-n.dateEnd.getTime():r-l})):e.sort(((e,t)=>{const n=e instanceof HTMLElement?e.$.event:e,i=t instanceof HTMLElement?t.$.event:t;n.dateStart.getTime(),i.dateStart.getTime()}))}_getOrderedEventCollision(e,t,n){const i=e.events,r=e.eventIndexes,l=Math.max(e.eventsInCollision||1,t.length+n.length);let a=[];if(n.length){const e=n.map((e=>r[i.indexOf(e)]));for(let i=0;i<l;i++){const r=n[e.indexOf(i)];if(r)a.push(r);else{const e=t.find((e=>a.indexOf(e)<0));e&&a.push(e)}}n.forEach((e=>a.indexOf(e)<0?a.push(e):null))}else a=t;return a}_getEventCellDetails(e){const t=this,n=t.viewType;if("month"===n)return t._getMonthEventCellDetails(e);const i=e.eventObj,r=i.dateStart,l=i.dateEnd,a=t._getEventHorizontallCellObjs(i),o=t._getEventVerticalCellObjs(i),s=o.start||o.first,d=s.group;let c,u,h,m=a.start,v=0;if(m||(m=a.first),u=m.group,c=m.date,e.isAllDayEvent)c>r.getTime()&&(c=new Date(r),c.setHours(c.getHours(),0,0,0)),h=new Date(c),h.setHours(23,59,59,999),c=c.getTime(),h=h.getTime();else{let e=t._getCellsScaleCount();v=t._getEventScaleIndex(i,n.indexOf("timeline")>-1?m:s).start,c=t._getCellTime({horizontal:m,vertical:s,scaleIndex:v}),c>r.getTime()?(c=new Date(r),c.setHours(c.getHours(),0,0,0),c=c.getTime(),e=1):c<r.getTime()&&(c=new Date(c),c.setMinutes(r.getMinutes()),c=c.getTime()),h=c+60*("timelineMonth"===n?1440:60/e)*1e3-1,h>l.getTime()&&(h=new Date(h),h.setMinutes(l.getMinutes()),h=h.getTime())}return{eventCellStartTime:c,eventCellEndTime:h,hCellGroup:u,vCellGroup:d}}_getMonthEventCellDetails(e){const t=this,n=e.eventObj,i=n.dateStart,r=n.dateEnd,l=t._getEventVerticalCellObjs(n);let a,o,s,d,c,u=l.start||l.first;u=l.start,d=u.group;const h=new Date(u.date),m=new Date(u.date),v=Object.assign({},n);m.setDate(m.getDate()+6),m.setHours(23,59,59,999),h.setHours(0,0,0,0),v.dateStart=new Date(Math.max(i.getTime(),h.getTime())),v.dateEnd=new Date(Math.min(r.getTime(),m.getTime()));const g=t._getEventHorizontallCellObjs(v);return a=g.start,a||(a=g.first),s=a.group,o=a.date,o=t._getCellTime({horizontal:a,vertical:u,scaleIndex:0}),o>i.getTime()&&(o=new Date(i),o=o.getTime()),c=o+864e5-1,c>r.getTime()&&(c=new Date(c),c.setMinutes(r.getMinutes()),c=c.getTime()),{eventCellStartTime:o,eventCellEndTime:c,hCellGroup:s,vCellGroup:d}}_getEventScaleIndex(e,t){const n=this,i=n._getCellsScaleCount(),r=60/i,l=e.dateStart,a=e.dateEnd;let o,s,d,c,u=0,h=r;if(t){const e=t.date;let r=new Date(e),u=new Date(e);n.viewType.indexOf("timeline")<0&&(r=new Date(l),u=new Date(a),r.setHours(e.getHours(),e.getMinutes(),0,0),u.setHours(e.getHours(),e.getMinutes(),0,0)),r=r.getTime(),u=r+36e5,l.getTime()<=r&&(d=!0,o=0),a.getTime()>=u&&(c=!0,s=i-1)}if(void 0===o||void 0===s){const e=l.getMinutes(),t=a.getMinutes();for(let n=0;n<i;n++)!d&&u<=e&&h>=e&&(o=n),!c&&u<t&&h>=t&&(s=n),u+=r,h+=r}return{start:o||0,end:s||0}}_getEventVisibleDateRange(e){const t=this,n=e.dateStart,i=e.dateEnd;if(t.viewType.toLowerCase().indexOf("day")>-1)return{dateStart:n,dateEnd:i};const r=t.view,l=t.views.find((e=>e.value&&e.value===r))||{};let a,o,s=new Date(n),d=new Date(i),c=[];if(0===d.getHours()&&0===d.getMinutes()&&0===d.getSeconds()&&(d.setDate(d.getDate()-1),d.setHours(23,59,59,999)),(t.hideNonworkingWeekdays||l.hideNonworkingWeekdays)&&(t.nonworkingDays||l.nonworkingDays).forEach((e=>c.push(e))),(t.hideWeekend||l.hideWeekend)&&[0,6].forEach((e=>c.push(e))),![0,1,2,3,4,5,6].every((e=>c.indexOf(e)>-1))){for(;c.indexOf(s.getDay())>-1;)s.setDate(s.getDate()+1),a=!0;for(;c.indexOf(d.getDay())>-1;)d.setDate(d.getDate()-1),o=!0;return s.getTime()<=d.getTime()?{dateStart:a?s:n,dateEnd:o?d:i}:void 0}}_getEventHorizontallCellObjs(e){const t=this,n=t.hourStart,i=t.hourEnd,r=t._getEventVisibleDateRange(e);if(!r)return;const l=r.dateStart,a=r.dateEnd,o=l.getHours(),s=a.getHours(),d=l.getMinutes()+l.getSeconds()+l.getMilliseconds()===0,c=a.getMinutes()+a.getSeconds()+a.getMilliseconds()===0,u=a.getTime()>l.getTime()&&c,h=t.viewType,m=l.getFullYear()===a.getFullYear()&&l.getMonth()===a.getMonth()&&l.getDate()===a.getDate();return t._getEventCellObjs(e,(function(r,v){let g;arguments.length?(g=!0,v||(v=r)):(r=l,v=a);let f=new Date(r),p=new Date(v);switch(h){case"agenda":f=l,p=a;break;case"day":case"week":case"timelineMonth":if(g)f.setHours(0,0,0,0),p.setHours(23,59,59,999);else{if(e.allDay||"day"!==h)p=new Date(a);else{const e=new Date(l);e.setHours(23,59,59,999),p=new Date(Math.min(a.getTime(),e.getTime()))}p.setHours(p.getHours(),p.getMinutes(),0,0),u&&(p=new Date(p.getTime()-1),p.setHours(p.getHours(),59,59,999))}break;case"timelineDay":case"timelineWeek":if(g){const e=r.getHours(),t=v.getHours();m&&(o<n&&(s<n||s===n&&c)||(o>i||o===n&&d)&&s>i)?(f.setHours(e,0,0,0),p.setHours(t,59,59,999)):(f.setHours(e===n&&o<n?o:e,0,0,0),p.setHours(t===i&&s>i?s:t,59,59,999))}else if(u&&(p=new Date(p.getTime()-1),p.setHours(p.getHours(),59,59,999)),!m){if(o>i){f.setHours(0),f.setDate(f.getDate()+1),f.setHours(n);const e=t._getEventVisibleDateRange({dateStart:f,dateEnd:p});f=e&&e.dateStart.getTime()<p.getTime()?e.dateStart:new Date(r)}if(s<n||s===n&&c){p.setHours(0),p.setDate(p.getDate()-1),p.setHours(i);const e=t._getEventVisibleDateRange({dateStart:f,dateEnd:p});p=e&&e.dateEnd.getTime()>f.getTime()?e.dateEnd:new Date(v)}s>i&&p.setHours(i)}break;case"month":return!g&&u&&(p=new Date(a.getTime()-1),p.setHours(p.getHours(),59,59,999)),{start:f.getDay(),end:p.getDay()}}return f=f.getTime(),p=p.getTime(),{start:f,end:p}}),"horizontal")}_getEventVerticalCellObjs(e){const t=this,n=t.hourStart,i=t.hourEnd,r=t._getEventVisibleDateRange(e);if(!r)return;const l=r.dateStart,a=r.dateEnd,o=l.getHours(),s=a.getHours(),d=a.getTime()>l.getTime()&&a.getMinutes()+a.getSeconds()+a.getMilliseconds()===0,c=t.viewType;return t._getEventCellObjs(e,(function(e,t){let r;arguments.length?(r=!0,t||(t=e)):(e=l,t=a);let u=new Date(e),h=new Date(t);switch(c){case"day":case"week":if(u=new Date(l),h=new Date(a),r){h=new Date(u);const r=e.getHours(),l=t.getHours();s<=n&&o<=n||o>=i&&s>=i?(u.setHours(r,0,0,0),h.setHours(l,59,59,999)):(u.setHours(r===n&&o<n?o:r,0,0,0),h.setHours(l===i&&s>i?s:l,59,59,999))}else u.setHours(u.getHours(),u.getMinutes(),0,0),h.setHours(h.getHours(),h.getMinutes(),0,0),d&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999));break;case"agenda":r&&(u.setHours(0,0,0,0),h.setHours(23,59,59,999));break;case"month":r?(u.setHours(0,0,0,0),h=new Date(e),h.setDate(h.getDate()+6),h.setHours(23,59,59,999)):d&&(h=new Date(h.getTime()-1),h.setHours(h.getHours(),59,59,999));break;case"timelineDay":case"timelineWeek":case"timelineMonth":return{start:0,end:0}}return u=u.getTime(),h=h.getTime(),{start:u,end:h}}),"vertical")}_getEventCellObjs(e,t,n="horizontal"){const i=this,r=i._timelineCells;if(!r||!r[n])return;const l=r[n],a=t(),o=a.start,s=a.end;let d,c,u,h,m,v;for(let n=0;n<l.length;n++){const r=l[n],a=r.date,g=r.group;if(g&&!i._isEventPartOfGroup(e,g))continue;const f=t(a,a),p=f.start,w=f.end;!d&&o>=p&&o<=w&&(d=r),s>=p&&s<=w&&(c=r),u||(u=r,m=p),h=r,v=p}return!d&&o<=m&&s>m&&(d=u),!c&&d&&(c=s>=m&&s<=v?d:h),{start:d,end:c,first:u,last:h}}_setVerticalTimelineEvents(e){const t=this,n=e.events,i=e.eventCells,r=e.eventRenderMode;if("agenda"===e.viewType||"modern"===r&&e.isMobile)return t._setAgendaOrMobileEvents(e);const l=e.isAllDayEvent,a=e.spaceAvailable,o=e.eventSize,s=Math.floor(a/o),d=e.eventIndexes,[c,u]=[t.scrollTop,t.scrollLeft],[h,m]=[c+t._scrollViewSize.height,u+t._scrollViewSize.width];let v,g;if("classic"===r){const n=t._getEventsCollisionIndexes(e,"vertical");v=n.eventOverlaps,g=n.eventCollisionsCount}for(let f=0;f<n.length;f++){const p=i[f],w=n[f];e.eventObj=w;for(let i=0;i<p.length;i++){const y=p[i],_=y[0];if(!_)continue;e.cellRange=y;let b=d[f];if(void 0===b){const n=t._getEventsInCollision(e);e.cellEventsCount=n.length,d[f]=n.indexOf(w)}if(!l){const e=y[y.length-1],[t,n]=[_.vertical,e.vertical],[i,r]=[_.horizontal,e.horizontal];if(n.top+n.height<c||t.top>h||r.left+r.width<u||i.left>m)continue}if(e.eventIndex=b=d[f],"modern"===r&&(b+1)*o>a)t._addEventToCollector(e);else{if("classic"===r){const t=v.filter((e=>e.indexOf(w)>-1)),i=v[f].reduce(((e,t)=>Math.max(e,g[n.indexOf(t)]||1)),1);let r=1;for(let e=b+1;e<i&&t.every((t=>t.map((e=>d[n.indexOf(e)])).indexOf(e)<0));e++)r++;e.isMaxSizeReached=i>s,e.cellEventsCount=i,e.eventSize=Math.min(o,a/i*r)}t._setEventCell(e)}}}}_setAgendaOrMobileEvents(e){const t=this,n=e.events,i=e.isAllDayEvent,r=e.eventCells,l="agenda"===e.viewType;let a,o,s,d;i||([a,o]=[t.scrollTop,t.scrollLeft],[s,d]=[a+t._scrollViewSize.height,o+t._scrollViewSize.width]);for(let c=0;c<n.length;c++){const u=r[c],h=n[c];e.eventObj=h,u.forEach((n=>{if(n[0])if(e.cellRange=n,i)l?t._setEventCell(e):t._addEventToCollector(e);else{const i=n[0],r=n[n.length-1],[c,u]=[i.vertical,r.vertical],[h,m]=[i.horizontal,r.horizontal];u.top+u.height>=a&&c.top<=s&&m.left+m.width>=o&&h.left<=d&&(l?t._setEventCell(e):t._addEventToCollector(e))}}))}return e.usedEventCells}_addEventToCollector(e){const t=this,n=e.viewType,i=n.indexOf("timeline")>-1,r=e.eventObj,l=e.cellRange,a=e.usedEventCells,o=t.$.allDayEventsContainer,s=e.isAllDayEvent,d=e.isDayOrWeekView,c="month"===n,u=s?o:t.$.timelineEventsContainer,h=t._getCellsScaleCount(),m=t._setEventCell(e,!0),v=l.length,g=t.hasAttribute("tabindex")?t.tabIndex:void 0;let f=document.createDocumentFragment(),p={tabIndex:g};e:for(let n=0;n<v;n++){const o=l[n],u=o.scaleIndex,g=o.vertical.group||o.horizontal.group;let w;w=s?1:1===v?t._getEventScaleIndex(r,i?o.horizontal:o.vertical).end+1:n===v-1?u+1:h;for(let i=0===n&&u||0;i<w;i++){o.scaleIndex=i;const n=t._getCellTime(o);let l=t._findCollector(e,n,g);if(l){const e=l.$.events;e.map((e=>e.$.event)).indexOf(r)<0&&(e.push(m),t._sortEventCellObjs(e,d))}else l=document.createElement("div"),l.classList.add("smart-scheduler-event"),l.setAttribute("collector",""),l.setAttribute("role","menuitem"),l.setAttribute("aria-haspopup",!0),l.$={group:g,cellTime:n,collector:!0,events:[m]},f.appendChild(l);if(c&&1===new Date(n).getDate()?l.setAttribute("first-month-day",""):l.removeAttribute("first-month-day"),p.eventCollector=l,p.cellObj=o,t._setEventCollectorStyles(e,p),t._setEventCellContent(l,e),a.indexOf(l)<0&&a.push(l),d&&!s)break e}o.scaleIndex=u}f.children.length&&u.appendChild(f)}_findCollector(e,t,n){const i=this;if(!e)return;const r=e.currentEvents;for(let e=0;e<r.length;e++){const l=r[e];if(l.$.events&&l.$.cellTime===t&&(!n||i._isEventPartOfGroup(l.$.group,n)))return l}}_setEventCollectorStyles(e,t){const n=this,i=e.cellSize,r=e.eventRenderMode,l=t.eventCollector,a=t.cellObj,o=t.tabIndex,s=e.isMobile,d=e.rightToLeft?"right":"left",c=e.isAllDayEvent,u=e.isDayOrWeekView,h=n._getCellOffset(a);let m=e.collectorSize;l.style[e.rightToLeft?"left":"right"]="","modern"===r&&s?(m=Math.min(i.width,i.height),l.style.width=l.style.height=m+"px",l.style[d]=h.left+(i.width-m)/2+"px",l.style.top=h.top+(i.height-m)/2+"px"):(l.style.top=h.top+"px",l.style.height=n._eventCollectorSize+"px",u&&!c?(l.style[d]=h.left+i.width-m+"px",l.style.width=m+"px"):(l.style[d]=h.left+"px",l.style.width=Math.max(0,i.width)+"px")),void 0!==o?l.tabIndex=o:l.removeAttribute("tabindex")}_removeEventFromCollector(e){const t=this,n=e.eventObj,i=e.cellRange;let r;for(let l=0;l<i.length;l++){const a=i[l],o=a.vertical.group||a.horizontal.group,s=t._getCellTime(a),d=t._findCollector(e,s,o);if(d){const i=d.$.events,l=i.map((e=>e.$.event)).indexOf(n);l>-1&&(r=i.splice(l,1)[0]),i.length?t._setEventCellContent(d,e):d.remove()}}return r}_findEventElement(e,t,n){if(!e)return;const i=e.currentEvents;for(let e=0;e<i.length;e++){const r=i[e];if(r.$.event===n&&r.$.cellTime===t)return r}}_setEventCell(e,t){const n=this,i=e.viewType,r=e.eventObj,l=e.usedEventCells,a=r.$?r.$.event:void 0,o=r.dateStart,s=r.dateEnd,d=r.status,c=n._getCellTime(e.cellRange[0]),u=e.isAllDayEvent?n.$.allDayEventsContainer:n.$.timelineEventsContainer,h=n._dragDetails,m=n.tabIndex;let v,g,f=n._findEventElement(e,c,r);if(!t){const t=n._removeEventFromCollector(e);!f&&t&&(f=t)}if(!f||!n.hasAttribute("resized")||f!==h.schedulerEvent){if(f?f.classList.remove("smart-hidden"):(f=document.createElement("div"),f.classList.add("smart-scheduler-event"),f.setAttribute("role","menuitem"),f.setAttribute("aria-haspopup",!0)),n._setEventCellStyles(e,{eventCell:f}),"agenda"===i?(v=new Date(c),v.setHours(o.getHours(),o.getMinutes())):v=new Date(o),f.$||(f.$={}),g=f.$,g.cellTime=c,g.dateStart=v,g.dateEnd=new Date(v.getTime()+s.getTime()-o.getTime()),g.event=r,n.resources.forEach((e=>{void 0!==r[e.value]&&f.setAttribute(e.value,r[e.value])})),d&&n.statuses.some((e=>e.value===d))?f.setAttribute("status",d):f.removeAttribute("status"),a){const e=a.repeat.exceptions;f.setAttribute("repeating",""),e&&e.indexOf(r)>-1?f.setAttribute("exception",""):f.removeAttribute("exception")}else f.removeAttribute("repeating"),f.removeAttribute("exception");if(r.allDay?f.setAttribute("all-day",""):f.removeAttribute("all-day"),t)return f;n._setEventCellContent(f,e),n.hasAttribute("tabindex")?f.tabIndex=m:f.removeAttribute("tabindex"),r.disableResize?f.setAttribute("disable-resize",""):f.removeAttribute("disable-resize"),f.setAttribute("title",r.label),l.indexOf(f)<0&&l.push(f),u.contains(f)||u.appendChild(f)}}_setEventCellStyles(e,t){const n=this,i=e.viewType,r=e.eventObj,l=e.eventIndex,a=t.eventCell,o=e.collectorSize,s=e.cellRange,d=e.cellSize,c=s[0],u=s[s.length-1],h=n._getCellOffset(c),m=e.isDayOrWeekView,v=e.isAllDayEvent,g=e.rightToLeft?"right":"left",f=i.indexOf("timeline")>-1,p=["timelineDay","timelineWeek"].indexOf(i)>-1,w=r.class?Array.isArray(r.class)?r.class:[r.class]:[];let y=r.backgroundColor,_=r.color;if(!y||!_){const e=n.resources.find((e=>void 0!==r[e.value]));if(e&&e.dataSource){const t=e.dataSource.find((t=>t.id===r[e.value]));t&&(y=y||t.backgroundColor,_=_||t.color)}}if(a.style[e.rightToLeft?"left":"right"]="",a.style.setProperty("--smart-scheduler-event-background",n._getRGBA(y)),a.style.setProperty("--smart-scheduler-event-focus",n._getRGBA(y,-1)),a.style.setProperty("--smart-scheduler-event-hover",n._getRGBA(y,-2)),a.style.setProperty("--smart-scheduler-event-color",n._getRGBA(_)),a.style.setProperty("--smart-scheduler-event-color-hover",n._getRGBA(_)),a.style.setProperty("--smart-scheduler-event-color-focus",n._getRGBA(_)),"agenda"===i)a.style.top=h.top+"px",a.style[g]=h.left+"px",a.style.width=d.width+"px",a.style.height=d.height+"px";else{const t=e.cellEventsCount,i=u.scaleIndex;let s,y=0,_=0,b=e.eventSize;(p||m)&&(y=n._getEventCellOffset(r,c)),c===u&&(u.scaleIndex=n._getEventScaleIndex(r,f?u.horizontal:u.vertical).end),s=n._getCellOffset(u),m&&!v?(y=parseFloat((d.height*y).toFixed(2)),_=parseFloat((d.height*n._getEventCellOffset(r,u,!0)).toFixed(2)),a.style.height=_+s.top-h.top-y+"px",a.style.width=b+"px",a.style.top=h.top+y+"px",a.style[g]=h.left+l*((d.width-o)/t)+"px"):(p?(y=parseFloat((d.width*y).toFixed(2)),_=parseFloat((d.width*n._getEventCellOffset(r,u,!0)).toFixed(2))):(_=d.width,y=0),a.style.height=b+"px",a.style.width=_+s.left-h.left-y+"px",a.style[g]=h.left+y+"px","classic"===n.eventRenderMode&&e.isMaxSizeReached?a.style.top=h.top+o+l*((d.height-o)/t)+"px":a.style.top=h.top+o+l*b+"px"),w.length?w.forEach((e=>a.classList.add(e))):"smart-scheduler-event"!==a.className&&(a.className="smart-scheduler-event"),void 0!==r.id?a.id=r.id+"":delete r.id,u.scaleIndex=i}}_getEventCellOffset(e,t,n){if(void 0===t.scaleIndex)return 0;const i=["day","week"].indexOf(this.viewType)>-1?"vertical":"horizontal",r=60/this._getCellsScaleCount()*60*1e3;let l=n?e.dateEnd:e.dateStart,a=t[i].date;return a=new Date(a.getTime()+r*t.scaleIndex),"vertical"===i&&(a=new Date(l.getFullYear(),l.getMonth(),l.getDate(),a.getHours(),a.getMinutes(),0,0),a.getHours()!==l.getHours())?n?1:0:(a=a.getTime(),l=l.getTime(),Math.max(0,Math.min(1,a>l?n?1:0:parseFloat(((l-a)/r).toFixed(2)))))}_getRGBA(e,t){if(!e)return"";const n=/^#(.)(.)(.)$/gi.exec(e),i=void 0!==t&&t<0?parseFloat((1+t/10).toFixed(2)):void 0;let r,l,a,o;if(n)r=parseInt(n[1]+n[1],16),l=parseInt(n[2]+n[2],16),a=parseInt(n[3]+n[3],16),t<0&&(t=parseFloat((1+t/10).toFixed()));else{const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(!n)return"";r=parseInt(n[1],16),l=parseInt(n[2],16),a=parseInt(n[3],16),o=parseInt(n[4],16)/255,isNaN(o)||(t=parseFloat((void 0!==t&&t<0?o+t/10:o).toFixed(2)))}return void 0!==t&&t<0&&(t=i),`rgba(${r},${l},${a},${t||1})`}_getCellRanges(e,t="horizontal"){if(!e)return[];const n=this._timelineCells[t],i=e.start,r=e.end,l=e.first,a=e.last;if(!i&&!r||!l&&!a)return[];const o=e.start||l,s=e.end||a,d=n.indexOf(o),c=n.indexOf(s),u=n.indexOf(l),h=n.indexOf(a);let m=[];return m=d>c?[{fromIndex:d,toIndex:h},{fromIndex:u,toIndex:c}]:[{fromIndex:d,toIndex:c}],m}_getEventTimelineCells(e,t,n){const i=this,r=i.viewType,l="agenda"===r,a=new Date(e.dateStart),o=new Date(e.dateEnd),s=i._timelineCells.horizontal,d=i._timelineCells.vertical;let c=[];if("month"===r)return i._getEventTimelineCellsMonth(e);if(n){const t={height:i._allDayCellSize,top:0,date:new Date(i.dateCurrent)};return t.date.setHours(0,0,0,0),i._getCellRanges(i._getEventHorizontallCellObjs(e)).forEach((n=>{const r=n.fromIndex,l=n.toIndex;for(let n=r;n<=l;n++){const r=s[n],l=r.group;l&&!i._isEventPartOfGroup(e,l)||c.push({allDay:!0,horizontal:r,vertical:t})}})),c}const u=Object.assign({},e),h=r.indexOf("timeline")>-1;let m,v;return i._getCellRanges(i._getEventHorizontallCellObjs(e)).forEach((n=>{const g=n.fromIndex,f=n.toIndex;for(let n=g;n<=f;n++){const p=s[n],w=new Date(p.date),y=p.group;let _,b=new Date(p.date);if(!y||i._isEventPartOfGroup(e,y)){if(a.getTime()>=w.getTime()&&w.setHours(a.getHours(),a.getMinutes()),b.setHours(o.getHours(),o.getMinutes()),b.getTime()<=w.getTime())if("timelineWeek"===r||"timelineDay"===r)for(;b.getTime()<=w.getTime();){const e=b.getHours();b.setHours(e+1,0,0,0),e===b.getHours()&&b.setHours(b.getHours()+2,0,0,0)}else b.setDate(b.getDate()+1),b.setHours(0,0,0,0);l||(u.dateStart=w,u.dateEnd=b),i._getCellRanges(i._getEventVerticalCellObjs(u),"vertical").forEach((r=>{const a=r.fromIndex,o=r.toIndex;for(let r=a;r<=o;r++){const s=d[r],w=s.group;if(w&&!i._isEventPartOfGroup(u,w))continue;if(l&&(_&&_.date.getTime()===s.date.getTime()||t.some((e=>e.horizontal===p&&e.vertical===s))))continue;const y={horizontal:p,vertical:s};h&&n!==g||r!==a?h&&n!==f||r!==o||(void 0===v&&(v=i._getEventScaleIndex(e,h?p:s).end),y.scaleIndex=v):(void 0===m&&(m=i._getEventScaleIndex(e,h?p:s).start),y.scaleIndex=m),_=s,c.push(y),t.push(y)}}))}}})),c}_getEventTimelineCellsMonth(e){const t=this,n=new Date(e.dateStart),i=new Date(e.dateEnd),r=t._timelineCells.horizontal,l=t._timelineCells.vertical,a=Object.assign({},e);let o=[];return t._getCellRanges(t._getEventVerticalCellObjs(e),"vertical").forEach((s=>{const d=s.fromIndex,c=s.toIndex;for(let s=d;s<=c;s++){const d=l[s],c=new Date(d.date),u=new Date(d.date),h=d.group;h&&!t._isEventPartOfGroup(e,h)||(u.setDate(u.getDate()+6),u.setHours(23,59,59,999),c.setHours(0,0,0,0),a.dateStart=new Date(Math.max(n.getTime(),c.getTime())),a.dateEnd=new Date(Math.min(i.getTime(),u.getTime())),t._getCellRanges(t._getEventHorizontallCellObjs(a)).forEach((n=>{const i=n.fromIndex,l=n.toIndex;for(let n=i;n<=l;n++){const a=r[n],c=d.group;if(c&&!t._isEventPartOfGroup(e,c))continue;const u={horizontal:a,vertical:d};s!==i&&s!==l||(u.scaleIndex=0),o.push(u)}})))}})),o}_getEventTimelineCellRanges(e,t){const n=this,i=n.viewType;if(!e.length)return[];if("agenda"===i)return e.map((e=>[e]));{let r,l=[],a=[];const o=["day","week"].indexOf(i)>-1&&!t;for(let t=0;t<e.length;t++){const i=e[t];if(!r){l.push(r=i);continue}const s=i.horizontal,d=i.vertical,c=r.horizontal,u=r.vertical,h=n._getCellOffset(i,void 0===d.scaleIndex),m=n._getCellOffset(r,void 0===d.scaleIndex);!o&&(d!==u||m.right!==h.left)||o&&(s!==c||m.bottom!==h.top)?(a.push(l),l=[i]):l.push(i),r=i}return l.length&&a.push(l),a}}_getCellSize(e){const t=this,n=t.viewType;let i,r;if(e){let t=e;if(e instanceof HTMLElement&&(t=e.$?e.$.cellObj:void 0),!t)return{width:0,height:0};i=t.vertical,r=t.horizontal}else{const e=t._timelineCells,n=e.vertical,l=e.horizontal;if(!n.length||!l.length)return{width:0,height:0};i=n[0],r=l[0]}const l=t._getCellsScaleCount();let a,o;switch(n){case"agenda":case"month":case"timelineMonth":a=r.width,o=i.height;break;case"day":case"week":a=r.width,o=i.height/l;break;case"timelineDay":case"timelineWeek":a=r.width/l,o=i.height}return{width:a,height:o}}_getCellOffset(e,t){const n=this.viewType;let i,r,l=e;if(!e)return{left:0,top:0};if(e instanceof HTMLElement&&(l=e.$?e.$.cellObj:void 0),!l)return{left:0,top:0};i=l.vertical,r=l.horizontal;const a=this._getCellsScaleCount(),o=t||l.allDay?0:l.scaleIndex||0;let s,d;switch(n){case"agenda":case"month":case"timelineMonth":s=r.left,d=i.top;break;case"day":case"week":s=r.left,d=parseFloat((i.top+i.height/a*o).toFixed(2));break;case"timelineDay":case"timelineWeek":s=parseFloat((r.left+r.width/a*o).toFixed(2)),d=i.top}return{left:s,right:parseFloat((s+r.width).toFixed(2)),top:d,bottom:parseFloat((d+i.height).toFixed(2))}}_getCellDateRange(e){const t=this;let n=e;if(e instanceof HTMLElement&&(n=e&&e.$?e.$.cellObj:void 0),!n)return;const i=t.viewType;let r=new Date(n.time?n.time:t._getCellTime(n)),l=new Date(r);switch(i){case"agenda":case"month":case"timelineMonth":l.setHours(23,59,59,999);break;case"week":case"day":case"timelineWeek":case"timelineDay":n.allDay?l.setHours(23,59,59,999):l=new Date(l.getTime()+60/t._getCellsScaleCount()*60*1e3)}return{dateStart:r,dateEnd:l}}_setEventCellContent(e,t){const n=this,i=t.eventObj;if(!e||!i)return;const r=t.isDayOrWeekView,l=t.isAllDayEvent;let a=e.querySelector(".smart-scheduler-event-content");if(e.$&&e.$.events){const t=e.$.events;if(a||(e.innerHTML='<div class="smart-scheduler-event-content"><div></div></div>',a=e.firstElementChild),n.eventCollectorTemplate)n._applyTemplate("eventCollectorTemplate",a,t.map((e=>n._cloneObject(e))));else{const e=n.eventRenderMode,i=n.$.timeline.hasAttribute("mobile"),o=t.length+(i||"modern"===e&&r&&!l?"":" "+n.localize("collector"));a.firstElementChild.textContent=o}return}a||(e.innerHTML='<div class="smart-scheduler-event-content"></div><div class="smart-scheduler-event-button"></div>',a=e.firstElementChild);const o=e.querySelector(".smart-scheduler-event-button");let s;if(o&&(o.tabIndex=t.tabIndex),t.isTooltipEvent&&n.eventTooltipTemplate)n._applyTemplate("eventTooltipTemplate",a,n._cloneObject(i));else if(n.eventTemplate)n._applyTemplate("eventTemplate",a,n._cloneObject(i));else{const e=void 0!==t.isMonthView?t.isMonthView:["timelineMonth","month"].indexOf(n.viewType)>-1;let r=a.querySelector(".smart-scheduler-event-time"),l=i.label;s=a.querySelector(".smart-scheduler-event-label");const o=n.locale,d=i.dateStart,c=i.dateEnd;let u;if(t.isAllDayEvent||e){const e="short",t=n.dayFormat;if(d.getFullYear()===c.getFullYear()&&d.getMonth()===c.getMonth()&&d.getDate()===c.getDate())u=new Intl.DateTimeFormat(o,{day:t,month:e}).format(d);else{const n=new Intl.DateTimeFormat(o,{day:t,month:e});u=n.format(d)+" - "+n.format(c)}}else{const e=new Intl.DateTimeFormat(o,{hour:n.hourFormat,minute:n.minuteFormat});u=e.format(d)+" - "+e.format(c)}r&&s||(i.label+""?a.innerHTML='\n                            <div role="presentation"><label class="smart-scheduler-event-label"></label></div>\n                            <div role="presentation"><label class="smart-scheduler-event-time"></label></div>':a.innerHTML='<div role="presentation"><label class="smart-scheduler-event-time"></label></div>',s=a.querySelector(".smart-scheduler-event-label"),r=a.querySelector(".smart-scheduler-event-time")),s&&(s.textContent=l),r&&(r.textContent=u,s&&e&&t.eventSize<45?a.setAttribute("single-line",""):a.removeAttribute("single-line"))}}_createTimeline(){const e=this,t=e.resizeTrigger,n=e.scrollTop,i=e.scrollLeft,r=e.$.timeline;let l,a;t&&(l=t.offsetWidth,a=t.offsetHeight,t.style.display="none"),delete e._selectedCellObj,delete e._eventsBetween,e._createTimelineHeader(),e._refreshTimelineContentCells(),e._handleMenuAria(),r.classList.contains("no-agenda")?r.setAttribute("agenda-placeholder",e.localize("agendaPlaceholder")):r.removeAttribute("agenda-placeholder"),e.scrollTop=n,e.scrollLeft=i,t&&(t.style.display=null,l===t.offsetWidth&&a===t.offsetHeight||(e._noResizeHandler=!0)),e._refreshEvents(),e._checkNotifications()}_createTimelineHeader(){const e=this,t=e.$.timelineContent;if(t.style.width=t.style.height=null,Smart.Utilities.Core.Browser.Chrome){const t=e.$.timelineHeaderVertical;t.style.display="none",t.offsetHeight,t.style.display=null}e._validateEventDateRange(),e._createTimelineCellsObj(),e._createTimelineHeaderCells("horizontal"),e._createTimelineHeaderCells("vertical"),e._refreshTimelineHeaderCells(),e._refreshTimelineAllDayCells(),e._refresh()}_validateEventDateRange(e){const t=this.viewType;if(["month","agenda"].indexOf(t.toLowerCase())>-1)return;const n="day"===t||"week"===t,i=e?[e]:this._events;for(let e=0;e<i.length;e++){const t=i[e],r=t.dateStart,l=t.dateEnd;n&&l.getTime()-r.getTime()>=864e5&&(t.allDay=!0),t.allDay&&(t.dateStart.setHours(0,0,0,0),t.dateEnd.setHours(23,59,59,999))}}_handleMenuAria(){const e=this,t=e.$.currentDate,n=e.$.viewItemsButton,i=e.$.tooltip;t.setAttribute("aria-haspopup",!0),n.setAttribute("aria-controls",i.id),n.setAttribute("aria-haspopup",!0)}_handleTimelineGroupHeader(e){const t=this,n=t._timelineCells.groups;let i=t.$.groupsContainer;if(!n||!n.length||"agenda"===t.viewType&&!Object.keys(e.vertical).length)return void(i&&i.remove());i||(i=document.createElement("div"),i.classList.add("smart-scheduler-groups-container"),i.innerHTML='\n                        <div class="smart-scheduler-view-groups-label-container" role="presentation"></div>\n                        <div class="smart-scheduler-view-groups-content" role="presentation">\n                            <div class="smart-scheduler-view-header-groups-container" role="presentation"></div>\n                        </div>',t.$.groupsContainer=i);const r=t.view,l=t.views.find((e=>e.value&&e.value===r))||{},a="vertical"!==(l&&l.groupOrientation?l.groupOrientation:t.groupOrientation)?t.$.timelineHeaderHorizontal:t.$.timelineHeaderVertical;a.contains(i)||a.insertBefore(i,a.firstElementChild)}_handleTimeZoneHeader(e){const t=this;e||(e="horizontal",t._handleTimeZoneHeader("vertical"));const n=t.viewType.toLowerCase(),i=n.indexOf("timeline")>-1,r=("vertical"===e?t.$.timelineHeaderVerticalContent:t.$.timelineHeaderHorizontalContent).querySelector(".smart-scheduler-view-time"),l=r.children,a=t.$.timelineViewCellsLabelContainer,o=!i&&"agenda"!==n&&"vertical"===e||"horizontal"===e&&i;let s=t.timeZones.slice(0);const d=t.$.viewDetailsLabel,c=t.$.timelineViewAllDay,u=t.$.timelineTimeZoneLabelContainer;if(u.remove(),d&&d.remove(),t._recycleContainerCells({fragment:r,cellsNeeded:1+(o&&n.indexOf("month")<0?s.length:0),className:"smart-scheduler-cells"}),s.push(t.timeZone),(i&&o||!i)&&t._recycleContainerCells({fragment:a,cellsNeeded:!i&&n.indexOf("month")<0&&"agenda"!==n?s.length:0,className:"smart-scheduler-time-zone"}),c.offsetHeight&&a.offsetHeight&&(t.$.timelineViewAllDaylabel.style.maxWidth=a.offsetWidth+"px"),o){const e=u.parentElement;t._recycleContainerCells({fragment:u,cellsNeeded:1===l.length?0:l.length,className:"smart-scheduler-time-zone"}),l.length&&e&&e.appendChild(u)}}_createTimelineHeaderCells(e="vertical"){const t=this,n=t.viewType.toLowerCase(),i=n.indexOf("timeline")>-1,r="vertical"===e?t.$.timelineHeaderVerticalContent:t.$.timelineHeaderHorizontalContent,l=r.querySelector(".smart-scheduler-view-time"),a=r.querySelector(".smart-scheduler-view-details"),o=l.children,s=!i&&"agenda"!==n&&"vertical"===e||"horizontal"===e&&i;let d=t.timeZones.slice(0);const c=t._getTimelineVisibleCellsCount(e),u=t.timeZone,h=o.length;d.push(t.timeZone);for(let e=0;e<h;e++){const n=o[e],i=d[e];n.timeZone=1===h?u:i.id||i,t._recycleContainerCells({fragment:n,cellsNeeded:c})}if(a&&t._recycleContainerCells({fragment:a,cellsNeeded:t._getTimelineVisibleCellsCount({orientation:e,type:"details"})}),t._createTimelineHeaderGroupCells(e),s){const e=t.$.timelineTimeZoneLabelContainer,r=t.$.timelineViewCellsLabelContainer;e.remove();const l=t.$.timelineAllDayLabelContainer;let o=t.$.viewDetailsLabel;if(i&&n.indexOf("week")>-1&&a?(o||(o=document.createElement("div"),o.classList.add("smart-scheduler-view-details-label"),t.$.viewDetailsLabel=o),o.parentElement||r.appendChild(o)):o&&o.parentElement&&o.remove(),!e.children.length)return;!i&&l.offsetHeight?l.appendChild(e):r.offsetHeight&&r.appendChild(e)}}_createTimelineHeaderGroupCells(e){const t=this,n=t.view,i=t.viewType,r=i.indexOf("timeline")>-1,l=t.views.find((e=>e.value&&e.value===n))||{},a=t._timelineCells,o=a.groups,s=l&&l.groupOrientation?l.groupOrientation:t.groupOrientation;let d=t.$.groupsContainer;if("vertical"===e&&"vertical"!==s||("horizontal"===e&&"day"!==i||!e)&&"vertical"===s)return;if(d&&d.remove(),!o||!o.length||"agenda"===i&&!a.vertical.length)return;const c=t._timelineCells.groups,u=d.querySelector(".smart-scheduler-view-header-groups-container"),h=u.children;t._recycleContainerCells({fragment:u,cellsNeeded:c.length,className:"smart-scheduler-cell-container",role:"row"});for(let n=0;n<h.length;n++)t._recycleContainerCells({fragment:h[n],cellsNeeded:t._getTimelineVisibleCellsCount({orientation:e,type:"groups",resource:c[n].resource})});let m="vertical"===e||i.toLowerCase().indexOf("month")>-1?0:t.timeZones.length+("month"===i?0:1);if(r&&(m=m>1?1:0),"agenda"===i&&(m="vertical"!==s&&t._timelineCells.vertical.length?1:0),t._recycleContainerCells({fragment:d.querySelector(".smart-scheduler-view-groups-label-container"),cellsNeeded:m,className:"smart-scheduler-time-zone"}),!d.parentElement&&e===s){const n="horizontal"===e?t.$.timelineHeaderHorizontal:t.$.timelineHeaderVertical;n.insertBefore(d,n.firstElementChild)}}_recycleContainerCells(e){const t=this,n=e.fragment;if(!n)return;const i=n.children,r=n.children.length,l=e.cellsNeeded,a=e.className,o=e.role,s=e.isBackwards?"lastElementChild":"firstElementChild";if(r>l)for(;i.length&&i.length!==l;)n.removeChild(n[s]);else r<l&&n.appendChild(t._createCells(l-r,a,o))}_createTimelineCellsObj(){const e=this,t=e.viewType,n=t.indexOf("timeline")>-1,i=e._getCellsCount(),r=e._getCellsScaleCount(),l=window.getComputedStyle(e);e.timeZones.length>0&&n&&"timelineMonth"!==t?e.$.timeline.setAttribute("show-vertical-header",""):e.$.timeline.removeAttribute("show-vertical-header");let a=Math.max(parseFloat(l.getPropertyValue("--smart-scheduler-timeline-cell-height"))||0,parseFloat(l.getPropertyValue("--smart-scheduler-timeline-cell-min-height")||0)),o=Math.max(parseFloat(l.getPropertyValue("--smart-scheduler-timeline-cell-width"))||0,parseFloat(l.getPropertyValue("--smart-scheduler-timeline-cell-min-width")||0));e._eventSize=parseFloat(l.getPropertyValue("--smart-scheduler-event-size"))||0,e._allDayCellSize=parseFloat(l.getPropertyValue("--smart-scheduler-timeline-header-all-day-cells-size"))||e.$.timelineViewAllDay.offsetHeight,e._eventCollectorSize=parseFloat(l.getPropertyValue("--smart-scheduler-event-collector-size"))||0,e._monthViewNumberSize="month"!==t?0:parseFloat(l.getPropertyValue("--smart-scheduler-month-view-number-size"))||0,t.indexOf("timeline")>-1?o*=r:a*=r,e._timelineCells={},e._scrollViewSize={},e.groups.length&&(e._timelineCells.groups=e._getTimelineCellsObjGroups()),e._handleTimelineGroupHeader(i),e._handleTimeZoneHeader(),e._refresh(),e._handleTimelineContentSize(i,a,"height");let s=e.$.timelineContainer.offsetHeight;e._handleTimelineContentSize(i,o,"width"),s!==(s=e.$.timelineContainer.offsetHeight)&&e._handleTimelineContentSize(i,a,"height"),e._scrollViewSize.height=s,e._scrollViewSize.width=e.$.timelineContainer.offsetWidth,e._timelineCells.horizontal=e._getTimelineCellsObjHorizontal(i.horizontal,o),e._timelineCells.vertical=e._getTimelineCellsObjVertical(i.vertical,a),"timelineWeek"===t&&(e._timelineCells.details=e._getTimelineCellsObjDetails())}_getResourceGroups(){const e=this.groups,t=this.resources;let n,i=[],r=[];if(!e.length||!t.length)return r;for(let r=0;r<e.length;r++){const l=t.find((t=>t.value===e[r]));if(!l||!l.dataSource.length)continue;let a={};const o=l.dataSource;for(let e=0;e<o.length;e++){const t=o[e];a[t.id]={id:t.id,label:t.label,color:t.color}}if(Object.keys(a).length){const e=Object.values(a),t=n?n.cells.length:1;let r=[];for(let i=0;i<t;i++)for(let t=0;t<e.length;t++){const a={resource:l.value,label:e[t].label,group:n?Object.assign({},n.cells[i].group):{},groupSeparator:!0};a.group[l.value]=e[t].id,r.push(a)}i.push(n={resource:l.value,groups:e,cells:r})}}return i}_getTimelineCellsObjGroups(){const e=this,t=e._getResourceGroups();let n=[];if(!t.length)return n;for(let e=t.length-1;e>-1;e--){const i=t[e];if(n.length){const e=n.slice(0);n=[],i.groups.forEach((t=>{e.forEach((e=>{const r=Object.assign({},e);r.group=Object.assign({},r.group),r.group[i.resource]=t.id,n.push(r)}))}))}else i.groups.forEach((e=>{const t={label:e.label,color:e.color,group:{},resource:i.resource,groupSeparator:!0};t.group[i.resource]=e.id,n.push(t)}))}if(n.length){const t=e.view,n=e.views.find((e=>e.value&&e.value===t))||{},i=n&&n.groupOrientation?n.groupOrientation:e.groupOrientation;e.$.timeline.setAttribute("show-group-header",i)}else e.$.timeline.removeAttribute("show-group-header");return t[t.length-1].cells=n,t}_getTimelineCellsObjHorizontal(e,t){const n=this,i=n.view,r=n.viewType,l=i.indexOf("timeline")>-1,a=n.views.find((e=>e.value&&e.value===i))||{},o=new Date(n.dateCurrent);l?o.setHours(n.hourStart,0,0,0):o.setHours(0,0,0,0);const s=n.firstDayOfWeek;let d,c;switch(r){case"week":case"timelineWeek":o.setDate(o.getDate()-o.getDay()+s),c=n.hideWeekend||a.hideWeekend,d=n.hideNonworkingWeekdays||a.hideNonworkingWeekdays;break;case"month":case"timelineMonth":o.setDate(1),l||o.setDate(o.getDate()-o.getDay()+s),o.setHours(0,0,0,0),c=n.hideWeekend||a.hideWeekend,d=n.hideNonworkingWeekdays||a.hideNonworkingWeekdays}return n._getCellsObject({orientation:"horizontal",cells:[],cellSize:t,cellCount:e,date:o,hideWeekend:c,hideNonworkingWeekdays:d,hourStart:n.hourStart,hourEnd:n.hourEnd,viewSize:n.$.timelineContent.offsetWidth,offset:0})}_getCellsObject(e){const t=this,n=t.view,i=t.viewType,r=t.views.find((e=>e.value&&e.value===n))||{},l=t._timelineCells.groups,a=r&&r.groupOrientation?r.groupOrientation:t.groupOrientation,o=e.cellCount,s=e.viewSize,d=e.orientation,c=e.cells;let u,h=e.cellSize,[m,v]="horizontal"===d?["width","left"]:["height","top"];if(e.restrictedDates=t.restrictedDates,e.restrictedHours=t.restrictedHours,l&&l.length&&(u=l[l.length-1].cells),!u||!u.length||"horizontal"===d&&"vertical"===a||"vertical"===d&&"vertical"!==a)o*h<s&&(h=s/o),e.cellSize=parseFloat(h.toFixed(2)),"agenda"===i&&u&&u.length&&(e.groups=u),t._createCellObjects(e);else{const n=u.length;if(1===o){let e=s/n;e>=h&&(h=e)}else{const e=o*n;e*h<s&&(h=s/e)}if(e.cellSize=parseFloat(h.toFixed(2)),t.groupByDate&&d===a)e.groupHeader=l[l.length-1],t._createCellObjects(e);else{for(let n=0;n<u.length;n++){const i=u[n];i[v]=e.offset,e.size=0,e.group=i.group,t._createCellObjects(e),i[m]=e.size||0,t._refreshGroupHeaderCells(d,i)}c.length||t._createCellObjects(e)}}return c}_refreshGroupHeaderCells(e="horizontal",t){const n=t.group,i=this._timelineCells.groups;if(!i)return;let r=t.date,l=r?"cellsByDate":"cells";const[a,o]="horizontal"===e?["width","left"]:["height","top"];i.forEach((e=>{if(e.resource!==t.resource){const i=e[l];for(let e=0;e<i.length;e++){const l=i[e],s=l.group;r&&r.getTime()!==l.date.getTime()||Object.keys(s).every((e=>s[e]===n[e]))&&(l[a]=(void 0===l[a]?0:l[a])+t[a],void 0===l[o]&&(l[o]=t[o]))}}}))}_createCellObjects(e){const t=this;"horizontal"===e.orientation?t._createCellsObjectHorizontal(e):t._createCellsObjectVertical(e)}_createCellsObjectHorizontal(e){if(!e)return[];const t=this,n=t.viewType,i=n.indexOf("timeline")>-1,r=e.cells,l=new Date(e.date),a=e.cellSize,o=e.cellCount,s=e.hideWeekend,d=e.hideNonworkingWeekdays,c=e.hourStart,u=e.hourEnd,h=e.group,m=e.groupHeader,v=["timelineDay","timelineWeek"].indexOf(n)>-1;let g,f,p,w,y,_=e.offset,b=0;"agenda"===n?f=p=w=y=[]:(f=t.nonworkingDays,p=t.nonworkingHours,w=e.restrictedDates,y=e.restrictedHours),v?l.setHours(c):l.setHours(0,0,0,0);for(let C=0;C<o;C++){if(g={width:a},d){let e=0;const t=l.getHours();for(;e<7&&f.indexOf(l.getDay())>-1;)l.setDate(l.getDate()+1),e++;l.setHours(t)}if(s&&[0,6].indexOf(l.getDay())>-1){const e=l.getHours();l.setDate(l.getDate()+1),l.setHours(e)}if(g.restricted=t._isDateRestricted(l,w),!g.restricted&&i&&(g.restricted=t._isHourRestricted(l,y)),"agenda"===n?g.noLabel=!0:g.weekend=0===l.getDay()||6===l.getDay(),g.nonworking=f.indexOf(l.getDay())>-1,v&&(g.nonworking=g.nonworking||p.indexOf(l.getHours())>-1),m?(e.offset=_,e.date=l,t._createCellsObjByDate(g,e),_=e.offset):(h&&(g.group=h),g.left=_,g.date=new Date(l),r.push(g),_=parseFloat((_+a).toFixed(2))),i&&"timelineMonth"!==n){const e=l.getHours();"timelineWeek"===n&&e===u?(l.setDate(l.getDate()+1),l.setHours(c)):(l.setHours(l.getHours()+1),e===l.getHours()&&l.setHours(l.getHours()+2))}else l.setDate(l.getDate()+1),l.setHours(0,0,0,0);b+=a}g&&h&&(g.groupSeparator=!0),e.offset=_,e.size=b}_getTimelineCellsObjVertical(e,t){const n=this;return n._getCellsObject({orientation:"vertical",cells:[],date:new Date(n.dateCurrent),cellSize:t,cellCount:e,viewSize:n._scrollViewSize.height,offset:0})}_isEventPartOfGroup(e,t){if(e)return t=t.group||t,Object.keys(t).every((n=>e[n]&&e[n]===t[n]))}_createCellsObjByDate(e,t){const n=this,i=t.groupHeader;if(!i)return;const[r,l]="horizontal"===t.orientation?["width","left"]:["height","top"],a=i.cells,o=t.date,s=e[r],d=t.cells,c=t.agendaItem;let u=t.offset;n._createGroupCellsByDate(t,c);const h=i.cellsByDate,m=a.length,v=m%2==0?"center":"offset";for(let i=0;i<m;i++){const g=a[i],f=g.group;if(c&&!n._isEventPartOfGroup(c,f))continue;const p=Object.assign({},e),w=h.find((e=>e.date.getTime()===o.getTime()&&Object.keys(f).every((t=>f[t]===e.group[t]))));w&&(w[l]=void 0===w[l]?u:w[l],w[r]=p[r]+(c&&w[r]||0),p[l]=u,p.date=new Date(o),p.group=g.group,c||(i===m-1&&(p.groupSeparator=!0),i===Math.round(m/2)&&(p.showLabel=v)),n._refreshGroupHeaderCells(t.orientation,w),d.push(p),u=parseFloat((u+s).toFixed(2)))}t.offset=u}_createGroupCellsByDate(e,t){const n=this,i=e.date,r=n._timelineCells.groups;if(i)for(let l=0;l<r.length;l++){const a=r[l];let o=a.cellsByDate;o||(o=a.cellsByDate=[]);const s=a.cells;for(let r=0;r<s.length;r++){let l;if(t){if(!n._isEventPartOfGroup(t,s[r]))continue;l=o.find((e=>e.date.getTime()===i.getTime()&&e.group[e.resource]===t[e.resource]))}l=l||Object.assign({},s[r]),l.date||(l.date=new Date(i)),l.separator=!!e.separator,l.groupSeparator=t?!l.separator:r===s.length-1,o.includes(l)||o.push(l)}}}_createCellsObjectVertical(e){const t=this;if(!e)return;const n=t.firstDayOfWeek,i=t.viewType,r=i.indexOf("timeline")>-1,l=e.cells,a=new Date(e.date),o=e.cellCount,s=e.viewSize,d=t.nonworkingHours,c=e.group,u=e.groups,h=e.groupHeader;let m,v=e.offset,g=0,f=e.cellSize;if("agenda"===i){const n=Object.keys(o).sort(((e,t)=>parseInt(e)-parseInt(t)));for(let i of n){let n=o[i],r=f;if(c)n=n.filter((e=>t._isEventPartOfGroup(e,c)));else if(u)n=t._getAgendaGroupEvents(n);else if(h){const e=h.cells;let i=n.slice(0);n=[];for(let r=0;r<e.length;r++)n.push(...i.filter((n=>t._isEventPartOfGroup(n,e[r]))))}const a=n.length,d=new Date(parseInt(i));a*r<s&&(r=s/a),r=parseFloat(f.toFixed(2));for(let i=0;i<a;i++){const o=d;m={height:r,separator:i===a-1,weekend:0===o.getDay()||6===o.getDay(),nonworking:t.nonworkingDays.indexOf(o.getDay())>-1},i>0&&(m.noLabel=!0),h?(e.offset=v,e.date=o,e.agendaItem=n[i],e.separator=m.separator,t._createCellsObjByDate(m,e),v=e.offset):(c&&(m.group=c),m.top=v,m.date=o,l.push(m),v=parseFloat((v+r).toFixed(2))),g+=r}}t.$.timeline.classList[l.length?"remove":"add"]("no-agenda")}else if(r)for(let n=0;n<o;n++)a.setHours(0,0,0,0),m={height:f,weekend:0===a.getDay()||6===a.getDay()},h?(e.offset=v,e.date=a,t._createCellsObjByDate(m,e),v=e.offset):(c&&(m.group=c),m.top=v,m.date=new Date(a),l.push(m),v=parseFloat((v+f).toFixed(2))),g+=f;else{let r;"month"===i?(a.setDate(1),a.setDate(a.getDate()-(a.getDay()-n+7)%7),a.setHours(0,0,0,0)):(a.setHours(t.hourStart,0,0,0),r=e.restrictedHours);for(let n=0;n<o;n++)m={height:f},h?(e.offset=v,e.date=a,t._createCellsObjByDate(m,e),v=e.offset):(c&&(m.group=c),m.top=v,m.date=new Date(a),l.push(m),v=parseFloat((v+f).toFixed(2))),g+=f,"month"===i?a.setDate(a.getDate()+7):(m.nonworking=d.indexOf(a.getHours())>-1,a.setHours(a.getHours()+1),r&&(m.restricted=t._isHourRestricted(a,r)))}m&&c&&(m.groupSeparator=!0),e.offset=v,e.size=g}_getTimelineCellsObjDetails(){const e=this;if("timelineWeek"===!e.viewType)return[];function t(e){let t="";if(!i&&e)for(const n in e)t+=n+e[n];return t}const n=e.hourStart,i=e.groupByDate,r=e._timelineCells.horizontal;let l,a={};for(let e=0;e<r.length;e++){const i=r[e],o=i.date,s=o.getDate()+t(i.group);if(l=a[s],l||(l=a[s]={width:0,left:i.left}),l.width+=i.width,i.groupSeparator&&(l.groupSeparator=i.groupSeparator),!l.date){const e=new Date(o);e.setHours(n,0,0,0),l.date=e}}return a=Object.values(a).sort(((e,t)=>e.left-t.left)),a}_getAgendaGroupEvents(e){const t=this,n=t._timelineCells.groups;let i;n&&n.length&&(i=n[n.length-1].cells);const r={};let l=0;for(let n=0;n<i.length;n++)r[n]=e.filter((e=>t._isEventPartOfGroup(e,i[n]))),r[n].length>r[l].length&&(l=n);return r[l]}_handleTimelineContentSize(e,t,n){const i=this,r=i.view,l=i.viewType,a=i._timelineCells.groups,o=i.views.find((e=>e.value&&e.value===r))||{},s=o&&o.groupOrientation?o.groupOrientation:i.groupOrientation,d="agenda"===l&&Object.keys(e.vertical).length?i.$.timelineHeaderVertical.offsetWidth:Math.max(i.$.timelineViewCellsLabelContainer.offsetWidth,i.$.timelineViewAllDaylabel.offsetWidth),c="width"===n?Math.max(0,i.$.timeline.offsetWidth-d):i.$.timelineContainer.offsetHeight;let u=0,h=[],m=e["width"===n?"horizontal":"vertical"];if(a&&a.length&&(h=a[a.length-1].cells),"agenda"===l&&"height"===n)for(let e in m){let n=m[e];h.length&&(n="horizontal"===s?i._getAgendaGroupEvents(n):n.filter((e=>h.some((t=>i._isEventPartOfGroup(e,t)))))),u+=n.length*t}else{let e=1;i.groups.length&&("vertical"!==s&&"width"===n||"vertical"===s&&"height"===n)&&(e=Math.max(h.length,1)),1===m?c<t?u=t*e:(u=c/e,u<t&&(u=t*e)):(m*=e,m*t<c&&(t=c/m),u=m*(t=parseFloat(t.toFixed(2))))}u=Math.max(u,c,t),i.$.timelineContent.style[n]=u===c?"":u+"px",i._refresh()}_createCells(e,t="smart-scheduler-cell",n="gridcell"){let i,r=document.createDocumentFragment();Array.isArray(t)||(t=[t]);for(let l=0;l<e;l++)i=document.createElement("div"),t.forEach((e=>i.classList.add(e))),i.setAttribute("role",n),r.appendChild(i);return r}_refreshTimelineContentCells(){const e=this,t=e._timelineCells;if(!t||!t.vertical||!t.horizontal)return;const n=e.$.timelineContainer,i=e.$.timelineCellsContainer,r=e.$.timelineContent,l=e.view,a=e.viewType,o=e.views.find((e=>e.value&&e.value===l))||{},s=o&&o.groupOrientation?o.groupOrientation:e.groupOrientation,d=e._getVisibleCellObj();if(!d)return;const c={viewType:a,isTimelineView:a.indexOf("timeline")>-1,visibleCellObjs:d,groupOrientation:s,locale:e.locale,timeZone:e.timeZone,isRightToLeft:e.rightToLeft,dateCurrent:e.dateCurrent,restrictedDates:e.restrictedDates,restrictedHours:e.restrictedHours};i.remove(),e._recycleContainerCells({fragment:i,cellsNeeded:d[e.viewType.indexOf("timeline")>-1?"horizontal":"vertical"].length,className:"smart-scheduler-cell-container",role:"row"}),e._refreshContainerCells(i,c),r.insertBefore(i,r.firstElementChild),n.scrollTop=e.scrollTop,n.scrollLeft=e._getScrollLeft(e.scrollLeft),e._setCurrentTimeIndicators()}_getVisibleCellObj(){const e=this,t=e._timelineCells;if(!t||!t.vertical||!t.horizontal)return;const n=t.vertical,i=t.horizontal,[r,l]=[e.scrollTop,e.scrollLeft],[a,o]=[r+e._scrollViewSize.height,l+e._scrollViewSize.width];let[s,d]=[[],[]];for(let e=0;e<n.length;e++){const t=n[e];t.top+t.height>=r&&t.top<=a&&s.push(t)}for(let e=0;e<i.length;e++){const t=i[e];t.left+t.width>=l&&t.left<=o&&d.push(t)}return{vertical:s,horizontal:d}}_refreshContainerCells(e,t){const n=this,i=t.viewType,r=t.groupOrientation,l=t.isTimelineView,a=t.visibleCellObjs,o=e.children,s=e===n.$.timelineCellsContainer,d=t.isRightToLeft,c=t.dateCurrent,u=t.restrictedDates,h=t.restrictedHours,m=new Date;let v,g,f,p,w,y,_;if(s)l?(f=a.horizontal,[w,y,_]=["horizontal","left","width"]):(f=a.vertical,[w,y,_]=["vertical","top","height"]),v=a.vertical,p=n._getCellsScaleCount();else if(l?(v=a.horizontal,f=a.vertical,[w,y,_]=["vertical","top","height"]):(v=a.vertical,f=a.horizontal,[w,y,_]=["horizontal","left","width"]),n._selectedCellObj){const e=n._selectedCellObj.from;if(!e.allDay){const t=n._selectedCellObj.to;g={lastTime:e.time,fromTime:Math.min(e.time,t.time),toTime:Math.max(e.time,t.time),group:e[r]?e[r].group:void 0}}}for(let a=0;a<o.length;a++){const b=o[a],C=f[a];let D;if(C.nonworking?b.setAttribute("nonworking",""):b.removeAttribute("nonworking"),C.weekend?b.setAttribute("weekend",""):b.removeAttribute("weekend"),C.separator?b.setAttribute("separator",""):b.removeAttribute("separator"),D=C.groupSeparator,s)l||"vertical"!==r||(D=v[a].groupSeparator),D&&(l&&"vertical"!==r||!l&&"vertical"===r)?b.setAttribute("group-separator",""):b.removeAttribute("group-separator"),b.$={cellObj:C},n._refreshScaleCells(b,t,p);else{b.$||(b.$={cellObj:{}});const t=b.$.cellObj;t.scaleIndex=e._scaleIndex,l?(t.horizontal=e.$.cellObj,t.vertical=C):(t.horizontal=C,t.vertical=e.$.cellObj);const a=t[r]?t[r].group:void 0;if(a)for(const e in a)b.setAttribute(e,a[e]||"");D&&(!l&&"vertical"!==r||l&&"vertical"===r)?b.setAttribute("group-separator",""):b.removeAttribute("group-separator");const o=new Date(t.time=n._getCellTime(t));n._isDateRestricted(o,u)||n._isHourRestricted(o,h)?b.setAttribute("restricted",""):b.removeAttribute("restricted"),o.getFullYear()===m.getFullYear()&&o.getMonth()===m.getMonth()&&o.getDate()===m.getDate()?b.setAttribute("today",""):b.removeAttribute("today",""),n._setCellContent(b,o),b.setAttribute("aria-haspopup",!0),"month"===i&&o.getMonth()!==c.getMonth()?b.setAttribute("other-month",""):b.removeAttribute("other-month"),b.setAttribute("date",o),b.removeAttribute("selected"),g&&a===g.group&&t.time>=g.fromTime&&t.time<=g.toTime&&b.setAttribute("selected",t.time===g.lastTime?"start":"")}b.style.top=b.style.left=b.style.right=b.style.width=b.style.height="",b.style[_]=C[_]+"px","horizontal"===w?b.style[d?"right":"left"]=C.left+"px":b.style[y]=C[y]+"px"}}_refreshScaleCells(e,t,n){const i=this,r=t.visibleCellObjs,l=t.isTimelineView,a=e.children;i._recycleContainerCells({fragment:e,cellsNeeded:n,className:["smart-scheduler-cell","scale"],role:"presentation"});const o=l?"width":"height",s=a.length,d=e.$.cellObj,c=r[l?"vertical":"horizontal"].length;for(let r=0;r<s;r++){const l=a[r];l.$=e.$,l._scaleIndex=r,d.nonworking?l.setAttribute("nonworking",""):l.removeAttribute("nonworking"),l.style.width=l.style.height=null,l.style[o]=100/n+"%",i._recycleContainerCells({fragment:l,cellsNeeded:c}),i._refreshContainerCells(l,t),delete l._scaleIndex}}_refreshTimelineAllDayCells(){const e=this,t=new Date,n=e.restrictedHours,i=e.viewType.toLowerCase(),r=e.$.timelineViewAllDayContent,l=e.$.timelineViewAllDayCellsContainer;if(i.indexOf("timeline")>-1||i.indexOf("month")>-1)return void(l.innerHTML="");l.remove();const a=l.children,o=e.locale,s=e.rightToLeft,d={height:e._allDayCellSize,top:0},c=e.$.timelineHeaderHorizontalContent.querySelector(".smart-scheduler-cells").children;e._recycleContainerCells({fragment:l,cellsNeeded:"agenda"===i?0:c.length});for(let i=0;i<a.length;i++){const r=a[i],l=c[i],u=l.$.cellObj;r.$||(r.$={cellObj:{}});const h=r.$.cellObj;h.horizontal=u,h.vertical=d,h.allDay=!0,r.setAttribute("all-day","");const m=h.horizontal.group;if(m)for(const e in m)r.setAttribute(e,m[e]||"");const v=new Date(h.time=e._getCellTime(h));u.restricted||n.length?r.setAttribute("restricted",""):r.removeAttribute("restricted"),v.getFullYear()===t.getFullYear()&&v.getMonth()===t.getMonth()&&v.getDate()===t.getDate()?r.setAttribute("today",""):r.removeAttribute("today",""),e._setCellContent(r,v),r.setAttribute("date",v.toLocaleDateString(o)),u.groupSeparator?r.setAttribute("group-separator",""):r.removeAttribute("group-separator"),u.weekend?r.setAttribute("weekend",""):r.removeAttribute("weekend"),u.nonworking?r.setAttribute("nonworking",""):r.removeAttribute("nonworking"),s?(r.style.left="",r.style.right=l.style.right):(r.style.right="",r.style.left=l.style.left),r.style.width=l.style.width}r.insertBefore(l,r.firstElementChild),r.scrollLeft=e._getScrollLeft(e.scrollLeft)}_getCellsScaleCount(){const e=this.viewType;if(["timelineMonth","month","agenda"].indexOf(e)>-1)return 1;switch(this.timelineDayScale){case"hour":return 1;case"halfHour":return 2;case"quarterHour":return 4;case"tenMinutes":return 6;case"fiveMinutes":return 12;default:return 1}}_getTimelineVisibleCellsCount(e="horizontal"){const t=this,n=e.orientation||e,i=e.type,r=e.resource;let l=t._timelineCells[n];if(i&&(l=r?t._timelineCells.groups.find((e=>e.resource===r))[t.groupByDate?"cellsByDate":"cells"]:t._timelineCells[i]),!l)return 0;const a=t._getFirstCellObjInView({orientation:n,type:i,resource:r});if(!a)return 0;const[o,s,d]="horizontal"===n?["left","width",t.scrollLeft]:["top","height",t.scrollTop];let c;if("vertical"===n?c=t._scrollViewSize.height:(c=t.$.timelineHeaderHorizontalContent.offsetWidth||t.$.timelineViewAllDayContent.offsetWidth,"agenda"===t.viewType&&t._timelineCells.vertical.length&&(c-=t.$.timelineHeaderVertical.offsetWidth)),i){let e=0;if("details"===i&&("timelineWeek"!==t.viewType||"vertical"===n))return e;for(let t=l.indexOf(a);t<l.length;t++){const n=l[t];n[o]+n[s]>=d&&n[o]<c+d&&e++}return e}const u=1-(a[o]+a[s]-d)/l[0][s];return isNaN(u)||!isFinite(u)?0:Math.min(l.length,Math.ceil(parseFloat((c/a[s]+u).toFixed(2))))}_getFirstCellObjInView(e="horizontal"){const t=this,n=e.orientation||e,i=e.type,r=e.resource,l=t._timelineCells;if(!l)return;let a,o,s;const[d,c,u]="horizontal"===n?["scrollLeft","left","width"]:["scrollTop","top","height"],h=Math.abs(t[d]);s=l[n],i&&(s=r?t._timelineCells.groups.find((e=>e.resource===r))[t.groupByDate?"cellsByDate":"cells"]:t._timelineCells[i]);for(let e=0;e<s.length;e++){const t=s[e];if(t[c]+t[u]>=h){a=t;break}o=t}return!a&&o&&(a=h>o[c]?o:s[0]),a}_getCellsCount(e){const t=this,n=t.dateCurrent,i=new Date(t.dateCurrent);e||(e=t.view);const r=t.viewType,l=t.views.find((t=>t.value&&t.value===e))||{},a=t.nonworkingDays;let[o,s,d,c]=[0,0,0,0,0];const u=t.hideNonworkingWeekdays||l.hideNonworkingWeekdays,h=t.hideWeekend||l.hideWeekend;switch(h&&(c=2,u&&(c-=(a.includes(0)?1:0)+(a.includes(6)?1:0))),r){case"agenda":s=t._getAgendaEvents(i,l),o=1;break;case"day":s=t._getDayHours(i),o=1;break;case"month":case"week":s="month"===r?6:t.hourEnd-t.hourStart+1,o=7-(u?a.length:0)-c;break;case"timelineDay":o=t._getDayHours(i),s=1;break;case"timelineWeek":{const e=t.firstDayOfWeek;let n=new Date(i);s=1,n.setDate(n.getDate()-n.getDay()+e);for(let e=0;e<7;e++)(!h||h&&[0,6].indexOf(n.getDay())<0)&&(!u||u&&a.indexOf(n.getDay())<0)&&(o+=t._getDayHours(n),d++),n.setDate(n.getDate()+1);break}case"timelineMonth":{const e=new Date(n);e.setDate(1),e.setMonth(e.getMonth()+1),e.setDate(0),o=e.getDate(),s=1;break}}return{horizontal:o,vertical:s,detail:d}}_getAgendaEvents(e,t){const n=this;if(!t){const e=n.view;t=n.views.find((t=>t.value&&t.value===e))||{}}e||(e=new Date(n.currentDate));const i=n.hideNonworkingWeekdays||t.hideNonworkingWeekdays,r=n.hideWeekend||t.hideWeekend,l=n.nonworkingDays,a=new Date(e),o=n.hourStart,s=n.hourEnd;a.setHours(0,0,0,0);const d=new Date(a);d.setDate(a.getDate()+6),d.setHours(23,59,59,999);const[c,u]=[a.getTime(),d.getTime()],h=n._getEventsBetween(c,u);let m={};if(!h||!h.length)return m;for(let e=0;e<h.length;e++){const t=h[e],n=t.dateStart,d=t.dateEnd,v=n.getTime(),g=d.getTime();if(!(v>=u||g<=c||t.hidden))for(let e=0;e<7;e++){const n=new Date(a);if(n.setDate(n.getDate()+e),i&&l.indexOf(n.getDay())>-1||r&&[0,6].indexOf(n.getDay())>-1)continue;n.setHours(o,0,0,0);const d=new Date(n);d.setHours(s,59,59,999);const c=n.getTime(),u=d.getTime();if(c<=g&&u>=v){let e=m[c];e||(m[c]=e=[]),e.push(t)}}}for(let e in m)m[e].sort(((e,t)=>e.dateStart.getTime()-t.dateStart.getTime()));return m}_getEventsBetween(e,t){const n=this;if(!e||!t)return[];e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime());let i=n._eventsBetween;if(n._eventsBetween){if(i.timeStart===e&&i.timeEnd===t)return i.events}else i=n._eventsBetween={timeStart:e,timeEnd:t,events:[]};let r=[];const l=n._events,a=n._rRule,o=n.restrictedDates,s=n.restrictedHours,d={isMonthView:n.viewType.toLowerCase().indexOf("month")>-1,restrictedDates:n.restrictedDates,restrictedHours:n.restrictedHours,hourStart:n.hourStart,hourEnd:n.hourEnd,dateStart:new Date(e),dateEnd:new Date(t),rRule:a,targetEvents:r};for(let i=0;i<l.length;i++){const c=l[i],u=c.repeat,h=c.dateStart,m=c.dateEnd,v=h.getTime(),g=m.getTime();if(v!==g&&n._applyFiltering(c)){if(u&&a){const e=n._getEventRepeatOptions(c);if(e){d.event=c,d.repeatObj=u,d.options=e,d.eventTimeStart=v,d.eventTimeEnd=g,n._setRepeatingEvents(d);continue}}else if(n._isEventRestricted(c,o,s)||v>t||g<e)continue;r.push(c)}}return r.sort(((e,t)=>e.dateStart.getTime()-t.dateStart.getTime())),i.timeStart=e,i.timeEnd=t,i.events=r}_applyFiltering(e){const t=this;if(!t.filterable)return!0;const n=t.filter;if("function"==typeof n)return!!n(t._cloneObject(e));if(!Array.isArray(n))return!0;if(!n.length)return!0;for(let i=0;i<n.length;i++){const r=n[i];if(void 0===r.name)continue;const l=e[r.name],a=r.value;return"function"==typeof a?!!a(l):t._checkFilterMode(l+"",a+"")}}_checkFilterMode(e,t){switch(this.filterMode){case"startsWith":return 0===e.indexOf(t);case"startsWithIgnoreCase":return 0===e.toLowerCase().indexOf(t.toLowerCase());case"doesNotContain":return e.indexOf(t)<0;case"doesNotContainIgnoreCase":return e.toLowerCase().indexOf(t.toLowerCase())<0;case"contains":return e.indexOf(t)>-1;case"containsIgnoreCase":return e.toLowerCase().indexOf(t.toLowerCase())>-1;case"equals":return 0===e.localeCompare(t);case"equalsIgnoreCase":return 0===e.toLowerCase().localeCompare(t.toLowerCase());case"endsWith":return e.endsWith(t);case"endsWithIgnoreCase":return e.toLowerCase().endsWith(t.toLowerCase())}}_isEventRestricted(e,t,n){const i=this;if(!e)return!1;const r=e.dateStart,l=e.dateEnd,a=r.getTime(),o=l.getTime();let s;if(t||(t=i.restrictedDates),n||(n=i.restrictedHours),n.length){let e=Math.max(1,Math.min(23,Math.floor((l.getTime()-r.getTime())/36e5))),t=r.getHours();if(e>0)for(s=[];e>=0;)s.push(t),t=23===t?0:t+1,e--;if(s&&n.some((e=>s.includes(e))))return!0}for(let e=0;e<t.length;e++){const n=t[e],i=n.getTime();let r=new Date(n);if(r.setHours(23,59,59,999),r=r.getTime(),a<=r&&o>=i)return!0}return!1}_isDateRestricted(e,t){const n=this;if(!e||!e.getTime||isNaN(e.getTime()))return!1;const i=e.getFullYear(),r=e.getMonth(),l=e.getDate();t||(t=n.restrictedDates);for(let e=0;e<t.length;e++){const n=t[e],a=n.getFullYear(),o=n.getMonth(),s=n.getDate();if(i===a&&r===o&&l===s)return!0}return!1}_isHourRestricted(e,t){const n=this;return e instanceof Date&&(e=e.getHours()),void 0!==e&&!isNaN(e)&&(t||(t=n.restrictedHours),t.includes(e))}_setRepeatingEvents(e){const t=this,n=e.isMonthView,i=e.hourStart,r=e.hourEnd,l=e.rRule,a=e.dateStart,o=e.dateEnd,s=e.restrictedDates,d=e.restrictedHours,c=a.getTime(),u=o.getTime(),h=e.event,m=e.options,v=e.repeatObj,g=e.eventTimeStart,f=e.eventTimeEnd,p=v.exceptions,w=e.targetEvents,y=h.dateStart,_=h.dateEnd;let b=a;y.getFullYear()===_.getFullYear()&&y.getMonth()===_.getMonth()&&y.getDate()===_.getDate()||(b=h.dateStart);let C=new l(m).between(new Date(Date.UTC(...t._getDateArgs(b))),new Date(Date.UTC(...t._getDateArgs(o))),!0);if(!C.length){const e=new l(m).before(new Date(Date.UTC(...t._getDateArgs(a))));e&&new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()).getTime()+f-g>=c&&C.push(e)}for(let e=0;e<C.length;e++){let l=C[e];l=new Date(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes());let a,o=new Date(l),m=new Date(l.getTime()+f-g);if(!(t._isEventRestricted(h,s,d)||o.getTime()>u||m.getTime()<c)&&(p&&(a=p.find((e=>{const t=e.date;return h.allDay&&t.setHours(l.getHours(),l.getMinutes(),l.getSeconds(),l.getMilliseconds()),t.getTime()===l.getTime()}))),a&&(o=a.dateStart,m=a.dateEnd),o&&!isNaN(o.getTime())||(o=new Date(l)),m&&!isNaN(m.getTime())||(m=new Date(o.getTime()+f-g)),n||!(o.getHours()<i&&m.getHours()<i||o.getHours()>r&&m.getHours()>r))){if(a)a.dateStart&&!isNaN(a.dateStart.getTime())||(a.dateStart=o),a.dateEnd&&!isNaN(a.dateEnd.getTime())||(a.dateEnd=m),a.$={event:h};else if(a=t._cloneObject(h,!1,!0),a.dateStart=o,a.dateEnd=m,a.$={event:h},p){const e=a.dateStart.getTime(),t=a.dateEnd.getTime();for(let n=0;n<p.length;n++){const i=p[n],r=i.date.getTime();r>e&&r<=t&&(void 0===i.dateStart&&(i.dateStart=new Date(o)),void 0===i.dateEnd&&(i.dateEnd=new Date(m)),w.push(i))}}w.push(a)}}}_getEventRepeatOptions(e,t){const n=this,i=n._rRule;if(!e||!e.repeat||!i)return;const r=e.repeat,l=r.repeatFreq,a=l?i[l.toUpperCase()]:void 0;if(void 0===a)return;const o=r.repeatOn,s=r.repeatEnd;let d={freq:a,wkst:(n.firstDayOfWeek-1+7)%7,interval:r.repeatInterval||1};const c=n._getRepeatOnCondition(l,o);switch(l){case"weekly":d.byweekday=c.map((e=>(e-1+7)%7));break;case"monthly":d.bymonthday=c;break;case"yearly":d.bymonth=c.index+1,d.bymonthday=c.value}return s instanceof Date?d.until=new Date(Date.UTC(...n[t?"_getUTCDateArgs":"_getDateArgs"](s))):"number"!=typeof s||isNaN(s)||(d.count=s),d.dtstart=new Date(Date.UTC(...n[t?"_getUTCDateArgs":"_getDateArgs"](e.dateStart))),d}_getUTCDateArgs(e){if(!isNaN(new Date(e).getTime()))return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()]}_getDateArgs(e){if(!isNaN(new Date(e).getTime()))return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()]}_getRepeatOnCondition(e,t){if(!e||!t)return[];let n;if("weekly"===e){let e=[];Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)n=t[i],"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n instanceof Date&&!isNaN(n.getTime())?e.push(n.getDay()):e.push(Math.max(0,Math.min(6,parseInt(t[i])||0)));return e}if("monthly"===e)return Array.isArray(t)&&(t=t[0]),n=t,"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n=n instanceof Date&&!isNaN(n.getTime())?n.getDate():Math.max(0,Math.min(31,parseInt(t)||0)),n;if("yearly"===e){let e,i;if(Array.isArray(t)&&(t=t[0]),n=t,"string"==typeof n&&(n=isNaN(parseInt(n))?new Date(n):parseInt(n)),n instanceof Date&&!isNaN(n.getTime()))e=n.getMonth(),i=n.getDate();else{let n=t,r=t;"object"==typeof t&&(n=t.month,r=t.date),e=Math.max(0,Math.min(11,parseInt(n)||0)),i=Math.max(0,Math.min(31,parseInt(r)||0))}return{index:e,value:i}}}_getDayHours(e){const t=this,n=new Date(e||t.dateCurrent),i=n.getDate(),r=t.hourStart,l=t.hourEnd;let a=0;for(n.setHours(r,0,0,0);i===n.getDate()&&n.getHours()<=l;){a++;const e=n.getHours();n.setHours(n.getHours()+1,0,0,0),e===n.getHours()&&n.setHours(n.getHours()+2,0,0,0)}return a}_getDateString(e,t="horizontal",n){const i=this,r=i.locale,l=i.viewType,a=l.indexOf("timeline")>-1,o=e.timeZone||i.timeZone;let s;if(e=e.timeZone&&e.timeZone===i.timeZone?e.date||e:new Smart.Utilities.DateTime(e.date||e).toDate(o),a){if("vertical"===t)return"";s="timelineMonth"===l||"timelineWeek"===l&&n?new Intl.DateTimeFormat(r,{day:i.dayFormat,weekday:i.weekdayFormat}).format(e):new Intl.DateTimeFormat(r,{hour:i.hourFormat,minute:i.minuteFormat}).format(e)}else if("horizontal"===t){if("day"===l)return"";"week"===l?s=new Intl.DateTimeFormat(r,{day:i.dayFormat,weekday:i.weekdayFormat}).format(e):"month"===l&&(s=new Intl.DateTimeFormat(r,{weekday:i.weekdayFormat}).format(e))}else{if("month"===l)return"";s="agenda"===l?new Intl.DateTimeFormat(r,{day:i.dayFormat,weekday:i.weekdayFormat}).format(e):new Intl.DateTimeFormat(r,{hour:i.hourFormat,minute:i.minuteFormat}).format(e)}return i.timelineHeaderFormatFunction?i.timelineHeaderFormatFunction(e,t,n,s):s}_setGroupContent(e){const t=this,n=e.$.cellObj;if(t.groupTemplate)t._applyTemplate("groupTemplate",e,n);else{const i=t.resources.find((e=>e.value===n.resource));if(!i)return void(e.innerHTML="");let r;n.group&&(r=n.label);let l=r||i.label;t.timelineHeaderGroupFormatFunction&&(l=t.timelineHeaderGroupFormatFunction(r,i,l)),e.innerHTML=`<div>${l}</div>`}}_applyTemplate(e,t,n){const i=this;let r,l=i[e];if("groupTemplate"===e){if(r=i.resources.find((e=>e.value===n.resource)),r){const e=n.group[n.resource];n=r.dataSource.find((t=>t.id===e))}n||(n=r)}i._templates||(i._templates={});const a=i._templates;if("function"==typeof l)return l.call(i,t,n),void delete a[e];if("string"==typeof l&&(l=document.getElementById(l)),!("content"in document.createElement("template")))return i.error(i.localize("htmlTemplateNotSuported",{elementType:i.nodeName.toLowerCase()})),void delete a[e];if(null===l||!("content"in l))return i.error(i.localize("invalidTemplate",{elementType:i.nodeName.toLowerCase(),property:"groupTemplate"})),void delete a[e];let o=a[e];o||(o=a[e]={}),t.innerHTML="";const s=document.importNode(l.content,!0);if("cellTemplate"===e)n=new Intl.DateTimeFormat(i.locale,{day:i.dayFormat}).format(n);else if("eventCollectorTemplate"===e||"headerTemplate"===e||"footerTemplate"===e)return t.innerHTML="",void t.appendChild(s);const d=s.childNodes,c=o.bindings;let u;c&&(u=c);for(let e=0;e<d.length;e++){let i=d[e].outerHTML;if(i){if(!c){const e=/{{\s*\w*\s*}}/gm;if(e.test(i)){const t=i.match(e);u||(u=[]),t&&t.forEach((e=>{u.includes(e)||u.push(e)}))}}if(u)for(let e=0;e<u.length;e++){const t=u[e];i=i.replace(t,"object"==typeof n?n[t.replace(/{{|}}/gm,"").trim()]||"":n)}t.innerHTML+=i}}u&&(o.bindings=u)}_setCellContent(e,t){const n=this;t=new Date(t||n.dateCurrent),n.cellTemplate?n._applyTemplate("cellTemplate",e,t):"month"===n.viewType?1!==t.getDate()||e.hasAttribute("today")?e.innerHTML=`<div>${new Intl.DateTimeFormat(n.locale,{day:n.dayFormat}).format(t)}</div>`:e.innerHTML=`<div>${new Intl.DateTimeFormat(n.locale,{month:"short",day:n.dayFormat}).format(t)}</div>`:e.innerHTML=""}_setCurrentTimeIndicators(){const e=this;clearInterval(e._currentTimeIndicatorInterval),delete e._currentTimeIndicatorInterval,e._refreshIndicators(),(e.currentTimeIndicator||e.shadeUntilCurrentTime)&&(e._currentTimeIndicatorInterval=setInterval(e._refreshIndicators.bind(e),1e3*e.currentTimeIndicatorInterval))}_refreshIndicators(){const e=this,t=e.viewType,n=new Date,i=e.$.timelineCellsContainer,r=60/e._getCellsScaleCount(),l=t.toLowerCase().indexOf("month")>-1,a=i.querySelectorAll(".smart-scheduler-cell:not(.scale)");let o,s=[];for(let e=0;e<a.length;e++){const t=a[e],i=new Date(t.$.cellObj.time);if(t.$&&n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()){if(!l&&i.getHours()!==n.getHours()||i.getMinutes()+r<n.getMinutes()||i.getMinutes()>n.getMinutes())continue;s.push(t)}}if(s.length){const e=s[0].$.cellObj,t=new Date(e.time),i=e.scaleIndex||0;let a,d;l?(d=60*n.getHours()+n.getMinutes(),a=1440):(d=n.getMinutes(),a=t.getMinutes()+r),o={cells:s,minutes:d,max:a,scaleIndex:i}}e._refreshCurrentTimeIndicator(o),e._refreshCurrentTimeShader(o)}_refreshCurrentTimeIndicatorHeader(){const e=this,t=e.currentTimeIndicator,n=e.timeZone,i=new Date,r=i.getFullYear(),l=i.getMonth(),a=i.getDate(),o=i.getHours(),s=e.viewType.toLowerCase(),d=e=>{let t=new Date(e);for(let e=0;e<6;e++){if(t.getFullYear()===r&&t.getMonth()===l&&t.getDate()===a)return!0;t.setDate(t.getDate()+7)}},c=s.indexOf("agenda")>-1,u=s.indexOf("timeline")>-1,h=s.indexOf("month")>-1;function m(e,i){let s;const m=!c&&!h&&(i&&!u||!i&&u);for(let t=0;t<e.length;t++){const i=e[t];if(i.timeZone===n){s=i.children;break}}if(s)for(let e=0;e<s.length;e++){const n=s[e];if(!n.$)return;const i=n.$.cellObj.date;if(t){if(h&&!u){d(i)?n.setAttribute("current",""):n.removeAttribute("current");continue}if(i.getDate()===a&&(!m||i.getFullYear()===r&&i.getMonth()===l&&i.getHours()===o)){n.setAttribute("current","");continue}}n.removeAttribute("current")}}m(e.$.timelineHeaderHorizontalContent.querySelectorAll(".smart-scheduler-cells")),m(e.$.timelineHeaderVerticalContent.querySelectorAll(".smart-scheduler-cells"),!0)}_refreshCurrentTimeIndicator(e){const t=this,n=t.viewType,i=t.$.timelineIndicatorsContainer;let r=i.querySelector(".smart-scheduler-current-time");if(t._refreshCurrentTimeIndicatorHeader(),!t.currentTimeIndicator||"agenda"===n||!e)return r&&r.remove(),void(i.firstElementChild||(clearInterval(t._currentTimeIndicatorInterval),delete t._currentTimeIndicatorInterval));const[l,a,o,s]=[e.cells,e.minutes,e.max,e.scaleIndex],d=l.length,c=t._getCellsScaleCount();r||(r=document.createElement("div"),r.classList.add("smart-scheduler-current-time"),r.setAttribute("role","presentation"));const u=r.children;t._recycleContainerCells({fragment:r,cellsNeeded:d,className:"smart-scheduler-current-time-indicator"});for(let e=0;e<u.length;e++){const t=l[e],i=u[e],r=t.closest(".smart-scheduler-cell-container");let d;n.toLowerCase().indexOf("timeline")>-1?(d=parseFloat(r.style.width)/c*(s+1),i.style.width=t.style.width,i.style.height=t.style.height,i.style.left=parseFloat(r.style.left)+d*(a/o)+"px",i.style.top=t.style.top):(d=parseFloat(r.style.height)/c*(s+1),i.style.width=t.style.width,i.style.height=t.style.height,i.style.left=t.style.left,i.style.top=parseFloat(r.style.top)+d*(a/o)+"px"),i.setAttribute("aria-label","Current Time Indicator")}r.parentElement||i.appendChild(r)}_refreshCurrentTimeShader(e){const t=this,n=t.$.timelineIndicatorsContainer;let i=n.querySelector(".smart-scheduler-shader");if(!t.shadeUntilCurrentTime||"agenda"===t.viewType)return i&&i.remove(),void(t.currentTimeIndicator||(clearInterval(t._currentTimeIndicatorInterval),delete t._currentTimeIndicatorInterval));i||(i=document.createElement("div"),i.classList.add("smart-scheduler-shader"));const r=i.children;if(e)t._shadeUntilToday(i,e);else{const e=t._getCellShadeRangesByDate(),l=e.length;if(t._recycleContainerCells({fragment:i,cellsNeeded:l,className:"smart-scheduler-shade"}),!l&&(i.remove(),!n.firstElementChild))return clearInterval(t._currentTimeIndicatorInterval),void delete t._currentTimeIndicatorInterval;for(let n=0;n<l;n++){const i=e[n],l=i.hFrom,a=i.hTo,o=t._getFirstShadeCell(i.vFrom.$.cellObj,!0),s=t._getFirstShadeCell(i.vTo.$.cellObj,!0,!0),d=r[n];t._recycleContainerCells({fragment:d,cellsNeeded:1,className:"smart-scheduler-shade-section"});const c=d.children[0];c.style.width=parseFloat(a.style.left)+parseFloat(a.style.width)-parseFloat(l.style.left)+"px",c.style.height=parseFloat(s.style.top)+parseFloat(s.style.height)-parseFloat(o.style.top)+"px",c.style.left=l.style.left,c.style.top=o.style.top}}i.parentElement||n.insertBefore(i,n.firstElementChild)}_shadeUntilToday(e,t){const n=this;if(!t)return void(e.innerHTML="");const i=e.children,r=n.viewType,l=r.indexOf("month")>-1,a=n._getCellsScaleCount(),[o,s,d,c]=[t.cells,t.minutes,t.max,t.scaleIndex],u=o?o.length:1;n._recycleContainerCells({fragment:e,cellsNeeded:u,className:"smart-scheduler-shade"});for(let e=0;e<u;e++){const t=o[e],u=i[e],h=t.closest(".smart-scheduler-cell-container"),m=t.$.cellObj.horizontal,v=t.$.cellObj.vertical;let g;if(r.toLowerCase().indexOf("timeline")>-1){n._recycleContainerCells({fragment:u,cellsNeeded:1,className:"smart-scheduler-shade-section"});const e=u.children[0],i=n._getFirstShadeCell(m);g=parseFloat(h.style.width)/a*(c+1),e.style.width=parseFloat(h.style.left)-parseFloat(i.style.left)+g*(s/d)+"px",e.style.height=t.style.height,e.style.left=i.style.left,e.style.top=t.style.top}else{n._recycleContainerCells({fragment:u,cellsNeeded:l?3:2,className:"smart-scheduler-shade-section"});const e=u.children[0],i=u.children[1],r=n._getFirstShadeCell(m),o=n._getFirstShadeCell(v,!0),f=n._getFirstShadeCell(v,!0,!0);if(g=parseFloat(h.style.height)/a*(c+1),e.style.top=o.style.top,e.style.left=r.style.left,l){e.style.width=parseFloat(t.style.left)-parseFloat(r.style.left)+"px",e.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+parseFloat(h.style.height)+"px";const l=n._getFirstShadeCell(m,void 0,!0),a=u.children[2];i.style.width=parseFloat(l.style.left)+parseFloat(l.style.width)-parseFloat(r.style.left)-parseFloat(e.style.width)+"px",i.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+"px",i.style.top=o.style.top,i.style.left=parseFloat(r.style.left)+parseFloat(e.style.width)+"px",a.style.top=parseFloat(i.style.top)+parseFloat(i.style.height)+"px",a.style.left=i.style.left,a.style.width=t.style.width,a.style.height=g*(s/d)+"px"}else e.style.width=parseFloat(t.style.left)+parseFloat(t.style.width)-parseFloat(r.style.left)+"px",e.style.height=parseFloat(h.style.top)-parseFloat(o.style.top)+g*(s/d)+"px",i.style.top=parseFloat(e.style.top)+parseFloat(e.style.height)+"px",i.style.left=r.style.left,i.style.width=parseFloat(t.style.left)-parseFloat(r.style.left)+"px",i.style.height=parseFloat(f.style.top)+parseFloat(f.style.height)-parseFloat(i.style.top)+"px"}}}_getFirstShadeCell(e,t,n){const i=(t?this.$.timelineHeaderVerticalContent:this.$.timelineHeaderHorizontalContent).querySelectorAll(".smart-scheduler-view-time .smart-scheduler-cell"),r=e.group;if(!r)return n?i[i.length-1]:i[0];let l;for(let e=0;e<i.length;e++){const t=i[e],a=t.$.cellObj.group;if(a&&Object.keys(a).every((e=>a[e]===r[e]))&&(l=t,!n))return l}return l}_getCellShadeRangesByDate(){const e=this,t=e.viewType.indexOf("timeline")>-1,n=new Date,i=n.getFullYear(),r=n.getMonth(),l=n.getDate(),a=n.getHours(),o=e.$.timelineHeaderHorizontalContent.querySelectorAll(".smart-scheduler-view-time .smart-scheduler-cell"),s=e.$.timelineHeaderVerticalContent.querySelectorAll(".smart-scheduler-cell"),d=e=>{let t,i;for(let r=0;r<s.length;r++){if(i=s[r],!i.$)continue;const l=new Date(i.$.cellObj.date);l.setDate(e.getDate());const a=l.getTime()||0;if(!t&&a<=n.getTime()&&(t=i),t&&a>n.getTime())break}return t&&i?{from:t,to:i}:void 0},c=e=>e.getFullYear()===i&&e.getMonth()===r&&e.getDate()===l;let u,h,m,v=[];for(let e=0;e<o.length;e++){const i=o[e],r=i.$.cellObj.date;!u&&r.getTime()<=n.getTime()&&(u=i),!c(r)||t&&r.getHours()!==a||(m=d(r),h=m?i:h,h&&(m=d(h.$.cellObj.date),m&&v.push({hFrom:u,hTo:h,vFrom:m.from,vTo:m.to})),u=void 0),h=i}return u&&!v.length&&(h=o[o.length-1],(h.$?h.$.cellObj.date.getTime():0)>n.getTime()&&(h=u),m=h.$?d(h.$.cellObj.date):void 0,m&&v.push({hFrom:u,hTo:h,vFrom:m.from,vTo:m.to})),v}_refreshTimelineHeaderCells(e){const t=this;e||(e="horizontal",t._refreshTimelineHeaderCells("vertical")),"horizontal"===e&&t.$.timelineViewAllDay.offsetHeight&&(t.$.timelineViewAllDaylabel.innerHTML=`<div>${t.localize("allDay")}</div>`);const[n,i,r,l]="horizontal"===e?["scrollLeft","left","width",t.$.timelineHeaderHorizontalContent]:["scrollTop","top","height",t.$.timelineHeaderVerticalContent],a=t.$.timelineTimeZoneLabelContainer,o=t.timeZones,s=t.rightToLeft,d=l.querySelector(".smart-scheduler-view-time"),c=t.viewType,u=c.indexOf("timeline")>-1,h=d.children,m=t[n],v=t._timelineCells[e];let g,f;for(let e=0;e<v.length;e++){const t=v[e];if(m<=t[i]+t[r]){g=e;break}}(a.parentElement&&!u&&"agenda"!==c&&"vertical"===e||u&&"horizontal"===e)&&(f=a.children);for(let n=0;n<h.length;n++){const l=h[n],a=l.children;let d=g;if(f){const e=o.find((e=>e.id===l.timeZone));f[n]&&(f[n].innerHTML=e?`<div>${e.label}</div>`:"")}for(let n=0;n<a.length;n++){const o=a[n],c=v[d];if(!c)break;d++,o.$={cellObj:c},o.innerHTML=`<div>${c.noLabel?"":t._getDateString({date:new Date(c.date),timeZone:l.timeZone},e)}</div>`,o.style[r]=c[r]+"px","horizontal"===e?s?(o.style.left="",o.style.right=c[i]+"px"):(o.style.right="",o.style.left=c[i]+"px"):o.style[i]=c[i]+"px",c.weekend?o.setAttribute("weekend",""):o.removeAttribute("weekend"),c.nonworking?o.setAttribute("nonworking",""):o.removeAttribute("nonworking"),c.separator?o.setAttribute("separator",""):o.removeAttribute("separator"),c.groupSeparator?o.setAttribute("group-separator",""):o.removeAttribute("group-separator"),c.showLabel?o.setAttribute("show-label",c.showLabel):o.removeAttribute("show-label"),c.restricted?o.setAttribute("restricted",""):o.removeAttribute("restricted")}}t._refreshHeaderDetailCells(e),t._refreshHeaderGroupCells(e),l[n]="scrollLeft"===n?t._getScrollLeft(t[n]):t[n]}_refreshHeaderGroupCells(e){const t=this,n=t._timelineCells.groups,i=t.$.groupsContainer,r=t.groupByDate;let l,a,o,s,d;if(!i)return;if(d=i.querySelector(".smart-scheduler-view-header-groups-container"),s="horizontal"===e?t.$.timelineHeaderHorizontal:t.$.timelineHeaderVertical,!n||!d||!s.contains(d))return;[l,a,o]="vertical"===e?["top","height","scrollTop"]:["left","width","scrollLeft"];let c=d.children,u=document.createDocumentFragment();for(;c.length;)u.appendChild(d.firstElementChild);c=u.children;for(let i=0;i<c.length;i++){const o=c[i],s=n[i];t._refreshAdditionalHeaderCells({orientation:e,fragment:o,type:"groups",offset:l,size:a,cellsObj:s[r?"cellsByDate":"cells"],resource:s.resource})}d.appendChild(u),t.$.groupsContainer.querySelector(".smart-scheduler-view-groups-content")[o]="scrollLeft"===o?t._getScrollLeft(t[o]):t[o]}_refreshHeaderDetailCells(e,t){const n=this,i=n._timelineCells.details;let r,l,a,o;if(!i||"horizontal"!==e||"timelineWeek"!==n.viewType)return;if(a=n.$.timelineHeaderHorizontalContent,o=a.querySelector(".smart-scheduler-view-details"),!o)return;[r,l]=["left","width"];let s=o.children,d=document.createDocumentFragment();for(;s.length;)d.appendChild(o.firstElementChild);n._refreshAdditionalHeaderCells({orientation:e,fragment:d,type:"details",offset:r,size:l,cellsObj:i,refreshContentOnly:t}),o.appendChild(d)}_refreshAdditionalHeaderCells(e){const t=this,n="agenda"===t.viewType,i=e.orientation,r=e.fragment,[l,a,o,s,d]=[e.type,e.offset,e.size,e.cellsObj,e.resource],c=t._getFirstCellObjInView({orientation:i,type:l,resource:d});if(!c)return;t._recycleContainerCells({fragment:r,cellsNeeded:t._getTimelineVisibleCellsCount({orientation:i,type:l,resource:d})});const u=Array.from(r.children),h=s.indexOf(c),m=t.rightToLeft,v="top"===a?a:"left";for(let e=0;e<u.length;e++){const r=u[e],d=s[h+e];if(r.$={cellObj:d},"groups"===l){if(!d[o]&&n){r.remove();continue}t._setGroupContent(r)}else{const e=d.date;r.innerHTML=`<div>${d.noLabel?"":t._getDateString({date:new Date(e)},i,!0)}</div>`}if(d.groupSeparator?r.setAttribute("group-separator",""):r.removeAttribute("group-separator"),d.separator?r.setAttribute("separator",""):r.removeAttribute("separator"),d.group){const e=d.group;for(const t in e)r.setAttribute(t,e[t]||"")}r.style.top=r.style.left=r.style.width=r.style.height=null,r.style[o]=d[o]+"px","left"===v?m?(r.style.left="",r.style.right=d[a]+"px"):(r.style.right="",r.style.left=d[a]+"px"):(r.style.left="",r.style.right="",r.style[v]=d[a]+"px")}}_createWindow(e){const t=this,n=e?e+"SchedulerWindow":"schedulerWindow";if(t.$[n])return t.$[n];const i=document.createElement("smart-window");return i.classList.add("smart-scheduler-window"),e?(i.classList.add(e),i.id=t.id+"ConfirmWindow"):i.id=t.id+"Window",i.setAttribute("smart-id",n),t.$[n]=i,t["$"+n]=Smart.Utilities.Extend(i),i.rightToLeft=t.rightToLeft,i.theme=t.theme,i.animation=t.animation,i.disableSnap=!0,i.headerButtons=["close"],i}_openWindow(e,t){const n=this;if(!e&&!(e=n._createEventFromSelection()))return;if([n.$.schedulerWindow,n.$.confirmSchedulerWindow].some((e=>e&&e.opened))||n.disableWindowEditor)return;const i=t?"confirm":"";function r(){function t(){n._positionWindow(),l.opened?(l.bringToFront(),l._handleActiveState(),l._onOpenCallback&&l._onOpenCallback()):l.open()}if(n.windowCustomizationFunction?n.windowCustomizationFunction(l,i,n._cloneObject(e)):(n._setPopupWindowTemplate("header",i),n._setPopupWindowTemplate("footer",i),n._setPopupWindowTemplate("content",i)),!l.opened){const e=n["$"+(i?i+"SchedulerWindow":"schedulerWindow")];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.unlisten("change"),e.unlisten("keydown"),i||(l._onOpenCallback=()=>{((l.shadowRoot||l).querySelector(".smart-input")||l).focus({preventScroll:!0})}),l.hasAnimation&&e.listen("transitionend",n._windowTransitionendHandler.bind(n)),e.listen("open",n._windowOpenHandler.bind(n)),e.listen("close",n._windowCloseHandler.bind(n)),e.listen("closing",n._windowClosingHandler.bind(n)),e.listen("click",n._windowClickHandler.bind(n)),e.listen("change",n._windowChangeHandler.bind(n)),e.listen("keydown",n._windowKeyDownHandler.bind(n))}l.shadowRoot?(l.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),n._onShadowDomLoaded(l,"smart.window.css",t)):t();const r=(n.getAttribute("aria-owns")||"")+" "+l.id;n.setAttribute("aria-owns",r.trim())}if(!e)return;const l=n._createWindow(i);n.$.fireEvent("editDialogOpening",{target:l,type:i,item:n._cloneObject(e)}).defaultPrevented||(l._target={event:e,originalTarget:t},l.parentElement||n.getShadowRootOrBody().appendChild(l),l.isCompleted?r():l.whenReady((()=>r())))}_positionWindow(){const e=this,t=e.getShadowRootOrBody(),n=[e.$.schedulerWindow,e.$.confirmSchedulerWindow];for(let i=0;i<n.length;i++){const r=n[i];if(!r||!t.contains(r))continue;const l=e.getBoundingClientRect();if(r.opened||(r.style.left=r.style.top=""),r.querySelector(".smart-scheduler-window-repeat")){const e=r.offsetWidth;!r.hasAttribute("horizontal")&&2*e<=l.width?r.setAttribute("horizontal",""):r.hasAttribute("horizontal")&&e>l.width&&r.removeAttribute("horizontal")}else r.removeAttribute("horizontal");e._isMobile?(r.setAttribute("mobile",""),r.style.left=l.left+window.pageXOffset+"px",r.style.top=l.top+window.pageYOffset+"px",r.style.width=l.width+"px",r.style.height=l.height+"px"):(r.style.left=Math.max(l.left+window.pageXOffset,l.left+window.pageXOffset+l.width/2-r.offsetWidth/2)+"px",r.style.top=Math.max(l.top+window.pageYOffset,l.top+window.pageYOffset+l.height/2-r.offsetHeight/2)+"px")}}_windowTransitionendHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;let i,r;n.classList.contains("confirm")?(i=t.$.confirmSchedulerWindow,r=t.$confirmSchedulerWindow):(i=t.$.schedulerWindow,r=t.$schedulerWindow),i.opened||"visibility"!==e.propertyName||(r.unlisten("transitionend"),i.remove())}_windowOpenHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow,r=n._target.event;i&&(t._handleModal(!0),n===t.$.schedulerWindow?t.$.fireEvent("editDialogOpen",{target:e.target,editors:t._windowEditors,item:t._cloneObject(r)}):t.$.fireEvent("editDialogOpen",{target:e.target,item:t._cloneObject(r)}),i.unlisten("open"))}_windowClosingHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow;if(i){const r={target:e.target,item:t._cloneObject(e.target._target.event)};if(n===t.$.schedulerWindow&&(r.editors=t._windowEditors),t.$.fireEvent("editDialogClosing",r).defaultPrevented)return void e.preventDefault();if(i.unlisten(e.type),t.hasAttribute("aria-owns")){const e=t.getAttribute("aria-owns").replace(i.id,"").trim();e?t.setAttribute("aria-owns",e):t.removeAttribute("aria-owns")}}}_windowCloseHandler(e){const t=this,n=e.target;if(!n.classList.contains("smart-scheduler-window"))return;const i=n.classList.contains("confirm")?t.$confirmSchedulerWindow:t.$schedulerWindow;if(i){const r=e.target._target.event;t._handleModal(),n===t.$.schedulerWindow?t.$.fireEvent("editDialogClose",{target:e.target,editors:t._windowEditors,item:t._cloneObject(r)}):t.$.fireEvent("editDialogClose",{target:e.target,item:t._cloneObject(r)}),i.unlisten("close"),i.unlisten("click"),i.unlisten("keydown"),t.hasAttribute("aria-owns")&&t.removeAttribute("aria-owns"),t.hasAnimation||i.remove();const l=t._getEventCell(n._target.originalTarget||r);(l||t.$.timeline).focus({preventScroll:!0})}}_getEventCell(e){if(e instanceof HTMLElement&&(e=e.$.event),!e)return;const t=this.$.timelineEventsContainer.children;for(let n=0;n<t.length;n++){const i=t[n],r=i.$?i.$.event:void 0;if(!r)continue;const l=r.$?r.$.event:void 0;if(r===e||l&&(l===e||e.$&&l===e.$.event))return i}}_windowChangeHandler(e){const t=this,n=e.target,i=n.closest(".smart-scheduler-window.confirm")?t.$.confirmSchedulerWindow:t.$.schedulerWindow;if(e.stopPropagation(),i!==t.$.schedulerWindow)return;const r=n.closest(".smart-scheduler-window-editor"),l=r?r.getAttribute("type"):void 0;if(l)if(l.indexOf("repeatEnd")>-1){const e=n.closest(".smart-scheduler-window-editor[multiple]");if(e){const t=e.children;for(let e=0;e<t.length;e++){const i=t[e],r=i.querySelector("[event-editor]");r&&(r.disabled=!i.contains(n))}}}else if(t._windowEditors&&n.hasAttribute("event-editor"))if("allDay"!==l)if("repeat"!==l){if("repeatFreq"===l)return t._setPopupWindowEditor(t._windowEditors.repeatOn),void t._setPopupWindowEditor(t._windowEditors.repeatInterval);"dateStart"!==l&&"dateEnd"!==l?"resources"!==l||t._setResourceDataEditor(t._windowEditors.resourceData):t._handleEditorDateValidation(n)}else i._target.event&&(t._createWindowEditor("repeat"),t._positionWindow());else t._handleEditorAllDay(n,i)}_windowKeyDownHandler(e){const t=this,n=e.target.closest(".smart-scheduler-window.confirm")?t.$.confirmSchedulerWindow:t.$.schedulerWindow;if(e.stopPropagation(),n!==t.$.schedulerWindow||"Enter"!==e.key)return;const i=n.getRootNode().activeElement,r=t._windowEditors,l=n._target.event;l&&r&&r.label&&r.label.contains(i)&&(t._updateEventViaWindow(l,r),n.close(),delete n._target)}_handleEditorDateValidation(e){const t=this,n=t._windowEditors.dateStart,i=t._windowEditors.dateEnd,r=t._windowEditors.allDay?t._windowEditors.allDay.querySelector("[event-editor]"):void 0;if(!n||!i)return;const l=n.querySelector("[event-editor]"),a=i.querySelector("[event-editor]"),o={dateStart:l.value.toDate(),dateEnd:a.value.toDate(),allDay:!!r&&r.checked};e===l?(o.type="end",a.value=t._getValidDate(o)):e===a&&(o.type="start",l.value=t._getValidDate(o))}_handleEditorAllDay(e){const t=this,n=t._windowEditors.dateStart,i=t._windowEditors.dateEnd;if(!n||!i)return;const r=n.querySelector("[event-editor]"),l=i.querySelector("[event-editor]"),a=e.checked;let o=r.value.toDate(),s=l.value.toDate();if(a){const e={dateStart:o,dateEnd:s,allDay:a,type:"start"};r.formatString="yyyy-MMM-dd",l.formatString="yyyy-MMM-dd",o.setHours(t.hourStart,0,0,0),s.setHours(t.hourEnd,0,0,0),r.value=t._getValidDate(e),e.type="end",l.value=t._getValidDate(e)}else{const e=t.hourStart,n=t.$.schedulerWindow;n&&n._target?(o=n._target.event.dateStart,s=n._target.event.dateEnd):(s=new Date(o),o.setHours(e,0,0,0),s.setHours(e,60/t._getCellsScaleCount(),0,0)),r.value=o,l.value=s,r.formatString="yyyy-MMM-dd HH:mm",l.formatString="yyyy-MMM-dd HH:mm"}}_windowClickHandler(e){const t=this;let n=(e.originalEvent||e).target;n.shadowRoot&&(n=(e.originalEvent||e).composedPath()[0]);const i=n.closest(".smart-scheduler-window.confirm")?t.$.confirmSchedulerWindow:t.$.schedulerWindow,r=n.closest(".smart-scheduler-window-button"),l=t._windowEditors,a=i._target.event;i&&r&&(r.classList.contains("ok")&&l?t._updateEventViaWindow(a,l):r.classList.contains("delete")&&t._deleteEventViaWindow(a),i.close(),delete i._target,r.classList.contains("edit-event")?(a.date||(a.date=new Date(a.dateStart)),delete a.repeat,t._openWindow(a)):r.classList.contains("edit-series")&&a.$&&t._openWindow(a.$.event))}_deleteEventViaWindow(e){const t=this,n=t._events.indexOf(e),i=e.$?e.$.event:void 0;if(i){const n=i.repeat?i.repeat.exceptions:void 0,r=n?n.indexOf(e):void 0;r>-1&&(n.splice(r,1),t._refreshTimelineEvents())}else if(n>-1){t._events.splice(n,1),t._refreshTimelineEvents(),t._updateUndoRedo(t._cloneObject(e),void 0,"itemRemove");const i=t._cloneObject(e);t.$.fireEvent("itemRemove",{item:i}),t.$.fireEvent("itemChange",{type:"remove",item:i})}}_updateEventViaWindow(e,t){const n=this,i=n._events.indexOf(e),r=e.$?e.$.event:void 0;if(n._updateEventSettings(e,t),i<0)if(r){if(r.repeat){const t=r.repeat;t.exceptions||(t.exceptions=[]);const n=t.exceptions;delete t.repeat,n.indexOf(e)<0&&t.exceptions.push(e)}}else{n._events.push(e),n._updateUndoRedo(void 0,n._cloneObject(e),"itemInsert");const t=n._cloneObject(e);n.$.fireEvent("itemInsert",{item:t}),n.$.fireEvent("itemChange",{type:"insert",item:t})}else{const t=n._cloneObject(e);n.$.fireEvent("itemUpdate",{item:t}),n.$.fireEvent("itemChange",{type:"update",item:t})}n._validateEventDateRange(e),n._refreshTimelineEvents()}_updateEventSettings(e,t){const n=this,i=Object.keys(t);for(let r=0;r<i.length;r++){const l=i[r],a=t[l].querySelectorAll("[event-editor]"),o=a[0];if(o)switch(l){case"allDay":e[l]=o.checked,o.checked&&(e.dateStart.setHours(0,0,0,0),e.dateEnd.setHours(23,59,59,999),e.dateEnd=n._getValidDate({dateStart:e.dateStart,dateEnd:e.dateEnd,allDay:!0,type:"end"}));break;case"dateEnd":case"dateStart":{const t=o.value.toDate();let i,r;"dateStart"===l?(i=t,r=e.dateEnd):(i=e.dateStart,r=t),r=n._getValidDate({dateStart:i,dateEnd:r,type:"end"}),n._isEventRestricted({dateStart:i,dateEnd:r})||(e.dateStart=i,e.dateEnd=r);break}case"description":case"label":e[l]=o.value;break;case"exceptions":e.repeat&&o.checked&&delete e.repeat.exceptions;break;case"notifications":o.value.length?e.notifications=o.value.slice(0):delete e.notifications;break;case"hidden":e.$&&e.$.event&&(e[l]=o.checked);break;case"backgroundColor":e[l]=o.value,e[l]||delete e[l];break;case"resources":n._updateEventResources(e,t,o);break;case"resoruceData":break;case"status":{const t=n.statuses[o.selectedIndex];t&&t.value?e[l]=t.value:delete e[l];break}default:n._updateEventRepeating(e,t,l,a)}}}_updateEventResources(e,t,n){const i=this.resources;if(!n.value)return void i.forEach((t=>delete e[t.value]));const r=t.resourceData.querySelectorAll(".smart-scheduler-window-editor[resource-type]");let l,a=[];for(let t=0;t<r.length;t++){const n=r[t],o=n.querySelector("[event-editor]"),s=n.getAttribute("resource-type");if(!o||o.value&&o.selectedIndex<0){a.push(s);continue}const d=i.find((e=>e.value===s));if(d){const t=d.dataSource[o.selectedIndex];l=!0,t?(e[s]=t.id,a.push(s)):delete e[s]}}l&&i.forEach((t=>{a.indexOf(t.value)<0&&delete e[t.value]}))}_updateEventRepeating(e,t,n,i){const r=i[0];if("repeat"===n)r.checked?e.repeat=e.repeat||{}:delete e.repeat;else{if(n.toLowerCase().indexOf("repeat")<0||!e.repeat)return;"object"!=typeof e.repeat&&(e.repeat={});const l=e.repeat;switch(n){case"repeatEnd":case"repeatEndAfter":case"repeatEndOn":{const e=t[n].querySelector(".smart-radio-button");if(e&&e.checked){const e=r.value;l.repeatEnd="repeatEndOn"===n?e.toDate():parseInt(e)}break}case"repeatFreq":l[n]=r.value.toLowerCase();break;case"repeatInterval":l[n]=parseInt(r.value);break;case"repeatOn":switch(l.repeatFreq){case"weekly":l[n]=r.selectedValues;break;case"monthly":l[n]=r.value;break;case"yearly":{const e=i[1]?parseInt(i[1].value):0;l[n]={month:r.selectedIndex,date:e};break}}}}}_updateUndoRedo(e,t,n){const i=this;if(!t&&!e)return void delete i._undoRedoHistory;let r=i._undoRedoHistory;if(r||(r=i._undoRedoHistory={currentStep:1,steps:[]}),n){const l=r.currentStep;l!==r.steps.length&&(r.steps=l<1?[]:r.steps.slice(0,l)),r.steps.length===i.undoRedoSteps&&r.steps.shift(),r.steps.push({oldValue:e,newValue:t,action:n,timeStamp:Date.now()})}r.currentStep=Math.max(1,r.steps.length)}_isUndoPossible(){const e=this._undoRedoHistory;if(e)return e.steps.length&&e.currentStep>0}_isRedoPossible(){const e=this._undoRedoHistory;if(!e)return;const t=e.steps;return t.length&&e.currentStep<t.length}_handleUndoRedo(e="undo",t){const n=this,i=n._undoRedoHistory;if(!i)return;const r=i.steps,l="undo"===e?0:1,a=r[(isNaN(t)?i.currentStep+l:t)-1];if(a){const t=n._events;let o,s,d;switch("undo"===e?a.newValue&&!a.oldValue?(s="delete",o=a.newValue):!a.newValue&&a.oldValue?(s="insert",o=a.oldValue):a.newValue&&a.oldValue&&(s="update",o=a.oldValue):a.newValue&&!a.oldValue?(s="insert",o=a.newValue):!a.newValue&&a.oldValue?(s="delete",o=a.oldValue):a.newValue&&a.oldValue&&(s="update",o=a.newValue),s){case"insert":d=o,t.push(d);break;case"delete":d=n._containsEvent(o),d&&t.splice(t.indexOf(d),1);break;case"update":if(d=n._containsEvent(a.newValue),d){for(let e in d)delete d[e];const e=n._cloneObject(o);for(let t in e)d[t]=e[t]}}if(d)return i.currentStep=Math.max(0,r.indexOf(a)+l),n.$.tooltip.close(),n.closeWindow(),n._refreshTimelineEvents(),n.$.fireEvent(a.action,{operation:e,eventObj:n._cloneObject(d),itemDateRange:{dateStart:new Date(o.dateStart),dateEnd:new Date(o.dateEnd)}}),n.unfocusable||n.$.timeline.focus({preventScroll:!0}),!0}}_getValidDate(e){const[t,n,i,r]=[e.dateStart,e.dateEnd,e.type,e.allDay||"start"];let l=new Date(t),a=new Date(n);if(isNaN(l)||isNaN(a)||n.getTime()>t.getTime())return"start"===i?l:a;for("start"===i?l=new Date(a):a=new Date(l);l.getTime()>=a.getTime();){const e=l.getTime();"start"===i?(l.setHours(l.getHours()-1),l.getTime()===e&&l.setHours(l.getHours()-2)):(a.setHours(a.getHours()+1),a.getTime()===e&&a.setHours(a.getHours()+2))}return r&&l.getFullYear()===a.getFullYear()&&l.getMonth()===a.getMonth()&&l.getDate()===a.getDate()&&("start"===i?(l.setHours(0,0,0,0),l.setDate(a.getDate()-1)):(a.setHours(0,0,0,0),a.setDate(a.getDate()+1))),"start"===i?l:a}_handleModal(e){const t=this;let n=(t.shadowRoot||t).querySelector(".smart-scheduler-window-modal");e?(n||(n=document.createElement("div"),n.classList.add("smart-scheduler-window-modal")),n.parentElement||(t.$.container.appendChild(n),t.setAttribute("modal",""))):n&&n.parentElement&&(n.parentElement.removeChild(n),t.removeAttribute("modal"))}_onShadowDomLoaded(e,t,n){requestAnimationFrame((function i(){const r=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<r.length;e++)if(-1!==r[e].href.indexOf(t))return void n();requestAnimationFrame(i)}))}_setPopupWindowTemplate(e,t){const n=this,i=n.$[t?t+"SchedulerWindow":"schedulerWindow"];if(!i)return;if("content"===e)return void n._setWindowContent(t);if(i[e+"Template"]||(i[e+"Template"]=n._createWindowTemplate(e,t)),t)return void n._setWindowTypeSection(e,t);const r=i._target.event,l=r.$&&r.$.event,a=n._events.indexOf(r)<0&&!l;let o;if(l&&l.repeat.exceptions&&(o=l.repeat.exceptions.indexOf(r)>-1),"header"===e){const e=(i.shadowRoot||i).querySelector(".smart-scheduler-window-label");r&&e&&(e.innerHTML=a?n.localize("newEvent"):l&&!o?n.localize("eventException"):r.label)}else if("footer"===e){const e=(i.shadowRoot||i).querySelectorAll(".smart-scheduler-window-button");for(let t=0;t<e.length;t++){const i=e[t];i.innerHTML='<span class="smart-icon"></span>',i.theme=n.theme,i.rightToLeft=n.rightToLeft,i.animation=n.animation,i.classList.contains("ok")?(i.innerHTML+=n.localize("ok"),i.setAttribute("aria-label","ok")):i.classList.contains("cancel")?(i.innerHTML+=n.localize("cancel"),i.setAttribute("aria-label","cancel")):i.classList.contains("delete")&&(i.innerHTML+=n.localize("delete"),i.setAttribute("aria-label","delete"),i.classList[a||l&&!o?"add":"remove"]("smart-hidden"));const r=i.querySelector(".smart-ripple");r&&r.parentElement.removeChild(r)}}}_setWindowTypeSection(e,t){const n=this,i=n.$[t?t+"SchedulerWindow":"schedulerWindow"];if(t&&i)if("confirm"!==t);else if("header"===e){const e=(i.shadowRoot||i).querySelector(".smart-scheduler-window-label");e&&(e.innerHTML=n.localize("repeatConfirmLabel"))}else if("footer"===e){const e=(i.shadowRoot||i).querySelectorAll(".smart-scheduler-window-button");for(let t=0;t<e.length;t++){const i=e[t];i.theme=n.theme,i.rightToLeft=n.rightToLeft,i.animation=n.animation,i.classList.contains("edit-event")?(i.innerHTML=n.localize("editEvent"),i.setAttribute("aria-label","edit-event")):i.classList.contains("edit-series")&&(i.innerHTML=n.localize("editSeries"),i.setAttribute("aria-label","edit-series"));const r=i.querySelector(".smart-ripple");r&&r.parentElement.removeChild(r)}}}_setWindowContent(e){const t=this,n=t.$[e?e+"SchedulerWindow":"schedulerWindow"];if(e){let i=n.querySelector(".smart-scheduler-confirm-label");if(!n.content||n.content.innerHTML&&!i)return;return i||(i=document.createElement("label"),i.classList.add("smart-scheduler-confirm-label"),n.appendChild(i)),void("confirm"===e&&i&&(i.innerHTML=t.localize("repeatConfirm")))}const i=n._target.event,r=[].slice.call(n.getElementsByClassName("smart-scheduler-window-editor"));n.innerHTML&&!r.length||i&&(t._createWindowEditor(),t._createWindowEditor("repeat"),i.id&&n.setAttribute("aria-controls",i.id))}_createWindowEditor(e="main"){const t=this,n=t.$.schedulerWindow,i=n._target.event,r=t._windowEditors;let l=n.querySelector(".smart-scheduler-window-content-wrapper"),a=n.querySelector(`.smart-scheduler-window-${e}`),o=i.repeat,s=i.$&&i.$.event;if(r&&r.repeat){const e=r.repeat.querySelector("[event-editor]");e&&(o=e.checked)}if(l||(l=document.createElement("div"),l.classList.add("smart-scheduler-window-content-wrapper"),n.appendChild(l)),"repeat"===e&&(!o||s))return void(a&&a.remove());if(!a){if(r){const t="main"===e?r.label:r.repeatFreq;t&&(a=t.closest(`.smart-scheduler-window-${e}`))}a||(a=document.createElement("div"),a.classList.add(`smart-scheduler-window-${e}`),a.innerHTML=t._getWindowEditorTemplate(e))}l.contains(a)||l.appendChild(a);const d=a.querySelectorAll(".smart-scheduler-window-editor[type]");for(let e=0;e<d.length;e++)t._setPopupWindowEditor(d[e])}_getWindowEditorTemplate(e){return e&&"main"!==e?"repeat"===e?'\n                <div class="smart-scheduler-window-editor" type="repeatFreq">\n                    <label></label>\n                    <smart-input readonly event-editor drop-down-button-position="right"></smart-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeatInterval">\n                    <label></label>\n                    <smart-number-input min="1" event-editor></smart-number-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeatOn" multiple>\n                    <label></label>\n                </div>\n                <div class="smart-scheduler-window-editor" multiple>\n                    <div class="smart-scheduler-window-editor" type="repeatEnd">\n                        <label></label>\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                    </div>\n                    <div class="smart-scheduler-window-editor" type="repeatEndOn">\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                        <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                        enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                    </div>\n                    <div class="smart-scheduler-window-editor" type="repeatEndAfter">\n                        <smart-radio-button group-name="repeat"></smart-radio-button>\n                        <smart-number-input min="1" event-editor></smart-number-input>\n                        <label></label>\n                    </div>\n                </div>\n                <div class="smart-scheduler-window-editor smart-hidden" type="exceptions">\n                    <label></label>\n                    <smart-check-box event-editor></smart-check-box>\n                </div>':void 0:'\n            <div class="smart-scheduler-window-editor" type="label">\n                <label></label>\n                <smart-input event-editor></smart-input>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="dateStart">\n                    <label></label>\n                    <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                    enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                </div>\n                <div class="smart-scheduler-window-editor" type="dateEnd">\n                    <label></label>\n                    <smart-date-time-picker calendar-button drop-down-append-to="body" event-editor\n                        enable-mouse-wheel-action drop-down-display-mode="auto"></smart-date-time-picker>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor" type="description">\n                <label></label>\n                <smart-text-area event-editor></smart-text-area>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="allDay">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n                <div class="smart-scheduler-window-editor" type="hidden">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n                <div class="smart-scheduler-window-editor" type="repeat">\n                    <label></label>\n                    <smart-switch-button event-editor></smart-switch-button>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor" type="notifications">\n                <label></label>\n                <smart-notification-panel event-editor></smart-notification-panel>\n            </div>\n            <div class="smart-scheduler-window-editor" multiple>\n                <div class="smart-scheduler-window-editor" type="backgroundColor">\n                    <label></label>\n                    <smart-color-input event-editor></smart-color-input>\n                </div>\n                <div class="smart-scheduler-window-editor" type="status">\n                    <label></label>\n                    <smart-input event-editor></smart-input>\n                </div>\n            </div>\n            <div class="smart-scheduler-window-editor smart-hidden" type="resources">\n                <label></label>\n                <smart-check-input event-editor disabled></smart-check-input>\n            </div>\n            <div class="smart-scheduler-window-editor smart-hidden" multiple type="resourceData"></div>\n            </div>'}_setPopupWindowEditor(e){const t=this,n=e.getAttribute("type"),i=e.querySelector("label"),r=t.$.schedulerWindow._target.event,l=r.$&&r.$.event;let a=e.querySelector("[event-editor]");if(!r)return;t._windowEditors||(t._windowEditors={});const o=t._windowEditors,s=t.rightToLeft;if(o[n]||(o[n]=e),i&&(i.id=t.id+n+"Label",i.innerHTML=t.localize(n)),"label"===n||"description"===n)a.value=void 0!==r[n]?r[n]+"":"";else if(n.indexOf("date")>-1){const e=!!r.allDay;a.formatString=e?"yyyy-MMM-dd":"yyyy-MMM-dd HH:mm",a.calendarButtonPosition=s?"left":"right",a.value=new Date(r[n])}else if("allDay"===n||"repeat"===n)a.checked=!!r[n],e.classList["repeat"===n&&l?"add":"remove"]("smart-hidden");else if("notifications"===n)t._setNotificationEditor(e,a);else if("repeatFreq"===n){const e=["hourly","daily","weekly","monthly","yearly"],n=r.repeat?(r.repeat.repeatFreq+"").toLowerCase():e[0];a.dataSource=[{label:t.localize(e[0]),value:e[0]},{label:t.localize(e[1]),value:e[1]},{label:t.localize(e[2]),value:e[2]},{label:t.localize(e[3]),value:e[3]},{label:t.localize(e[4]),value:e[4]}],a.value=t.localize(e.indexOf(n)>-1?n:e[0])}else if("repeatInterval"===n){const e=parseInt(r.repeat?r.repeat.repeatInterval:void 0);if(a.value=isNaN(e)?1:e,i&&o.repeatFreq){const e=o.repeatFreq.querySelector("[event-editor]");if(e){const n={hourly:"repeatEveryHour",daily:"repeatEveryDay",weekly:"repeatEveryWeek",monthly:"repeatEveryMonth",yearly:"repeatEveryYear"},r=e.dataSource[Math.max(0,e.selectedIndex)].value||"";i.innerHTML+=` (${t.localize(n[r.toLowerCase()])||""})`}}}else if("repeatOn"===n)t._setRepeatOnEditor(e,a);else if(n.indexOf("repeatEnd")>-1){let i=r.repeat?r.repeat.repeatEnd:void 0,l=i;switch(n){case"repeatEnd":l=!l;break;case"repeatEndOn":l=l instanceof Date;break;case"repeatEndAfter":l="number"==typeof l&&!isNaN(l)}const o=e.querySelector(".smart-radio-button");o&&(o.innerHTML=t.localize(n+"Option"),o.checked=l,t._setEditorCommonProperties(o)),a&&(a instanceof Smart.DateTimePicker?(i=new Date(i),a.formatString="yyyy-MMM-dd",a.calendarButtonPosition=s?"left":"right",a.value=l&&!isNaN(i.getTime())?i:new Date):(i=parseInt(i),a.value=l&&!isNaN(i)?i:1),a.disabled=o&&!o.checked)}else if("exceptions"===n){const n=!l&&r.repeat&&r.repeat.exceptions&&r.repeat.exceptions.length;a.checked=!1,a.innerHTML=t.localize("resetExceptions"),e.classList[n?"remove":"add"]("smart-hidden")}else if("hidden"===n)a.checked=!!r[n],e.classList[l?"remove":"add"]("smart-hidden");else if("backgroundColor"===n){a.dataSource||(a.dataSource=r.colorScheme||t.colorScheme);const e=a.$.scrollView;e&&e.classList.add("smart-scheduler-color-input"),a.valueDisplayMode="colorBox",a.value=r.backgroundColor||""}else"status"===n?t._setStatusEditor(e,a):"resources"===n?t._setResourceEditor(e,a):"resourceData"===n&&t._setResourceDataEditor(e);a&&i&&a.setAttribute("aria-labelledby",i.id),t._setEditorCommonProperties(a)}_setEditorCommonProperties(e){const t=this;if(e){const n=e.messages,i=t.messages,r=t.locale;if(n)for(let e in n.en){const t=i[r][e];void 0!==t&&(n[r]||(n[r]={}),n[r][e]=t)}e.locale=t.locale,e.rightToLeft=t.rightToLeft,e.animation=t.animation,e.theme=t.theme}}_setNotificationEditor(e,t){const n=this,i=n.$.schedulerWindow._target.event;i?(t.value=Array.isArray(i.notifications)?i.notifications.slice():[],t.hourStart=n.hourStart,t.hourFormat=n.hourFormat,t.minuteFormat=n.minuteFormat,t.timeZone=n.timeZone,n._setEditorCommonProperties(t)):t.value=[]}_setStatusEditor(e,t){const n=this,i=n.statuses,r=n.$.schedulerWindow._target.event;if(!r||!i.length)return void e.classList.add("smart-hidden");const l=r.status,a=i.find((e=>e.value===l));e.classList.remove("smart-hidden"),t.dataSource=n.statuses.map((e=>{const t=void 0===e.value?"none":e.value;return e.label=n.localize(t)||t})),t.value=a?n.localize(a.label)||a.label:"",t.readonly=!0,t.placeholder=n.localize("selectPlaceholder"),t.dropDownButtonPosition=n.rightToLeft?"left":"right",n._setEditorCommonProperties(t)}_setResourceEditor(e,t){const n=this,i=n.resources,r=n.$.schedulerWindow._target.event;let l=[],a=[];r&&i.length?(e.classList.remove("smart-hidden"),l=i.map((e=>(e&&r[e.value]&&a.push(e.label),{label:e.label,value:e.value}))),t.readonly=!0,t.placeholder=n.localize("selectPlaceholder"),t.dropDownButtonPosition=n.rightToLeft?"left":"right",t.disabled=!i.length,t.dataSource=l,t.value=a.toString(),n._setEditorCommonProperties(t),t.wait&&(t.wait=!1)):e.classList.add("smart-hidden")}_setResourceDataEditor(e){const t=this,n=t.resources,i=t.$.schedulerWindow._target.event;let r,l,a=Array.from(e.querySelectorAll(".smart-scheduler-window-editor")),o=[];if(i&&n.length){t._windowEditors.resources&&(l=t._windowEditors.resources.querySelector("[event-editor]"),l&&l.value&&(r=l.selectedValues));for(let l=0;l<n.length;l++){const s=n[l],d=s.label,c=s.value,u=s.dataSource;if(!u||!r)continue;const h=r.length;if(h&&r.indexOf(c)>-1||!h&&i[c]){const n=u.find((e=>s&&e.id===i[c]));let r,l,h=a.find((e=>e.getAttribute("resource-type")===c));h?(r=h.querySelector("label"),l=h.querySelector("[event-editor]")):(h=document.createElement("div"),r=document.createElement("label"),l=document.createElement("smart-input"),l.setAttribute("event-editor",""),h.appendChild(r),h.appendChild(l),h.classList.add("smart-scheduler-window-editor"),h.setAttribute("resource-type",c),e.appendChild(h)),o.push(h),t._setEditorCommonProperties(l),r.innerHTML=t.localize(d)||d,l.dataSource=s.dataSource.map((e=>Object.create({label:e.label,value:e.value}))),l.value=n?n.label:"",l.dropDownButtonPosition=t.rightToLeft?"left":"right",l.readonly=!0,l.placeholder=t.localize("selectPlaceholder")}}for(let e=0;e<a.length;e++)o.indexOf(a[e])<0&&a[e].remove();e.classList.remove("smart-hidden")}else e.classList.add("smart-hidden")}_setRepeatOnEditor(e){const t=this,n=t.$.schedulerWindow._target.event,i=t._windowEditors,r=i.repeatOn,l=i.repeatFreq.querySelector("[event-editor]").value.toLowerCase();let a,o=n.repeat?n.repeat.repeatOn:void 0;if(!n||!l||["weekly","monthly","yearly"].indexOf(l)<0)return void e.classList.add("smart-hidden");r.$||(r.$={});const s=r.$;for(let e in s)e!==l&&s[e]&&s[e].remove();void 0===o&&(o=new Date(n.dateStart));let d=s[l];switch(l){case"weekly":d||(d=document.createElement("smart-button-group"),d.dataSource=t._getWeekDays(),d.selectionMode="zeroOrMany",d.setAttribute("event-editor",""),s[l]=d),t._setEditorCommonProperties(d),d.selectedValues=t._getRepeatOnCondition(l,o).map((e=>e.toString()));break;case"monthly":d||(d=document.createElement("smart-number-input"),d.min=1,d.max=31,d.setAttribute("event-editor",""),s[l]=d),t._setEditorCommonProperties(d),d.value=t._getRepeatOnCondition(l,o).toString();break;case"yearly":{let e,n;if(!d){d=document.createElement("div");const e=document.createElement("smart-input"),n=document.createElement("smart-number-input");e.dataSource=t._getMonthNames(),e.dropDownButtonPosition=t.rightToLeft?"left":"right",e.readonly=!0,n.min=1,n.max=31,e.setAttribute("event-editor",""),n.setAttribute("event-editor",""),t._setEditorCommonProperties(e),t._setEditorCommonProperties(n),d.appendChild(e),d.appendChild(n),d.classList.add("smart-scheduler-window-editor"),s[l]=d}e||(e=d.querySelector("smart-input")),n||(n=d.querySelector("smart-number-input")),a=t._getRepeatOnCondition(l,o),e.selectedIndex=a.index,n.value=a.value.toString();break}}d=s[l],e.contains(d)||e.appendChild(d),e.classList.remove("smart-hidden")}_getMonthNames(){const e=[],t=this.monthFormat,n=this.locale,i=new Date;i.setMonth(0);for(let r=0;r<12;r++)e.push({label:new Intl.DateTimeFormat(n,{month:t}).format(i),value:i.getMonth()}),i.setMonth(i.getMonth()+1);return e}_getWeekDays(){const e=this,t=[],n=e.weekdayFormat,i=e.locale,r=new Date;r.setDate(r.getDate()-r.getDay()+e.firstDayOfWeek);for(let e=0;e<7;e++)t.push({label:new Intl.DateTimeFormat(i,{weekday:n}).format(r),value:r.getDay()}),r.setDate(r.getDate()+1);return t}_createWindowTemplate(e,t){const n=this,i=n.animation,r=n.theme,l=n.rightToLeft,a=document.createElement("template");return"footer"===e?t?"confirm"===t&&(a.innerHTML=`\n                    <smart-button class="smart-scheduler-window-button edit-event"\n                        animation="${i}" theme="${r}" ${l?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button edit-series"\n                        animation="${i}" theme="${r}" ${l?"right-to-left":""}>\n                    </smart-button>`):a.innerHTML=`<smart-button class="smart-scheduler-window-button ok primary"\n                        animation="${i}" theme="${r}" ${l?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button cancel"\n                        animation="${i}" theme="${r}" ${l?"right-to-left":""}>\n                    </smart-button>\n                    <smart-button class="smart-scheduler-window-button delete secondary"\n                        animation="${i}" theme="${r}" ${l?"right-to-left":""}>\n                    </smart-button>`:"header"===e&&(a.innerHTML='<span class="smart-scheduler-window-label"></span>'),a}_currentTimeIndicatorIntervalValidator(e,t){return Math.max(1,t)}_hourValidator(e,t){return Math.max(0,Math.min(23,t))}_datesValidator(e,t){const n=this;let i=[];for(let e=0;e<t.length;e++){const r=n._parseDate(t[e]);isNaN(r)||(r.setHours(0,0,0,0),i.push(r))}return i}_dateValidator(e,t){return t=this._parseDate(t),this._minMaxDateValidator(isNaN(t)?e:t)}_parseDate(e){let t;if(e instanceof Date)return e;if(Smart.Utilities.DateTime&&e instanceof Smart.Utilities.DateTime)return e.toDate();if("string"==typeof e){const n=/\d+:\d+:\d+/;if("new Date()"===e.trim()||"new Smart.Utilities.DateTime()"===e.trim())return new Date;if(isNaN(Date.parse(e))){const i=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(i.test(e)){const r=i.exec(e)[0].replace(/[,-.\/]/g,",").split(",");if(3===r.length){const[i,l]=parseInt(r[0])<parseInt(r[2])?[r[0],r[2]]:[r[2],r[0]];if(t=new Date(parseInt(l),parseInt(r[1])-1,parseInt(i)),n.test(e)){const i=n.exec(e)[0].split(":");t.setHours(i[0]||0,i[1]||0,i[2]||0)}e=t}}}else t=new Date(Date.parse(e)),n.test(e)||t.setHours(0,0,0,0),e=t}return new Date(e)}_firstDayOfWeekValidator(e,t){return Math.min(6,Math.max(0,t))}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=new Date(this.min),n=new Date(this.max);return t&&(e=new Date(Math.max(t.getTime(),e.getTime()))),n&&(e=new Date(Math.min(n.getTime(),e.getTime()))),e}_nonworkingDayValidator(e,t){return this._nonworkingDateTimeValidator(e,t)}_nonworkingTimeValidator(e,t){return this._nonworkingDateTimeValidator(e,t,!0)}_nonworkingDateTimeValidator(e,t,n){let i=[];const[r,l]=[0,n?23:6];for(let e=0;e<t.length;e++){const a=t[e];if("number"!=typeof a||isNaN(a))if(Array.isArray(a)){let e=Math.max(r,Math.min(l,parseInt(a[0]))),t=Math.max(r,Math.min(l,parseInt(a[1])));if(!isNaN(e)&&!isNaN(t)){for(;e!==t;)i.push(e),e=e===l?r:++e;i.push(e)}}else{const e=this._dateValidator(a,a);e instanceof Date&&i.push(n?e.getHours():e.getDay())}else i.push(Math.max(r,Math.min(l,parseInt(a))))}return i}_setViewType(e){const t=this,n=t.views.find((t=>t.value&&t.value===e));e=n?n.type:e,t.set("viewType",t.properties.viewType.allowedValues.indexOf(e)>-1?e:"day")}_timeZoneValidator(e,t){const n=this,i=(new Smart.Utilities.DateTime).timeZones;t||(t="local"),t=t.toLowerCase();const r=i.find((e=>e.id.toLowerCase()===t));return r?r.id:(n.error(n.localize("invalidTimeZone",{elementType:n.nodeName.toLowerCase()})),e)}_timeZonesValidator(e,t){const n=this;let i=[];for(let e=0;e<t.length;e++){const r=t[e],l=r.id||r;null!==n._timeZoneValidator(null,l)&&i.push({id:l,label:r.label||l})}return i}_viewValidator(e,t){const n=this;return n._isViewUpdated=!0,n._setViewType(t),delete n._isViewUpdated,t}_viewTypeValidator(e,t){return this._isViewUpdated?t:e}_viewsValidator(e,t){const n=this,i=n.properties.viewType.allowedValues;let r=[];for(let e=0;e<t.length;e++){const l=t[e];"string"==typeof l&&i.includes(l)?r.push(l):"object"==typeof l&&i.includes(l.type)&&(l.value=l.value||l.type,l.label=void 0===l.label?n.localize(l.type):l.label+"",r.push(l))}return r}}),Smart("smart-notification-panel",class extends Smart.BaseElement{static get properties(){return{hourStart:{value:0,type:"number"},hourFormat:{value:"numeric",allowedValues:["numeric","2-digit"],type:"string"},messages:{extend:!0,value:{en:{beforeAt:"before at",days:"days",weeks:"weeks",placeholder:"Add notification",hours:"Hours",minutes:"Minutes",am:"am",pm:"pm"}},type:"object"},minuteFormat:{value:"2-digit",allowedValues:["numeric","2-digit"],type:"string"},placeholder:{value:"placeholder",type:"string"},timeZone:{value:"local",type:"string"},value:{value:[],type:"array"}}}template(){return'<div id="container" role="presentation">\n                    <div id="notificationsContainer" class="smart-notification-container" role="group"></div>\n                    <div id="placeholder" class="smart-notification-placeholder" role="button"></div>\n                    <smart-input wait right-to-left="[[rightToLeft]]" readonly id="typeInput" class="smart-notification-editor smart-hidden"></smart-input>\n                    <smart-time-input wait right-to-left="[[rightToLeft]]" id="timeInput" class="smart-notification-editor smart-hidden"></smart-time-input>\n                    <smart-number-input wait right-to-left="[[rightToLeft]]" id="intervalInput" class="smart-notification-editor smart-hidden"></smart-number-input>\n                </div>'}static get listeners(){return{"document.click":"_clickHandler",keydown:"_keyDownHandler","container.change":"_containerChangeHandler"}}static get requires(){return{"Smart.Input":"smart.input.js","Smart.TimeInput":"smart.timeinput.js","Smart.NumberInput":"smart.numberinput.js"}}propertyChangedHandler(e,t,n){const i=this;if("placeholder"!==e){if("rightToLeft"===e){const e=n?"left":"right";i.$.typeInput.dropDownButtonPosition=e,i.$.intervalInput.dropDownButtonPosition=e}else"locale"===e?(i.$.placeholder.textContent=i.localize(i.placeholder),i._handleNotificationEditors()):super.propertyChangedHandler(e,t,n);i._handleNotifications()}else i.$.placeholder.textContent=i.localize(i.placeholder)}render(){const e=this;e.hasAttribute("role")||e.setAttribute("role","dialog"),e.$.placeholder.textContent=e.localize(e.placeholder),e._handleNotifications(),e._handleNotificationEditors(),e._setFocusable(),super.render()}_setFocusable(){const e=this,t=e.$.placeholder;if(e.disabled||e.unfocusable)return e.removeAttribute("tabindex"),void t.removeAttribute("tabindex");const n=e.tabIndex>0?e.tabIndex:0;e.tabIndex=n,t.setAttribute("tabindex",n);const i=e.$.notificationsContainer.children;for(let e=0;e<i.length;e++){const t=i[e];Array.from(t.children).forEach((e=>{e instanceof HTMLLabelElement||(e.tabIndex=n)}))}}_keyDownHandler(e){const t=this;if(t.disabled||t.readonly)return;const n=e.target;switch(e.key){case"Enter":(n.closest(".smart-notification-item")||n.closest(".smart-notification-placeholder"))&&(e.preventDefault(),t._clickHandler({target:n}));break;case"Escape":case"Tab":t._hideEditor()}}_clickHandler(e){const t=this;let n=e.target;if(!n||!n.closest||!t.$.container.contains(n)||t.disabled||t.readonly)return void t._hideEditor();if(n.closest(".smart-notificaiton-editor"))return;if(n.closest(".smart-notification-placeholder"))return t._createNotificaiton(),void t._hideEditor();const i=n.closest(".smart-notification-item");if(!i){if(t._editor&&!t._editor.classList.contains("smart-hidden")&&n.closest(".smart-notification-editor"))return;return void t._hideEditor()}t._hideEditor();const r=i._notificationObj;if(n.hasAttribute("delete"))return void t._deleteNotification(i);const l=n.closest(".smart-input");if(!l)return;let a;n.hasAttribute("interval")?(a=t.$.intervalInput,a.value=r.interval,a.min=0,a.max="days"===r.type?28:4):n.hasAttribute("type")?(a=t.$.typeInput,a.value=a.dataSource.find((e=>e.value===r.type)).label):n.hasAttribute("time")&&(a=t.$.timeInput,a.dateTimeFormat={hour:t.hourFormat,minute:t.minuteFormat},a.value=r.time),a._notificationObj=r,a.classList.remove("smart-hidden"),a.wait=!1,a.style.width=l.offsetWidth+"px",a.style.height=l.offsetHeight+"px",a.style.top=l.offsetTop+"px",a.style.left=l.offsetLeft+"px",a&&a.open(),t._editor=a}_hideEditor(){const e=this,t=e._editor;if(!t)return;const n=e._editor._notificationObj;n&&(t===e.$.timeInput?n.time=t.value:t===e.$.typeInput?n.type=t.value:n.interval=t.value,e._refreshNotificationItem(n)),t.close&&t.close(),e._editor.classList.add("smart-hidden"),delete e._editor}_createNotificaiton(){const e=this,t=e._notifications;if(!t)return;const n={interval:1,type:"days",time:[e.hourStart,0]};t.push(n),e._refreshNotificationItems()}_deleteNotification(e){const t=this._notifications;if(!t||!e)return;const n=e._notificationObj;if(delete e._notificationObj,e.remove(),!n)return;const i=t.indexOf(n);i<0||(t.splice(i,1),this._refreshNotificationItems())}_containerChangeHandler(e){const t=this,n=e.target,i=n._notificationObj;n===t.$.timeInput?i.time=n.value:n===t.$.typeInput?i.type=n.dataSource.find((e=>e.label===n.value)).value:n===t.$.intervalInput&&(i.interval=n.value),t._refreshNotificationItem(i)}_refreshNotificationItem(e){const t=this,n=t.$.notificationsContainer.children;for(let i=0;i<n.length;i++){const r=n[i];if(r._notificationObj===e){let n=new Date;n.setHours(e.time[0],e.time[1]);const i=r.children;for(let r=0;r<i.length;r++){const l=i[r];l.hasAttribute("interval")?l.textContent=e.interval:l.hasAttribute("type")?l.textContent=t.localize(e.type)||e.type:l.hasAttribute("time")&&(l.textContent=n.toLocaleTimeString(t.locale,{hour:t.hourFormat,minute:t.minuteFormat}))}}}}_refreshNotificationItems(){const e=this,t=e.$.notificationsContainer,n=e._notifications;for(;t.firstElementChild;)delete t.firstElementChild._notificationObj,t.firstElementChild.remove();if(n&&n.length){const i=document.createDocumentFragment();for(let t=0;t<n.length;t++)i.appendChild(e._createNotificationItem(n[t]));i.children.length&&t.appendChild(i)}e._setFocusable(),e.set("value",n)}_handleNotifications(){const e=this,t=e.value;let n;e.$.notificationsContainer.innerHTML="",n=e._notifications=[];for(let e=0;e<t.length;e++){const i=t[e];let r=i.interval,l=i.type,a=i.time;if(void 0===r||void 0===l||void 0===a)continue;a instanceof Date?a=[a.getHours(),a.getMinutes()]:Array.isArray(a)||(a=[]),l=l&&"days"!==l?"weeks":"days","days"===l?r=Math.max(0,Math.min(28,r)):(l="weeks",r=Math.max(0,Math.min(4,r))),a[0]=Math.max(0,Math.min(23,a[0]||0)),a[1]=Math.max(0,Math.min(59,a[1]||0));const o={interval:r,type:l,time:a};n.push(o)}e._refreshNotificationItems()}_createNotificationItem(e){const t=this,n=document.createElement("div");n.classList.add("smart-notification-item"),n.setAttribute("role","group");let i=new Smart.Utilities.DateTime(new Date).toDate(t.timeZone);return i.setHours(e.time[0],e.time[1]),n.innerHTML=`\n            <div class="smart-input" interval>${e.interval}</div>\n            <div class="smart-input" type>${t.localize(e.type)||e.type}</div>\n            <label>${t.localize("beforeAt")||""}</label>\n            <div class="smart-input" time>${i.toLocaleTimeString(t.locale,{hour:t.hourFormat,minute:t.minuteFormat})}</div>\n            <div class="smart-button" delete aria-label="Delete" role="button"></div>`,n._notificationObj=e,n}_handleNotificationEditors(){const e=this,t=e.rightToLeft,n=e.locale,i=e.theme,r=e.$.intervalInput,l=e.$.typeInput,a=e.$.timeInput,o=e.messages;[r,l,a].forEach((e=>{const r=e.messages;for(let e in r.en){const t=o[n][e];void 0!==t&&(r[n]||(r[n]={}),r[n][e]=t)}e.rigtToLeft=t,e.locale=n,e.theme=i}));const s=t?"left":"right";a.dropDownButtonPosition="none",l.dropDownButtonPosition=s,r.dropDownButtonPosition=s,l.dataSource=[{label:e.localize("days"),value:"days"},{label:e.localize("weeks"),value:"weeks"}]}});