
/* Smart HTML Elements v6.0.0 (2020-Jan) 
Copyright (c) 2011-2020 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-input",class extends Smart.BaseElement{static get properties(){return{autoCompleteDelay:{value:100,type:"number"},dataSource:{type:"any",value:[]},dropDownDataSource:{type:"any",value:[]},dropDownHeight:{type:"any",value:200},dropDownWidth:{type:"any",value:null},dropDownButtonPosition:{allowedValues:["none","left","right"],value:"none",type:"string"},inputPurpose:{type:"string",value:"off"},items:{type:"number",value:8},minLength:{type:"number",value:1},name:{value:"",type:"string"},opened:{value:!1,type:"boolean"},query:{type:"string",value:""},queryMode:{allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string",value:"containsIgnoreCase"},placeholder:{value:"",type:"string"},readonly:{type:"boolean",value:!1},sorted:{value:!1,type:"boolean"},sortDirection:{value:"asc",type:"string"},type:{type:"string"},value:{type:"string",value:""}}}static get styleUrls(){return["smart.textbox.css"]}template(){return"<div id=\"inputContainer\" role=\"presentation\"><input class=\"smart-input\" id='input' readonly='[[readonly]]' placeholder='[[placeholder]]' type='[[type]]' name='[[name]]' value='{{value::keyup}}' disabled='[[disabled]]' aria-label=\"[[placeholder]]\" /><div id=\"dropDownButton\" tabindex=-1 class=\"smart-drop-down-button\" role=\"button\" aria-label=\"Toggle popup\"><div id=\"arrow\" class=\"arrow\" aria-hidden=\"true\"></div></div></div>"}static get listeners(){return{"input.focus":"_focusHandler","input.blur":"_blurHandler","input.keydown":"_keyDownHandler","input.keyup":"_keyUpHandler","input.keypress":"_keyPressHandler","dropDownButton.down":"_dropDownButtonDownHandler","inputContainer.down":"_downHandler","document.up":"_documentUpHandler"}}focus(){const a=this;a.$.input.focus()}select(){const a=this;a.readonly?a.$.input.focus():a.$.input.select()}_documentUpHandler(a){const b=this,c=b.shadowRoot||b.isInShadowDOM?a.originalEvent.composedPath()[0]:a.originalEvent.target;return c===b||c===b.$.dropDownButton||c===b.$.input||c===b.$.arrow?void 0:b.$.scrollView.contains(c.shadowParent||c)?void(b._isPointerDown&&(b._isPointerDown=!1,b.opened&&(b._preventLookup=!0),b.$.input.focus())):void(b.opened&&(b._preventLookup=!0),b._isPointerDown=!1,b.close())}_focusHandler(){const a=this;return a.setAttribute("focus",""),a.readonly||0!==a.minLength||0!==a.$.input.value.length||a._preventLookup?void delete a._preventLookup:void a._lookup()}_blurHandler(){const a=this;a.opened||a.removeAttribute("focus"),delete a._preventLookup}_refreshMenu(){const a=this;a.$.menu.classList.remove("scroll"),a.$.scrollView.computedVerticalScrollBarVisibility&&a.$.menu.classList.add("scroll")}_performSelect(){const a=this,b=a.$.menu.querySelector(".active"),c=b.getAttribute("data-label"),d=b.getAttribute("value"),e=a.value,f=a.$.input.dataValue;a.value=c,a.$.input.dataValue=d,(c!==e||d!==f)&&a.$.fireEvent("change",{value:d,label:c,oldValue:f,oldLabel:e}),a.close()}_offsetTop(a){const b=this;return a?a.offsetTop+b._offsetTop(a.offsetParent)-(a.offsetParent?a.offsetParent.verticalScrollBarVisibility?0:a.offsetParent.scrollTop:0):0}_offsetLeft(a){const b=this;return a?a.offsetLeft+b._offsetLeft(a.offsetParent)-(a.offsetParent?a.offsetParent.horizontalScrollBarVisibility?0:a.offsetParent.scrollLeft:0):0}_offset(a){return{left:this._offsetLeft(a),top:this._offsetTop(a)}}_open(){const a=this,b=a._offset(a);this.opened||(a.timer&&clearTimeout(a.timer),document.body.appendChild(a.$.scrollView),a.setAttribute("aria-owns",a.$.scrollView.id),!a.readonly&&a.$.input.setAttribute("aria-controls",a.$.scrollView.id),a.$.scrollView.enableShadowDOM&&!a._importedStyle&&(a.$.scrollView.importStyle(a._getStyleUrl("smart.textbox.css")),a._importedStyle=!0),a.$.scrollView.style.setProperty("--smart-input-drop-down-menu-width",""),a.$.scrollView.style.left=-3+b.left+"px",a.$.scrollView.style.top=b.top+a.offsetHeight+1+"px",a.$.scrollView.classList.remove("open"),a.$.scrollView.onpointerdown=function(){a._isPointerDown=!0},requestAnimationFrame(function(){var b=Math.max;const c=a.dropDownWidth;if(a.$.scrollView.refresh&&a.$.scrollView.refresh(),a._refreshMenu(),a.$.scrollView.setAttribute("open",""),a.setAttribute("open",""),a.$.dropDownButton.setAttribute("open",""),a.$.input.setAttribute("open",""),c&&"string"==typeof c&&-1!==c.indexOf("%")){const b=parseFloat(c)/100;a.$.scrollView.style.setProperty("--smart-input-drop-down-menu-width",a.offsetWidth*b+"px")}else if("auto"!==c&&c)a.$.scrollView.style.setProperty("--smart-input-drop-down-menu-width",parseFloat(c)+"px");else if("auto"===c)a.$.scrollView.style.setProperty("--smart-input-drop-down-menu-width","");else{a.$.menu.style.width="auto";let c=a.$.menu.offsetWidth;const d=a.$.menu.querySelectorAll("li");for(let c=0;c<d.length;c++)a._maxDropDownWidth=b((d[c].firstElementChild||d[c]).offsetWidth,a._maxDropDownWidth);a.$.scrollView.computedVerticalScrollBarVisibility&&(c+=a.$.scrollView.$&&a.$.scrollView.$.verticalScrollBar?a.$.scrollView.$.verticalScrollBar.offsetWidth:30),a.$.scrollView.style.setProperty("--smart-input-drop-down-menu-width",b(c,a.offsetWidth-8)+"px"),a.$.menu.style.width=""}(a.shadowRoot||a.isInShadowDOM)&&a.$.scrollView._scrollView&&Smart.ScrollBar&&requestAnimationFrame(()=>a.$.scrollView._scrollView.vScrollBar.refresh())}),a.$.scrollView.refresh&&a.$.scrollView.refresh(),a._refreshMenu(),this.opened=!0,a.setAttribute("aria-expanded",!0))}close(){const a=this;return!!a.opened&&(a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.$.scrollView.parentNode&&!a.opened&&(document.body.removeChild(a.$.scrollView),a.removeAttribute("aria-owns"),!a.readonly&&a.$.input.removeAttribute("aria-controls"))},1e3),a.$.scrollView.removeAttribute("open"),a.$.dropDownButton.removeAttribute("open"),a.$.input.removeAttribute("open"),a.removeAttribute("open"),a.opened=!1,a.setAttribute("aria-expanded",!1),a.$.input.focus(),!0)}_lookup(a){const b=this;let c=[];return b.query=b.$.input.value,b.$.input.readonly&&(!b._incrementalSearchQuery&&(b._incrementalSearchQuery=""),b._incrementalSearchQuery+=a.key,b._incrementalSearchTimer&&clearTimeout(b._incrementalSearchTimer),b.query=b._incrementalSearchQuery,b._incrementalSearchTimer=setTimeout(function(){b._incrementalSearchQuery=""},700)),b.query.length<b.minLength?void b.close():void(c="function"==typeof b.dataSource?b.dataSource(b.query):b.dataSource,clearTimeout(b._autoCompleteTimeout),b._autoCompleteTimeout=setTimeout(function(){const a=b.context;b.context=b,b._process(c),b.context=a},b.autoCompleteDelay))}_downHandler(a){const b=this;b.readonly&&b._dropDownButtonDownHandler(a)}_dropDownButtonDownHandler(a){const b=this;return b._toggle(),a.preventDefault(),a.stopPropagation(),a.originalEvent.preventDefault(),a.originalEvent.stopPropagation(),!1}_toggle(){const a=this;a.opened?a.close():a.open()}open(){const a=this;let b;a.dropDownDataSource?(a.query="",b="function"==typeof a.dataSource?a.dataSource(a.query):a.dataSource):b="function"==typeof a.dropDownDataSource?a.dropDownDataSource(a.query):a.dropDownDataSource,a._process(b);const c=a.$.menu.querySelector(".active");if(c){const b=a.$.input.dataValue;for(let d=0;d<a.$.menu.children.length;d++){const e=a.$.menu.children[d],f=e.getAttribute("data-label"),g=e.getAttribute("value");if(b!==void 0&&g===b||b===void 0&&f===a.$.input.value){c.classList.remove("active"),e.classList.add("active"),a._setActiveDescendant(e),a.$.input.dataValue=g;break}}}a.ensureVisible(),a.$.input.focus(),setTimeout(function(){a.$.input.focus()},25)}_process(a){const b=this;"string"==typeof a&&(a=b.$.deserialize(a,"array")),a=a.filter(function(a){return b.matcher?b.matcher(a):b._matcher(a)}),a=b._sorter(a),b.sorted&&(a.sort((c,a)=>void 0===c.label?c.localeCompare(a):c.label.localeCompare(a.label)),"desc"===b.sortDirection&&a.reverse()),!a.length&&b.opened&&b.close();0===a.length||(0<b.query.length?b._render(a.slice(0,b.items)):b._render(a),b._open(),b.$.scrollView.refresh&&b.$.scrollView.refresh(),b._refreshMenu(),b.ensureVisible())}_matcher(a){const b=this,c=b.query;switch(a=a.label||a,b.queryMode){case"startsWith":return a.startsWith(c);case"startsWithIgnoreCase":return a.toLowerCase().startsWith(c.toLowerCase());case"doesNotContain":return 0>a.indexOf(c);case"doesNotContainIgnoreCase":return 0>a.toLowerCase().indexOf(c.toLowerCase());case"contains":return-1<a.indexOf(c);default:case"containsIgnoreCase":return~a.toLowerCase().indexOf(c.toLowerCase());case"equals":return 0===a.localeCompare(c);case"equalsIgnoreCase":return 0===a.toLowerCase().localeCompare(c.toLowerCase());case"endsWith":return a.endsWith(c);case"endsWithIgnoreCase":return a.toLowerCase().endsWith(c.toLowerCase());}}_sorter(a){const b=this;let c,d=[],e=[],f=[];for(;c=a.shift();){const a=c.label||c;a.toLowerCase().indexOf(b.query.toLowerCase())?~a.indexOf(b.query)?e.push(c):f.push(c):d.push(c)}return d.concat(e,f)}_highlighter(a){const b=this,c=b.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+c+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})}_render(a){function b(){const a=c.$.menu.getElementsByClassName("active");a[0]&&a[0].classList.remove("active"),this.classList.add("active"),c._setActiveDescendant(this)}const c=this,d=a.map(function(a){let b=a,d=a;"object"==typeof a&&(b=a.label,d=a.value||b);const e=document.createElement("li"),f=document.createElement("a");return f.href="#",e.id=c.id+"Item"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),e.setAttribute("data-label",b),e.setAttribute("value",d),e.setAttribute("role","option"),e.setAttribute("aria-label",b),f.innerHTML=c.highlighter?c.highlighter(b):c._highlighter(b),f.setAttribute("aria-hidden",!0),a.icon&&(f.classList.add("icon"),f.classList.add(a.icon)),e.appendChild(f),e});0<d.length&&(d[0].classList.add("active"),c._setActiveDescendant(d[0])),c.$.menu.innerHTML="";for(let e=0;e<d.length;e++){const a=d[e];c.$.menu.appendChild(a),a.onmouseenter=b,a.onmouseleave=function(){this.classList.remove("active"),c._setActiveDescendant(null)},a.onclick=b}}ensureVisible(){const a=this,b=a.$.menu.querySelector(".active");b&&(b.offsetTop+b.offsetHeight>=a.$.scrollView.scrollTop+a.$.scrollView.offsetHeight&&(a.$.scrollView.scrollTop=b.offsetTop+b.offsetHeight),(b.offsetTop<=a.$.scrollView.scrollTop||b.offsetTop>=a.$.scrollView.scrollTop+a.$.scrollView.offsetHeight)&&(a.$.scrollView.scrollTop=b.offsetTop),0===[...a.$.menu.children].indexOf(b)?a.$.scrollView.scrollTop=0:[...a.$.menu.children].indexOf(b)===a.$.menu.children.length-1&&(a.$.scrollView.scrollTop=a.$.scrollView.scrollHeight))}_next(){const a=this,b=a.$.menu.querySelector(".active");if(!b){const b=a.$.menu.firstElementChild;return b.classList.add("active"),void a._setActiveDescendant(b)}b.classList.remove("active");let c=b.nextElementSibling;c||(c=a.$.menu.firstElementChild),c.classList.add("active"),a._setActiveDescendant(c),a.ensureVisible()}_prev(){const a=this,b=a.$.menu.querySelector(".active");if(!b){const b=a.$.menu.firstElementChild;return b.classList.add("active"),void a._setActiveDescendant(b)}b.classList.remove("active");let c=b.previousElementSibling;c||(c=a.$.menu.lastElementChild),c.classList.add("active"),a._setActiveDescendant(c),a.ensureVisible()}_move(a){const b=this;if(b.opened){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),b._prev();break;case 40:a.preventDefault(),b._next();}a.stopPropagation()}}_keyDownHandler(a){const b=this;b._suppressKeyPressRepeat=![40,38,9,13,27,16,17,18].includes(a.keyCode);a.shiftKey||a.altKey||a.ctrlKey||b._move(a)}_keyPressHandler(a){const b=this;b._suppressKeyPressRepeat||a.shiftKey||a.altKey||a.ctrlKey||b._move(a)}_keyUpHandler(a){const b=this;if(!(a.shiftKey||a.altKey||a.ctrlKey))switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:40===a.keyCode&&a.altKey&&b.open(),38===a.keyCode&&a.altKey&&b.close();break;case 9:case 13:if(!b.opened)return;b._performSelect(),a.stopPropagation(),a.preventDefault();break;case 27:if(!b.opened)return;b.close(),a.stopPropagation(),a.preventDefault();break;default:b._lookup(a),!b.opened||a.ctrlKey||a.shiftKey||(a.stopPropagation(),a.preventDefault()),b.$.input.dataValue=b.$.input.value;}}propertyChangedHandler(a,b,c){super.propertyChangedHandler(a,b,c);const d=this;if("dropDownHeight"===a)d.$.scrollView.style.setProperty("--smart-input-drop-down-menu-height",d.dropDownHeight+"px");else if("opened"===a)d.opened=b,c?d.open():d.close();else if(!("placeholder"===a))"readonly"===a?(d._setAriaRelations(),d._setInputPurpose()):"theme"===a||"rightToLeft"===a?d.$.scrollView[a]=c:"inputPurpose"===a&&d._setInputPurpose();else if(d.readonly){const a=d.getAttribute("aria-label");if(a&&a!==b)return;c?d.setAttribute("aria-label",c):d.removeAttribute("aria-label")}}render(){const a=this;a._createElement&&a._createElement(),a.opened&&(a.opened=!1,a.open());const b=a.$.scrollView,c=a.$.menu;c.setAttribute("role","presentation"),b.appendChild(c),b.style.setProperty("--smart-input-drop-down-menu-height",a.dropDownHeight+"px"),b.classList.add("smart-input-drop-down-menu"),b.id=a.id+"_"+a.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),b.ownerElement=a,a._setAriaRelations(),a._setInputPurpose(),super.render()}_createElement(){const a=this,b=document.createElement("ul"),c=document.createElement("smart-scroll-viewer");c.rightToLeft=a.rightToLeft,c.theme=a.theme,c.horizontalScrollBarVisibility="hidden",a.$.scrollView=c,a.$.menu=b,a.$.menu.onclick=function(b){b.stopPropagation(),b.preventDefault(),a._performSelect(),a.$.input.focus()}}_setAriaRelations(){const a=this,b=a.getAttribute("aria-label");a.readonly?(a.setAttribute("role","button"),!b&&a.placeholder&&a.setAttribute("aria-label",a.placeholder),a.removeAttribute("aria-readonly"),a.$.input.setAttribute("aria-hidden",!0),a.$.input.removeAttribute("aria-activedescendant"),a.$.input.removeAttribute("aria-controls"),a.$.dropDownButton.setAttribute("aria-hidden",!0)):(a.setAttribute("role","combobox"),b&&b===a.placeholder&&a.removeAttribute("aria-label"),a.$.input.setAttribute("role","searchbox"),a.$.input.removeAttribute("aria-hidden",!0),a.$.dropDownButton.removeAttribute("aria-hidden")),a.setAttribute("aria-expanded",a.opened),a.setAttribute("aria-haspopup","listbox"),a.$.scrollView.setAttribute("role","listbox")}_setActiveDescendant(a){const b=this;b.readonly||(a?b.setAttribute("aria-activedescendant",a.id):b.removeAttribute("aria-activedescendant"))}_setInputPurpose(){const a=this;a.readonly?a.$.input.removeAttribute("autocomplete"):a.$.input.setAttribute("autocomplete",a.inputPurpose)}});